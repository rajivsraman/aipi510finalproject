(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    922125,      21117]
NotebookOptionsPosition[    904340,      20857]
NotebookOutlinePosition[    904920,      20877]
CellTagsIndexPosition[    904877,      20874]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Dataset Generator Notebook", "Title",
 CellChangeTimes->{{3.941427242237813*^9, 3.941427248886351*^9}, {
  3.941427285212565*^9, 3.9414272976888847`*^9}, {3.941427491004162*^9, 
  3.941427493965931*^9}},ExpressionUUID->"304f5765-109a-4cbf-953b-\
37d160345bfa"],

Cell[TextData[{
 StyleBox["Author - Rajiv Raman",
  FontWeight->"Bold"],
 "\nInstitution - Duke University",
 "\nCourse - AIPI 510: Sourcing Data for Analytics\nAssignment - Final \
Dataset Project"
}], "Subtitle",
 CellChangeTimes->{{3.9414273106633797`*^9, 3.941427541219895*^9}, {
  3.941427696950366*^9, 3.941427697165699*^9}, {3.9414277621366873`*^9, 
  3.941427768826138*^9}},ExpressionUUID->"a887d431-9759-47e8-ad93-\
93d4401927b1"],

Cell[CellGroupData[{

Cell["Overview", "Chapter",
 CellChangeTimes->{{3.941427589915021*^9, 3.941427591965494*^9}, {
  3.941428643897719*^9, 
  3.941428644743903*^9}},ExpressionUUID->"a5c3189b-d446-48d5-ae53-\
e35d28b53d90"],

Cell["\<\
This notebook was used to generate the simulated SABRE-SHEATH dataset that I \
created for my final project in AIPI 510: Sourcing Data for Analytics. I took \
this class in my first semester as a graduate student in the Masters of \
Engineering in Artificial Intelligence for Product Innovation (AIPI) with Dr. \
Brinnae Bent at Duke. Signal Amplification By Reversible Exchange (SABRE) and \
its variants (such as SABRE-SHEATH) are real experiments that can be \
conducted to perform \[OpenCurlyDoubleQuote]hyperpolarization\
\[CloseCurlyDoubleQuote] (increase in signal-to-noise ratio) in nuclear \
magnetic resonance (NMR) spectra. For those who might not have a background \
in chemistry, NMR spectroscopy is an incredibly powerful tool. This \
technology powers a number of important scientific techniques including \
magnetic resonance imaging (MRI), an undeniable revolution in the field of \
diagnostic imaging in medicine. While \[OpenCurlyDoubleQuote]thermally \
polarized\[CloseCurlyDoubleQuote] (in other words, not hyperpolarized) NMR \
spectroscopy can be quite effective, there are many cases where it fails to \
yield a satisfactory result, usually when an NMR-active nucleus besides \
hydrogen-1 is targeted. By overcoming this barrier with hyperpolarization, \
scientists have made scientific breakthroughs both inside and outside of the \
hospital.

Dr. Warren S. Warren runs a lab at Duke that specializes in quantum optimal \
control of the SABRE process, and I have worked in this lab for three years \
now. The lab possesses a unique capability to simulate SABRE experiments to \
high accuracy, which helps in determining which experiments will actually be \
useful to run. By inputting various experimental parameters, we can \
approximate the spin polarization at the end of the experiment, where spin \
polarization is a measure of how much the experiment can grow signal-to-noise \
ratio in an NMR spectrum. So, we generally aim for a higher polarization on \
the target nucleus.

The SABRE-SHEATH dataset is generated by sweeping over a collection of \
parameters that are input into the DMExFR2 simulations. Because these \
calculations take time due to a large number of matrix dot products involved \
with time propagation, it would be beneficial to have a stored dataset of \
calculations that could be referenced instantly. This way, we can observe \
some interesting trends in how single parameter changes affect polarization, \
and we might even be able to expedite the approximation of future \
calculations.\
\>", "Text",
 CellChangeTimes->{{3.941427677764121*^9, 3.9414281743939333`*^9}, {
  3.941428220265814*^9, 
  3.941428776565875*^9}},ExpressionUUID->"47c06549-c1fc-457a-8b9c-\
813a7ee2d643"]
}, Closed]],

Cell[CellGroupData[{

Cell["System Loader", "Chapter",
 CellChangeTimes->{{3.941427589915021*^9, 
  3.9414276263229647`*^9}},ExpressionUUID->"178b57ac-9fcf-4af4-87c5-\
bc695b7132ca"],

Cell[CellGroupData[{

Cell[TextData[{
 StyleBox["System: (3+1)Y",
  FontWeight->"Bold",
  FontVariations->{"Underline"->True},
  FontColor->RGBColor[1., 0.9998626688029297, 0.9999389639124132]],
 StyleBox["\nCalculation: polarization buildup on target nucleus",
  FontColor->RGBColor[1., 0.9998626688029297, 0.9999389639124132]]
}], "Subsection",
 CellChangeTimes->{
  3.900518995750594*^9, {3.900519140223647*^9, 3.900519143653084*^9}, {
   3.911142694810607*^9, 3.911142694996686*^9}, 3.941426382889351*^9, 
   3.941426459608548*^9, {3.941428985307551*^9, 3.941428990127306*^9}},
 FontSize->15,
 FontWeight->"Regular",
 FontColor->GrayLevel[1],
 Background->RGBColor[
  0.042969405661097124`, 0., 
   0.6988479438467994],ExpressionUUID->"d11f4a5f-e484-4594-8fc5-aaffe3dc5dac"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "This", " ", "defines", " ", "the", " ", "number", " ", "and", " ", 
     "type", " ", "of", " ", 
     RowBox[{"spins", ".", " ", "However"}]}], ",", " ", 
    RowBox[{
     RowBox[{
     "you", " ", "will", " ", "pretty", " ", "much", " ", "only", " ", "ever",
       " ", "need", " ", "spin"}], "-", 
     RowBox[{
      RowBox[{"1", "/", "2"}], " ", "nuclei"}]}], ",", " ", 
    RowBox[{
    "which", " ", "are", " ", "denoted", " ", "by", " ", "\"\<h\>\"", " ", 
     "for", " ", 
     RowBox[{"\"\<half\>\"", ".", " ", "The"}], " ", "length", " ", "of", " ",
      "the", " ", "list", " ", "determines", " ", "the", " ", "number", " ", 
     "of", " ", "spins"}], ",", " ", 
    RowBox[{
     RowBox[{
     "so", " ", "in", " ", "this", " ", "case", " ", "we", " ", "have", " ", 
      "a", " ", "3", " ", "spin"}], "-", 
     RowBox[{
      RowBox[{"1", "/", "2"}], " ", 
      RowBox[{"system", "."}]}]}]}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"spins", "=", 
     RowBox[{"Table", "[", 
      RowBox[{"h", ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "This", " ", "is", " ", "a", " ", "function", " ", "defining", " ", 
      "the", " ", "Larmor", " ", "frequency", " ", "of", " ", "the", " ", 
      "different", " ", 
      RowBox[{"nuclei", ".", " ", "It"}], " ", "takes", " ", "the", " ", 
      "argument", " ", "of", " ", "the", " ", "magnetic", " ", "field"}], ",",
      " ", "B0", ",", " ", 
     RowBox[{
      RowBox[{
      "and", " ", "converts", " ", "it", " ", "into", " ", "a", " ", 
       "frequency", " ", "in", " ", "units", " ", "of", " ", "Hz"}], ";", " ", 
      RowBox[{
      "the", " ", "units", " ", "of", " ", "\[Gamma]", " ", "are", " ", "in", 
       " ", 
       RowBox[{"Hz", "/", "\[Mu]T"}], " ", "or", " ", 
       RowBox[{"MHz", "/", 
        RowBox[{"T", ".", " ", "You"}]}], " ", "can", " ", "use", " ", "1", 
       "H"}]}], ",", " ", 
     RowBox[{"13", "C"}], ",", " ", 
     RowBox[{"15", "N"}], ",", " ", 
     RowBox[{"19", "F"}], ",", " ", 
     RowBox[{
     "or", " ", "31", "P", " ", "by", " ", "using", " ", "\[Gamma]H"}], ",", 
     " ", "\[Gamma]C", ",", " ", "\[Gamma]N", ",", " ", "\[Gamma]F", ",", " ", 
     RowBox[{"or", " ", "\[Gamma]P"}], ",", " ", 
     RowBox[{"respectively", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"larmorFreq", "[", "B0_", "]"}], ":=", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"\[Gamma]H", ",", "\[Gamma]H", ",", "\[Gamma]N"}], "}"}], "*", 
      "B0"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Here", " ", "we", " ", "are", " ", "going", " ", "to", " ", "define", 
      " ", "which", " ", "spins", " ", "are", " ", "coupled", " ", "together",
       " ", "in", " ", "the", " ", "variable", " ", 
      RowBox[{"Jcouplings1", ".", " ", "For"}], " ", "instance"}], ",", " ", 
     RowBox[{
      RowBox[{"each", " ", "element", " ", "of", " ", "the", " ", "list", " ", 
       RowBox[{"{", 
        RowBox[{"i", ",", "j"}], "}"}], " ", "will", " ", "be", " ", 
       "couplings", " ", "for", " ", "spin"}], "-", 
      RowBox[{"i", " ", "and", " ", "spin"}], "-", 
      RowBox[{
       RowBox[{"j", ".", " ", "In"}], " ", "the", " ", "same", " ", 
       "order"}]}], ",", " ", 
     RowBox[{
      RowBox[{
      "you", " ", "can", " ", "define", " ", "the", " ", "value", " ", "of", 
       " ", "the", " ", "J"}], "-", 
      RowBox[{"coupling", " ", "in", " ", 
       RowBox[{
       "Jvalues1", ".", "\[IndentingNewLine]", "\[IndentingNewLine]", "You"}],
        " ", "can", " ", "also", " ", "use", " ", "more", " ", "than", " ", 
       "2", " ", "elements", " ", "in", " ", "each", " ", "list"}]}], ",", 
     " ", 
     RowBox[{
      RowBox[{"like", " ", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"i", ",", "j", ",", "k", ",", "l", ",", "..."}], "}"}], ".", 
        " ", "The"}], " ", "couplings", " ", "will", " ", "follow", " ", 
       "the", " ", "unique", " ", "length"}], "-", 
      RowBox[{
      "2", " ", "permutations", " ", "of", " ", "the", " ", "spins"}]}], ",", 
     " ", 
     RowBox[{
     "sorted", " ", "by", " ", "the", " ", "lowest", " ", "index", " ", 
      RowBox[{"first", ".", " ", "For"}], " ", "instance"}], ",", " ", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"i", ",", "j", ",", "k"}], "}"}], " ", "will", " ", "require", 
      " ", "an", " ", "input", " ", "for", " ", "Jvalues1", " ", "of", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Jij", ",", " ", "Jik", ",", " ", "Jjk"}], "}"}], ".", " ", 
       "Similarly"}], " ", "for", " ", 
      RowBox[{"{", 
       RowBox[{"i", ",", "j", ",", "k", ",", "l"}], "}"}]}], ",", " ", 
     RowBox[{
     "it", " ", "will", " ", "require", " ", "the", " ", "inputs", " ", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "Jij", ",", " ", "Jik", ",", " ", "Jil", ",", " ", "Jjk", ",", " ", 
         "Jjl", ",", " ", "Jkl"}], "}"}], ".", " ", "However"}]}], ",", " ", 
     RowBox[{
      RowBox[{
      "you", " ", "can", " ", "also", " ", "simply", " ", "do", " ", "each", 
       " ", "two"}], "-", 
      RowBox[{
      "spin", " ", "coupling", " ", "individually", " ", "like", " ", 
       RowBox[{"below", "."}]}]}]}], "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Jcouplings1", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Jvalues1", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"-", "9.2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"-", "25.41"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "This", " ", "is", " ", "the", " ", "construction", " ", "of", " ", 
      "the", " ", "Hamiltonian"}], ",", " ", 
     RowBox[{
      RowBox[{
      "which", " ", "is", " ", "made", " ", "to", " ", "be", " ", "a", " ", 
       "function", " ", "of", " ", "the", " ", "magnetic", " ", "field", " ", 
       
       RowBox[{"B0", ".", " ", "The"}], " ", "first", " ", "term", " ", 
       "calculates", " ", "the", " ", "Larmor", " ", "frequencies", " ", "of",
        " ", "each", " ", "spins", " ", "and", " ", "the", " ", "second", " ",
        "term", " ", "calculates", " ", "the", " ", "J"}], "-", 
      RowBox[{
      "coupling", " ", "Hamiltonian", " ", "in", " ", "the", " ", "strong", 
       " ", "coupling", " ", 
       RowBox[{"limit", ".", " ", "You"}], " ", "can", " ", "also", " ", 
       "add", " ", "the", " ", "term", " ", "ScalarCouplingWeakN2", " ", 
       "with", " ", "the", " ", "same", " ", "form", " ", "of", " ", "the", 
       " ", "inputs", " ", "as", " ", 
       RowBox[{"below", ".", " ", "You"}], " ", 
       RowBox[{"don", "'"}], "t", " ", "need", " ", "to", " ", "change", " ", 
       "anything", " ", "in", " ", "the", " ", "Hamiltonian", " ", "unless", 
       " ", "you", " ", "add", " ", "additional", " ", 
       RowBox[{"effects", "."}]}]}]}], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{"H1", "[", "B0_", "]"}], ":=", 
    RowBox[{
     RowBox[{"ZeemanN", "[", 
      RowBox[{"spins", ",", 
       RowBox[{"larmorFreq", "[", "B0", "]"}]}], "]"}], "+", 
     RowBox[{"JCouplingStrongN", "[", 
      RowBox[{"Jcouplings1", ",", "Jvalues1", ",", "spins"}], "]"}]}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "This", " ", "function", " ", "calculates", " ", "the", " ", 
      "propagator", " ", "for", " ", "the", " ", "coherent", " ", 
      "Hamiltonian", " ", "for", " ", "the", " ", "stepsize", " ", "dictated",
       " ", "by", " ", "\[CapitalDelta]t", " ", "you", " ", "defined", " ", 
      RowBox[{"above", ".", " ", "Again"}]}], ",", " ", 
     RowBox[{
     "you", " ", "do", " ", "not", " ", "need", " ", "to", " ", "change", " ", 
      RowBox[{"this", "."}]}]}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"U1", "[", 
     RowBox[{"B0_", ",", "dt_"}], "]"}], ":=", 
    RowBox[{"MatrixExp", "[", 
     RowBox[{"2", "\[Pi]", " ", "I", " ", 
      RowBox[{"H1", "[", "B0", "]"}], 
      FractionBox["dt", "1000"]}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.7710726356152987`*^9, 3.7710726392771854`*^9}, {
   3.7710726966040754`*^9, 3.7710727176503973`*^9}, {3.771072835263051*^9, 
   3.7710728945133777`*^9}, {3.771072938963888*^9, 3.771072974766859*^9}, {
   3.7710735202532697`*^9, 3.7710735741848927`*^9}, {3.7710736378243437`*^9, 
   3.771073698585307*^9}, {3.7710737299574757`*^9, 3.7710738707292247`*^9}, {
   3.7710741026681795`*^9, 3.7710741423561316`*^9}, {3.7723799010308795`*^9, 
   3.7723799152169266`*^9}, {3.7772032897045956`*^9, 3.777203349349411*^9}, {
   3.777203393211503*^9, 3.777203405056079*^9}, {3.777203533127586*^9, 
   3.7772035571296644`*^9}, {3.7772036231499176`*^9, 3.777203764253234*^9}, {
   3.7773098201541643`*^9, 3.777309838154561*^9}, {3.781380142931121*^9, 
   3.7813801610565095`*^9}, {3.7813801982708783`*^9, 3.781380256175924*^9}, {
   3.781381665594991*^9, 3.781381670294591*^9}, {3.782485217343938*^9, 
   3.7824852194487476`*^9}, {3.7824852670480776`*^9, 
   3.7824852745039673`*^9}, {3.782485329297933*^9, 3.7824853345979695`*^9}, {
   3.782485431522908*^9, 3.7824854399231825`*^9}, {3.782485482662797*^9, 
   3.7824855742674017`*^9}, {3.7824856053063197`*^9, 
   3.7824856338918657`*^9}, {3.7824862652511606`*^9, 
   3.7824863598386145`*^9}, {3.782486827051654*^9, 3.7824869598513107`*^9}, {
   3.782491655808318*^9, 3.78249169466061*^9}, {3.7843806785234547`*^9, 
   3.784380683277728*^9}, {3.7843814563506565`*^9, 3.7843815010307794`*^9}, {
   3.7858524641456795`*^9, 3.785852464193551*^9}, {3.786978250482465*^9, 
   3.7869782505352793`*^9}, {3.7875724598920193`*^9, 
   3.7875724599545107`*^9}, {3.787572668947729*^9, 3.787572669010442*^9}, {
   3.7906962557844906`*^9, 3.7906962559718075`*^9}, {3.7939648899353204`*^9, 
   3.7939649019182873`*^9}, {3.7939649976282578`*^9, 3.793965016298653*^9}, {
   3.7939680008079395`*^9, 3.7939680009079366`*^9}, {3.7939688502865715`*^9, 
   3.793968851245175*^9}, {3.7939688922365446`*^9, 3.7939688939786997`*^9}, {
   3.793971234576776*^9, 3.793971235662204*^9}, {3.7939714522555485`*^9, 
   3.793971494189568*^9}, {3.7939722604688773`*^9, 3.793972265144081*^9}, {
   3.7939726582269278`*^9, 3.7939726810018415`*^9}, {3.794010154770222*^9, 
   3.7940101559859686`*^9}, {3.794059833825505*^9, 3.794059847064085*^9}, {
   3.794064951351224*^9, 3.7940649514010906`*^9}, {3.794145363880745*^9, 
   3.7941453642707057`*^9}, {3.7941457786100035`*^9, 
   3.7941457794748707`*^9}, {3.794146110645214*^9, 3.7941461111436872`*^9}, {
   3.79415225410052*^9, 3.794152255093867*^9}, {3.7941526917385073`*^9, 
   3.7941526920516696`*^9}, {3.7943182514114356`*^9, 
   3.7943182516796827`*^9}, {3.7945790315182743`*^9, 
   3.7945790318833838`*^9}, {3.794580644161448*^9, 3.794580644416783*^9}, {
   3.797365250301215*^9, 3.797365251142965*^9}, 3.808581434164854*^9, {
   3.808581816636979*^9, 3.8085818506960683`*^9}, {3.8140214216755457`*^9, 
   3.8140214430471*^9}, {3.8140215368181543`*^9, 3.814021569872904*^9}, 
   3.814021736426148*^9, {3.814022035628924*^9, 3.8140220422415237`*^9}, {
   3.8140222305666523`*^9, 3.814022234415051*^9}, {3.814025833497768*^9, 
   3.8140258751674285`*^9}, 3.8140259612292995`*^9, {3.814026020432165*^9, 
   3.814026022255246*^9}, {3.814125238752904*^9, 3.8141252782576704`*^9}, {
   3.814125406097182*^9, 3.81412564040914*^9}, {3.814125684657091*^9, 
   3.814125728914731*^9}, {3.814125761926421*^9, 3.8141257960596657`*^9}, {
   3.81412583531522*^9, 3.8141258381203527`*^9}, {3.8141259807101183`*^9, 
   3.8141260322616205`*^9}, {3.8141261300447397`*^9, 3.814126353738926*^9}, {
   3.8141264649767513`*^9, 3.814126486975716*^9}, {3.8141265337471724`*^9, 
   3.8141265575532827`*^9}, {3.8141266268092985`*^9, 
   3.8141266463880424`*^9}, {3.814126684599753*^9, 3.8141267960447583`*^9}, {
   3.8141268263313017`*^9, 3.8141269845069547`*^9}, {3.8141279577404833`*^9, 
   3.8141279630887613`*^9}, 3.814128422312749*^9, {3.8165296944629455`*^9, 
   3.8165296949318347`*^9}, 3.8365743539941406`*^9, {3.836574455849187*^9, 
   3.836574476154336*^9}, 3.836575219098796*^9, 3.836575668573064*^9, 
   3.836576205711402*^9, {3.8365778113907537`*^9, 3.8365778134066715`*^9}, {
   3.8365780432943454`*^9, 3.836578054557356*^9}, 3.8399236481028666`*^9, 
   3.8399255346002417`*^9, 3.863515922468401*^9, {3.863523973330309*^9, 
   3.863524013237084*^9}, {3.8635240536602163`*^9, 3.8635240888813334`*^9}, {
   3.8635241538356757`*^9, 3.8635241544138937`*^9}, {3.8635243115647078`*^9, 
   3.8635243146110363`*^9}, {3.8635245515736275`*^9, 3.8635245554633465`*^9}, 
   3.8637902885115232`*^9, {3.8832237713492527`*^9, 3.883223771421349*^9}, {
   3.883224009567202*^9, 3.883224024202127*^9}, {3.8832240837793503`*^9, 
   3.883224087631672*^9}, {3.8832246384081783`*^9, 3.88322464320825*^9}, {
   3.8832250553692913`*^9, 3.883225056658945*^9}, {3.88322530559254*^9, 
   3.8832253370668507`*^9}, {3.8832254711133432`*^9, 3.883225471249704*^9}, {
   3.88373581759429*^9, 3.883735837567738*^9}, {3.8837359145965652`*^9, 
   3.883735922582447*^9}, {3.883743556295538*^9, 3.883743663109766*^9}, {
   3.883743697612245*^9, 3.883743756773979*^9}, {3.883743795641982*^9, 
   3.883743806504589*^9}, {3.899308894010474*^9, 3.899308894217353*^9}, {
   3.899378145675275*^9, 3.899378145775757*^9}, {3.899380396091642*^9, 
   3.899380396254137*^9}, 3.911039461052575*^9, 3.911142720673333*^9, {
   3.941428997554248*^9, 3.9414290757412*^9}, {3.94143215419243*^9, 
   3.941432165554886*^9}},
 FontFamily->"Source Sans Pro",
 FontSize->15,
 FontWeight->"Regular",
 FontColor->GrayLevel[0],
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->
  "In[372]:=",ExpressionUUID->"cf03b436-3128-443e-a34f-9fc2138cb00f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"These", " ", "are", " ", "the", " ", "J"}], "-", 
     RowBox[{
     "couplings", " ", "of", " ", "the", " ", "second", " ", "configuation", 
      " ", "of", " ", "the", " ", "iridium", " ", "complex"}]}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"where", " ", "here", " ", "spins", " ", "1"}], "&"}], "3", 
       " ", "are", " ", "coupled", " ", "instead", " ", "of", " ", "spins", 
       " ", "2"}], "&"}], "3"}], ",", " ", 
    RowBox[{"as", " ", "in", " ", "configuration", " ", "1"}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Jcouplings2", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"1", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "3"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Jvalues2", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"-", "9.2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"-", "25.41"}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "This", " ", "is", " ", "the", " ", "calculation", " ", "of", " ", "the", 
     " ", "Hamiltonian", " ", "of", " ", "the", " ", "second", " ", 
     "configuration", " ", "of", " ", "the", " ", "iridium", " ", 
     RowBox[{"complex", ".", " ", "You"}], " ", "only", " ", "need", " ", 
     "to", " ", "change", " ", "the", " ", "Jcouplings", " ", "and", " ", 
     "Jvalues", " ", "number", " ", "to", " ", "those", " ", 
     RowBox[{"above", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"H2", "[", "B0_", "]"}], ":=", 
    RowBox[{
     RowBox[{"ZeemanN", "[", 
      RowBox[{"spins", ",", 
       RowBox[{"larmorFreq", "[", "B0", "]"}]}], "]"}], "+", 
     RowBox[{"JCouplingStrongN", "[", 
      RowBox[{"Jcouplings2", ",", "Jvalues2", ",", "spins"}], "]"}]}]}], 
   "\[IndentingNewLine]", "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "This", " ", "function", " ", "calculates", " ", "the", " ", 
      "propagator", " ", "for", " ", "the", " ", "coherent", " ", 
      "Hamiltonian", " ", "for", " ", "the", " ", "stepsize", " ", "dictated",
       " ", "by", " ", "\[CapitalDelta]t", " ", "you", " ", "defined", " ", 
      RowBox[{"above", ".", " ", "Again"}]}], ",", " ", 
     RowBox[{
     "you", " ", "do", " ", "not", " ", "need", " ", "to", " ", "change", " ", 
      RowBox[{"this", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"U2", "[", 
     RowBox[{"B0_", ",", "dt_"}], "]"}], ":=", 
    RowBox[{"MatrixExp", "[", 
     RowBox[{"2", "\[Pi]", " ", "I", " ", 
      RowBox[{"H2", "[", "B0", "]"}], 
      FractionBox["dt", "1000"]}], "]"}], " "}]}]}]], "Input",
 CellChangeTimes->{{3.7710726356152987`*^9, 3.7710726392771854`*^9}, {
   3.7710726966040754`*^9, 3.7710727176503973`*^9}, {3.771072835263051*^9, 
   3.7710728945133777`*^9}, {3.771072938963888*^9, 3.771072974766859*^9}, {
   3.7710735202532697`*^9, 3.7710735741848927`*^9}, {3.7710736378243437`*^9, 
   3.771073698585307*^9}, {3.7710737299574757`*^9, 3.7710738707292247`*^9}, {
   3.7710741026681795`*^9, 3.7710741423561316`*^9}, {3.7723799010308795`*^9, 
   3.7723799152169266`*^9}, {3.7772032897045956`*^9, 3.777203349349411*^9}, {
   3.777203393211503*^9, 3.777203405056079*^9}, {3.777203533127586*^9, 
   3.7772035571296644`*^9}, {3.7772036231499176`*^9, 3.777203764253234*^9}, {
   3.7773098201541643`*^9, 3.777309838154561*^9}, {3.781380142931121*^9, 
   3.7813801610565095`*^9}, {3.7813801982708783`*^9, 3.781380256175924*^9}, {
   3.781381665594991*^9, 3.7813816910632005`*^9}, 3.782485685500744*^9, 
   3.782486379763829*^9, {3.7824869890295706`*^9, 3.7824869915904827`*^9}, {
   3.7824915090767593`*^9, 3.7824915391823287`*^9}, {3.782491645914197*^9, 
   3.7824916621823597`*^9}, {3.7824917236401806`*^9, 3.7824917537618704`*^9}, 
   3.7824920413811483`*^9, {3.784381558396422*^9, 3.784381580856132*^9}, {
   3.7858524676383348`*^9, 3.785852467688201*^9}, {3.7869782540395737`*^9, 
   3.786978254100376*^9}, {3.7875724634067287`*^9, 3.787572463453427*^9}, {
   3.787572671384672*^9, 3.7875726714317575`*^9}, {3.7906962750471797`*^9, 
   3.7906962758272934`*^9}, {3.793965050983395*^9, 3.793965069972253*^9}, {
   3.7939679953257685`*^9, 3.7939679954772377`*^9}, 3.793968899176384*^9, 
   3.793971240252179*^9, {3.7939718658949814`*^9, 3.7939718722755556`*^9}, 
   3.7939722786674147`*^9, {3.7939726615250497`*^9, 3.7939726851077023`*^9}, 
   3.794010196157467*^9, {3.7940600067677813`*^9, 3.7940600112487926`*^9}, {
   3.7941453806947947`*^9, 3.7941453810897093`*^9}, {3.7941457721626773`*^9, 
   3.794145773276513*^9}, {3.7941461054457583`*^9, 3.7941461057585936`*^9}, {
   3.794152258343137*^9, 3.794152258588481*^9}, {3.7941526873572264`*^9, 
   3.7941526875975494`*^9}, {3.7943182563302717`*^9, 3.794318256581568*^9}, {
   3.7945790365770082`*^9, 3.79457903703281*^9}, {3.7945806507153616`*^9, 
   3.7945806511303067`*^9}, {3.7973652577682405`*^9, 3.7973652584663734`*^9}, 
   3.808581797255637*^9, {3.808581857209199*^9, 3.8085818759076786`*^9}, {
   3.8140225057236733`*^9, 3.8140225073058443`*^9}, {3.8140225442592974`*^9, 
   3.814022545098799*^9}, {3.8140260079322195`*^9, 3.8140260184547706`*^9}, {
   3.8141269881648064`*^9, 3.81412703705507*^9}, {3.81412709631742*^9, 
   3.8141271370796933`*^9}, {3.8141272007142863`*^9, 3.814127248894709*^9}, {
   3.8141279654210267`*^9, 3.814127965589946*^9}, 3.8141284145636406`*^9, {
   3.816529699368154*^9, 3.816529699999873*^9}, 3.8365743562173967`*^9, {
   3.836574457929266*^9, 3.83657447815366*^9}, {3.836575214714254*^9, 
   3.836575216170785*^9}, 3.8365756722204905`*^9, 3.8365762026199775`*^9, {
   3.836577816190226*^9, 3.8365778182861376`*^9}, {3.8365780464964924`*^9, 
   3.8365780567175045`*^9}, 3.8399236508958693`*^9, {3.8635240396138353`*^9, 
   3.8635240709113097`*^9}, {3.863524304937991*^9, 3.863524307859412*^9}, {
   3.8635245653219624`*^9, 3.863524571715057*^9}, {3.8832254759414988`*^9, 
   3.883225490797792*^9}, {3.883735975579918*^9, 3.883736015038144*^9}, 
   3.883743927550321*^9, 3.8957424002678022`*^9, 3.8957425174979267`*^9, {
   3.899310713712315*^9, 3.899310714014292*^9}, {3.899378164850925*^9, 
   3.899378165016075*^9}, {3.899380398449727*^9, 3.899380398608817*^9}, 
   3.911039463363222*^9, 3.911142723049666*^9, {3.941429100671928*^9, 
   3.941429120613097*^9}, {3.941432169631218*^9, 3.941432179964493*^9}},
 FontFamily->"Source Sans Pro",
 FontSize->15,
 FontWeight->"Regular",
 FontColor->GrayLevel[0],
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->
  "In[378]:=",ExpressionUUID->"b5af20c1-bd13-4328-a710-51160cd95b10"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "This", " ", "variable", " ", "sets", " ", "the", " ", "density", " ", 
     "matrix", " ", "of", " ", "the", " ", "parahydrogen", " ", 
     RowBox[{"source", ".", " ", "We"}], " ", "usually", " ", "use", " ", 
     "\[Rho]Singlet"}], ",", " ", 
    RowBox[{
     RowBox[{"which", " ", "is", " ", "simply", " ", "a", " ", "singlet"}], 
     "-", 
     RowBox[{
     "state", " ", "density", " ", "matrix", " ", "for", " ", "100", "%", " ", 
      RowBox[{"parahydrogen", ".", " ", "There"}], " ", "is", " ", "no", " ", 
      "need", " ", "to", " ", "change", " ", 
      RowBox[{"this", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"\[Rho]H20", "=", "\[Rho]Singlet"}], ";"}]}]], "Input",
 CellChangeTimes->{{3.788283499197116*^9, 3.7882835060546684`*^9}, {
   3.788302297179074*^9, 3.7883023025060596`*^9}, {3.8141272606180124`*^9, 
   3.814127262503276*^9}, {3.8141272929537582`*^9, 3.81412736510785*^9}, {
   3.8141273964061885`*^9, 3.81412740062362*^9}, {3.814127449568078*^9, 
   3.814127458352103*^9}, {3.8141276201495056`*^9, 3.814127641270168*^9}, 
   3.8635241283506823`*^9},
 FontFamily->"Source Sans Pro",
 FontSize->15,
 FontWeight->"Regular",
 FontColor->GrayLevel[0],
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->
  "In[382]:=",ExpressionUUID->"e7fd64f1-3173-4c30-9ca5-22512210a1e6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Here", " ", "we", " ", "define", " ", "the", " ", "operator", " ", 
     "that", " ", "will", " ", "be", " ", "used", " ", "to", " ", "take", " ",
      "the", " ", "expectation", " ", "value", " ", "as", " ", "the", " ", 
     "simulation", " ", "is", " ", "being", " ", 
     RowBox[{"solved", ".", " ", "Do"}], " ", "not", " ", "change", " ", 
     "the", " ", "variable", " ", "name", " ", 
     RowBox[{"OP", ".", " ", "This"}], " ", "uses", " ", "the", " ", 
     "function", " ", "OperatorNF"}], ",", " ", 
    RowBox[{
    "which", " ", "will", " ", "calculate", " ", "a", " ", "spin", " ", 
     "product", " ", 
     RowBox[{"operator", ".", " ", "The"}], " ", "first", " ", "argument", 
     " ", "is", " ", "the", " ", "number", " ", "of", " ", "spins", " ", "in",
      " ", "that", " ", "system"}], ",", " ", 
    RowBox[{
    "and", " ", "the", " ", "second", " ", "argument", " ", "dictates", " ", 
     "the", " ", "spin", " ", 
     RowBox[{"operator", ".", " ", "The"}], " ", "operator", " ", "below", 
     " ", "is", " ", "I3z"}], ",", " ", 
    RowBox[{
     RowBox[{
     "and", " ", "will", " ", "generate", " ", "the", " ", "expectation", " ",
       "value", " ", "for", " ", "the", " ", "z"}], "-", 
     RowBox[{
     "polarization", " ", "on", " ", "spin", " ", "3.", " ", "You", " ", 
      "can", " ", "give", " ", "the", " ", "second", " ", "argument", " ", 
      "any", " ", "combination", " ", "of", " ", "the", " ", "spin", " ", 
      RowBox[{"operators", ".", " ", "For"}], " ", "instance"}]}], ",", " ", 
    RowBox[{
     RowBox[{"the", " ", "argument", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "x", ",", "3", ",", "z"}], "}"}], " ", "gives", " ", 
      "the", " ", "operator", " ", "I1xI3z"}], ";", " ", 
     RowBox[{"the", " ", "argument", " ", 
      RowBox[{"{", 
       RowBox[{"2", ",", "z", ",", "3", ",", "z"}], "}"}], " ", "gives", " ", 
      "the", " ", "operator", " ", "I2zI3z"}], ";", " ", 
     RowBox[{"the", " ", "argument", " ", 
      RowBox[{"{", 
       RowBox[{"1", ",", "x", ",", "2", ",", "y", ",", "3", ",", "z"}], "}"}],
       " ", "gives", " ", "the", " ", "oeprator", " ", 
      RowBox[{"I1xI2yI3z", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"OP", "=", 
     RowBox[{"OperatorNF", "[", 
      RowBox[{"3", ",", 
       RowBox[{"{", 
        RowBox[{"3", ",", "z"}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "This", " ", "is", " ", "where", " ", "we", " ", "calculate", " ", "the",
       " ", "initial", " ", "density", " ", "matrix"}], ",", " ", 
     RowBox[{
     "which", " ", "uses", " ", "the", " ", "density", " ", "matrix", " ", 
      "of", " ", "the", " ", "source"}], ",", " ", "\[Rho]H20", ",", " ", 
     RowBox[{
     "and", " ", "the", " ", "initial", " ", "spin", " ", "density", " ", 
      "on", " ", "the", " ", 
      RowBox[{"target", ".", " ", "We"}], " ", "will", " ", "approximate", 
      " ", "the", " ", "initial", " ", "spin", " ", "density", " ", "as", " ",
       "identity", " ", "for", " ", "a", " ", "hyperpolarization", " ", 
      RowBox[{"experiment", ".", " ", "You"}], " ", "only", " ", "need", " ", 
      "to", " ", "change", " ", "the", " ", "power", " ", "of", " ", "base", 
      " ", "2", " ", "numbers"}], ",", " ", 
     RowBox[{
     "which", " ", "must", " ", "be", " ", "the", " ", "number", " ", "of", 
      " ", "spins", " ", "in", " ", "the", " ", 
      RowBox[{"ligand", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Rho]0", "=", 
     RowBox[{"KroneckerProduct", "[", 
      RowBox[{"\[Rho]H20", ",", 
       RowBox[{
        FractionBox["1", 
         SuperscriptBox["2", "1"]], 
        RowBox[{"IdentityMatrix", "[", 
         SuperscriptBox["2", "1"], "]"}]}]}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.769342341283226*^9, 3.7693426001143703`*^9}, {
   3.7693426349100184`*^9, 3.769342767605994*^9}, 3.769966733147533*^9, 
   3.769967163233714*^9, 3.77712027818683*^9, {3.7771206140867195`*^9, 
   3.7771206953229303`*^9}, {3.777220321548032*^9, 3.777220359801241*^9}, {
   3.7791179539747453`*^9, 3.779117960946348*^9}, {3.7813802901395893`*^9, 
   3.7813803083175173`*^9}, {3.784381639398889*^9, 3.7843816485642633`*^9}, {
   3.7882835661483603`*^9, 3.7882835695505133`*^9}, {3.7893167269430923`*^9, 
   3.789316777774922*^9}, {3.7893177592090244`*^9, 3.7893177624811172`*^9}, {
   3.789318629439982*^9, 3.789318630656322*^9}, {3.793967431245934*^9, 
   3.793967437359104*^9}, {3.7940600310976853`*^9, 3.794060038315374*^9}, {
   3.8085818935029263`*^9, 3.808581894086877*^9}, {3.8085820179545484`*^9, 
   3.808582033416752*^9}, {3.8140228072190433`*^9, 3.8140228457602444`*^9}, {
   3.814127659850452*^9, 3.8141279279456325`*^9}, {3.814128045223653*^9, 
   3.8141281643515625`*^9}, {3.814128239986195*^9, 3.8141283468183827`*^9}, 
   3.8399260621115746`*^9, {3.8635241631484413`*^9, 3.8635241646482964`*^9}, 
   3.863524703108495*^9, 3.863781924793816*^9, {3.883495905053595*^9, 
   3.8834959098044243`*^9}, {3.883578753116848*^9, 3.8835787532940197`*^9}, {
   3.8910149881758013`*^9, 3.8910149882041283`*^9}, {3.891038432711419*^9, 
   3.891038432795497*^9}, {3.891038983220574*^9, 3.891038988634952*^9}, {
   3.8910406607813263`*^9, 3.891040689001143*^9}, {3.8910419584959307`*^9, 
   3.891041959120071*^9}, {3.8913575664402037`*^9, 3.8913575665295*^9}, {
   3.941429124883422*^9, 3.941429130459025*^9}},
 FontFamily->"Source Sans Pro",
 FontSize->15,
 FontWeight->"Regular",
 FontColor->GrayLevel[0],
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->
  "In[383]:=",ExpressionUUID->"6678d03c-60b1-4ba7-85c2-ecff1d0f0632"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Here", " ", "we", " ", "set", " ", "a", " ", "2", " ", "spin"}], 
    "-", 
    RowBox[{
     RowBox[{"1", "/", "2"}], " ", "system", " ", "and", " ", "build", " ", 
     "the", " ", "15", "N"}], "-", 
    RowBox[{"acetonitrile", " ", 
     RowBox[{"spins", ".", " ", "This"}], " ", "is", " ", "the", " ", "free", 
     " ", "15", "N"}], "-", 
    RowBox[{"acetonitrile", " ", 
     RowBox[{"species", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"spinsF", "=", 
     RowBox[{"{", "h", "}"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"larmorFreqF", "[", "B0_", "]"}], ":=", 
     RowBox[{
      RowBox[{"{", "\[Gamma]N", "}"}], "*", "B0"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "We", " ", "calculate", " ", "the", " ", "free", " ", "species", " ", 
     "Hamiltonian"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"HF", "[", "B_", "]"}], ":=", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"\[Gamma]N", "*", "B"}], ")"}], "*", 
     RowBox[{"OperatorNF", "[", 
      RowBox[{"1", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "z"}], "}"}]}], "]"}]}]}], "\[IndentingNewLine]", 
   "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "This", " ", "function", " ", "calculates", " ", "the", " ", 
      "propagator", " ", "for", " ", "the", " ", "coherent", " ", 
      "Hamiltonian", " ", "for", " ", "the", " ", "stepsize", " ", "dictated",
       " ", "by", " ", "\[CapitalDelta]t", " ", "you", " ", "defined", " ", 
      RowBox[{"above", ".", " ", "Again"}]}], ",", " ", 
     RowBox[{
     "you", " ", "do", " ", "not", " ", "need", " ", "to", " ", "change", " ", 
      RowBox[{"this", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"UF", "[", 
     RowBox[{"B0_", ",", "dt_"}], "]"}], ":=", 
    RowBox[{"SparseArray", "@", 
     RowBox[{"MatrixExp", "[", 
      FractionBox[
       RowBox[{"2", "\[Pi]", " ", "I", " ", 
        RowBox[{"HF", "[", "B0", "]"}], "*", "dt"}], "1000"], 
      "]"}]}]}]}]}]], "Input",
 CellChangeTimes->{{3.7710726356152987`*^9, 3.7710726392771854`*^9}, {
   3.7710726966040754`*^9, 3.7710727176503973`*^9}, {3.771072835263051*^9, 
   3.7710728945133777`*^9}, {3.771072938963888*^9, 3.771072974766859*^9}, {
   3.7710735202532697`*^9, 3.7710735741848927`*^9}, {3.7710736378243437`*^9, 
   3.771073698585307*^9}, {3.7710737299574757`*^9, 3.7710738707292247`*^9}, {
   3.7710741026681795`*^9, 3.7710741423561316`*^9}, {3.7723799010308795`*^9, 
   3.7723799152169266`*^9}, {3.7772032897045956`*^9, 3.777203349349411*^9}, {
   3.777203393211503*^9, 3.777203405056079*^9}, {3.777203533127586*^9, 
   3.7772035571296644`*^9}, {3.7772036231499176`*^9, 3.777203764253234*^9}, {
   3.7773098201541643`*^9, 3.777309838154561*^9}, {3.781380142931121*^9, 
   3.7813801610565095`*^9}, {3.7813801982708783`*^9, 3.781380256175924*^9}, {
   3.781381665594991*^9, 3.781381670294591*^9}, {3.782485217343938*^9, 
   3.7824852194487476`*^9}, {3.7824852670480776`*^9, 
   3.7824852745039673`*^9}, {3.782485329297933*^9, 3.7824853345979695`*^9}, {
   3.782485431522908*^9, 3.7824854399231825`*^9}, {3.782485482662797*^9, 
   3.7824855742674017`*^9}, {3.7824856053063197`*^9, 
   3.7824856338918657`*^9}, {3.7824862652511606`*^9, 
   3.7824863598386145`*^9}, {3.782486827051654*^9, 3.7824869598513107`*^9}, {
   3.782491655808318*^9, 3.78249169466061*^9}, {3.7843806785234547`*^9, 
   3.784380683277728*^9}, {3.7843814563506565`*^9, 3.7843815010307794`*^9}, {
   3.7858524641456795`*^9, 3.785852464193551*^9}, {3.786978250482465*^9, 
   3.7869782505352793`*^9}, {3.7875724598920193`*^9, 
   3.7875724599545107`*^9}, {3.787572668947729*^9, 3.787572669010442*^9}, {
   3.790098610402629*^9, 3.7900987449735384`*^9}, {3.7900987947832146`*^9, 
   3.7900988073176236`*^9}, {3.790366466420847*^9, 3.7903666900180693`*^9}, {
   3.790523595953679*^9, 3.7905236031729345`*^9}, {3.790525976737712*^9, 
   3.7905260575494986`*^9}, {3.7905261335422544`*^9, 3.7905261828542604`*^9}, 
   3.7905262280329967`*^9, {3.790526637258623*^9, 3.7905266378862433`*^9}, {
   3.7906988960784473`*^9, 3.7906989443856773`*^9}, {3.790698991438615*^9, 
   3.7906990002662444`*^9}, {3.7907022785916104`*^9, 3.790702281247854*^9}, {
   3.7939659802958336`*^9, 3.7939660519511375`*^9}, {3.7939680084616203`*^9, 
   3.7939680086050963`*^9}, 3.79396890684542*^9, 3.793971247874263*^9, {
   3.793971902407585*^9, 3.7939719111266966`*^9}, 3.793972285930738*^9, {
   3.793972667966816*^9, 3.7939726898978434`*^9}, {3.7940600496729827`*^9, 
   3.7940600895143843`*^9}, 3.7940651099660563`*^9, 3.7940662362638617`*^9, {
   3.7940663109548073`*^9, 3.7940663195915136`*^9}, {3.7940663605751686`*^9, 
   3.7940663657113605`*^9}, {3.794066493467909*^9, 3.794066538314843*^9}, {
   3.7940667448274107`*^9, 3.7940667828451085`*^9}, {3.7940668909043856`*^9, 
   3.794066900278514*^9}, {3.794145388326372*^9, 3.794145388717327*^9}, {
   3.7941457115848937`*^9, 3.794145711947411*^9}, {3.794146100740797*^9, 
   3.7941461012047615`*^9}, {3.794152262777272*^9, 3.794152263003666*^9}, {
   3.794152683219298*^9, 3.794152683811679*^9}, {3.79431826110347*^9, 
   3.794318261387743*^9}, {3.7945790412230587`*^9, 3.7945790421401353`*^9}, {
   3.79458065692584*^9, 3.794580657195523*^9}, {3.7973652644982367`*^9, 
   3.797365265661127*^9}, {3.814022998522803*^9, 3.814023001183668*^9}, {
   3.8140230920032177`*^9, 3.814023101348987*^9}, {3.8141276576001406`*^9, 
   3.814127657800156*^9}, {3.814127931949664*^9, 3.814128038472184*^9}, {
   3.8141283873297224`*^9, 3.8141284067021365`*^9}, {3.86352417280583*^9, 
   3.8635241959343824`*^9}, {3.883499105597926*^9, 3.8834991105899343`*^9}, 
   3.883558758661487*^9, {3.8837364954776363`*^9, 3.8837365577244062`*^9}, {
   3.883736667834002*^9, 3.8837366705293818`*^9}, {3.88373674903454*^9, 
   3.883736778952928*^9}, {3.883744174365818*^9, 3.883744243661264*^9}, {
   3.895589408018751*^9, 3.8955894128001223`*^9}, {3.895589763064373*^9, 
   3.895589763909411*^9}, {3.895593871958275*^9, 3.895593872168838*^9}, 
   3.895742521265697*^9, {3.8993107173177757`*^9, 3.899310717557124*^9}, {
   3.89937816978761*^9, 3.8993781700059757`*^9}, {3.899380408111185*^9, 
   3.899380408266405*^9}, 3.911039469466717*^9, {3.911142733104467*^9, 
   3.9111427342797318`*^9}, {3.9414291366752462`*^9, 3.941429136771681*^9}, {
   3.941429169300185*^9, 3.941429205967822*^9}, {3.941430833700018*^9, 
   3.9414308567870007`*^9}, {3.94143192966822*^9, 3.9414319491784897`*^9}, {
   3.941432187898851*^9, 3.941432225316975*^9}},
 FontFamily->"Source Sans Pro",
 FontSize->15,
 FontWeight->"Regular",
 FontColor->GrayLevel[0],
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->
  "In[385]:=",ExpressionUUID->"e0d34ab5-8960-4a3b-968f-09f085a76ce0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "is", " ", "the", " ", "expectation", " ", "value", " ", 
    "that", " ", "is", " ", "calculated", " ", "for", " ", "the", " ", "free",
     " ", 
    RowBox[{"species", ".", " ", "It"}], " ", "be", " ", "the", " ", "same", 
    " ", "operator", " ", 
    RowBox[{"(", 
     RowBox[{"with", " ", "a", " ", "different", " ", "index"}], ")"}], " ", 
    "as", " ", "the", " ", "one", " ", "defined", " ", "in", " ", 
    RowBox[{"OP", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"OPfree", "=", 
     RowBox[{"OperatorNF", "[", 
      RowBox[{"1", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "z"}], "}"}]}], "]"}]}], ";"}], "\n", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Here", " ", "we", " ", "calculate", " ", "the", " ", "initial", " ", 
      "density", " ", "matrix", " ", "for", " ", "the", " ", "free", " ", 
      RowBox[{"species", ".", " ", "You"}], " ", "only", " ", "need", " ", 
      "to", " ", "change", " ", "the", " ", "power", " ", "of", " ", "base", 
      " ", "2", " ", "numbers"}], ",", " ", 
     RowBox[{
     "which", " ", "must", " ", "be", " ", "the", " ", "number", " ", "of", 
      " ", "spins", " ", "in", " ", "the", " ", 
      RowBox[{"ligand", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Rho]F0", "=", 
     RowBox[{"SparseArray", "[", 
      RowBox[{
       FractionBox["1", 
        SuperscriptBox["2", "1"]], 
       RowBox[{"IdentityMatrix", "[", 
        SuperscriptBox["2", "1"], "]"}]}], "]"}]}], ";"}]}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10005.},
 CellChangeTimes->{
  3.7663212933981175`*^9, {3.7664425009060535`*^9, 3.766442510266837*^9}, {
   3.766442565300376*^9, 3.766442569370489*^9}, 3.7664436287455235`*^9, {
   3.7664439423919506`*^9, 3.76644394816856*^9}, 3.766753323849673*^9, {
   3.766753385149128*^9, 3.7667534404725447`*^9}, {3.766753837144203*^9, 
   3.766753844158705*^9}, {3.7667539480750847`*^9, 3.766753956439148*^9}, 
   3.7667541350973053`*^9, {3.7667607831948028`*^9, 3.766760786937602*^9}, {
   3.766762742941247*^9, 3.766762748255621*^9}, {3.7667838115474567`*^9, 
   3.7667838261013002`*^9}, {3.768148254547882*^9, 3.768148267364931*^9}, {
   3.7724534287641797`*^9, 3.7724534314245777`*^9}, 3.772455508913102*^9, {
   3.774800259439867*^9, 3.7748002754879684`*^9}, {3.7759190916193542`*^9, 
   3.775919123062895*^9}, {3.777293014658745*^9, 3.777293015461447*^9}, {
   3.7772933032757683`*^9, 3.7772933064545865`*^9}, {3.784382139389223*^9, 
   3.784382142805504*^9}, {3.7905262664670486`*^9, 3.790526306777053*^9}, {
   3.79052638437335*^9, 3.7905263932878323`*^9}, {3.790526456066148*^9, 
   3.790526456107991*^9}, {3.790526524238698*^9, 3.7905265304623795`*^9}, {
   3.790526595258356*^9, 3.7905266159199533`*^9}, 3.790699126072981*^9, {
   3.7939660863860054`*^9, 3.793966092381956*^9}, {3.7940601105550876`*^9, 
   3.7940601209622416`*^9}, {3.794067155832179*^9, 3.794067167948942*^9}, {
   3.814128489262786*^9, 3.8141284909472437`*^9}, {3.814128531345278*^9, 
   3.814128584019529*^9}, {3.8141286441396017`*^9, 3.8141287049188724`*^9}, {
   3.8635242192013335`*^9, 3.8635242282650003`*^9}, {3.863524671608424*^9, 
   3.863524684092291*^9}, {3.883495938829908*^9, 3.883495974459811*^9}, {
   3.883578772362018*^9, 3.883578772484942*^9}, {3.891015121373913*^9, 
   3.891015121584897*^9}, {3.891038438498186*^9, 3.891038438807644*^9}, {
   3.891040665394641*^9, 3.891040693763247*^9}, {3.891041954964911*^9, 
   3.8910419550458*^9}, {3.89135757743291*^9, 3.891357577520289*^9}, {
   3.9414292166297827`*^9, 3.941429220829913*^9}},
 FontFamily->"Source Sans Pro",
 FontSize->15,
 FontWeight->"Regular",
 FontColor->GrayLevel[0],
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->
  "In[389]:=",ExpressionUUID->"a3c1030e-364a-4bc2-83e2-7edb261f0c13"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Within", " ", "this", " ", "formalism"}], ",", " ", 
    RowBox[{
     RowBox[{
     "we", " ", "need", " ", "to", " ", "partially", " ", "trace", " ", 
      "over", " ", "the", " ", "spin", " ", 
      RowBox[{"indices", ".", " ", "This"}], " ", "is", " ", "actually", " ", 
      "easiest", " ", "if", " ", "you", " ", "re"}], "-", 
     RowBox[{
     "index", " ", "the", " ", "density", " ", "matrix", " ", "so", " ", 
      "that", " ", "the", " ", "N", " ", "spins", " ", "that", " ", "you", 
      " ", "are", " ", "tracing", " ", "out", " ", "are", " ", "the", " ", 
      "first", " ", "N", " ", 
      RowBox[{"indices", ".", " ", "Here"}]}]}], ",", " ", 
    RowBox[{
    "we", " ", "will", " ", "calculate", " ", "the", " ", "permutation", " ", 
     "matrix", " ", "that", " ", "changes", " ", "the", " ", "index", " ", 
     "of", " ", "the", " ", 
     RowBox[{"spins", ".", " ", "In"}], " ", "this", " ", "case"}], ",", " ", 
    
    RowBox[{
    "we", " ", "need", " ", "to", " ", "move", " ", "spin", " ", "3", " ", 
     RowBox[{"(", 
      RowBox[{"the", " ", "ligand"}], ")"}], " ", "to", " ", "position", " ", 
     "1", " ", "so", " ", "that", " ", "it", " ", "can", " ", "be", " ", 
     "traced", " ", 
     RowBox[{"out", ".", " ", "The"}], " ", "function", " ", "that", " ", 
     "we", " ", "need", " ", "to", " ", "use", " ", "is", " ", "MoveSpins"}], 
    ",", " ", 
    RowBox[{
    "which", " ", "takes", " ", "the", " ", "first", " ", "argument", " ", 
     "of", " ", "the", " ", "number", " ", "of", " ", "spins"}], ",", " ", 
    RowBox[{
    "and", " ", "then", " ", "the", " ", "second", " ", "argument", " ", 
     "being", " ", "the", " ", "spin", 
     RowBox[{"(", "s", ")"}], " ", "being", " ", "moved", " ", "to", " ", 
     "the", " ", "positions", " ", "indicated", " ", "by", " ", "the", " ", 
     "third", " ", 
     RowBox[{"index", ".", " ", "The"}], " ", "curly", " ", "braces", " ", 
     "must", " ", "be", " ", "used", " ", "in", " ", "the", " ", "second", 
     " ", "and", " ", "third", " ", "arugment", " ", "because", " ", "there", 
     " ", "can", " ", "be", " ", "multiple", " ", "spins", " ", "in", " ", 
     "each", " ", "list"}], ",", " ", 
    RowBox[{
    "as", " ", "long", " ", "as", " ", "they", " ", "are", " ", "the", " ", 
     "same", " ", 
     RowBox[{"length", ".", " ", "For"}], " ", "instance"}], ",", " ", 
    RowBox[{"if", " ", "the", " ", "second", " ", "index", " ", "was", " ", 
     RowBox[{"{", 
      RowBox[{"3", ",", "4"}], "}"}]}], ",", " ", 
    RowBox[{"and", " ", "the", " ", "third", " ", "index", " ", "was", " ", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2"}], "}"}]}], ",", " ", 
    RowBox[{
    "this", " ", "would", " ", "move", " ", "spin", " ", "3", " ", "to", " ", 
     "position", " ", "1", " ", "and", " ", "spin", " ", "4", " ", "to", " ", 
     "position", " ", "1."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"permuteSpins", "=", 
     RowBox[{"MoveSpins", "[", 
      RowBox[{"3", ",", 
       RowBox[{"{", "3", "}"}], ",", 
       RowBox[{"{", "1", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "We", " ", "will", " ", "need", " ", "to", " ", "calculate", " ", "the", 
      " ", "transpose", " ", "of", " ", "permuteSpins"}], ",", " ", 
     RowBox[{
     "so", " ", "we", " ", "will", " ", "calculate", " ", "that", " ", 
      "externally", " ", "so", " ", "that", " ", "it", " ", 
      RowBox[{"doesn", "'"}], "t", " ", "have", " ", "to", " ", "be", " ", 
      "done", " ", "with", " ", "each", " ", "time", " ", 
      RowBox[{"step", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"permuteSpinsTr", "=", 
     RowBox[{"Transpose", "[", "permuteSpins", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "This", " ", "is", " ", "the", " ", "function", " ", "that", " ", 
      "performs", " ", "all", " ", "of", " ", "the", " ", "necessary", " ", 
      "partial", " ", "traces", " ", "for", " ", "the", " ", "simulation"}], 
     ",", " ", 
     RowBox[{
     "inputting", " ", "the", " ", "density", " ", "matrix", " ", "at", " ", 
      "every", " ", "time", " ", 
      RowBox[{"point", ".", " ", "\[Rho]Tr"}], " ", "is", " ", "a", " ", 
      "module"}], ",", " ", 
     RowBox[{
      RowBox[{"which", " ", "is", " ", "how", " ", "multi"}], "-", 
      RowBox[{"line", " ", "functions", " ", "are", " ", "built"}]}], ",", 
     " ", 
     RowBox[{"where", " ", "the", " ", "list", " ", 
      RowBox[{"{", 
       RowBox[{"a1", ",", "a2"}], "}"}], " ", "defines", " ", "local", " ", 
      RowBox[{"variables", ".", " ", "It"}], " ", "uses", " ", "the", " ", 
      "function", " ", "PartialTr"}], ",", " ", 
     RowBox[{
     "for", " ", "which", " ", "the", " ", "first", " ", "argument", " ", 
      "is", " ", "the", " ", "density", " ", "matrix"}], ",", " ", 
     RowBox[{
      RowBox[{"or", " ", "the", " ", "spin"}], "-", 
      RowBox[{"label", " ", "permuted", " ", "density", " ", "matrix"}]}], 
     ",", " ", 
     RowBox[{
     "and", " ", "the", " ", "second", " ", "argument", " ", "of", " ", 
      "PartialTr", " ", "is", " ", "the", " ", "number", " ", "of", " ", 
      "spins", " ", "to", " ", "be", " ", "traced", " ", 
      RowBox[{
      "over", ".", "\[IndentingNewLine]", "\[IndentingNewLine]", "a1"}], " ", 
      "permutes", " ", "the", " ", "index", " ", "as", " ", "defined", " ", 
      "above", " ", "and", " ", "then", " ", "traces", " ", "over", " ", 
      "spin", " ", "1"}], ",", " ", 
     RowBox[{"which", " ", "is", " ", "the", " ", "ligand", " ", "spin"}], 
     ",", " ", 
     RowBox[{
     "therefore", " ", "a1", " ", "gives", " ", "the", " ", "parahydrogen", 
      " ", 
      RowBox[{
      "subsystem", ".", "\[IndentingNewLine]", "\[IndentingNewLine]", "a2"}], 
      " ", "simply", " ", "traces", " ", "over", " ", "the", " ", "first", 
      " ", "two", " ", "spins"}], ",", " ", 
     RowBox[{
     "which", " ", "are", " ", "the", " ", "parahydrogen", " ", "subsystem", 
      " ", "leaving", " ", "the", " ", "ligand", " ", 
      RowBox[{
      "spin", ".", "\[IndentingNewLine]", "\[IndentingNewLine]", "The"}], " ",
       "output", " ", "of", " ", "this", " ", "is", " ", "then", " ", "a", 
      " ", "list", " ", "of", " ", "the", " ", "partially", " ", "traced", 
      " ", "density", " ", 
      RowBox[{"matrices", "."}]}]}], "\[IndentingNewLine]", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"\[Rho]Tr", "[", "\[Rho]in_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"a1", ",", "a2"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"a1", "=", 
        RowBox[{"PartialTr", "[", 
         RowBox[{
          RowBox[{"permuteSpinsTr", ".", "\[Rho]in", ".", "permuteSpins"}], 
          ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"a2", "=", 
        RowBox[{"PartialTr", "[", 
         RowBox[{"\[Rho]in", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{"a1", ",", "a2"}], "}"}]}]}], "\[IndentingNewLine]", 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.777291793106742*^9, 3.777291817491798*^9}, {
   3.777293398724903*^9, 3.777293399226633*^9}, 3.777308429821271*^9, {
   3.7773084797687197`*^9, 3.7773084869856596`*^9}, {3.7773120553986316`*^9, 
   3.777312059557661*^9}, 3.7774646177559447`*^9, {3.7774647196077023`*^9, 
   3.7774647222775583`*^9}, {3.7774652952547073`*^9, 3.77746531783212*^9}, {
   3.777629046556176*^9, 3.777629048087141*^9}, {3.778943197039095*^9, 
   3.77894320122499*^9}, {3.7790283392662907`*^9, 3.779028340389787*^9}, {
   3.7791180453426347`*^9, 3.779118077294084*^9}, {3.781380345077097*^9, 
   3.781380353235358*^9}, {3.7813804449652977`*^9, 3.781380458297447*^9}, {
   3.7843826917310457`*^9, 3.784382703514003*^9}, {3.7909462726406054`*^9, 
   3.7909462781938205`*^9}, 3.7909463259549074`*^9, {3.790946525209072*^9, 
   3.790946541324334*^9}, {3.790946589114584*^9, 3.7909465904812555`*^9}, {
   3.7909466631614666`*^9, 3.7909466950898037`*^9}, {3.790946731462948*^9, 
   3.7909467334492044`*^9}, {3.793966143554037*^9, 3.793966183676689*^9}, {
   3.7939678291436357`*^9, 3.79396782924833*^9}, {3.7940601452033825`*^9, 
   3.7940601509151*^9}, {3.794060424867114*^9, 3.794060433389311*^9}, {
   3.7940673005401187`*^9, 3.794067301289827*^9}, {3.7940679269317627`*^9, 
   3.7940679562521315`*^9}, {3.8140232078263297`*^9, 3.8140232105142574`*^9}, 
   3.8141287240723886`*^9, {3.814128810511854*^9, 3.814128815368784*^9}, {
   3.81412887226987*^9, 3.8141289154439726`*^9}, {3.814128960794321*^9, 
   3.8141289629412303`*^9}, {3.814129025492433*^9, 3.814129122009341*^9}, {
   3.8141291778236623`*^9, 3.814129457838665*^9}, {3.814129531493513*^9, 
   3.8141295851225986`*^9}, {3.814129630133845*^9, 3.8141297281319838`*^9}, {
   3.814129767806593*^9, 3.814129770192413*^9}, {3.8141298380620503`*^9, 
   3.8141300369968925`*^9}, {3.883499131761595*^9, 3.883499134191976*^9}, {
   3.883560573950313*^9, 3.8835605741171618`*^9}, {3.883560624529684*^9, 
   3.883560693069129*^9}, {3.8835754590747757`*^9, 3.883575459255134*^9}, {
   3.883578020538433*^9, 3.883578025294321*^9}, {3.8837447013274117`*^9, 
   3.883744701880363*^9}, {3.941429227148509*^9, 3.9414292672242107`*^9}},
 FontFamily->"Source Sans Pro",
 FontSize->15,
 FontWeight->"Regular",
 FontColor->GrayLevel[0],
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->
  "In[391]:=",ExpressionUUID->"396cd895-3518-4daf-9dd2-d7b795632577"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "These", " ", "are", " ", "the", " ", "functions", " ", "that", " ", 
    "rebuild", " ", "the", " ", "system", " ", "denisty", " ", "matrices", 
    " ", "after", " ", 
    RowBox[{"exchange", ".", " ", "You"}], " ", "do", " ", "not", " ", "need",
     " ", "to", " ", "change", " ", "any", " ", "of", " ", 
    RowBox[{"these", "."}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"MixDensityRebind", "[", 
      RowBox[{
      "\[Rho]1_", ",", "\[Rho]2_", ",", "\[Rho]f_", ",", "\[Rho]H_", ",", 
       "kaH_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", "kaH"}], ")"}], 
       RowBox[{"KroneckerProduct", "[", 
        RowBox[{
         RowBox[{
          FractionBox["1", "2"], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"\[Rho]1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+", 
            RowBox[{"\[Rho]2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}], ",", "\[Rho]f"}], 
        "]"}]}], "+", 
      RowBox[{"kaH", "*", 
       RowBox[{"KroneckerProduct", "[", 
        RowBox[{"\[Rho]H", ",", "\[Rho]f"}], "]"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"MixDensityRebindC", "[", 
      RowBox[{
      "\[Rho]1_", ",", "\[Rho]2_", ",", "\[Rho]f_", ",", "\[Rho]H_", ",", 
       "kaH_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", "kaH"}], ")"}], 
       RowBox[{"KroneckerProduct", "[", 
        RowBox[{
         RowBox[{
          FractionBox["1", "2"], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"\[Rho]1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+", 
            RowBox[{"\[Rho]2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}], ",", 
         RowBox[{
          FractionBox["1", "2"], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"\[Rho]1", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "+", 
            RowBox[{"\[Rho]2", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}]}], "]"}]}], "+", 
      RowBox[{"kaH", "*", 
       RowBox[{"KroneckerProduct", "[", 
        RowBox[{"\[Rho]H", ",", 
         RowBox[{
          FractionBox["1", "2"], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"\[Rho]1", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "+", 
            RowBox[{"\[Rho]2", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], ")"}]}]}], "]"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MixDensityH2", "[", 
     RowBox[{"\[Rho]1_", ",", "\[Rho]2_"}], "]"}], ":=", 
    FractionBox[
     RowBox[{
      RowBox[{"\[Rho]1", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "+", 
      RowBox[{"\[Rho]2", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], "2"]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"MixDensityFree", "[", 
     RowBox[{"\[Rho]1_", ",", "\[Rho]2_"}], "]"}], ":=", 
    FractionBox[
     RowBox[{
      RowBox[{"\[Rho]1", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "+", 
      RowBox[{"\[Rho]2", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], "2"]}]}]}]], "Input",
 CellChangeTimes->{{3.767088194939649*^9, 3.7670882224528456`*^9}, {
   3.7670882553740835`*^9, 3.7670882714843864`*^9}, {3.767088311718536*^9, 
   3.7670883386724315`*^9}, {3.771325696012819*^9, 3.771325714726718*^9}, {
   3.7716813332846537`*^9, 3.7716813594417353`*^9}, {3.7716815516425753`*^9, 
   3.7716815681904187`*^9}, {3.771681724110471*^9, 3.771681725899198*^9}, {
   3.77168192135701*^9, 3.7716819248023863`*^9}, {3.7716819578045664`*^9, 
   3.771681979405874*^9}, {3.7724473482671804`*^9, 3.7724473861871014`*^9}, {
   3.772455994340501*^9, 3.772456017235848*^9}, {3.7773123496778736`*^9, 
   3.777312355256048*^9}, {3.7789464418723807`*^9, 3.7789464905973864`*^9}, {
   3.779027809780419*^9, 3.779027860814687*^9}, {3.779028034665289*^9, 
   3.7790280437506294`*^9}, {3.779030211885384*^9, 3.7790302222326574`*^9}, {
   3.779030354548317*^9, 3.779030357585486*^9}, {3.779041069029783*^9, 
   3.779041073508074*^9}, {3.7791180843117456`*^9, 3.7791181041420684`*^9}, {
   3.779118179638599*^9, 3.779118179982323*^9}, {3.779288939372305*^9, 
   3.7792889454715247`*^9}, {3.7813712925380487`*^9, 
   3.7813712991400747`*^9}, {3.7813803845397015`*^9, 3.7813804214881225`*^9}, 
   3.7813804686416388`*^9, {3.781380820271381*^9, 3.7813808423115573`*^9}, {
   3.781381030021714*^9, 3.781381046911674*^9}, {3.781381115813181*^9, 
   3.781381118388473*^9}, {3.781381490590069*^9, 3.7813814921719456`*^9}, {
   3.781381591959283*^9, 3.781381596516572*^9}, {3.7813821991225905`*^9, 
   3.781382334523884*^9}, {3.7843828368103333`*^9, 3.784382836865887*^9}, {
   3.7843829142294703`*^9, 3.784382922273328*^9}, {3.785852491667043*^9, 
   3.785852507759985*^9}, {3.78697827965256*^9, 3.7869782937240763`*^9}, {
   3.787572484870443*^9, 3.787572502881954*^9}, {3.787572680351443*^9, 
   3.7875726925500083`*^9}, {3.789833521393355*^9, 3.7898335864124117`*^9}, {
   3.7908907533719187`*^9, 3.79089075428763*^9}, {3.7939662084065185`*^9, 
   3.7939662230812635`*^9}, {3.7939663571525326`*^9, 
   3.7939663639146233`*^9}, {3.793968124089054*^9, 3.7939681748725615`*^9}, {
   3.793970088954668*^9, 3.79397010259914*^9}, {3.7940604517402115`*^9, 
   3.7940604716030674`*^9}, {3.7940673164590073`*^9, 3.794067326151325*^9}, {
   3.7941454003781233`*^9, 3.794145409386033*^9}, {3.794318284826028*^9, 
   3.794318293778064*^9}, {3.7943330951466255`*^9, 3.7943330960082407`*^9}, 
   3.7943353389814634`*^9, {3.797365277585228*^9, 3.7973652905395737`*^9}, {
   3.814023937078231*^9, 3.8140239400816174`*^9}, {3.814024048057615*^9, 
   3.8140240543228707`*^9}, {3.814130094086445*^9, 3.814130108041628*^9}, {
   3.8141301738125725`*^9, 3.8141301935259237`*^9}, {3.8141302273532486`*^9, 
   3.8141302453964415`*^9}, {3.86361479224816*^9, 3.8636148059509096`*^9}},
 FontFamily->"Source Sans Pro",
 FontSize->15,
 FontWeight->"Regular",
 FontColor->GrayLevel[0],
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->
  "In[394]:=",ExpressionUUID->"64a24b2b-daa5-46b6-9699-41916b3f8a3d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "You", " ", "will", " ", "need", " ", "a", " ", "basis", " ", "set", " ", 
     "transform", " ", "to", " ", "relax", " ", "the", " ", "triplet", " ", 
     "states", " ", "of", " ", "the", " ", "parahydrogen", " ", "derived", 
     " ", 
     RowBox[{"hydrides", ".", " ", "You"}], " ", "only", " ", "need", " ", 
     "to", " ", "change", " ", "the", " ", "power", " ", "of", " ", "base", 
     " ", "2", " ", "numbers"}], ",", " ", 
    RowBox[{
    "which", " ", "must", " ", "be", " ", "the", " ", "number", " ", "of", 
     " ", "spins", " ", "in", " ", "the", " ", 
     RowBox[{"ligand", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Ust", "=", 
     RowBox[{"SparseArray", "[", 
      RowBox[{"KroneckerProduct", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Flatten", "/@", "st"}], ")"}], ",", 
        RowBox[{"IdentityMatrix", "[", 
         SuperscriptBox["2", "1"], "]"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"UstT", "=", 
     RowBox[{"Ust", "\[ConjugateTranspose]"}]}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "This", " ", "induces", " ", "relaxation", " ", "on", " ", "the", " ", 
     "free", " ", "ligand", " ", "using", " ", "a", " ", "40", "s", " ", "T1",
      " ", "on", " ", "the", " ", 
     RowBox[{"nitrogen", ".", " ", "The"}], " ", "position", " ", "where", 
     " ", "the", " ", "T1", " ", "can", " ", "be", " ", "changed", " ", "is", 
     " ", "indicated", " ", "in", " ", "the", " ", 
     RowBox[{"function", "."}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"T1N", "=", "40"}], 
    RowBox[{"(*", "s", "*)"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"T1Hf", "=", "4"}], 
    RowBox[{"(*", "s", "*)"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"T1Hb", "=", "1"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RelaxFree", "[", 
      RowBox[{"\[Rho]_", ",", "dt_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "-", 
         RowBox[{
          FractionBox["1", "T1N"], 
          FractionBox["dt", "1000"]}]}], ")"}], "\[Rho]"}], "+", 
      RowBox[{
       FractionBox["1", "T1N"], 
       FractionBox["dt", "1000"], "*", 
       FractionBox["1", "2"], 
       RowBox[{"IdentityMatrix", "[", "2", "]"}]}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "This", " ", "induces", " ", "relaxation", " ", "on", " ", "the", " ", 
      "bound", " ", "species"}], ",", " ", 
     RowBox[{
     "relaxing", " ", "the", " ", "triplet", " ", "state", " ", "of", " ", 
      "the", " ", "parahydrogen", " ", "derived", " ", 
      RowBox[{"hydrides", ".", " ", "The"}], " ", "T1", " ", "value", " ", 
      "of", " ", "the", " ", "hydrides", " ", "is", " ", "indicated", " ", 
      RowBox[{"below", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"RelaxBound", "[", 
     RowBox[{"\[Rho]_", ",", "\[Rho]Traced_", ",", "dt_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"1", "-", 
        RowBox[{
         FractionBox["1", "T1Hb"], 
         FractionBox["dt", "1000"]}]}], ")"}], "\[Rho]"}], "+", 
     RowBox[{
      FractionBox["1", "T1Hb"], 
      FractionBox["dt", "1000"], 
      RowBox[{"RelaxTriplet", "[", 
       RowBox[{"Ust", ".", "\[Rho]", ".", "UstT"}], "]"}]}]}]}]}]}]], "Input",\

 CellChangeTimes->{{3.767088194939649*^9, 3.7670882224528456`*^9}, {
   3.7670882553740835`*^9, 3.7670882714843864`*^9}, {3.767088311718536*^9, 
   3.7670883386724315`*^9}, {3.771325696012819*^9, 3.771325714726718*^9}, {
   3.7716813332846537`*^9, 3.7716813594417353`*^9}, {3.7716815516425753`*^9, 
   3.7716815681904187`*^9}, {3.771681724110471*^9, 3.771681725899198*^9}, {
   3.77168192135701*^9, 3.7716819248023863`*^9}, {3.7716819578045664`*^9, 
   3.771681979405874*^9}, {3.7724473482671804`*^9, 3.7724473861871014`*^9}, {
   3.772455994340501*^9, 3.772456017235848*^9}, {3.7773123496778736`*^9, 
   3.777312355256048*^9}, {3.7789464418723807`*^9, 3.7789464905973864`*^9}, {
   3.779027809780419*^9, 3.779027860814687*^9}, {3.779028034665289*^9, 
   3.7790280437506294`*^9}, {3.779030211885384*^9, 3.7790302222326574`*^9}, {
   3.779030354548317*^9, 3.779030357585486*^9}, {3.779041069029783*^9, 
   3.779041073508074*^9}, {3.7791180843117456`*^9, 3.7791181041420684`*^9}, {
   3.779118179638599*^9, 3.779118179982323*^9}, {3.779288939372305*^9, 
   3.7792889454715247`*^9}, {3.7813712925380487`*^9, 
   3.7813712991400747`*^9}, {3.7813803845397015`*^9, 3.7813804214881225`*^9}, 
   3.7813804686416388`*^9, {3.781380820271381*^9, 3.7813808423115573`*^9}, {
   3.781381030021714*^9, 3.781381046911674*^9}, {3.781381115813181*^9, 
   3.781381118388473*^9}, {3.781381490590069*^9, 3.7813814921719456`*^9}, {
   3.781381591959283*^9, 3.781381596516572*^9}, {3.7813821991225905`*^9, 
   3.781382334523884*^9}, {3.7843828368103333`*^9, 3.784382836865887*^9}, {
   3.7843829142294703`*^9, 3.784382922273328*^9}, {3.785852491667043*^9, 
   3.785852507759985*^9}, {3.78697827965256*^9, 3.7869782937240763`*^9}, {
   3.787572484870443*^9, 3.787572502881954*^9}, {3.787572680351443*^9, 
   3.7875726925500083`*^9}, {3.789833521393355*^9, 3.7898335864124117`*^9}, {
   3.7908907533719187`*^9, 3.79089075428763*^9}, {3.7939662084065185`*^9, 
   3.7939662230812635`*^9}, {3.7939663571525326`*^9, 
   3.7939663639146233`*^9}, {3.793968124089054*^9, 3.7939681748725615`*^9}, {
   3.793970088954668*^9, 3.79397010259914*^9}, {3.7940604517402115`*^9, 
   3.7940604716030674`*^9}, {3.7940673164590073`*^9, 3.794067326151325*^9}, {
   3.7941454003781233`*^9, 3.794145409386033*^9}, {3.794318284826028*^9, 
   3.794318293778064*^9}, {3.7943330951466255`*^9, 3.7943330960082407`*^9}, 
   3.7943353389814634`*^9, {3.797365277585228*^9, 3.7973652905395737`*^9}, {
   3.814023937078231*^9, 3.8140239400816174`*^9}, {3.814024048057615*^9, 
   3.8140240543228707`*^9}, 3.814130094086445*^9, {3.8141302492014923`*^9, 
   3.8141303979053707`*^9}, {3.8141304292870207`*^9, 
   3.8141304475708055`*^9}, {3.814130597978222*^9, 3.814130601015879*^9}, {
   3.814130672771329*^9, 3.8141307203025417`*^9}, {3.8635245430738664`*^9, 
   3.863524544386029*^9}, {3.8635245810902834`*^9, 3.8635246593716683`*^9}, {
   3.863524715342541*^9, 3.8635247527022505`*^9}, {3.8635251876256266`*^9, 
   3.8635252036038065`*^9}, {3.883495961080242*^9, 3.883495961382093*^9}, {
   3.883569933737575*^9, 3.883570020884831*^9}, {3.883570125180872*^9, 
   3.883570231653802*^9}, {3.883570286734531*^9, 3.8835702869280977`*^9}, {
   3.883570341890697*^9, 3.883570360773786*^9}, {3.899380329086672*^9, 
   3.899380329284617*^9}, {3.910585536966949*^9, 3.9105855374969997`*^9}, {
   3.910588861653948*^9, 3.910588862240387*^9}, {3.910865655370431*^9, 
   3.910865656916554*^9}, {3.911037100927549*^9, 3.9110371018371477`*^9}, {
   3.91103838439845*^9, 3.911038390922336*^9}, {3.9111428055248404`*^9, 
   3.911142833342375*^9}, {3.941429276842348*^9, 3.941429357318308*^9}, {
   3.9414296942484903`*^9, 3.941429694421492*^9}},
 FontFamily->"Source Sans Pro",
 FontSize->15,
 FontWeight->"Regular",
 FontColor->GrayLevel[0],
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->
  "In[398]:=",ExpressionUUID->"15023cc4-d951-481c-ab39-d0958e758908"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Simulations", "Chapter",
 CellChangeTimes->{{3.941427589915021*^9, 
  3.9414276568196793`*^9}},ExpressionUUID->"574db862-bd9c-4e54-bea9-\
5a6f4a9aa45a"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"\[CapitalDelta]t", "=", "2.5"}]], "Input",
 CellChangeTimes->{{3.941428878609693*^9, 3.941428888072568*^9}, {
  3.941429584722608*^9, 3.941429585830616*^9}},
 CellLabel->
  "In[370]:=",ExpressionUUID->"72c4e47d-408c-4ac0-835e-e693d26f458d"],

Cell[BoxData["2.5`"], "Output",
 CellChangeTimes->{{3.941428879697291*^9, 3.9414288883155727`*^9}, 
   3.9414294228007*^9, {3.941429582251528*^9, 3.94142958611522*^9}, 
   3.9414297145599213`*^9, 3.9414300063185663`*^9, 3.941430561808897*^9, {
   3.941430884454174*^9, 3.941430903181723*^9}, 3.941431733888817*^9, 
   3.941432237335284*^9},
 CellLabel->
  "Out[370]=",ExpressionUUID->"6afe363f-413e-4ea9-b049-00416ecc7401"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"SHEATHFieldSweep", "=", 
   RowBox[{"AbsoluteTiming", "[", 
    RowBox[{"ParallelTable", "[", 
     RowBox[{
      RowBox[{"Last", "@", 
       RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"U1", "[", 
           RowBox[{"B0", ",", "\[CapitalDelta]t"}], "]"}], "}"}], ",", 
         RowBox[{"(*", 
          RowBox[{"propagators", " ", "for", " ", "isomer", " ", 
           RowBox[{"1", " ", "[", 
            RowBox[{"Bz", ",", "Bx", ",", "By", ",", "dt"}], "]"}]}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"U2", "[", 
           RowBox[{"B0", ",", "\[CapitalDelta]t"}], "]"}], "}"}], ",", 
         RowBox[{"(*", 
          RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"UF", "[", 
           RowBox[{"B0", ",", "\[CapitalDelta]t"}], "]"}], "}"}], ",", 
         RowBox[{"(*", 
          RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
          "*)"}], "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
         RowBox[{"(*", 
          RowBox[{
          "initial", " ", "conditions", " ", "for", " ", "bound", " ", "and", 
           " ", "free", " ", "species"}], "*)"}], ",", "\[IndentingNewLine]", 
         "16", 
         RowBox[{"(*", 
          RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",", 
         "2", 
         RowBox[{"(*", 
          RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
         "\[IndentingNewLine]", 
         FractionBox["1", "20"], 
         RowBox[{"(*", 
          FractionBox[
           RowBox[{"[", "Ir", "]"}], 
           RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
         RowBox[{"(*", 
          RowBox[{
           FractionBox[
            RowBox[{"[", "Ir", "]"}], 
            RowBox[{"[", "H2", "]"}]], ",", " ", 
           RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          FractionBox["60000", "\[CapitalDelta]t"], "}"}], 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
           ",", " ", 
           RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
         RowBox[{"{", "\[CapitalDelta]t", "}"}], 
         RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", "1"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"B0", ",", 
        RowBox[{"-", "5"}], ",", "5", ",", "0.1"}], "}"}]}], "]"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.910579349069747*^9, 3.910579349645952*^9}, {
  3.910580807010594*^9, 3.910580807651093*^9}, {3.941428847712523*^9, 
  3.941428848044002*^9}, {3.941429900516447*^9, 3.9414299123748503`*^9}, {
  3.941430543193789*^9, 3.941430568020113*^9}, {3.941430901523161*^9, 
  3.941430916331874*^9}, {3.941431735677415*^9, 3.941431737978786*^9}, {
  3.941432288365654*^9, 3.94143232449673*^9}},
 CellLabel->
  "In[413]:=",ExpressionUUID->"943d7a27-eecd-44c1-8ec8-e59156ff679c"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SHEATHFieldSweep", "[", 
  RowBox[{"[", "1", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.941431106792657*^9, 3.941431109517685*^9}},
 CellLabel->
  "In[414]:=",ExpressionUUID->"c98b50b9-bd05-4791-8e6a-136dfbdddc86"],

Cell[BoxData["657.417069`"], "Output",
 CellChangeTimes->{{3.941432300473237*^9, 3.941432313828665*^9}, 
   3.941432985434688*^9},
 CellLabel->
  "Out[414]=",ExpressionUUID->"b39f5124-07e9-4332-ae01-836921ad9f89"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"charger", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{
          RowBox[{"-", "5"}], ",", "5", ",", "0.1"}], "]"}], "[", 
        RowBox[{"[", "i", "]"}], "]"}], ",", "16", ",", "2", ",", "0.05", ",",
        "0", ",", "60000", ",", "2.5", ",", 
       RowBox[{"SHEATHFieldSweep", "[", 
        RowBox[{"[", 
         RowBox[{"2", ",", "i"}], "]"}], "]"}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", 
        RowBox[{"SHEATHFieldSweep", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.941477426729301*^9, 3.941477535996681*^9}},
 CellLabel->
  "In[483]:=",ExpressionUUID->"633f1931-bb4c-4a3c-b563-935de7b5e240"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"TimePlot", "[", 
  RowBox[{
   RowBox[{"SHEATHFieldSweep", "[", 
    RowBox[{"[", "2", "]"}], "]"}], ",", "0.1", ",", 
   RowBox[{"-", "5"}], ",", "Black", ",", 
   RowBox[{"{", 
    RowBox[{
    "\"\<\!\(\*SubscriptBox[\(B\), \(0\)]\) (\[Micro]T)\>\"", ",", 
     "\"\<Pol @ 20 s (%)\>\""}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.9105806856677513`*^9, 3.910580745880939*^9}, {
  3.910580810521227*^9, 3.910580812797635*^9}, {3.910580910939125*^9, 
  3.910580938611274*^9}, {3.910582343548978*^9, 3.9105823442242813`*^9}, {
  3.911180623105424*^9, 3.9111806281524477`*^9}, {3.941428860841915*^9, 
  3.9414288656327868`*^9}, {3.941430924134193*^9, 3.941430924546885*^9}},
 CellLabel->
  "In[415]:=",ExpressionUUID->"4d8ed523-101e-4f6d-84f4-ecde39c08ec4"],

Cell[BoxData[
 GraphicsBox[{{}, {{}, {}, 
    {GrayLevel[0], PointSize[
      NCache[
       Rational[1, 72], 0.013888888888888888`]], AbsoluteThickness[1.6], 
     LineBox[CompressedData["
1:eJw1lX9M1GUcx7/HHdwddwfHHYkeJFcTslsNJlm3SJ6POZiO6Yo12gwNLdG5
CKaCy0YjJFIrhFTmuZyWTNuaq/4wbKHPR6kGisA6xiJpk3RsnF38EA844Yj7
PB+ffb+73Z7n8/o8z+f5vN/fp7ZXFO2I0TRtx+Ib/VUjGVcf/aSlfDYoTvmi
w4mVK38UebVjIoeGEz3Gv9DbNC5udUeHA0u/Xh8KlU+IMhoOfNs9drF086RQ
PAeeOfb9nebiB8xLwpwv4nRX3pliXhJeuZVf/tzBh8yz47aawN/rfgoxz46B
q80dH0emmWfHjqHrh2u3zHJ8Ig6/t+nCdH+Y1yfg1tvZu9vL5jifDc1jVVuv
J0cE4but2F664EkdXmCeFcua994Oj2igeBZc6t+V1fOfDhQvHj2um2GvWQ+K
Z8ajRa4z1S8ZQPFM2HnkYV7XgVhQPBNuij+4uao/jnlGHHDpIr/km5gXh8cb
fF5/rxkI54vFijz/oaG9FuYZsATcd/9cZWOeAePXZQR9tkTm6bFx4vL8m3V2
5sVgVvuJDM/nSczTYYslduczrQ7mafh6U+Vr97uczNPwu2v7gpfmkjk+IofX
r97yRu4SXj8nWwuqTuvrU2AV5Xski0VBRWH/UjhJ/Fnp//B0Y89KF/Nm5PMZ
3UZbTSrzQvLXf4I9T9xMY96UBKm/lGlZzrwHMve89kFeTjrzJuQe3879xalu
5o3LeduMb6jODZ0U/69c8dtbgWu/u3n9qNzdmqh5htywi/KNyMApV4q3zQ3Z
xL8rdX9UDX5T+Jh3R2aGN4a3LUuHJooflBdzn/7M3p/G6/1y+Z6SZ431y6CW
5rvk9pRGy2R1Mv//WZ6EysD9d02P66et2PDl4jP0Cqp5sfZVmsezKl6YVTyq
C/OL+n3E5/lBIQTlR96fODRN+0Ov2r8AP+0f+XxiRJ2P40fFuDo/9qn6iARV
H+aNi6CV6odfqfqKNlVffEHVX4hzVH+OnxIfXab74Xwh0TJI98e8GdGQSffL
vFlxuJrun3mPhHEN9Qfz5sTVIuof5kXE8bXUX8zTIL+P+g97VH9C2xHqT1T6
0sExI/Uvx8fAwg3qb86nB8s89T/zDNC7hvTBPAOMCdIP82LhgCB9MS8OWi6Q
/phnhIGXSZ/MM0GHk/SLrG8YqCF98/nNYC0j/TMvHr5NI39gngVKOsk/mGeF
9z8lf2GeFbqzyX+k4tlgo7M66k9S8RLgRjP5l1S8RKjLIn+T7H+wf5L8T7I/
wmgv+aNU57eDSfknxyfBk/Pkr5L9F+4ZjFH/ZZ4DzhaQP3N+B2QvIf9mngMs
98jfmeeEF/vI/5nnhMINP0S/D8xb1E16Q/T7If8HmfLINw==
      "]]}}, {{}, {}}},
  AspectRatio->NCache[GoldenRatio^(-1), 0.6180339887498948],
  Axes->{True, True},
  AxesLabel->{None, None},
  AxesOrigin->{0, 0},
  AxesStyle->GrayLevel[0],
  DisplayFunction->Identity,
  Frame->{{True, True}, {True, True}},
  FrameLabel->{{
     FormBox["\"Pol @ 20 s (%)\"", TraditionalForm], None}, {
     FormBox[
     "\"\\!\\(\\*SubscriptBox[\\(B\\), \\(0\\)]\\) (\[Micro]T)\"", 
      TraditionalForm], None}},
  FrameStyle->Directive[Medium, 
    GrayLevel[0], FontSize -> 22],
  FrameTicks->{{Automatic, Automatic}, {Automatic, Automatic}},
  GridLines->{None, None},
  GridLinesStyle->Directive[
    GrayLevel[0.5, 0.4]],
  ImageSize->450,
  Method->{
   "OptimizePlotMarkers" -> True, "OptimizePlotMarkers" -> True, 
    "CoordinatesToolOptions" -> {"DisplayFunction" -> ({
        Identity[
         Part[#, 1]], 
        Identity[
         Part[#, 2]]}& ), "CopiedValueFunction" -> ({
        Identity[
         Part[#, 1]], 
        Identity[
         Part[#, 2]]}& )}},
  PlotRange->{{-5., 5.}, {-8.430007936391547, 8.43000793639131}},
  PlotRangeClipping->True,
  PlotRangePadding->{{
     Scaled[0.02], 
     Scaled[0.02]}, {
     Scaled[0.05], 
     Scaled[0.05]}},
  Ticks->{Automatic, Automatic}]], "Output",
 CellChangeTimes->{{3.9414323024896107`*^9, 3.941432315732608*^9}, 
   3.941432985530034*^9},
 CellLabel->
  "Out[415]=",ExpressionUUID->"830763f8-9f83-4d5e-9635-03e2f1fb8fcb"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"Range", "[", 
   RowBox[{
    RowBox[{"-", "5"}], ",", "5", ",", "0.1"}], "]"}], "[", 
  RowBox[{"[", 
   RowBox[{"FindMax", "[", 
    RowBox[{"SHEATHFieldSweep", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.941473493754216*^9, 3.9414734958797703`*^9}, {
   3.941473525901491*^9, 3.941473535730722*^9}, {3.9414744523969393`*^9, 
   3.941474491161828*^9}, {3.941474570410102*^9, 3.9414747106867657`*^9}, 
   3.941474752108939*^9, {3.941475079080085*^9, 3.9414750811539717`*^9}, {
   3.941475325459566*^9, 3.941475424956723*^9}, {3.9414754666902857`*^9, 
   3.941475522071437*^9}, 3.941475588081059*^9, {3.94147568530969*^9, 
   3.941475708227517*^9}, {3.941476382353648*^9, 3.9414763952135*^9}, {
   3.941476523342949*^9, 3.941476620541971*^9}, {3.941476661679901*^9, 
   3.94147666709657*^9}, {3.9414767532251167`*^9, 3.941476753470646*^9}, {
   3.941476788631699*^9, 3.941476788974351*^9}, {3.94147684927818*^9, 
   3.941476983407063*^9}, {3.941477116655954*^9, 3.941477146339081*^9}, {
   3.941477191612335*^9, 3.941477201976408*^9}, {3.941477296993396*^9, 
   3.9414773685323887`*^9}, 3.941477595945904*^9, 3.941477658836111*^9, {
   3.941478537181272*^9, 3.9414785586233673`*^9}},
 CellLabel->
  "In[564]:=",ExpressionUUID->"ac5b875d-79f2-473c-b0f0-4b7373855d37"],

Cell[BoxData[
 RowBox[{"-", "0.7999999999999998`"}]], "Output",
 CellChangeTimes->{{3.9414785501619062`*^9, 3.941478558849601*^9}},
 CellLabel->
  "Out[564]=",ExpressionUUID->"9a1320ef-bc2b-4d5c-8c01-06a7af5e02ff"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"UploadDataToCSV", "[", 
  RowBox[{
  "charger", ",", 
   "\"\</Users/rajivraman/Downloads/SABRE_SHEATH_Dataset.csv\>\""}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.941476792849457*^9, 3.9414767929402647`*^9}, {
   3.941476995417342*^9, 3.94147705266186*^9}, {3.941477210753599*^9, 
   3.9414772121479263`*^9}, 3.941477243407629*^9, {3.9414773500165157`*^9, 
   3.941477351252883*^9}, {3.941477541980628*^9, 3.9414775435203953`*^9}, 
   3.941477755752221*^9, 
   3.9414779762915173`*^9},ExpressionUUID->"c11108fe-c03f-48ed-bcc1-\
d441a9854055"],

Cell[BoxData["\<\"Uploaded data to CSV.\"\>"], "Output",
 CellChangeTimes->{
  3.941476793368218*^9, 3.941477053731119*^9, 3.941477148902698*^9, {
   3.941477204204199*^9, 3.941477212564748*^9}, {3.941477344813409*^9, 
   3.941477372440257*^9}, 3.941477543757435*^9, 3.94147770554144*^9, {
   3.94147775000947*^9, 3.941477765039912*^9}, 3.9414778021574574`*^9, {
   3.9414778848599854`*^9, 3.9414779118955936`*^9}},
 CellLabel->
  "Out[557]=",ExpressionUUID->"9bb6275b-0e7c-4db6-8f65-fa05f6d69288"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[CapitalDelta]t", "=", "2.5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"kNkHSweep", "=", 
   RowBox[{"ParallelTable", "[", 
    RowBox[{
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.8"}], ",", "kN", ",", "kH", ",", "0.05", ",", "0", 
         ",", "60000", ",", "2.5", ",", 
         RowBox[{"Last", "@", 
          RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"U1", "[", 
              RowBox[{
               RowBox[{"-", "0.8"}], ",", "\[CapitalDelta]t"}], "]"}], "}"}], 
            ",", 
            RowBox[{"(*", 
             RowBox[{"propagators", " ", "for", " ", "isomer", " ", 
              RowBox[{"1", " ", "[", 
               RowBox[{"Bz", ",", "Bx", ",", "By", ",", "dt"}], "]"}]}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"U2", "[", 
              RowBox[{
               RowBox[{"-", "0.8"}], ",", "\[CapitalDelta]t"}], "]"}], "}"}], 
            ",", 
            RowBox[{"(*", 
             RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"UF", "[", 
              RowBox[{
               RowBox[{"-", "0.8"}], ",", "\[CapitalDelta]t"}], "]"}], "}"}], 
            ",", 
            RowBox[{"(*", 
             RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}],
              "*)"}], "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
            RowBox[{"(*", 
             RowBox[{
             "initial", " ", "conditions", " ", "for", " ", "bound", " ", 
              "and", " ", "free", " ", "species"}], "*)"}], ",", 
            "\[IndentingNewLine]", "kN", 
            RowBox[{"(*", 
             RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], 
            ",", "kH", 
            RowBox[{"(*", 
             RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
            "\[IndentingNewLine]", 
            FractionBox["1", "20"], 
            RowBox[{"(*", 
             FractionBox[
              RowBox[{"[", "Ir", "]"}], 
              RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
            RowBox[{"(*", 
             RowBox[{
              FractionBox[
               RowBox[{"[", "Ir", "]"}], 
               RowBox[{"[", "H2", "]"}]], ",", " ", 
              RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             FractionBox["60000", "\[CapitalDelta]t"], "}"}], 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
              ",", " ", 
              RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
            RowBox[{"{", "\[CapitalDelta]t", "}"}], 
            RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", "1"}], "]"}]}]}], 
        "}"}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"kH", ",", "0.25", ",", 
         RowBox[{"kN", "-", "0.5"}], ",", "0.5"}], "}"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"kN", ",", "1", ",", "30", ",", "2"}], "}"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.9414780117119513`*^9, 3.941478020221292*^9}, {
  3.9414781837595577`*^9, 3.941478269861396*^9}, {3.9414782999149923`*^9, 
  3.941478376697051*^9}, {3.941478439906888*^9, 3.941478444339498*^9}, {
  3.941478562543689*^9, 3.941478568512959*^9}, {3.9414786991341887`*^9, 
  3.941478779773535*^9}, {3.9414788319863873`*^9, 3.941478866544839*^9}, {
  3.941479146198812*^9, 3.9414791548925447`*^9}, {3.941483951205452*^9, 
  3.941483965738777*^9}},
 CellLabel->
  "In[583]:=",ExpressionUUID->"473a157c-f14f-4e72-8ac8-9e7cb6a9c612"],

Cell[BoxData[
 RowBox[{
  RowBox[{"injection1", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"kNkHSweep", ",", "1"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.94148361357592*^9, 3.9414836611660633`*^9}},
 CellLabel->
  "In[585]:=",ExpressionUUID->"02912ffa-4d70-4fdb-9b96-324a11929df1"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"UploadDataToCSV", "[", 
  RowBox[{
  "injection1", ",", 
   "\"\</Users/rajivraman/Downloads/SABRE_SHEATH_Dataset.csv\>\""}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.941483678929894*^9, 3.941483681016911*^9}},
 CellLabel->
  "In[586]:=",ExpressionUUID->"ba3f16eb-55c0-408c-9b4e-f43ac1d2cee3"],

Cell[BoxData["\<\"Uploaded data to CSV.\"\>"], "Output",
 CellChangeTimes->{3.9414836816507998`*^9, 3.941489360606185*^9},
 CellLabel->
  "Out[586]=",ExpressionUUID->"00e808ef-756c-42e8-af86-fa8810f17996"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[CapitalDelta]t", "=", "2.5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"concentrationSweep", "=", 
   RowBox[{"ParallelTable", "[", 
    RowBox[{
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.8"}], ",", "16", ",", "2", ",", "0.05", ",", "0", 
         ",", "60000", ",", "2.5", ",", 
         RowBox[{"Last", "@", 
          RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"U1", "[", 
              RowBox[{
               RowBox[{"-", "0.8"}], ",", "\[CapitalDelta]t"}], "]"}], "}"}], 
            ",", 
            RowBox[{"(*", 
             RowBox[{"propagators", " ", "for", " ", "isomer", " ", 
              RowBox[{"1", " ", "[", 
               RowBox[{"Bz", ",", "Bx", ",", "By", ",", "dt"}], "]"}]}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"U2", "[", 
              RowBox[{
               RowBox[{"-", "0.8"}], ",", "\[CapitalDelta]t"}], "]"}], "}"}], 
            ",", 
            RowBox[{"(*", 
             RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"UF", "[", 
              RowBox[{
               RowBox[{"-", "0.8"}], ",", "\[CapitalDelta]t"}], "]"}], "}"}], 
            ",", 
            RowBox[{"(*", 
             RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}],
              "*)"}], "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
            RowBox[{"(*", 
             RowBox[{
             "initial", " ", "conditions", " ", "for", " ", "bound", " ", 
              "and", " ", "free", " ", "species"}], "*)"}], ",", 
            "\[IndentingNewLine]", "16", 
            RowBox[{"(*", 
             RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], 
            ",", "2", 
            RowBox[{"(*", 
             RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
            "\[IndentingNewLine]", "IrL", 
            RowBox[{"(*", 
             FractionBox[
              RowBox[{"[", "Ir", "]"}], 
              RowBox[{"[", "L", "]"}]], "*)"}], ",", "IrH2", 
            RowBox[{"(*", 
             RowBox[{
              FractionBox[
               RowBox[{"[", "Ir", "]"}], 
               RowBox[{"[", "H2", "]"}]], ",", " ", 
              RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             FractionBox["60000", "\[CapitalDelta]t"], "}"}], 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
              ",", " ", 
              RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
            RowBox[{"{", "\[CapitalDelta]t", "}"}], 
            RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", "1"}], "]"}]}]}], 
        "}"}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"IrL", ",", "0.01", ",", "0.5", ",", "0.02"}], "}"}]}], "]"}],
      ",", 
     RowBox[{"{", 
      RowBox[{"IrH2", ",", "0", ",", "0.2", ",", "0.02"}], "}"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.9414780117119513`*^9, 3.941478020221292*^9}, {
  3.9414781837595577`*^9, 3.941478269861396*^9}, {3.9414782999149923`*^9, 
  3.941478376697051*^9}, {3.941478439906888*^9, 3.941478444339498*^9}, {
  3.941478562543689*^9, 3.941478568512959*^9}, {3.9414786991341887`*^9, 
  3.941478779773535*^9}, {3.9414788319863873`*^9, 3.941478866544839*^9}, {
  3.941479146198812*^9, 3.9414791548925447`*^9}, {3.941483951205452*^9, 
  3.941483965738777*^9}, {3.94148972387881*^9, 3.941489824609953*^9}},
 CellLabel->
  "In[587]:=",ExpressionUUID->"f6923071-d557-459c-ac38-58b7bbd26071"],

Cell[BoxData[
 RowBox[{
  RowBox[{"injection2", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"concentrationSweep", ",", "1"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.94148361357592*^9, 3.9414836611660633`*^9}, {
  3.941489862707201*^9, 3.941489866029846*^9}},
 CellLabel->
  "In[589]:=",ExpressionUUID->"beb6a614-2b73-4541-8d8b-962364884953"],

Cell[BoxData[
 RowBox[{
  RowBox[{"concTable", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"IrL", ",", "IrH2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"IrL", ",", "0.01", ",", "0.5", ",", "0.02"}], "}"}]}], 
        "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"IrH2", ",", "0", ",", "0.2", ",", "0.02"}], "}"}]}], "]"}], 
     ",", "1"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.94149203279745*^9, 3.941492078206023*^9}, {
  3.941492194706274*^9, 3.941492199436008*^9}},
 CellLabel->
  "In[602]:=",ExpressionUUID->"e3c9b428-a191-41d2-808c-70f07d3a0c8a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"fixedInjection2", "=", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"injection2", "\[Transpose]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", 
      RowBox[{
       RowBox[{"injection2", "\[Transpose]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}], ",", 
      RowBox[{
       RowBox[{"injection2", "\[Transpose]"}], "[", 
       RowBox[{"[", "3", "]"}], "]"}], ",", 
      RowBox[{
       RowBox[{"concTable", "\[Transpose]"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], ",", 
      RowBox[{
       RowBox[{"concTable", "\[Transpose]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}], ",", 
      RowBox[{
       RowBox[{"injection2", "\[Transpose]"}], "[", 
       RowBox[{"[", "6", "]"}], "]"}], ",", 
      RowBox[{
       RowBox[{"injection2", "\[Transpose]"}], "[", 
       RowBox[{"[", "7", "]"}], "]"}], ",", 
      RowBox[{
       RowBox[{"injection2", "\[Transpose]"}], "[", 
       RowBox[{"[", "8", "]"}], "]"}]}], "}"}], "\[Transpose]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.941492089234811*^9, 3.9414921452120667`*^9}, {
  3.941492219855707*^9, 3.941492263913886*^9}},
 CellLabel->
  "In[608]:=",ExpressionUUID->"9fdfdc91-40f1-4c62-a751-712348c54ef5"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"UploadDataToCSV", "[", 
  RowBox[{
  "fixedInjection2", ",", 
   "\"\</Users/rajivraman/Downloads/SABRE_SHEATH_Dataset.csv\>\""}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.941483678929894*^9, 3.941483681016911*^9}, {
  3.941489871700366*^9, 3.9414898717883244`*^9}, {3.9414922742573357`*^9, 
  3.941492275106914*^9}},
 CellLabel->
  "In[609]:=",ExpressionUUID->"d4d89c69-80cb-401d-ada2-4ed5fa5c2a58"],

Cell[BoxData["\<\"Uploaded data to CSV.\"\>"], "Output",
 CellChangeTimes->{3.941492277555846*^9},
 CellLabel->
  "Out[609]=",ExpressionUUID->"51a880ab-eb40-460c-b9a5-848dc6bae96c"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[CapitalDelta]t", "=", "2.5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"runtimeB0Sweep", "=", 
   RowBox[{"ParallelTable", "[", 
    RowBox[{
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "B0", ",", "16", ",", "2", ",", "0.05", ",", "0", ",", "runtime", ",",
          "2.5", ",", 
         RowBox[{"Last", "@", 
          RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"U1", "[", 
              RowBox[{"B0", ",", "\[CapitalDelta]t"}], "]"}], "}"}], ",", 
            RowBox[{"(*", 
             RowBox[{"propagators", " ", "for", " ", "isomer", " ", 
              RowBox[{"1", " ", "[", 
               RowBox[{"Bz", ",", "Bx", ",", "By", ",", "dt"}], "]"}]}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"U2", "[", 
              RowBox[{"B0", ",", "\[CapitalDelta]t"}], "]"}], "}"}], ",", 
            RowBox[{"(*", 
             RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"UF", "[", 
              RowBox[{"B0", ",", "\[CapitalDelta]t"}], "]"}], "}"}], ",", 
            RowBox[{"(*", 
             RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}],
              "*)"}], "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
            RowBox[{"(*", 
             RowBox[{
             "initial", " ", "conditions", " ", "for", " ", "bound", " ", 
              "and", " ", "free", " ", "species"}], "*)"}], ",", 
            "\[IndentingNewLine]", "16", 
            RowBox[{"(*", 
             RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], 
            ",", "2", 
            RowBox[{"(*", 
             RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
            "\[IndentingNewLine]", 
            FractionBox["1", "20"], 
            RowBox[{"(*", 
             FractionBox[
              RowBox[{"[", "Ir", "]"}], 
              RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
            RowBox[{"(*", 
             RowBox[{
              FractionBox[
               RowBox[{"[", "Ir", "]"}], 
               RowBox[{"[", "H2", "]"}]], ",", " ", 
              RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             FractionBox["runtime", "\[CapitalDelta]t"], "}"}], 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
              ",", " ", 
              RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
            RowBox[{"{", "\[CapitalDelta]t", "}"}], 
            RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", "1"}], "]"}]}]}], 
        "}"}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"runtime", ",", "1000", ",", "60000", ",", "4000"}], "}"}]}], 
      "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"B0", ",", 
       RowBox[{"-", "5"}], ",", "5", ",", "0.5"}], "}"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.9414780117119513`*^9, 3.941478020221292*^9}, {
  3.9414781837595577`*^9, 3.941478269861396*^9}, {3.9414782999149923`*^9, 
  3.941478376697051*^9}, {3.941478439906888*^9, 3.941478444339498*^9}, {
  3.941478562543689*^9, 3.941478568512959*^9}, {3.9414786991341887`*^9, 
  3.941478779773535*^9}, {3.9414788319863873`*^9, 3.941478866544839*^9}, {
  3.941479146198812*^9, 3.9414791548925447`*^9}, {3.941483951205452*^9, 
  3.941483965738777*^9}, {3.94148972387881*^9, 3.941489824609953*^9}, {
  3.9414925366767187`*^9, 3.941492576971781*^9}, {3.941492617506165*^9, 
  3.9414926636613483`*^9}, {3.941492695297345*^9, 3.9414926957322598`*^9}, {
  3.941492730802472*^9, 3.941492740000216*^9}, {3.9414927810598917`*^9, 
  3.941492804681726*^9}, {3.941492844111532*^9, 3.941492849720064*^9}},
 CellLabel->
  "In[610]:=",ExpressionUUID->"33e2f13f-b16c-4121-89da-a8953482032e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"injection3", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"runtimeB0Sweep", ",", "1"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.941492877191399*^9, 3.941492891330268*^9}, {
  3.941498353567255*^9, 3.941498354248293*^9}},
 CellLabel->
  "In[613]:=",ExpressionUUID->"49ab5e2f-e5da-4084-a23f-87bf2e92cf51"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"UploadDataToCSV", "[", 
  RowBox[{
  "injection3", ",", 
   "\"\</Users/rajivraman/Downloads/SABRE_SHEATH_Dataset.csv\>\""}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.941492898741809*^9, 3.941492902672179*^9}},
 CellLabel->
  "In[615]:=",ExpressionUUID->"e2b70bf9-ea53-4644-a3fb-ac1ba286a793"],

Cell[BoxData["\<\"Uploaded data to CSV.\"\>"], "Output",
 CellChangeTimes->{3.9414983856989803`*^9},
 CellLabel->
  "Out[615]=",ExpressionUUID->"4121a072-bff2-491a-8b55-268415e25889"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"runtimeDTSweep", "=", 
   RowBox[{"ParallelTable", "[", 
    RowBox[{
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.8"}], ",", "16", ",", "2", ",", "0.05", ",", "0", 
         ",", "runtime", ",", "dt", ",", 
         RowBox[{"Last", "@", 
          RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"U1", "[", 
              RowBox[{
               RowBox[{"-", "0.8"}], ",", "dt"}], "]"}], "}"}], ",", 
            RowBox[{"(*", 
             RowBox[{"propagators", " ", "for", " ", "isomer", " ", 
              RowBox[{"1", " ", "[", 
               RowBox[{"Bz", ",", "Bx", ",", "By", ",", "dt"}], "]"}]}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"U2", "[", 
              RowBox[{
               RowBox[{"-", "0.8"}], ",", "dt"}], "]"}], "}"}], ",", 
            RowBox[{"(*", 
             RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"UF", "[", 
              RowBox[{
               RowBox[{"-", "0.8"}], ",", "dt"}], "]"}], "}"}], ",", 
            RowBox[{"(*", 
             RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}],
              "*)"}], "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
            RowBox[{"(*", 
             RowBox[{
             "initial", " ", "conditions", " ", "for", " ", "bound", " ", 
              "and", " ", "free", " ", "species"}], "*)"}], ",", 
            "\[IndentingNewLine]", "16", 
            RowBox[{"(*", 
             RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], 
            ",", "2", 
            RowBox[{"(*", 
             RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
            "\[IndentingNewLine]", 
            FractionBox["1", "20"], 
            RowBox[{"(*", 
             FractionBox[
              RowBox[{"[", "Ir", "]"}], 
              RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
            RowBox[{"(*", 
             RowBox[{
              FractionBox[
               RowBox[{"[", "Ir", "]"}], 
               RowBox[{"[", "H2", "]"}]], ",", " ", 
              RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             FractionBox["runtime", "dt"], "}"}], 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
              ",", " ", 
              RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
            RowBox[{"{", "dt", "}"}], 
            RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", "1"}], "]"}]}]}], 
        "}"}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"runtime", ",", "1000", ",", "60000", ",", "4000"}], "}"}]}], 
      "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"dt", ",", 
       RowBox[{"{", 
        RowBox[{
        "0.5", ",", "1", ",", "2.5", ",", "5", ",", "10", ",", "20", ",", 
         "50", ",", "100"}], "}"}]}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.9414780117119513`*^9, 3.941478020221292*^9}, {
  3.9414781837595577`*^9, 3.941478269861396*^9}, {3.9414782999149923`*^9, 
  3.941478376697051*^9}, {3.941478439906888*^9, 3.941478444339498*^9}, {
  3.941478562543689*^9, 3.941478568512959*^9}, {3.9414786991341887`*^9, 
  3.941478779773535*^9}, {3.9414788319863873`*^9, 3.941478866544839*^9}, {
  3.941479146198812*^9, 3.9414791548925447`*^9}, {3.941483951205452*^9, 
  3.941483965738777*^9}, {3.94148972387881*^9, 3.941489824609953*^9}, {
  3.9414925366767187`*^9, 3.941492576971781*^9}, {3.941492617506165*^9, 
  3.9414926636613483`*^9}, {3.941492695297345*^9, 3.9414926957322598`*^9}, {
  3.941492730802472*^9, 3.941492740000216*^9}, {3.9414927810598917`*^9, 
  3.941492804681726*^9}, {3.941492844111532*^9, 3.941492849720064*^9}, {
  3.941498551984025*^9, 3.9414985981871223`*^9}, {3.941498782338656*^9, 
  3.9414988403397007`*^9}},
 CellLabel->
  "In[616]:=",ExpressionUUID->"f42b1c03-eb11-4614-825b-1254704f0895"],

Cell[BoxData[
 RowBox[{
  RowBox[{"injection4", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"runtimeDTSweep", ",", "1"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.941492877191399*^9, 3.941492891330268*^9}, {
   3.941498353567255*^9, 3.941498354248293*^9}, {3.941498529036355*^9, 
   3.941498529183367*^9}, 3.941498857176588*^9},
 CellLabel->
  "In[617]:=",ExpressionUUID->"bbdea9a3-6d65-42d6-a14b-33cef58f2c98"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"UploadDataToCSV", "[", 
  RowBox[{
  "injection4", ",", 
   "\"\</Users/rajivraman/Downloads/SABRE_SHEATH_Dataset.csv\>\""}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.941492898741809*^9, 3.941492902672179*^9}, {
  3.9414993481845837`*^9, 3.941499348672647*^9}},
 CellLabel->
  "In[619]:=",ExpressionUUID->"2634b05e-16fa-4e9f-9ea3-b756e3b367ce"],

Cell[BoxData["\<\"Uploaded data to CSV.\"\>"], "Output",
 CellChangeTimes->{3.941500105428381*^9},
 CellLabel->
  "Out[619]=",ExpressionUUID->"219bc614-1673-49c4-94d4-fe5559b426a0"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{"runtimeDTSweep2", "=", 
   RowBox[{"ParallelTable", "[", 
    RowBox[{
     RowBox[{"Table", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "0.8"}], ",", "16", ",", "2", ",", "0.05", ",", "0", 
         ",", "runtime", ",", "dt", ",", 
         RowBox[{"Last", "@", 
          RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"U1", "[", 
              RowBox[{
               RowBox[{"-", "0.8"}], ",", "dt"}], "]"}], "}"}], ",", 
            RowBox[{"(*", 
             RowBox[{"propagators", " ", "for", " ", "isomer", " ", 
              RowBox[{"1", " ", "[", 
               RowBox[{"Bz", ",", "Bx", ",", "By", ",", "dt"}], "]"}]}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"U2", "[", 
              RowBox[{
               RowBox[{"-", "0.8"}], ",", "dt"}], "]"}], "}"}], ",", 
            RowBox[{"(*", 
             RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
             "*)"}], "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"UF", "[", 
              RowBox[{
               RowBox[{"-", "0.8"}], ",", "dt"}], "]"}], "}"}], ",", 
            RowBox[{"(*", 
             RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}],
              "*)"}], "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
            RowBox[{"(*", 
             RowBox[{
             "initial", " ", "conditions", " ", "for", " ", "bound", " ", 
              "and", " ", "free", " ", "species"}], "*)"}], ",", 
            "\[IndentingNewLine]", "16", 
            RowBox[{"(*", 
             RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], 
            ",", "2", 
            RowBox[{"(*", 
             RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
            "\[IndentingNewLine]", 
            FractionBox["1", "20"], 
            RowBox[{"(*", 
             FractionBox[
              RowBox[{"[", "Ir", "]"}], 
              RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
            RowBox[{"(*", 
             RowBox[{
              FractionBox[
               RowBox[{"[", "Ir", "]"}], 
               RowBox[{"[", "H2", "]"}]], ",", " ", 
              RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"{", 
             FractionBox["runtime", "dt"], "}"}], 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
              ",", " ", 
              RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
            RowBox[{"{", "dt", "}"}], 
            RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", "1"}], "]"}]}]}], 
        "}"}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"runtime", ",", "1000", ",", "60000", ",", "4000"}], "}"}]}], 
      "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"dt", ",", 
       RowBox[{"{", 
        RowBox[{"0.25", ",", "150", ",", "200", ",", "250", ",", "300"}], 
        "}"}]}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBWIQ7Xei7PzR2LeOl0XaL4BoH78fT0B034Td70H0PPfa
zyDazk/sL4i2Yv3LcgxIa9/tYgXRz1IDRUC0ZpaAKIh2805RBdFnDlTog+ia
Cf9NQXRQfqAViF4d4xYLonf1x8SBaIHJz7aeANFLtm8H0WbyNe2ngfSeFuEp
IHrdctHnZ4D0FQn5NyC60cjgI4g+ovn1G4i+1fzyF4hek/cdTN9aG/kfRB9l
bGA4C6QXvVrICqI3X5jKAaLXTGzmBdFHuMz5QLRS7f9r54H0iz9H74Bo12un
PoPoK/e4foNoJoFXRy8A6XsxAadB9KovNZevAekFLqlXQfRir1eVt4F0k+3i
ahANAFptvH8=
  "],
 CellLabel->
  "In[622]:=",ExpressionUUID->"80a7b658-119c-4620-8c89-b580f4cd9360"],

Cell[BoxData[
 RowBox[{
  RowBox[{"injection5", "=", 
   RowBox[{"Flatten", "[", 
    RowBox[{"runtimeDTSweep2", ",", "1"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.941492877191399*^9, 3.941492891330268*^9}, {
   3.941498353567255*^9, 3.941498354248293*^9}, {3.941498529036355*^9, 
   3.941498529183367*^9}, 3.941498857176588*^9, {3.941500464896825*^9, 
   3.941500466537773*^9}},
 CellLabel->
  "In[623]:=",ExpressionUUID->"cb2a4ac1-51f8-4edb-8389-2b5bbef38d2f"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"UploadDataToCSV", "[", 
  RowBox[{
  "injection5", ",", 
   "\"\</Users/rajivraman/Downloads/SABRE_SHEATH_Dataset.csv\>\""}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.941492898741809*^9, 3.941492902672179*^9}, {
  3.9414993481845837`*^9, 3.941499348672647*^9}, {3.941500468123658*^9, 
  3.941500468202384*^9}},
 CellLabel->
  "In[625]:=",ExpressionUUID->"994db34f-6a07-477e-be99-e303be88ed5a"],

Cell[BoxData["\<\"Uploaded data to CSV.\"\>"], "Output",
 CellChangeTimes->{3.941535491737191*^9},
 CellLabel->
  "Out[625]=",ExpressionUUID->"2a11690d-4d35-4105-8caa-c62fcfca4c96"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[StyleBox[" CORE",
 FontSize->36,
 FontWeight->"Bold"]], "Chapter",
 CellChangeTimes->{{3.9005041034667664`*^9, 3.900504106305999*^9}, {
  3.900504142912565*^9, 3.900504170172287*^9}, {3.9005044987210217`*^9, 
  3.9005045383639927`*^9}, {3.900504588136673*^9, 3.900504592602879*^9}, {
  3.900504887603812*^9, 3.90050488795218*^9}, {3.900507451580868*^9, 
  3.900507507165332*^9}, {3.900507703411497*^9, 3.900507730149908*^9}, {
  3.900508386137354*^9, 3.900508458682027*^9}, {3.900509017038699*^9, 
  3.900509028657703*^9}, {3.941426578734139*^9, 3.94142658989211*^9}},
 FontSize->45,
 FontWeight->"Regular",
 FontColor->GrayLevel[0],
 Background->RGBColor[
  0.9, 1, 1],ExpressionUUID->"13c91605-e72d-407d-b93b-a55b405c9d93"],

Cell[TextData[StyleBox["This entire cell should be evaluated prior to any \
calculation made in the notebook. If only specific components are required, \
each module may also be loaded individually, though the runtime difference is \
minimal.",
 FontSize->16]], "Text",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.},
 CellChangeTimes->{{3.900498890117324*^9, 3.900498956578624*^9}, {
   3.900498991363874*^9, 3.90049984283245*^9}, {3.9004998763279543`*^9, 
   3.900500270992241*^9}, {3.90050031427922*^9, 3.9005005138790207`*^9}, 
   3.900504902506783*^9, {3.90050493917238*^9, 3.900504991397406*^9}, {
   3.900505124624642*^9, 3.9005051333234863`*^9}, {3.900505169789208*^9, 
   3.900505362125183*^9}, {3.900505398303471*^9, 3.900505902772193*^9}, 
   3.900506807292096*^9, 3.900506917109418*^9, {3.900508610679535*^9, 
   3.9005086462736807`*^9}, {3.90050903979504*^9, 3.900509044738027*^9}, {
   3.9005790762174883`*^9, 3.900579076877014*^9}},
 FontSize->45,
 FontWeight->"Regular",
 Background->RGBColor[
  0.87, 0.94, 1],ExpressionUUID->"0b278a87-8e8d-4958-857a-b6202b445119"],

Cell[CellGroupData[{

Cell[TextData[StyleBox["Rajiv\[CloseCurlyQuote]s Toolbox",
 FontSize->24]], "Chapter",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.900505957185018*^9, 3.900505958128427*^9}, {
   3.90050600145219*^9, 3.90050601023938*^9}, {3.900506063993947*^9, 
   3.9005061439162292`*^9}, {3.900506917109592*^9, 3.9005069256269693`*^9}, 
   3.900507239785925*^9, 3.900507416030861*^9, {3.900508657216529*^9, 
   3.900508661908112*^9}, 3.9005088810507183`*^9},
 FontSize->24,
 FontWeight->"Regular",
 FontColor->GrayLevel[0],
 Background->RGBColor[
  0.88, 1, 0.88],ExpressionUUID->"80b55f5f-f82d-4c01-abcb-d55ba7826525"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FindMax", "[", "list_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Position", "[", 
     RowBox[{"list", ",", 
      RowBox[{"Max", "[", "list", "]"}]}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.895077257782114*^9, 3.895077369943862*^9}, 
   3.9005088810511312`*^9, {3.902481442745922*^9, 3.902481451935416*^9}, 
   3.9104322330477037`*^9, 3.910432368958514*^9, 3.910432404439392*^9, 
   3.9156165338319483`*^9, 3.915616577047537*^9, 3.922881161712843*^9, 
   3.930647333093836*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[485]:=",ExpressionUUID->"9044995d-6b21-4e14-b27e-385a1c2ea5e0"],

Cell["\<\
FSPlot takes a raw DMExFR2 field sweep from minField to maxField at \
fieldStep, and it returns a graph of the field profile.\
\>", "Text",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.895131436278171*^9, 3.895131474707206*^9}, {
   3.895132799723237*^9, 3.895132803878562*^9}, 3.900508881051175*^9, {
   3.902481442746005*^9, 3.902481451935493*^9}, 3.910432233047793*^9, 
   3.9104323689585752`*^9, 3.9104324044394493`*^9, 3.9156165338320093`*^9, 
   3.915616577047592*^9, 3.922881161712843*^9, 3.930647333093945*^9},
 FontSize->16,
 FontWeight->"Regular",ExpressionUUID->"8170ed69-07ec-447e-b2af-0fd5f7a84a81"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FSPlot", "[", 
    RowBox[{
    "rawData_", ",", "minField_", ",", "maxField_", ",", "fieldStep_"}], 
    "]"}], ":=", 
   RowBox[{"TracePlot", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"minField", ",", "maxField", ",", "fieldStep"}], "]"}], ",", 
        "rawData"}], "}"}], "\[Transpose]"}], ",", "Black", ",", 
     RowBox[{"{", 
      RowBox[{
      "\"\<\!\(\*SubscriptBox[\(B\), \(z\)]\) (\[Micro]T)\>\"", ",", 
       "\"\<Polarization (%)\>\""}], "}"}], ",", 
     RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.895078022244933*^9, 3.895078088768651*^9}, {
   3.8950781388613997`*^9, 3.895078163682807*^9}, 3.895100158949856*^9, {
   3.895132807804566*^9, 3.895132808614242*^9}, 3.9005088810513973`*^9, {
   3.902481442746285*^9, 3.9024814519357777`*^9}, 3.910432233048069*^9, 
   3.9104323689588623`*^9, 3.9104324044396687`*^9, 3.915616533832315*^9, 
   3.915616577047906*^9, 3.922881161712843*^9, 3.930647333094428*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[486]:=",ExpressionUUID->"6d59fa3a-469c-4ffb-afaa-08ff90ca4e42"],

Cell[TextData[{
 "StandardFS",
 " runs a SABRE-SHEATH field sweep with no pulsing and typical parameters ",
 Cell[BoxData[
  FormBox[
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      SubscriptBox["k", "N"], "=", 
      RowBox[{"16", " ", 
       SuperscriptBox["s", 
        RowBox[{"-", "1"}]]}]}], ",", " ", 
     RowBox[{
      SubscriptBox["k", "H"], "=", 
      RowBox[{"2", " ", 
       SuperscriptBox["s", 
        RowBox[{"-", "1"}]]}]}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"[", "Ir", "]"}], ":", 
       RowBox[{"[", "S", "]"}]}], " ", "=", " ", 
      RowBox[{"1", ":", "20"}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"[", "Ir", "]"}], ":", 
       RowBox[{"[", "H", "]"}]}], " ", "=", " ", "0"}]}]}], TraditionalForm]],
  ExpressionUUID->"359a55bb-f460-435b-9c89-e3a0bcad8054"],
 ")."
}], "Text",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.895132896007496*^9, 3.89513301361451*^9}, {
   3.89513652522682*^9, 3.8951365446195087`*^9}, 3.900508881051491*^9, {
   3.9024814427464037`*^9, 3.902481451935907*^9}, 3.910432233048177*^9, 
   3.910432368958963*^9, 3.910432404439762*^9, 3.915616533832445*^9, 
   3.915616577048023*^9, 3.922881161712843*^9, 3.930647333094513*^9},
 FontSize->16,
 FontWeight->"Regular",ExpressionUUID->"f34f0080-33da-407d-99f6-bc2954b9bfe1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"StandardFS", "[", 
   RowBox[{
   "runtime_", ",", " ", "timeStep_", ",", "minField_", ",", " ", "maxField_",
     ",", " ", "fieldStep_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"TR", " ", "=", " ", "runtime"}], ",", 
      RowBox[{"dt", "=", "timeStep"}], ",", 
      RowBox[{"min", " ", "=", " ", "minField"}], ",", " ", 
      RowBox[{"max", " ", "=", " ", "maxField"}], ",", " ", 
      RowBox[{"step", "=", " ", "fieldStep"}], ",", " ", "output"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"output", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Last", "@", 
         RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"U1", "[", 
             RowBox[{"B0", ",", "0", ",", "0", ",", "dt"}], "]"}], "}"}], ",", 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "isomer", " ", 
             RowBox[{"1", " ", "[", 
              RowBox[{"Bz", ",", "Bx", ",", "By", ",", "dt"}], "]"}]}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"U2", "[", 
             RowBox[{"B0", ",", "0", ",", "0", ",", "dt"}], "]"}], "}"}], ",", 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"UF", "[", 
             RowBox[{"B0", ",", "0", ",", "0", ",", "dt"}], "]"}], "}"}], ",", 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
            "*)"}], "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
           RowBox[{"(*", 
            RowBox[{
            "initial", " ", "conditions", " ", "for", " ", "bound", " ", 
             "and", " ", "free", " ", "species"}], "*)"}], ",", 
           "\[IndentingNewLine]", "16", 
           RowBox[{"(*", 
            RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",",
            "2", 
           RowBox[{"(*", 
            RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
           "\[IndentingNewLine]", 
           FractionBox["1", "20"], 
           RowBox[{"(*", 
            FractionBox[
             RowBox[{"[", "Ir", "]"}], 
             RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
           RowBox[{"(*", 
            RowBox[{
             FractionBox[
              RowBox[{"[", "Ir", "]"}], 
              RowBox[{"[", "H2", "]"}]], ",", " ", 
             RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"TR", "/", "dt"}], "}"}], 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
             ",", " ", 
             RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
           RowBox[{"{", "dt", "}"}], 
           RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", "1"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"B0", ",", 
          RowBox[{"-", "min"}], ",", "max", ",", "step"}], "}"}]}], "]"}]}], 
     ";"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.887359483433188*^9, 3.88735961308919*^9}, {
   3.8873596739814377`*^9, 3.887359685116671*^9}, {3.887359922447757*^9, 
   3.887359958975767*^9}, {3.8873600566410913`*^9, 3.8873600604229927`*^9}, {
   3.887360530283193*^9, 3.887360549408661*^9}, {3.887360581609803*^9, 
   3.887360662412793*^9}, {3.887361294527277*^9, 3.887361317220296*^9}, 
   3.887361367690514*^9, {3.8873614111968527`*^9, 3.887361477575032*^9}, {
   3.887361521732052*^9, 3.887361651448204*^9}, {3.887361716364909*^9, 
   3.88736173183381*^9}, {3.887362261902657*^9, 3.887362289433342*^9}, {
   3.887362351123448*^9, 3.8873627862914953`*^9}, {3.887382503867445*^9, 
   3.887382522047555*^9}, {3.887382581282659*^9, 3.887382606600277*^9}, {
   3.887382696556077*^9, 3.887382828362282*^9}, {3.887382873187916*^9, 
   3.8873828903464937`*^9}, {3.887382932139861*^9, 3.887382976350305*^9}, {
   3.887383029218276*^9, 3.8873830425396013`*^9}, {3.88738308264155*^9, 
   3.887383121875527*^9}, {3.887383157238029*^9, 3.887383211454967*^9}, {
   3.887383255727137*^9, 3.8873834538143177`*^9}, {3.8873836542121363`*^9, 
   3.8873836724094963`*^9}, {3.8873838421301537`*^9, 3.887383895206661*^9}, {
   3.8873839659562798`*^9, 3.8873842076514263`*^9}, {3.887384315221389*^9, 
   3.887384381058621*^9}, {3.8873844389353733`*^9, 3.8873847426447678`*^9}, {
   3.887384779428215*^9, 3.8873847871192837`*^9}, {3.887384829513357*^9, 
   3.887384882214867*^9}, {3.895132767931554*^9, 3.895132793911811*^9}, {
   3.89513284607835*^9, 3.895132865435748*^9}, {3.89513655530997*^9, 
   3.89513668742072*^9}, {3.895138049237238*^9, 3.895138058253577*^9}, 
   3.900508881051712*^9, {3.902481442746825*^9, 3.902481451936322*^9}, 
   3.910432233048567*^9, 3.910432368959341*^9, 3.91043240444007*^9, 
   3.915616533832735*^9, 3.9156165770483227`*^9, 3.922881161712843*^9, {
   3.922881449172433*^9, 3.922881450978021*^9}, 3.930647333094709*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[487]:=",ExpressionUUID->"6262355d-7a7e-4b85-82b9-0a7577d355c1"],

Cell[TextData[{
 "XZStrikeFS",
 " runs a SABRE-SHEATH field sweep with XZ and YZ pulsing (as suggested by \
Warren) and typical parameters ",
 Cell[BoxData[
  FormBox[
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      SubscriptBox["k", "N"], "=", 
      RowBox[{"16", " ", 
       SuperscriptBox["s", 
        RowBox[{"-", "1"}]]}]}], ",", " ", 
     RowBox[{
      SubscriptBox["k", "H"], "=", 
      RowBox[{"2", " ", 
       SuperscriptBox["s", 
        RowBox[{"-", "1"}]]}]}], ",", " ", 
     RowBox[{
      RowBox[{
       RowBox[{"[", "Ir", "]"}], ":", 
       RowBox[{"[", "S", "]"}]}], " ", "=", " ", 
      RowBox[{"1", ":", "20"}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"[", "Ir", "]"}], ":", 
       RowBox[{"[", "H", "]"}]}], " ", "=", " ", "0"}]}]}], TraditionalForm]],
  ExpressionUUID->"219252a5-6de6-497c-98e4-4a8ceab0b69a"],
 ")."
}], "Text",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.895136891995906*^9, 3.895136911659896*^9}, 
   3.900508881051792*^9, {3.902481442746951*^9, 3.902481451936445*^9}, 
   3.910432233048665*^9, 3.910432368959435*^9, 3.910432404440156*^9, 
   3.915616533832839*^9, 3.9156165770484257`*^9, 3.922881161712843*^9, 
   3.930647333094778*^9},
 FontSize->16,
 FontWeight->"Regular",ExpressionUUID->"de74281e-7d22-467d-ba72-04158d639b1e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"XZStrikeFS", "[", 
   RowBox[{
   "JSYNC_", ",", "runtime_", ",", "pulseDur_", " ", ",", "pulseStep_", ",", 
    "delayStep_", ",", "minField_", ",", " ", "maxField_", ",", " ", 
    "fieldStep_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"J", "=", "JSYNC"}], ",", 
      RowBox[{"TR", " ", "=", " ", "runtime"}], ",", 
      RowBox[{"PD", "=", "pulseDur"}], ",", 
      RowBox[{"ps", "=", "pulseStep"}], ",", 
      RowBox[{"ds", "=", "delayStep"}], ",", 
      RowBox[{"min", " ", "=", " ", "minField"}], ",", " ", 
      RowBox[{"max", " ", "=", " ", "maxField"}], ",", " ", 
      RowBox[{"step", "=", " ", "fieldStep"}], ",", " ", "\[Tau]", ",", "PP", 
      ",", "dt", ",", "DT", ",", "output"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\[Tau]", "=", 
      RowBox[{
       RowBox[{"1", "/", 
        RowBox[{"(", 
         RowBox[{"2", "*", "J"}], ")"}]}], "*", "1000"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PP", "=", " ", 
      RowBox[{"\[Pi]", "/", 
       RowBox[{"(", 
        RowBox[{"\[Gamma]H", "*", "2", "\[Pi]", "*", "PD", "*", 
         RowBox[{"Sqrt", "[", "2", "]"}], "*", 
         SuperscriptBox["10", 
          RowBox[{"-", "3"}]]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dt", "=", "ps"}], ";", "\[IndentingNewLine]", 
     RowBox[{"DT", "=", "ds"}], ";", "\[IndentingNewLine]", 
     RowBox[{"output", "=", 
      RowBox[{"ParallelTable", "[", 
       RowBox[{
        RowBox[{"Last", "@", 
         RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"U1", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U1", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}]}], "}"}], ",", 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "isomer", " ", 
             RowBox[{"1", "[", 
              RowBox[{"Bz", ",", "Bx", ",", "By", ",", "dt"}], "]"}]}], 
            "*)"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"U2", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"U2", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}]}], "}"}], ",", 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
            "*)"}], 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"UF", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", 
               RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
             RowBox[{"UF", "[", 
              RowBox[{"PP", ",", "0", ",", 
               RowBox[{"-", "PP"}], ",", "dt"}], "]"}]}], "}"}], ",", 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
            "*)"}], "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
           RowBox[{"(*", 
            RowBox[{
            "initial", " ", "conditions", " ", "for", " ", "bound", " ", 
             "and", " ", "free", " ", "species"}], "*)"}], ",", 
           "\[IndentingNewLine]", "16", 
           RowBox[{"(*", 
            RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",",
            "2", 
           RowBox[{"(*", 
            RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
           "\[IndentingNewLine]", 
           FractionBox["1", "20"], 
           RowBox[{"(*", 
            FractionBox[
             RowBox[{"[", "Ir", "]"}], 
             RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
           RowBox[{"(*", 
            RowBox[{
             FractionBox[
              RowBox[{"[", "Ir", "]"}], 
              RowBox[{"[", "H2", "]"}]], ",", " ", 
             RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
             FractionBox["\[Tau]", "DT"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox[
              RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox[
              RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox[
              RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox[
              RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox[
              RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox[
              RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox[
              RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox[
              RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox[
              RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox[
              RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox[
              RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox[
              RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
             FractionBox["PD", "dt"], ",", 
             FractionBox["PD", "dt"]}], "}"}], 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
             ",", " ", 
             RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "DT", ",", "dt", ",", "dt", ",", "DT", ",", "dt", ",", "dt", ",", 
             "DT", ",", "dt", ",", "dt", ",", "DT", ",", "dt", ",", "dt", ",",
              "dt", ",", "dt", ",", "DT", ",", "dt", ",", "dt", ",", "DT", 
             ",", "dt", ",", "dt", ",", "DT", ",", "dt", ",", "dt", ",", "dt",
              ",", "dt", ",", "DT", ",", "dt", ",", "dt", ",", "DT", ",", 
             "dt", ",", "dt", ",", "DT", ",", "dt", ",", "dt", ",", "dt", ",",
              "dt", ",", "DT", ",", "dt", ",", "dt", ",", "DT", ",", "dt", 
             ",", "dt", ",", "DT", ",", "dt", ",", "dt"}], "}"}], 
           RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", 
           RowBox[{"Round", "[", 
            FractionBox["TR", 
             RowBox[{
              RowBox[{"32", "*", "PD"}], "+", 
              RowBox[{"4", "*", "\[Tau]"}]}]], "]"}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"B0", ",", 
          RowBox[{"-", "min"}], ",", "max", ",", "step"}], "}"}]}], 
       "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.895136928327002*^9, 3.8951369572892942`*^9}, {
   3.895137002480261*^9, 3.8951370537251368`*^9}, {3.895137466706828*^9, 
   3.89513761490347*^9}, {3.895142166030365*^9, 3.895142166264018*^9}, {
   3.8952414478125877`*^9, 3.895241448679175*^9}, 3.900508881052009*^9, {
   3.902481442747754*^9, 3.9024814519373903`*^9}, 3.9104322330494137`*^9, 
   3.910432368960144*^9, 3.91043240444081*^9, 3.915616533833128*^9, 
   3.915616577048719*^9, 3.922881161712843*^9, 3.9306473330949697`*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[488]:=",ExpressionUUID->"2692444d-2ae6-4503-8f41-cbd91505ab7e"],

Cell["\<\
StandardOPT runs a standard SABRE-SHEATH field sweep and uses the optimal \
field to trace polarization over a specified runtime at that field.\
\>", "Text",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.895137743349654*^9, 3.895137797799945*^9}, {
   3.89513796812969*^9, 3.8951379698580112`*^9}, 3.900508881052054*^9, {
   3.902481442747828*^9, 3.902481451937481*^9}, 3.910432233049478*^9, 
   3.910432368960196*^9, 3.910432404440867*^9, 3.915616533833187*^9, 
   3.915616577048769*^9, 3.922881161712843*^9, 3.930647333095003*^9},
 FontSize->16,
 FontWeight->"Regular",ExpressionUUID->"07a3bbc4-6e52-4339-8e19-21050495c3c1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"StandardOPT", "[", 
   RowBox[{
   "runtime_", ",", " ", "timeStep_", ",", "minField_", ",", " ", "maxField_",
     ",", " ", "fieldStep_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"TR", " ", "=", " ", "runtime"}], ",", 
      RowBox[{"dt", "=", "timeStep"}], ",", 
      RowBox[{"min", " ", "=", " ", "minField"}], ",", " ", 
      RowBox[{"max", " ", "=", " ", "maxField"}], ",", " ", 
      RowBox[{"step", "=", " ", "fieldStep"}], ",", "raw", ",", "B0", ",", 
      " ", "output"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"raw", "=", 
      RowBox[{"StandardFS", "[", 
       RowBox[{"TR", ",", "dt", ",", "min", ",", "max", ",", "step"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"B0", "=", 
      RowBox[{
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"-", "min"}], ",", "max", ",", "step"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"FindMax", "[", "raw", "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"output", "=", 
      RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"U1", "[", 
          RowBox[{"B0", ",", "0", ",", "0", ",", "dt"}], "]"}], "}"}], ",", 
        RowBox[{"(*", 
         RowBox[{"propagators", " ", "for", " ", "isomer", " ", 
          RowBox[{"1", " ", "[", 
           RowBox[{"Bz", ",", "Bx", ",", "By", ",", "dt"}], "]"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"U2", "[", 
          RowBox[{"B0", ",", "0", ",", "0", ",", "dt"}], "]"}], "}"}], ",", 
        RowBox[{"(*", 
         RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], "*)"}],
         "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"UF", "[", 
          RowBox[{"B0", ",", "0", ",", "0", ",", "dt"}], "]"}], "}"}], ",", 
        RowBox[{"(*", 
         RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
         "*)"}], "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
        RowBox[{"(*", 
         RowBox[{
         "initial", " ", "conditions", " ", "for", " ", "bound", " ", "and", 
          " ", "free", " ", "species"}], "*)"}], ",", "\[IndentingNewLine]", 
        "16", 
        RowBox[{"(*", 
         RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",", 
        "2", 
        RowBox[{"(*", 
         RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
        "\[IndentingNewLine]", 
        FractionBox["1", "20"], 
        RowBox[{"(*", 
         FractionBox[
          RowBox[{"[", "Ir", "]"}], 
          RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
        RowBox[{"(*", 
         RowBox[{
          FractionBox[
           RowBox[{"[", "Ir", "]"}], 
           RowBox[{"[", "H2", "]"}]], ",", " ", 
          RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"TR", "/", "dt"}], "}"}], 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], ",",
           " ", 
          RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
        RowBox[{"{", "dt", "}"}], 
        RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", "1"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.895137697235181*^9, 3.895137737306468*^9}, {
   3.895137809158041*^9, 3.895137940893949*^9}, {3.895137987950197*^9, 
   3.895138023748301*^9}, {3.895138071103464*^9, 3.895138074677791*^9}, 
   3.900508881052271*^9, {3.902481442748192*^9, 3.902481451937832*^9}, 
   3.910432233049868*^9, 3.910432368960532*^9, 3.9104324044411716`*^9, 
   3.915616533833468*^9, 3.9156165770490503`*^9, 3.922881161712843*^9, 
   3.930647333095202*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[489]:=",ExpressionUUID->"23e4b4bf-70e7-41be-8fcd-469a7a6473af"],

Cell[BoxData[
 RowBox[{
  RowBox[{"JModStandardOPT", "[", 
   RowBox[{
   "runtime_", ",", " ", "timeStep_", ",", "minField_", ",", " ", "maxField_",
     ",", " ", "fieldStep_", ",", "Jcoupling_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"J", "=", "Jcoupling"}], ",", 
      RowBox[{"TR", " ", "=", " ", "runtime"}], ",", 
      RowBox[{"dt", "=", "timeStep"}], ",", 
      RowBox[{"min", " ", "=", " ", "minField"}], ",", " ", 
      RowBox[{"max", " ", "=", " ", "maxField"}], ",", " ", 
      RowBox[{"step", "=", " ", "fieldStep"}], ",", "raw", ",", "B0", ",", 
      " ", "output"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"raw", "=", 
      RowBox[{"StandardFS", "[", 
       RowBox[{"TR", ",", "dt", ",", "min", ",", "max", ",", "step"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"B0", "=", 
      RowBox[{
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"-", "min"}], ",", "max", ",", "step"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"FindMax", "[", "raw", "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"output", "=", 
      RowBox[{"{", 
       RowBox[{"B0", ",", 
        RowBox[{"Last", "@", 
         RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"U1", "[", 
             RowBox[{"J", ",", "B0", ",", "0", ",", "0", ",", "dt"}], "]"}], 
            "}"}], ",", 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "isomer", " ", 
             RowBox[{"1", " ", "[", 
              RowBox[{"Bz", ",", "Bx", ",", "By", ",", "dt"}], "]"}]}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"U2", "[", 
             RowBox[{"J", ",", "B0", ",", "0", ",", "0", ",", "dt"}], "]"}], 
            "}"}], ",", 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"UF", "[", 
             RowBox[{"J", ",", "B0", ",", "0", ",", "0", ",", "dt"}], "]"}], 
            "}"}], ",", 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
            "*)"}], "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
           RowBox[{"(*", 
            RowBox[{
            "initial", " ", "conditions", " ", "for", " ", "bound", " ", 
             "and", " ", "free", " ", "species"}], "*)"}], ",", 
           "\[IndentingNewLine]", "16", 
           RowBox[{"(*", 
            RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",",
            "2", 
           RowBox[{"(*", 
            RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
           "\[IndentingNewLine]", 
           FractionBox["1", "20"], 
           RowBox[{"(*", 
            FractionBox[
             RowBox[{"[", "Ir", "]"}], 
             RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
           RowBox[{"(*", 
            RowBox[{
             FractionBox[
              RowBox[{"[", "Ir", "]"}], 
              RowBox[{"[", "H2", "]"}]], ",", " ", 
             RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"TR", "/", "dt"}], "}"}], 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
             ",", " ", 
             RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
           RowBox[{"{", "dt", "}"}], 
           RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", "1"}], "]"}]}]}], 
       "}"}]}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.922881075156171*^9, 3.922881161712843*^9}, 
   3.9306473330954237`*^9},
 CellLabel->
  "In[490]:=",ExpressionUUID->"7360b8e0-7e36-43f7-9159-62b4432ad909"],

Cell["\<\
XZStrikeOPT runs an XZ-pulsed field sweep and uses the optimal field to trace \
polarization over a specified runtime at that field.\
\>", "Text",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.895138095533353*^9, 3.8951381063653727`*^9}, 
   3.9005088810523167`*^9, {3.902481442748267*^9, 3.902481451937896*^9}, 
   3.91043223304992*^9, 3.910432368960582*^9, 3.910432404441225*^9, 
   3.915616533833521*^9, 3.9156165770491*^9, 3.9228811738789945`*^9, 
   3.9306473330954733`*^9},
 FontSize->16,
 FontWeight->"Regular",ExpressionUUID->"53b9e7d7-3d02-47b9-8e7c-3df5c5fc797e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"XZStrikeOPT", "[", 
   RowBox[{
   "JSYNC_", ",", "runtime_", ",", "pulseDur_", " ", ",", "pulseStep_", ",", 
    "delayStep_", ",", "minField_", ",", " ", "maxField_", ",", " ", 
    "fieldStep_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"J", "=", "JSYNC"}], ",", 
      RowBox[{"TR", " ", "=", " ", "runtime"}], ",", 
      RowBox[{"PD", "=", "pulseDur"}], ",", 
      RowBox[{"ps", "=", "pulseStep"}], ",", 
      RowBox[{"ds", "=", "delayStep"}], ",", 
      RowBox[{"min", " ", "=", " ", "minField"}], ",", " ", 
      RowBox[{"max", " ", "=", " ", "maxField"}], ",", " ", 
      RowBox[{"step", "=", " ", "fieldStep"}], ",", " ", "\[Tau]", ",", "PP", 
      ",", "dt", ",", "DT", ",", "raw", ",", "B0", ",", "output"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\[Tau]", "=", 
      RowBox[{
       RowBox[{"1", "/", 
        RowBox[{"(", 
         RowBox[{"2", "*", "J"}], ")"}]}], "*", "1000"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PP", "=", " ", 
      RowBox[{"\[Pi]", "/", 
       RowBox[{"(", 
        RowBox[{"\[Gamma]H", "*", "2", "\[Pi]", "*", "PD", "*", 
         RowBox[{"Sqrt", "[", "2", "]"}], "*", 
         SuperscriptBox["10", 
          RowBox[{"-", "3"}]]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"dt", "=", "ps"}], ";", "\[IndentingNewLine]", 
     RowBox[{"DT", "=", "ds"}], ";", "\[IndentingNewLine]", 
     RowBox[{"raw", "=", 
      RowBox[{"XZStrikeFS", "[", 
       RowBox[{
       "J", ",", "TR", ",", "PD", ",", "ps", ",", "ds", ",", "min", ",", 
        "max", ",", "step"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"B0", "=", 
      RowBox[{
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"-", "min"}], ",", "max", ",", "step"}], "]"}], "[", 
       RowBox[{"[", 
        RowBox[{"FindMax", "[", "raw", "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"output", "=", 
      RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"U1", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U1", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}]}], "}"}], ",", 
        RowBox[{"(*", 
         RowBox[{"propagators", " ", "for", " ", "isomer", " ", 
          RowBox[{"1", "[", 
           RowBox[{"Bz", ",", "Bx", ",", "By", ",", "dt"}], "]"}]}], "*)"}], 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"U2", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"U2", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}]}], "}"}], ",", 
        RowBox[{"(*", 
         RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], "*)"}], 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"UF", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "PP", ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", 
            RowBox[{"-", "PP"}], ",", "0", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"B0", ",", "0", ",", "0", ",", "DT"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", "PP", ",", "dt"}], "]"}], ",", 
          RowBox[{"UF", "[", 
           RowBox[{"PP", ",", "0", ",", 
            RowBox[{"-", "PP"}], ",", "dt"}], "]"}]}], "}"}], ",", 
        RowBox[{"(*", 
         RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
         "*)"}], "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
        RowBox[{"(*", 
         RowBox[{
         "initial", " ", "conditions", " ", "for", " ", "bound", " ", "and", 
          " ", "free", " ", "species"}], "*)"}], ",", "\[IndentingNewLine]", 
        "16", 
        RowBox[{"(*", 
         RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",", 
        "2", 
        RowBox[{"(*", 
         RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
        "\[IndentingNewLine]", 
        FractionBox["1", "20"], 
        RowBox[{"(*", 
         FractionBox[
          RowBox[{"[", "Ir", "]"}], 
          RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
        RowBox[{"(*", 
         RowBox[{
          FractionBox[
           RowBox[{"[", "Ir", "]"}], 
           RowBox[{"[", "H2", "]"}]], ",", " ", 
          RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          FractionBox["\[Tau]", "DT"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox[
           RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox[
           RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox[
           RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox[
           RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox[
           RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox[
           RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox[
           RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox[
           RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox[
           RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox[
           RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox[
           RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox[
           RowBox[{"\[Tau]", "/", "4"}], "DT"], ",", 
          FractionBox["PD", "dt"], ",", 
          FractionBox["PD", "dt"]}], "}"}], 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], ",",
           " ", 
          RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "DT", ",", "dt", ",", "dt", ",", "DT", ",", "dt", ",", "dt", ",", 
          "DT", ",", "dt", ",", "dt", ",", "DT", ",", "dt", ",", "dt", ",", 
          "dt", ",", "dt", ",", "DT", ",", "dt", ",", "dt", ",", "DT", ",", 
          "dt", ",", "dt", ",", "DT", ",", "dt", ",", "dt", ",", "dt", ",", 
          "dt", ",", "DT", ",", "dt", ",", "dt", ",", "DT", ",", "dt", ",", 
          "dt", ",", "DT", ",", "dt", ",", "dt", ",", "dt", ",", "dt", ",", 
          "DT", ",", "dt", ",", "dt", ",", "DT", ",", "dt", ",", "dt", ",", 
          "DT", ",", "dt", ",", "dt"}], "}"}], 
        RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", 
        RowBox[{"Round", "[", 
         FractionBox["TR", 
          RowBox[{
           RowBox[{"32", "*", "PD"}], "+", 
           RowBox[{"4", "*", "\[Tau]"}]}]], "]"}]}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.8951381477216787`*^9, 3.89513822054687*^9}, {
   3.89513826743999*^9, 3.895138292967143*^9}, {3.8951457547822866`*^9, 
   3.8951457551187696`*^9}, {3.895241464089347*^9, 3.895241464870434*^9}, 
   3.90050888105254*^9, {3.902481442749064*^9, 3.9024814519386473`*^9}, 
   3.91043223305055*^9, 3.9104323689612637`*^9, 3.91043240444189*^9, 
   3.915616533833827*^9, 3.915616577049386*^9, 3.9228811738789945`*^9, 
   3.930647333095684*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[491]:=",ExpressionUUID->"4ad30a52-c327-4903-b4d5-d5232ba99f44"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Zeros", "[", "length_", "]"}], ":=", 
   RowBox[{"0", "*", 
    RowBox[{"Range", "[", 
     RowBox[{"1", ",", "length"}], "]"}]}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.895151828989986*^9, 3.895151847636105*^9}, 
   3.900508881052752*^9, {3.9024814427493057`*^9, 3.9024814519388638`*^9}, 
   3.910432233050754*^9, 3.9104323689614964`*^9, 3.910432404442089*^9, 
   3.9156165338341217`*^9, 3.915616577049658*^9, 3.9228811738789945`*^9, 
   3.930647333095868*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[492]:=",ExpressionUUID->"363accc3-8a15-4c94-9f1b-ebb25e577b48"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OnesList", "[", "length_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Range", "[", 
     RowBox[{"1", ",", "length"}], "]"}], "/", 
    RowBox[{"Range", "[", 
     RowBox[{"1", ",", "length"}], "]"}]}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.895151850032855*^9, 3.895151872715695*^9}, {
   3.89516113992358*^9, 3.895161140480682*^9}, 3.900508881052986*^9, {
   3.902481442749559*^9, 3.902481451939077*^9}, 3.910432233050961*^9, 
   3.910432368961713*^9, 3.910432404442281*^9, 3.9156165338343897`*^9, 
   3.9156165770499268`*^9, 3.9228811738789945`*^9, 3.930647333096066*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[493]:=",ExpressionUUID->"d0533bd4-5e09-480b-a6b6-7df65d111d27"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RectFunction", "[", 
    RowBox[{"leftEdge_", ",", "rightEdge_", ",", "point_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"UnitStep", "[", 
     RowBox[{"point", "-", "leftEdge"}], "]"}], "-", 
    RowBox[{"UnitStep", "[", 
     RowBox[{"point", "-", "rightEdge"}], "]"}]}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.895755205407206*^9, 3.895755274980722*^9}, {
   3.895755352049004*^9, 3.895755356436602*^9}, 3.900508881053195*^9, {
   3.902481442749803*^9, 3.9024814519392977`*^9}, 3.9104322330511703`*^9, 
   3.910432368961944*^9, 3.910432404442477*^9, 3.9156165338346643`*^9, 
   3.9156165770501957`*^9, 3.9228811738789945`*^9, 3.9306473330962477`*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[494]:=",ExpressionUUID->"f318d244-ace9-4494-a167-a26d71344396"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"HypeTan", "[", 
    RowBox[{"edgeFreq_", ",", "leftEdge_", ",", "rightEdge_", ",", "point_"}],
     "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Tanh", "[", 
      RowBox[{"edgeFreq", "*", 
       RowBox[{"(", 
        RowBox[{"point", "-", "leftEdge"}], ")"}]}], "]"}], "*", 
     RowBox[{"Tanh", "[", 
      RowBox[{"edgeFreq", "*", 
       RowBox[{"(", 
        RowBox[{"point", "-", "rightEdge"}], ")"}]}], "]"}]}], ")"}]}], 
  ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.895757300464916*^9, 3.895757376731559*^9}, {
   3.8957580243892403`*^9, 3.895758028096609*^9}, {3.896880574912568*^9, 
   3.896880575866872*^9}, {3.8968807225745783`*^9, 3.896880722819488*^9}, 
   3.896882420847494*^9, 3.896882667607236*^9, 3.900508881053391*^9, {
   3.9024814427500277`*^9, 3.902481451939517*^9}, 3.910432233051381*^9, 
   3.910432368962159*^9, 3.910432404442672*^9, 3.915616533834931*^9, 
   3.9156165770504704`*^9, 3.9228811738789945`*^9, 3.930647333096427*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[495]:=",ExpressionUUID->"89d6cb66-a359-4caf-8a91-4e118bd7c81d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"isoU", "[", 
    RowBox[{"\[Gamma]_", ",", "Bx_", ",", "By_", ",", "Bz_", ",", "dt_"}], 
    "]"}], ":=", 
   RowBox[{"MatrixExp", "[", 
    RowBox[{"2", "*", "\[Pi]", "*", "I", "*", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"\[Gamma]", "*", "Bx", "*", 
        RowBox[{"OperatorNF", "[", 
         RowBox[{"1", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "x"}], "}"}]}], "]"}]}], "+", 
       RowBox[{"\[Gamma]", "*", "By", "*", 
        RowBox[{"OperatorNF", "[", 
         RowBox[{"1", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "y"}], "}"}]}], "]"}]}], "+", 
       RowBox[{"\[Gamma]", "*", "Bz", "*", 
        RowBox[{"OperatorNF", "[", 
         RowBox[{"1", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "z"}], "}"}]}], "]"}]}]}], ")"}], "*", "dt", "*",
      "0.001"}], "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.8951497326333857`*^9, 3.895149746251013*^9}, {
   3.895149796651082*^9, 3.895149831499919*^9}, {3.895149883167508*^9, 
   3.895149886070665*^9}, {3.895150407719368*^9, 3.895150505539382*^9}, {
   3.895150555880587*^9, 3.895150695926717*^9}, {3.895150793229783*^9, 
   3.895150799644861*^9}, {3.895151046327347*^9, 3.895151046830756*^9}, 
   3.895151354530436*^9, {3.8951514875963383`*^9, 3.895151591278368*^9}, {
   3.8951516323857613`*^9, 3.8951516364292583`*^9}, {3.895151891743383*^9, 
   3.895151892410646*^9}, {3.8951519533907757`*^9, 3.895152011839933*^9}, {
   3.8951520560930977`*^9, 3.895152070276169*^9}, {3.8951521557750797`*^9, 
   3.8951521594204473`*^9}, {3.895152260887126*^9, 3.895152289895801*^9}, {
   3.8951524542997313`*^9, 3.895152523647026*^9}, {3.895152628699534*^9, 
   3.895152733372203*^9}, 3.895153005354231*^9, {3.8951578840482063`*^9, 
   3.895157911716091*^9}, 3.900508881053588*^9, {3.902481442750276*^9, 
   3.9024814519397497`*^9}, 3.910432233051599*^9, 3.910432368962388*^9, 
   3.910432404442875*^9, 3.9156165338352003`*^9, 3.9156165770507383`*^9, 
   3.9228811738789945`*^9, 3.930647333096614*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[496]:=",ExpressionUUID->"43fb2404-e221-4015-b474-e18fd1fae7ee"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"propGen", "[", 
    RowBox[{
    "\[Gamma]_", ",", "x_", ",", "y_", ",", "z_", ",", "dt_", ",", "T_"}], 
    "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"isoU", "[", 
      RowBox[{"\[Gamma]", ",", 
       RowBox[{"x", "[", 
        RowBox[{"[", "i", "]"}], "]"}], ",", 
       RowBox[{"y", "[", 
        RowBox[{"[", "i", "]"}], "]"}], ",", 
       RowBox[{"z", "[", 
        RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"T", "/", "dt"}]}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.895152778523364*^9, 3.895152788951653*^9}, {
   3.895152826657735*^9, 3.895152911747513*^9}, {3.8951529883767033`*^9, 
   3.89515300743598*^9}, {3.895155748165378*^9, 3.8951557831640778`*^9}, {
   3.895156825065172*^9, 3.895156844003758*^9}, 3.900508881053795*^9, {
   3.902481442750514*^9, 3.9024814519399757`*^9}, {3.909745233709324*^9, 
   3.909745235193446*^9}, 3.9104322330518303`*^9, 3.910432368962611*^9, 
   3.910432404443087*^9, 3.915616533835505*^9, 3.915616577051009*^9, 
   3.9228811738789945`*^9, 3.9306473330968018`*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[497]:=",ExpressionUUID->"76783028-d8bd-4f60-b6c9-a3b12f63d44c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ZMagEval", "[", 
    RowBox[{
    "\[Gamma]_", ",", "x_", ",", "y_", ",", "z_", ",", "times_", ",", "dt_", 
     ",", "T_"}], "]"}], ":=", 
   RowBox[{"OneLvNSolve", "[", 
    RowBox[{
     RowBox[{"propGen", "[", 
      RowBox[{"\[Gamma]", ",", "x", ",", "y", ",", "z", ",", "dt", ",", "T"}],
       "]"}], ",", 
     RowBox[{"OperatorNF", "[", 
      RowBox[{"1", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "z"}], "}"}]}], "]"}], ",", "times", ",", 
     RowBox[{"OperatorNF", "[", 
      RowBox[{"1", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "z"}], "}"}]}], "]"}]}], "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.895153021502685*^9, 3.895153022396221*^9}, {
   3.8951531107625017`*^9, 3.895153189505727*^9}, {3.895153224054278*^9, 
   3.895153293212359*^9}, {3.895153410233965*^9, 3.895153415899054*^9}, {
   3.8951537156256247`*^9, 3.895153725802828*^9}, {3.8951559901397963`*^9, 
   3.895155994608275*^9}, {3.8951560768522243`*^9, 3.895156101433351*^9}, {
   3.895156657587041*^9, 3.89515666265457*^9}, 3.900508881053987*^9, {
   3.902481442750741*^9, 3.9024814519402103`*^9}, 3.910432233052045*^9, 
   3.910432368962834*^9, 3.9104324044432993`*^9, 3.915616533835775*^9, 
   3.915616577051306*^9, 3.9228811738789945`*^9, 3.930647333097002*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[498]:=",ExpressionUUID->"ffdeae15-a439-4197-bb83-9df20bd62ee2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Normalizer", "[", "list_", "]"}], ":=", 
   RowBox[{"list", "/", 
    RowBox[{"Max", "[", 
     RowBox[{"Abs", "[", "list", "]"}], "]"}]}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.8965250230926113`*^9, 3.896525062268921*^9}, {
   3.8967847491769457`*^9, 3.896784759257169*^9}, 3.900508881054185*^9, {
   3.902481442750959*^9, 3.902481451940424*^9}, 3.910432233052245*^9, 
   3.910432368963069*^9, 3.910432404443487*^9, 3.915616533836046*^9, 
   3.915616577051586*^9, 3.9228811738789945`*^9, 3.930647333097186*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[499]:=",ExpressionUUID->"08f6e6ab-b033-4dd8-9edc-a3dae8ef378c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"XY4CosPC", "[", 
    RowBox[{"period_", ",", "power_", ",", "point_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"T", "=", "period"}], ",", 
       RowBox[{"t", "=", "point"}], ",", "domain", ",", "output"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"output", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"t", "<", "T"}], "\[Or]", 
         RowBox[{"t", ">", 
          RowBox[{"3", "T"}]}]}], ",", 
        RowBox[{"1", "-", 
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"Cos", "[", 
            FractionBox[
             RowBox[{"\[Pi]", "*", "t"}], "T"], "]"}], ")"}], "power"]}], ",", 
        RowBox[{
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"Cos", "[", 
            FractionBox[
             RowBox[{"\[Pi]", "*", "t"}], "T"], "]"}], ")"}], "power"], "-", 
         "1"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.89895670028564*^9, 3.898956866910478*^9}, {
   3.898956973245283*^9, 3.898956981788621*^9}, {3.898957288598342*^9, 
   3.8989574873451014`*^9}, 3.8989576880332336`*^9, 3.9005088810543756`*^9, {
   3.902481442751199*^9, 3.9024814519406567`*^9}, 3.910432233052463*^9, 
   3.910432368963355*^9, 3.9104324044437017`*^9, 3.9156165338363247`*^9, 
   3.915616577051859*^9, 3.9228811738789945`*^9, 3.9306473330973682`*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[500]:=",ExpressionUUID->"ab84127b-e226-4a08-9f63-9cf14d63c8fb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PhaseCycle", "[", 
    RowBox[{"pulse_", ",", "period_", ",", "dt_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"stitch", ",", "times", ",", 
       RowBox[{"P", "=", "period"}], ",", "cycledStitch", ",", "output"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"stitch", "=", 
       RowBox[{"Delete", "[", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{"pulse", ",", "pulse", ",", "pulse", ",", "pulse"}], "]"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Floor", "[", 
             RowBox[{"period", "/", 
              RowBox[{"(", "dt", ")"}]}], "]"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", "*", 
             RowBox[{"Floor", "[", 
              RowBox[{"period", "/", 
               RowBox[{"(", "dt", ")"}]}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", "*", 
             RowBox[{"Floor", "[", 
              RowBox[{"period", "/", 
               RowBox[{"(", "dt", ")"}]}], "]"}]}], "}"}]}], "}"}]}], "]"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"0", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "stitch", "]"}], "*", "dt"}], "-", "dt"}], 
         ",", "dt"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cycledStitch", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"stitch", "[", 
           RowBox[{"[", "j", "]"}], "]"}], "*", 
          RowBox[{"XY4CosPC", "[", 
           RowBox[{"P", ",", "12", ",", 
            RowBox[{"times", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           RowBox[{"Length", "[", "times", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"output", "=", "cycledStitch"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.896436020948139*^9, 3.8964360455949583`*^9}, {
   3.896436117560588*^9, 3.896436210449005*^9}, {3.896436242778863*^9, 
   3.8964362891793737`*^9}, {3.8964420928882103`*^9, 3.896442194541094*^9}, {
   3.8964423034247913`*^9, 3.8964424258401623`*^9}, {3.896442493987343*^9, 
   3.896442529756784*^9}, {3.896442598043908*^9, 3.896442863074862*^9}, {
   3.89644299120548*^9, 3.896442991850997*^9}, {3.896443104417768*^9, 
   3.896443105010426*^9}, {3.896443217012992*^9, 3.896443287443679*^9}, {
   3.896446013765275*^9, 3.8964460170555363`*^9}, {3.896795383994019*^9, 
   3.896795392666287*^9}, {3.896797154094492*^9, 3.8967971882750053`*^9}, {
   3.8967989763256283`*^9, 3.896798977341607*^9}, {3.8967990502997093`*^9, 
   3.896799051144273*^9}, {3.89679917356083*^9, 3.896799194722533*^9}, {
   3.896806092047724*^9, 3.896806111570489*^9}, {3.898761787287532*^9, 
   3.898761790647736*^9}, {3.898761847811624*^9, 3.8987619329227448`*^9}, {
   3.898761974399576*^9, 3.898762131248007*^9}, {3.8987623663675947`*^9, 
   3.898762421167438*^9}, {3.898765049228713*^9, 3.8987650552955093`*^9}, {
   3.8987867474528103`*^9, 3.8987867495534267`*^9}, {3.898957716252619*^9, 
   3.898957731200067*^9}, {3.898957773495887*^9, 3.898957792925275*^9}, {
   3.899814897005526*^9, 3.8998149010786858`*^9}, 3.9005088810545692`*^9, {
   3.9024814427514677`*^9, 3.902481451940921*^9}, 3.9104322330527067`*^9, 
   3.910432368963625*^9, 3.9104324044439497`*^9, 3.9156165338365927`*^9, 
   3.9156165770521317`*^9, 3.9228811738789945`*^9, 3.930647333097554*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[501]:=",ExpressionUUID->"889ef677-d88d-49bc-a983-572a38944da1"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CosProduct", "[", 
    RowBox[{"degree_", ",", "domain_", ",", "possibleFreqs_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"freqs", ",", "product", ",", "output"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"freqs", "=", 
       RowBox[{"possibleFreqs", "[", 
        RowBox[{"[", 
         RowBox[{"1", ";;", "degree"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"product", "=", 
       RowBox[{"Times", "@@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{
              RowBox[{"freqs", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "*", 
              RowBox[{"domain", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "1", ",", 
              RowBox[{"Length", "[", "domain", "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "degree"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"output", "=", "product"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.896806120549872*^9, {3.8976631687205067`*^9, 3.8976631694325933`*^9}, 
   3.900508881054777*^9, {3.902481442751712*^9, 3.902481451941161*^9}, 
   3.910432233052928*^9, 3.9104323689638577`*^9, 3.910432404444174*^9, 
   3.915616533836864*^9, 3.91561657705241*^9, 3.9228811738789945`*^9, 
   3.930647333097742*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[502]:=",ExpressionUUID->"33e7099c-e9f5-4c6d-86fe-e41cbd76e3c5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SineMod", "[", 
    RowBox[{"cycles_", ",", "period_", ",", "phase_", ",", "domain_"}], "]"}],
    ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Sin", "[", 
      RowBox[{
       RowBox[{
        FractionBox[
         RowBox[{"2", "\[Pi]", "*", "cycles"}], "period"], "*", 
        RowBox[{"domain", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], "-", "phase"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "domain", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.8965284718660994`*^9, 3.89652853228454*^9}, {
   3.896528587186551*^9, 3.8965285882221537`*^9}, {3.896537747445026*^9, 
   3.8965377514829473`*^9}, {3.896537909570671*^9, 3.8965379229884977`*^9}, {
   3.8965383805079803`*^9, 3.896538458313406*^9}, 3.8965386575209713`*^9, {
   3.896538717405198*^9, 3.896538720834507*^9}, {3.897663158295615*^9, 
   3.897663158736218*^9}, 3.900508881054966*^9, {3.9024814427519407`*^9, 
   3.902481451941383*^9}, 3.910432233053133*^9, 3.91043236896408*^9, 
   3.910432404444372*^9, 3.915616533837131*^9, 3.9156165770526876`*^9, 
   3.9228811738789945`*^9, 3.930647333097926*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[503]:=",ExpressionUUID->"92d32430-5627-4c27-a225-e93623f7510e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PolyMod", "[", 
    RowBox[{"cheb_", ",", "period_", ",", "domain_"}], "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"ChebyshevT", "[", 
      RowBox[{"cheb", ",", 
       RowBox[{
        RowBox[{"domain", "[", 
         RowBox[{"[", "i", "]"}], "]"}], "-", 
        RowBox[{"period", "/", "2"}]}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "domain", "]"}]}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.896528542773839*^9, 3.896528590669037*^9}, {
   3.896539176233472*^9, 3.8965392323879213`*^9}, {3.896540806341743*^9, 
   3.896540839169675*^9}, {3.8965410374530287`*^9, 3.89654106893447*^9}, {
   3.897663161290588*^9, 3.897663161494813*^9}, 3.9005088810551558`*^9, {
   3.902481442752174*^9, 3.9024814519416027`*^9}, 3.910432233053338*^9, 
   3.9104323689642973`*^9, 3.910432404444569*^9, 3.915616533837422*^9, 
   3.915616577052966*^9, 3.9228811738789945`*^9, 3.9306473330981092`*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[504]:=",ExpressionUUID->"34344d3b-b2d9-42f7-8082-48a046623c23"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"TimeAmpMod", "[", 
    RowBox[{
    "cycles_", ",", "phase_", ",", "cheb_", ",", "period_", ",", "domain_", 
     ",", "phaseCount_"}], "]"}], ":=", 
   RowBox[{"Delete", "[", 
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"cycles", "==", "0"}], ",", 
       RowBox[{"OnesList", "[", 
        RowBox[{"4", "*", 
         RowBox[{"Length", "[", "domain", "]"}]}], "]"}], ",", 
       RowBox[{"Join", "@@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"SineMod", "[", 
            RowBox[{"cycles", ",", "period", ",", "phase", ",", "domain"}], 
            "]"}], "*", 
           RowBox[{"PolyMod", "[", 
            RowBox[{"cheb", ",", "period", ",", "domain"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", "1", ",", "phaseCount"}], "}"}]}], "]"}]}]}], 
      "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Floor", "[", 
         RowBox[{"period", "/", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"domain", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "-", 
            RowBox[{"domain", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}], "]"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"Floor", "[", 
         RowBox[{"2", "*", 
          RowBox[{"period", "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"domain", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "-", 
             RowBox[{"domain", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}], "}"}], ",", 
       
       RowBox[{"{", 
        RowBox[{"Floor", "[", 
         RowBox[{"3", "*", 
          RowBox[{"period", "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"domain", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "-", 
             RowBox[{"domain", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}]}], "]"}], "}"}]}], 
      "}"}]}], "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.896542388813583*^9, 3.896542410623328*^9}, {
   3.89654246475144*^9, 3.896542503349371*^9}, {3.89654259865528*^9, 
   3.896542644228219*^9}, {3.896804763978561*^9, 3.896804878745626*^9}, 
   3.896883574848363*^9, {3.89688393625418*^9, 3.896883943246475*^9}, {
   3.896883990065349*^9, 3.8968839914738007`*^9}, {3.8968840336876802`*^9, 
   3.8968840682548103`*^9}, {3.8968842993756857`*^9, 
   3.8968843130057573`*^9}, {3.896884343747674*^9, 3.896884357078977*^9}, {
   3.896884548866138*^9, 3.896884572822694*^9}, {3.896885520840864*^9, 
   3.896885536079329*^9}, {3.8968856014545307`*^9, 3.896885609179598*^9}, 
   3.900508881055355*^9, {3.902481442752452*^9, 3.9024814519418592`*^9}, 
   3.910432233053568*^9, 3.910432368964542*^9, 3.9104324044447947`*^9, 
   3.915616533837707*^9, 3.915616577053238*^9, 3.9228811738789945`*^9, 
   3.9306473330982943`*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[505]:=",ExpressionUUID->"ebae434a-887b-49fc-9c47-86907735db4a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PeriodToXY16", "[", 
    RowBox[{
    "fullPulse_", ",", "period_", ",", "timestep_", ",", "edgeFreq_"}], "]"}],
    ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"P", "=", "period"}], ",", 
       RowBox[{"dt", "=", "timestep"}], ",", 
       RowBox[{"F", "=", "edgeFreq"}], ",", "delay", ",", "delayPulse", ",", 
       "cycler", ",", "times", ",", "output"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"times", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Round", "[", 
          RowBox[{
           FractionBox[
            RowBox[{"16", "*", "period"}], "3"], ",", "dt"}], "]"}], ",", 
         "dt"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"delay", "=", 
       RowBox[{"Round", "[", 
        RowBox[{
         FractionBox[
          RowBox[{"4", "*", "period"}], "3"], ",", "dt"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"delayPulse", "=", 
       RowBox[{"Zeros", "[", 
        FractionBox["delay", "dt"], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cycler", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "1"}], "*", 
          RowBox[{"fullPulse", "[", 
           RowBox[{"[", "j", "]"}], "]"}], "*", 
          RowBox[{"HypeTan", "[", 
           RowBox[{"F", ",", "0", ",", "P", ",", 
            RowBox[{"times", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "*", 
          RowBox[{"HypeTan", "[", 
           RowBox[{"F", ",", 
            RowBox[{"3", "P"}], ",", 
            RowBox[{"4", "P"}], ",", 
            RowBox[{"times", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           RowBox[{"Length", "[", "fullPulse", "]"}]}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"Join", "[", 
        RowBox[{"delayPulse", ",", "cycler"}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.8968805174587097`*^9, 3.8968805242715816`*^9}, {
   3.896880802637149*^9, 3.896880825067628*^9}, {3.8968826808204107`*^9, 
   3.896882681323941*^9}, {3.896882723062972*^9, 3.896882724203158*^9}, {
   3.897648528668296*^9, 3.897648529324724*^9}, {3.8986893344672947`*^9, 
   3.898689341476079*^9}, 3.900508881055543*^9, {3.9024814427527227`*^9, 
   3.902481451942127*^9}, 3.9104322330538073`*^9, 3.91043236896481*^9, 
   3.9104324044450502`*^9, 3.915616533837987*^9, 3.915616577053513*^9, 
   3.9228811738789945`*^9, 3.930647333098482*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[506]:=",ExpressionUUID->"499d0dc8-0b1f-495c-ab66-286b8bac8e02"],

Cell[BoxData[
 RowBox[{
  RowBox[{"OneLvNSolve", "[", 
   RowBox[{"U1_", ",", "\[Rho]0_", ",", "tf_", ",", "OP_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Rho]1", ",", "expectationValue", ",", "j", ",", "i"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"\[Rho]1", "=", "\[Rho]0"}], ";", "\[IndentingNewLine]", 
     RowBox[{"expectationValue", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"j", "=", "1"}], ",", 
       RowBox[{"j", "\[LessEqual]", 
        RowBox[{"Length", "[", "tf", "]"}]}], ",", 
       RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "\[LessEqual]", 
           RowBox[{
           "tf", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}], 
          ",", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"\[Rho]1", "=", 
            RowBox[{
             RowBox[{"ConjugateTranspose", "[", 
              RowBox[{
              "U1", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
              "]"}], ".", "\[Rho]1", ".", 
             RowBox[{
             "U1", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}]}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"expectationValue", ",", 
             RowBox[{"Chop", "[", 
              RowBox[{"Tr", "[", 
               RowBox[{"\[Rho]1", ".", "OP"}], "]"}], "]"}]}], "]"}], ";"}]}],
          "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
      ";", "\[IndentingNewLine]", 
     RowBox[{
      FractionBox["100", 
       RowBox[{"Norm", "[", "OP", "]"}]], "expectationValue"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.897037010687278*^9, 3.897037020421579*^9}, 
   3.900508881055751*^9, {3.902481442752993*^9, 3.902481451942379*^9}, 
   3.910432233054039*^9, 3.9104323689650583`*^9, 3.910432404445278*^9, 
   3.915616533838273*^9, 3.915616577053782*^9, 3.9228811738789945`*^9, 
   3.9306473330986633`*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[507]:=",ExpressionUUID->"86dd1f48-96ec-4b9c-962e-99af82577aab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SoloMagnetizationTracker", "[", 
   RowBox[{
   "shaped3DPulse_", ",", "\[Gamma]_", ",", "initialDensityMatrix_", ",", 
    "targetExpectationOperator_", ",", "timestep_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"dt", "=", "timestep"}], ",", 
      RowBox[{"idm", "=", "initialDensityMatrix"}], ",", 
      RowBox[{"ExpOp", "=", "targetExpectationOperator"}], ",", "xChannel", 
      ",", "yChannel", ",", "zChannel", ",", "testProps", ",", "testList", 
      ",", "output"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"xChannel", "=", 
      RowBox[{"shaped3DPulse", "[", 
       RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"yChannel", "=", 
      RowBox[{"shaped3DPulse", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"zChannel", "=", 
      RowBox[{"shaped3DPulse", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"testProps", "=", 
      RowBox[{"propGen", "[", 
       RowBox[{
       "\[Gamma]", ",", "xChannel", ",", "yChannel", ",", "zChannel", ",", 
        "dt", ",", 
        RowBox[{
         RowBox[{"Length", "[", "xChannel", "]"}], "*", "dt"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"output", "=", 
      RowBox[{"OneLvNSolve", "[", 
       RowBox[{"testProps", ",", "idm", ",", 
        RowBox[{"OnesList", "[", 
         RowBox[{"Length", "[", "testProps", "]"}], "]"}], ",", "ExpOp"}], 
       "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.8958393581915407`*^9, 3.895839404211378*^9}, {
   3.8958398719490223`*^9, 3.895839926273278*^9}, {3.8958399991096478`*^9, 
   3.895840035600305*^9}, {3.8958400847248077`*^9, 3.895840309243133*^9}, 
   3.895840740766515*^9, {3.895841314873458*^9, 3.8958413185034037`*^9}, {
   3.897037319499833*^9, 3.89703733580694*^9}, {3.897039467528491*^9, 
   3.897039534963265*^9}, {3.8970396166222897`*^9, 3.8970396465137587`*^9}, {
   3.897040333907119*^9, 3.897040342131337*^9}, {3.897040392265499*^9, 
   3.89704040006846*^9}, 3.900508881055938*^9, {3.902481442753251*^9, 
   3.902481451942627*^9}, 3.910432233054269*^9, 3.910432368965293*^9, 
   3.9104324044454927`*^9, 3.915616533838667*^9, 3.915616577054078*^9, 
   3.9228811738789945`*^9, 3.9306473330988407`*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[508]:=",ExpressionUUID->"6cff9846-1c24-4894-b208-b1f4d58471dd"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FinalExpVal", "[", 
    RowBox[{
    "shaped3DPulse_", ",", "\[Gamma]_", ",", "initialDensityMatrix_", ",", 
     "targetExpectationOperator_", ",", "timestep_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"dt", "=", "timestep"}], ",", 
       RowBox[{"idm", "=", "initialDensityMatrix"}], ",", 
       RowBox[{"ExpOp", "=", "targetExpectationOperator"}], ",", "xChannel", 
       ",", "yChannel", ",", "zChannel", ",", "testProps", ",", "testList", 
       ",", "hold", ",", "output"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xChannel", "=", 
       RowBox[{"shaped3DPulse", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"yChannel", "=", 
       RowBox[{"shaped3DPulse", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"zChannel", "=", 
       RowBox[{"shaped3DPulse", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"testProps", "=", 
       RowBox[{"propGen", "[", 
        RowBox[{
        "\[Gamma]", ",", "xChannel", ",", "yChannel", ",", "zChannel", ",", 
         "dt", ",", 
         RowBox[{
          RowBox[{"Length", "[", "xChannel", "]"}], "*", "dt"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"Last", "@", 
        RowBox[{"OneLvNSolve", "[", 
         RowBox[{"testProps", ",", "idm", ",", 
          RowBox[{"OnesList", "[", 
           RowBox[{"Length", "[", "testProps", "]"}], "]"}], ",", "ExpOp"}], 
         "]"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.897037349193783*^9, 3.897037374441552*^9}, {
   3.897038933732648*^9, 3.897038964909697*^9}, {3.897039471385869*^9, 
   3.89703948109501*^9}, 3.897039523461309*^9, {3.897039654961678*^9, 
   3.897039655181006*^9}, {3.8970403248493233`*^9, 3.8970403300824423`*^9}, {
   3.897040404312448*^9, 3.897040405831709*^9}, {3.897040780103507*^9, 
   3.897040790968536*^9}, {3.89704082506168*^9, 3.897040885953182*^9}, 
   3.9005088810561237`*^9, {3.90248144275351*^9, 3.9024814519428873`*^9}, 
   3.91043223305449*^9, 3.9104323689655323`*^9, 3.910432404445702*^9, 
   3.915616533839023*^9, 3.9156165770543537`*^9, 3.9228811738789945`*^9, 
   3.9306473330990257`*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[509]:=",ExpressionUUID->"83fcca06-6e13-4a9d-a480-8d945be2ded7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"OptimizedPropagation", "[", 
    RowBox[{
    "\[Gamma]_", ",", "XYZshapes_", ",", "initialDensityMatrix_", ",", 
     "ExpOp_", ",", "timestep_", ",", "nullField_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"dt", "=", "timestep"}], ",", 
       RowBox[{"NF", "=", "nullField"}], ",", "x", ",", "y", ",", "z", ",", 
       RowBox[{"idm", "=", "initialDensityMatrix"}], ",", 
       RowBox[{"OP", "=", "ExpOp"}], ",", "binList", ",", "indexFinder", ",", 
       "cleaner", ",", "cleanList", ",", "propList", ",", "hold", ",", 
       "output"}], "}"}], ",", 
     RowBox[{
      RowBox[{"x", "=", 
       RowBox[{"XYZshapes", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"B", 
         RowBox[{"(", "t", ")"}], " ", "applied", " ", "along", " ", "x"}], 
        "-", "axis"}], "*)"}], 
      RowBox[{"y", "=", 
       RowBox[{"XYZshapes", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"B", 
         RowBox[{"(", "t", ")"}], " ", "applied", " ", "along", " ", "y"}], 
        "-", "axis"}], "*)"}], 
      RowBox[{"z", "=", 
       RowBox[{"XYZshapes", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"B", 
         RowBox[{"(", "t", ")"}], " ", "applied", " ", "along", " ", "z"}], 
        "-", "axis"}], "*)"}], 
      RowBox[{"binList", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Chop", "[", 
              RowBox[{
               RowBox[{"x", "[", 
                RowBox[{"[", "j", "]"}], "]"}], ",", "NF"}], "]"}], "==", 
             "0"}], "&&", 
            RowBox[{
             RowBox[{"Chop", "[", 
              RowBox[{
               RowBox[{"y", "[", 
                RowBox[{"[", "j", "]"}], "]"}], ",", "NF"}], "]"}], "==", 
             "0"}]}], ",", "0", ",", "1"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
       "binary", " ", "list", " ", "that", " ", "toggles", " ", "to", " ", 
        "1", " ", "when", " ", "Bx", 
        RowBox[{"(", "t", ")"}], " ", "and", " ", "By", 
        RowBox[{"(", "t", ")"}], " ", "are", " ", "both", " ", "0", " ", 
        "under", " ", "some", " ", "chop", " ", "threshold"}], "*)"}], 
      RowBox[{"indexFinder", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
       "blank", " ", "list", " ", "where", " ", "toggled", " ", "indeces", 
        " ", "will", " ", "be", " ", "tracked"}], "*)"}], 
      RowBox[{"cleaner", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "imperfect", " ", "chops", " ", "within", " ", "binList", " ", "can", 
         " ", "cause", " ", "delays", " ", "of", " ", "length", " ", "dt", 
         " ", "to", " ", "be", " ", "found", " ", "in", " ", "the", " ", 
         "middle", " ", "of", " ", "pulses"}], "-", 
        RowBox[{
        "cleaner", " ", "will", " ", "allow", " ", "us", " ", "to", " ", 
         "clip", " ", "out", " ", "these", " ", "useless", " ", "indeces"}]}],
        "*)"}], 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "2"}], ",", 
        RowBox[{"j", "<=", 
         RowBox[{"Length", "[", "binList", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"binList", "[", 
            RowBox[{"[", 
             RowBox[{"j", "-", "1"}], "]"}], "]"}], "!=", 
           RowBox[{"binList", "[", 
            RowBox[{"[", "j", "]"}], "]"}]}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"indexFinder", ",", "j"}], "]"}]}], "]"}]}], "]"}], ";", 
      RowBox[{"(*", 
       RowBox[{
       "indexFinder", " ", "traces", " ", "all", " ", "indeces", " ", "where",
         " ", "binList", " ", "switches", " ", "from", " ", "0", " ", "to", 
        " ", "1", " ", "or", " ", "1", " ", "to", " ", "0"}], "*)"}], 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "2"}], ",", 
        RowBox[{"j", "<=", 
         RowBox[{"Length", "[", "indexFinder", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"indexFinder", "[", 
            RowBox[{"[", "j", "]"}], "]"}], "==", 
           RowBox[{
            RowBox[{"indexFinder", "[", 
             RowBox[{"[", 
              RowBox[{"j", "-", "1"}], "]"}], "]"}], "+", "1"}]}], ",", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"cleaner", ",", 
             RowBox[{"{", 
              RowBox[{"j", "-", "1"}], "}"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"cleaner", ",", 
             RowBox[{"{", "j", "}"}]}], "]"}], ";"}]}], "]"}]}], "]"}], ";", 
      RowBox[{"(*", 
       RowBox[{
       "cleaner", " ", "picks", " ", "up", " ", "all", " ", "delays", " ", 
        "of", " ", "length", " ", "dt"}], "*)"}], 
      RowBox[{"cleanList", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", "1", "}"}], ",", 
         RowBox[{"Delete", "[", 
          RowBox[{"indexFinder", ",", "cleaner"}], "]"}]}], "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"ultra", "-", 
        RowBox[{
        "short", " ", "delays", " ", "embedded", " ", "in", " ", "pulses", 
         " ", "are", " ", "deleted", " ", "from", " ", "indexFinder"}]}], 
       "*)"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Mod", "[", 
          RowBox[{
           RowBox[{"Length", "[", "cleanList", "]"}], ",", "2"}], "]"}], "==",
          "1"}], ",", 
        RowBox[{
         RowBox[{"propList", "=", 
          RowBox[{"Join", "@@", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"isoU", "[", 
                 RowBox[{"\[Gamma]", ",", 
                  RowBox[{"x", "[", 
                   RowBox[{"[", 
                    RowBox[{"cleanList", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", "-", "1"}], "]"}], "]"}], "]"}], "]"}], ",", 
                  
                  RowBox[{"y", "[", 
                   RowBox[{"[", 
                    RowBox[{"cleanList", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", "-", "1"}], "]"}], "]"}], "]"}], "]"}], ",", 
                  
                  RowBox[{"z", "[", 
                   RowBox[{"[", 
                    RowBox[{"cleanList", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", "-", "1"}], "]"}], "]"}], "]"}], "]"}], ",", 
                  
                  RowBox[{"dt", "*", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"cleanList", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "-", 
                    RowBox[{"cleanList", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", "-", "1"}], "]"}], "]"}]}], ")"}]}]}], "]"}],
                 "}"}], ",", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"isoU", "[", 
                  RowBox[{"\[Gamma]", ",", 
                   RowBox[{"x", "[", 
                    RowBox[{"[", "k", "]"}], "]"}], ",", 
                   RowBox[{"y", "[", 
                    RowBox[{"[", "k", "]"}], "]"}], ",", 
                   RowBox[{"z", "[", 
                    RowBox[{"[", "k", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"k", ",", 
                   RowBox[{"cleanList", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ",", 
                   RowBox[{
                    RowBox[{"cleanList", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", "+", "1"}], "]"}], "]"}], "-", "1"}]}], 
                  "}"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "2", ",", 
               RowBox[{
                RowBox[{"Length", "[", "cleanList", "]"}], "-", "1"}], ",", 
               "2"}], "}"}]}], "]"}]}]}], ";"}], 
        RowBox[{"(*", 
         RowBox[{
         "generates", " ", "an", " ", "optimized", " ", "list", " ", "of", 
          " ", "propagators", " ", "with", " ", "all", " ", "delays", " ", 
          "treated", " ", "via", " ", "one", " ", "propagator", " ", "each"}],
          "*)"}], ",", 
        RowBox[{
         RowBox[{"propList", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"isoU", "[", 
             RowBox[{"\[Gamma]", ",", 
              RowBox[{"x", "[", 
               RowBox[{"[", "k", "]"}], "]"}], ",", 
              RowBox[{"y", "[", 
               RowBox[{"[", "k", "]"}], "]"}], ",", 
              RowBox[{"z", "[", 
               RowBox[{"[", "k", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"k", ",", "1", ",", 
              RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], "]"}]}], ";"}]}], 
       
       RowBox[{"(*", 
        RowBox[{
        "generates", " ", "an", " ", "optimized", " ", "list", " ", "of", " ",
          "propagators", " ", "with", " ", "all", " ", "delays", " ", 
         "treated", " ", "via", " ", "one", " ", "propagator", " ", "each"}], 
        "*)"}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"OneLvNSolve", "[", 
        RowBox[{"propList", ",", "idm", ",", 
         RowBox[{"OnesList", "[", 
          RowBox[{"Length", "[", "propList", "]"}], "]"}], ",", "OP"}], 
        "]"}]}]}]}], "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.89704490560113*^9, 3.897044941810536*^9}, {
   3.897047951151103*^9, 3.897047951452484*^9}, {3.897048144240698*^9, 
   3.8970482312424297`*^9}, {3.8970482855237417`*^9, 
   3.8970483243806267`*^9}, {3.8970483621469803`*^9, 3.897048573160529*^9}, {
   3.897048706713324*^9, 3.897048709576819*^9}, {3.89704903362179*^9, 
   3.8970490422726717`*^9}, {3.897049161608699*^9, 3.897049196148707*^9}, {
   3.8970496709044943`*^9, 3.8970496722345743`*^9}, {3.897050423262704*^9, 
   3.897050426426649*^9}, {3.897050542387467*^9, 3.897050568573604*^9}, {
   3.897050613855695*^9, 3.897050882023191*^9}, {3.8970509222091417`*^9, 
   3.897051084186138*^9}, {3.8970511239703207`*^9, 3.897051202341874*^9}, {
   3.897051364499699*^9, 3.8970515939125633`*^9}, {3.897051678672974*^9, 
   3.897051798347341*^9}, {3.897052057358809*^9, 3.897052117701976*^9}, {
   3.897052177767589*^9, 3.897052217653767*^9}, {3.897052261060299*^9, 
   3.897052273807811*^9}, {3.897052395148117*^9, 3.897052530341085*^9}, {
   3.8970526483718576`*^9, 3.897052657976996*^9}, {3.89705271513301*^9, 
   3.897052716272588*^9}, {3.897052870546041*^9, 3.897052884569233*^9}, {
   3.897052966063035*^9, 3.897053016090858*^9}, {3.897053103369545*^9, 
   3.897053126957243*^9}, {3.897053214342381*^9, 3.89705323727245*^9}, {
   3.8970532916833553`*^9, 3.897053291898093*^9}, {3.897053468052842*^9, 
   3.897053473270308*^9}, {3.897053631676797*^9, 3.8970536529720497`*^9}, {
   3.897053918333879*^9, 3.89705392467406*^9}, {3.897054104227902*^9, 
   3.897054133322616*^9}, {3.897054177037314*^9, 3.897054302870544*^9}, {
   3.897054357304744*^9, 3.8970543592004766`*^9}, {3.8970544052091503`*^9, 
   3.897054491344906*^9}, {3.897054531569837*^9, 3.897054566580721*^9}, {
   3.8970546076958303`*^9, 3.897054609315817*^9}, {3.897054734689783*^9, 
   3.897054761770708*^9}, {3.897055273743992*^9, 3.897055280882004*^9}, {
   3.897055674123695*^9, 3.897055779030328*^9}, {3.897056081056839*^9, 
   3.89705609177207*^9}, {3.8970561999417877`*^9, 3.897056204415772*^9}, {
   3.89705623705486*^9, 3.8970562383169603`*^9}, {3.897056307594467*^9, 
   3.89705633952733*^9}, {3.897056511546081*^9, 3.89705654874193*^9}, {
   3.8970570479448013`*^9, 3.8970570663277607`*^9}, {3.897057117472597*^9, 
   3.897057142166602*^9}, {3.897057807940278*^9, 3.897057808146186*^9}, {
   3.8970578716232033`*^9, 3.897057872306917*^9}, {3.897057917598881*^9, 
   3.89705791765858*^9}, {3.897058284210682*^9, 3.8970582937205267`*^9}, {
   3.897058736704432*^9, 3.897058739317483*^9}, {3.897058779475258*^9, 
   3.897058780299033*^9}, {3.897059301307345*^9, 3.897059310642701*^9}, {
   3.897059868198091*^9, 3.8970599261843147`*^9}, {3.897060469585746*^9, 
   3.897060476329668*^9}, {3.897061739461603*^9, 3.8970617603841467`*^9}, {
   3.897556078870557*^9, 3.897556085615953*^9}, {3.897668013211834*^9, 
   3.897668013373135*^9}, {3.897668059476141*^9, 3.897668084854025*^9}, {
   3.8976683841954613`*^9, 3.8976683845501823`*^9}, {3.897668541437504*^9, 
   3.897668546992078*^9}, {3.8976687354144907`*^9, 3.897668735951025*^9}, {
   3.897668905687088*^9, 3.89766890958139*^9}, {3.898074455083661*^9, 
   3.898074551349617*^9}, 3.898074658606371*^9, {3.898074720927762*^9, 
   3.898074776885275*^9}, 3.900508881056334*^9, {3.9024814427540607`*^9, 
   3.9024814519434357`*^9}, {3.905857899772901*^9, 3.905857903788488*^9}, 
   3.9104322330548973`*^9, 3.910432368966028*^9, 3.910432404446164*^9, 
   3.9156165338393173`*^9, 3.915616577054693*^9, 3.915629427448595*^9, 
   3.9228811738789945`*^9, 3.930647333099226*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[510]:=",ExpressionUUID->"83a7f6e5-02ea-44cb-bee3-f20f28ed3df7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"FilterShapes", "[", 
   RowBox[{
   "thres_", ",", "\[Gamma]_", ",", "ListOfXShapes_", ",", "ListOfYShapes_", 
    ",", "ListOfZFields_", ",", "timestep_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"dt", "=", "timestep"}], ",", 
      RowBox[{"X", "=", "ListOfXShapes"}], ",", 
      RowBox[{"Y", "=", "ListOfYShapes"}], ",", 
      RowBox[{"ZF", "=", "ListOfZFields"}], ",", "mag", ",", "\[Lambda]1", 
      ",", "\[Lambda]2", ",", "filteredXList", ",", "filteredYList", ",", 
      "filteredZList", ",", "indexList", ",", "test", ",", "hold", ",", 
      "output"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"filteredXList", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"filteredYList", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"filteredZList", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"indexList", "=", 
      RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"ParallelTable", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"mag", "=", 
         RowBox[{"OptimizedPropagation", "[", 
          RowBox[{"\[Gamma]", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"X", "[", 
              RowBox[{"[", "k", "]"}], "]"}], ",", 
             RowBox[{"Y", "[", 
              RowBox[{"[", "k", "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"ZF", "[", 
            RowBox[{"[", "k", "]"}], "]"}], ",", 
           RowBox[{"OperatorNF", "[", 
            RowBox[{"1", ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "z"}], "}"}]}], "]"}], ",", 
           RowBox[{"OperatorNF", "[", 
            RowBox[{"1", ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "z"}], "}"}]}], "]"}], ",", "dt", ",", 
           "0.1"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Lambda]1", "=", 
         RowBox[{
          RowBox[{"Min", "[", "mag", "]"}], "/", 
          RowBox[{"Max", "[", "mag", "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Lambda]2", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Last", "@", "mag"}], ")"}], "/", 
          RowBox[{"Max", "[", "mag", "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"test", "=", 
         RowBox[{
          FractionBox["1", "2"], "*", 
          RowBox[{"Dot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"\[Lambda]1", ",", "\[Lambda]2"}], "}"}]}], "]"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"test", ">=", "thres"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"filteredXList", ",", 
             RowBox[{"X", "[", 
              RowBox[{"[", "k", "]"}], "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"filteredYList", ",", 
             RowBox[{"Y", "[", 
              RowBox[{"[", "k", "]"}], "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"filteredZList", ",", 
             RowBox[{"ZF", "[", 
              RowBox[{"[", "k", "]"}], "]"}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"indexList", ",", "k"}], "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"k", ",", "1", ",", 
         RowBox[{"Length", "[", "X", "]"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"output", "=", 
      RowBox[{"{", 
       RowBox[{
       "filteredXList", ",", "filteredYList", ",", "filteredZList", ",", 
        "indexList"}], "}"}]}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.897555409942978*^9, 3.897555420036957*^9}, 
   3.8975554750022497`*^9, {3.897555881008296*^9, 3.8975558993940687`*^9}, {
   3.897556066137813*^9, 3.897556070651634*^9}, {3.897556115241493*^9, 
   3.897556220555077*^9}, {3.897556273152113*^9, 3.897556307945569*^9}, {
   3.89755634024544*^9, 3.8975564993693542`*^9}, {3.897556543674306*^9, 
   3.897556728077869*^9}, {3.8975568095109987`*^9, 3.897556876815518*^9}, {
   3.897557032278081*^9, 3.89755717645439*^9}, {3.8975572370649357`*^9, 
   3.897557327617301*^9}, {3.8975574155837717`*^9, 3.897557424115947*^9}, {
   3.897557557115098*^9, 3.8975575696976023`*^9}, {3.897557624934225*^9, 
   3.897557657294828*^9}, {3.897557705778314*^9, 3.897557735161656*^9}, {
   3.8975584346290207`*^9, 3.897558441175665*^9}, {3.897558488409746*^9, 
   3.8975585124917583`*^9}, {3.8976436279875383`*^9, 
   3.8976436825987062`*^9}, {3.897649355224482*^9, 3.897649372146241*^9}, 
   3.900508881056555*^9, {3.902481442754427*^9, 3.90248145194375*^9}, 
   3.910432233055135*^9, 3.910432368966329*^9, 3.910432404446431*^9, 
   3.915616533839594*^9, 3.915616577054985*^9, 3.9228811738789945`*^9, 
   3.930647333099431*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[511]:=",ExpressionUUID->"2b4fd6c0-d4f6-424a-b845-91b0e5a48cb5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ComputeShape", "[", 
   RowBox[{
   "\[Gamma]_", ",", "XShape_", ",", "YShape_", ",", "ZShape_", ",", 
    "timestep_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"dt", "=", "timestep"}], ",", 
      RowBox[{"X", "=", "XShape"}], ",", 
      RowBox[{"Y", "=", "YShape"}], ",", 
      RowBox[{"Z", "=", "ZShape"}], ",", "mag", ",", "\[Lambda]1", ",", 
      "\[Lambda]2", ",", "test", ",", "hold", ",", "output"}], "}"}], ",", 
    RowBox[{
     RowBox[{"mag", "=", 
      RowBox[{"OptimizedPropagation", "[", 
       RowBox[{"\[Gamma]", ",", 
        RowBox[{"{", 
         RowBox[{"X", ",", "Y", ",", "Z"}], "}"}], ",", 
        RowBox[{"OperatorNF", "[", 
         RowBox[{"1", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "z"}], "}"}]}], "]"}], ",", 
        RowBox[{"OperatorNF", "[", 
         RowBox[{"1", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "z"}], "}"}]}], "]"}], ",", "dt", ",", "0.1"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "mag", "]"}], ">", "0"}], ",", 
       RowBox[{
        RowBox[{"\[Lambda]1", "=", 
         RowBox[{
          RowBox[{"Min", "[", "mag", "]"}], "/", 
          RowBox[{"Max", "[", "mag", "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"\[Lambda]2", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"Last", "@", "mag"}], ")"}], "/", 
          RowBox[{"Max", "[", "mag", "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"test", "=", 
         RowBox[{
          RowBox[{"1", "/", "2"}], "*", 
          RowBox[{"Dot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", "1"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"\[Lambda]1", ",", "\[Lambda]2"}], "}"}]}], "]"}]}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"output", "=", "test"}], ";"}], ",", 
       RowBox[{
        RowBox[{"output", "=", 
         RowBox[{"-", "1"}]}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
     "output"}]}], "]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.897555409942978*^9, 3.897555420036957*^9}, 
   3.8975554750022497`*^9, {3.897555881008296*^9, 3.8975558993940687`*^9}, {
   3.897556066137813*^9, 3.897556070651634*^9}, {3.897556115241493*^9, 
   3.897556220555077*^9}, {3.897556273152113*^9, 3.897556307945569*^9}, {
   3.89755634024544*^9, 3.8975564993693542`*^9}, {3.897556543674306*^9, 
   3.897556728077869*^9}, {3.8975568095109987`*^9, 3.897556876815518*^9}, {
   3.897557032278081*^9, 3.89755717645439*^9}, {3.8975572370649357`*^9, 
   3.897557327617301*^9}, {3.8975574155837717`*^9, 3.897557424115947*^9}, {
   3.897557557115098*^9, 3.8975575696976023`*^9}, {3.897557624934225*^9, 
   3.897557657294828*^9}, {3.897557705778314*^9, 3.897557735161656*^9}, {
   3.8975584346290207`*^9, 3.897558441175665*^9}, {3.897558488409746*^9, 
   3.8975585124917583`*^9}, {3.8976436279875383`*^9, 
   3.8976436825987062`*^9}, {3.897649355224482*^9, 3.897649372146241*^9}, {
   3.897651389018527*^9, 3.897651406318924*^9}, {3.897651520902858*^9, 
   3.897651535495347*^9}, {3.8976515732299*^9, 3.897651575171859*^9}, {
   3.897651636526155*^9, 3.897651639251602*^9}, {3.8976520505827208`*^9, 
   3.897652051143219*^9}, {3.897652722507476*^9, 3.897652896837105*^9}, {
   3.897652948647582*^9, 3.897652950248534*^9}, {3.897653044047035*^9, 
   3.897653045314836*^9}, {3.898253827034255*^9, 3.898253874901935*^9}, 
   3.900508881056768*^9, {3.9024814427547293`*^9, 3.902481451944018*^9}, 
   3.910432233055357*^9, 3.9104323689665956`*^9, 3.9104324044466667`*^9, 
   3.915616533839882*^9, 3.9156165770552607`*^9, 3.9156294617739773`*^9, 
   3.9228811738789945`*^9, 3.930647333099628*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[512]:=",ExpressionUUID->"4c7baac0-2b7c-416a-b6b4-0b7f8152f12d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ShapeMagic", "[", 
   RowBox[{"ParameterTable_", ",", "timestep_", ",", "request_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"genP", "=", "ParameterTable"}], ",", 
      RowBox[{"dt", "=", "timestep"}], ",", 
      RowBox[{"req", "=", "request"}], ",", "freqsP", ",", "fxData", ",", 
      "fyData", ",", "ModFx", ",", "ModFy", ",", "ifxData", ",", "ifyData", 
      ",", "XPeriod", ",", "YPeriod", ",", "shapesX", ",", "shapesY", ",", 
      "sliceX", ",", "sliceY", ",", "U1List", ",", "U2List", ",", "UFList", 
      ",", "output"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"freqsP", "=", 
      RowBox[{"Range", "[", 
       RowBox[{
        RowBox[{"-", "10"}], ",", "10", ",", 
        FractionBox["1", 
         RowBox[{"genP", "[", 
          RowBox[{"[", "20", "]"}], "]"}]]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"fxData", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"genP", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "*", 
            SuperscriptBox["j", "2"]}], "]"}], "*", 
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"genP", "[", 
              RowBox[{"[", "7", "]"}], "]"}]}], "*", 
            RowBox[{"Abs", "[", "j", "]"}]}], "]"}], "*", 
          RowBox[{"Cos", "[", 
           RowBox[{
            RowBox[{"genP", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "*", "j"}], "]"}], "*", 
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", "2"}], "*", "\[Pi]", "*", "I", "*", "j", "*", 
            RowBox[{"genP", "[", 
             RowBox[{"[", "5", "]"}], "]"}]}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "freqsP"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"fyData", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"genP", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "*", 
            SuperscriptBox["j", "2"]}], "]"}], "*", 
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"genP", "[", 
              RowBox[{"[", "8", "]"}], "]"}]}], "*", 
            RowBox[{"Abs", "[", "j", "]"}]}], "]"}], "*", 
          RowBox[{"Cos", "[", 
           RowBox[{
            RowBox[{"genP", "[", 
             RowBox[{"[", "4", "]"}], "]"}], "*", "j"}], "]"}], "*", 
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", "2"}], "*", "\[Pi]", "*", "I", "*", "j", "*", 
            RowBox[{"genP", "[", 
             RowBox[{"[", "6", "]"}], "]"}]}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "freqsP"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"ModFx", "=", 
      RowBox[{"fxData", "*", 
       RowBox[{"CosProduct", "[", 
        RowBox[{
         RowBox[{"genP", "[", 
          RowBox[{"[", "9", "]"}], "]"}], ",", "freqsP", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"genP", "[", 
            RowBox[{"[", "22", "]"}], "]"}], ",", 
           RowBox[{"genP", "[", 
            RowBox[{"[", "23", "]"}], "]"}], ",", 
           RowBox[{"genP", "[", 
            RowBox[{"[", "24", "]"}], "]"}], ",", 
           RowBox[{"genP", "[", 
            RowBox[{"[", "25", "]"}], "]"}], ",", 
           RowBox[{"genP", "[", 
            RowBox[{"[", "26", "]"}], "]"}]}], "}"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ModFy", "=", 
      RowBox[{"fyData", "*", 
       RowBox[{"CosProduct", "[", 
        RowBox[{
         RowBox[{"genP", "[", 
          RowBox[{"[", "10", "]"}], "]"}], ",", "freqsP", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"genP", "[", 
            RowBox[{"[", "27", "]"}], "]"}], ",", 
           RowBox[{"genP", "[", 
            RowBox[{"[", "28", "]"}], "]"}], ",", 
           RowBox[{"genP", "[", 
            RowBox[{"[", "29", "]"}], "]"}], ",", 
           RowBox[{"genP", "[", 
            RowBox[{"[", "30", "]"}], "]"}], ",", 
           RowBox[{"genP", "[", 
            RowBox[{"[", "31", "]"}], "]"}]}], "}"}]}], "]"}]}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"ifxData", "=", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{
          RowBox[{"ModFx", "[", 
           RowBox[{"[", "j", "]"}], "]"}], "*", 
          RowBox[{"Exp", "[", 
           RowBox[{"I", "*", "2", "*", "\[Pi]", "*", 
            RowBox[{"freqsP", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "*", 
            RowBox[{"Range", "[", 
             RowBox[{"0", ",", 
              RowBox[{"4", "*", 
               RowBox[{"genP", "[", 
                RowBox[{"[", "20", "]"}], "]"}]}], ",", "dt"}], "]"}]}], 
           "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{"Length", "[", "ModFx", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ifyData", "=", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"N", "[", 
         RowBox[{
          RowBox[{"ModFy", "[", 
           RowBox[{"[", "j", "]"}], "]"}], "*", 
          RowBox[{"Exp", "[", 
           RowBox[{"I", "*", "2", "*", "\[Pi]", "*", 
            RowBox[{"freqsP", "[", 
             RowBox[{"[", "j", "]"}], "]"}], "*", 
            RowBox[{"Range", "[", 
             RowBox[{"0", ",", 
              RowBox[{"4", "*", 
               RowBox[{"genP", "[", 
                RowBox[{"[", "20", "]"}], "]"}]}], ",", "dt"}], "]"}]}], 
           "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "1", ",", 
          RowBox[{"Length", "[", "ModFy", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"XPeriod", "=", 
      RowBox[{
       RowBox[{"Re", "[", "ifxData", "]"}], "*", 
       RowBox[{"TimeAmpMod", "[", 
        RowBox[{
         RowBox[{"genP", "[", 
          RowBox[{"[", "11", "]"}], "]"}], ",", 
         RowBox[{"genP", "[", 
          RowBox[{"[", "13", "]"}], "]"}], ",", 
         RowBox[{"genP", "[", 
          RowBox[{"[", "15", "]"}], "]"}], ",", 
         RowBox[{"genP", "[", 
          RowBox[{"[", "20", "]"}], "]"}], ",", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", 
           RowBox[{"genP", "[", 
            RowBox[{"[", "20", "]"}], "]"}], ",", "dt"}], "]"}], ",", "4"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"YPeriod", "=", 
      RowBox[{
       RowBox[{"Re", "[", "ifyData", "]"}], "*", 
       RowBox[{"TimeAmpMod", "[", 
        RowBox[{
         RowBox[{"genP", "[", 
          RowBox[{"[", "12", "]"}], "]"}], ",", 
         RowBox[{"genP", "[", 
          RowBox[{"[", "14", "]"}], "]"}], ",", 
         RowBox[{"genP", "[", 
          RowBox[{"[", "16", "]"}], "]"}], ",", 
         RowBox[{"genP", "[", 
          RowBox[{"[", "20", "]"}], "]"}], ",", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", 
           RowBox[{"genP", "[", 
            RowBox[{"[", "20", "]"}], "]"}], ",", "dt"}], "]"}], ",", "4"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"shapesX", "=", 
      RowBox[{
       RowBox[{"genP", "[", 
        RowBox[{"[", "17", "]"}], "]"}], "*", 
       RowBox[{"Normalizer", "[", 
        RowBox[{"PeriodToXY16", "[", 
         RowBox[{"XPeriod", ",", 
          RowBox[{"genP", "[", 
           RowBox[{"[", "20", "]"}], "]"}], ",", "dt", ",", "2"}], "]"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"shapesY", "=", 
      RowBox[{
       RowBox[{"genP", "[", 
        RowBox[{"[", "18", "]"}], "]"}], "*", 
       RowBox[{"Normalizer", "[", 
        RowBox[{"PeriodToXY16", "[", 
         RowBox[{"YPeriod", ",", 
          RowBox[{"genP", "[", 
           RowBox[{"[", "20", "]"}], "]"}], ",", "dt", ",", "2"}], "]"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"req", "==", "\"\<Graph\>\""}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"output", "=", 
         RowBox[{"Show", "[", 
          RowBox[{
           RowBox[{"TracePlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Range", "[", 
                 RowBox[{"0", ",", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesX"}], 
               "}"}], "\[Transpose]"}], ",", "Red", ",", 
             RowBox[{"{", 
              RowBox[{
              "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], "}"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], ")"}], 
                "*", "dt"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"TracePlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Range", "[", 
                 RowBox[{"0", ",", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesY", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesY"}], 
               "}"}], "\[Transpose]"}], ",", "Blue", ",", 
             RowBox[{"{", 
              RowBox[{
              "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], "}"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], ")"}], 
                "*", "dt"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"req", "==", "\"\<Generate\>\""}], ",", "\[IndentingNewLine]", 
       
       RowBox[{
        RowBox[{"output", "=", 
         RowBox[{"{", 
          RowBox[{"shapesX", ",", "shapesY"}], "}"}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"req", "==", "\"\<Pol\>\""}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"output", "=", 
         RowBox[{"SliceAndPolarize", "[", 
          RowBox[{"shapesX", ",", "shapesY", ",", 
           RowBox[{"genP", "[", 
            RowBox[{"[", "21", "]"}], "]"}], ",", "dt", ",", "20000"}], 
          "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"req", "==", "\"\<FullPol\>\""}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"output", "=", 
         RowBox[{"SliceAndPolarize", "[", 
          RowBox[{"shapesX", ",", "shapesY", ",", 
           RowBox[{"genP", "[", 
            RowBox[{"[", "21", "]"}], "]"}], ",", "dt", ",", "60000"}], 
          "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "output"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.897659822259109*^9, 3.89765987730907*^9}, {
   3.897659928444145*^9, 3.8976600382204227`*^9}, {3.897660099592849*^9, 
   3.897660318197349*^9}, {3.897660353738356*^9, 3.897660441006205*^9}, {
   3.897660540257638*^9, 3.897660554313534*^9}, {3.8976606874779043`*^9, 
   3.897660734362981*^9}, {3.897660825155039*^9, 3.897661058737631*^9}, {
   3.897661092397361*^9, 3.897661167986149*^9}, {3.897661355512824*^9, 
   3.8976613621331043`*^9}, {3.897662556341218*^9, 3.897662558448262*^9}, {
   3.897663912920223*^9, 3.89766393139149*^9}, 3.897664220076878*^9, {
   3.897664261422962*^9, 3.897664266926774*^9}, {3.897731597034133*^9, 
   3.897731597198043*^9}, {3.8980924556444902`*^9, 3.898092455720746*^9}, {
   3.898165689965897*^9, 3.89816569810366*^9}, {3.8981670183125362`*^9, 
   3.898167027150591*^9}, {3.899278791929181*^9, 3.899278797939643*^9}, {
   3.8994781839753017`*^9, 3.899478208551538*^9}, 3.900508881056963*^9, {
   3.902481442755259*^9, 3.9024814519445343`*^9}, 3.910432233055731*^9, 
   3.910432368967045*^9, 3.910432404447096*^9, 3.915616533840184*^9, 
   3.915616577055541*^9, 3.9228811738789945`*^9, 3.9306473330998096`*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[513]:=",ExpressionUUID->"160e7eea-cd8d-419e-8a7e-3af47c9225d6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"AddDelay", "[", 
    RowBox[{"list_", ",", "duration_", ",", "dt_"}], "]"}], ":=", 
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"Zeros", "[", 
      FractionBox["duration", "dt"], "]"}], ",", "list"}], "]"}]}], 
  ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.8987867556835327`*^9, 3.8987867962546988`*^9}, 
   3.900508881057152*^9, {3.902481442755493*^9, 3.902481451944762*^9}, 
   3.91043223305591*^9, 3.910432368967267*^9, 3.9104324044472933`*^9, 
   3.915616533840456*^9, 3.91561657705582*^9, {3.9180871369074783`*^9, 
   3.918087137618816*^9}, 3.9228811738789945`*^9, 3.930647333099991*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[514]:=",ExpressionUUID->"ee3d7721-cd28-4748-a60a-ad85b1a31aa2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"AddDCDelay", "[", 
    RowBox[{"list_", ",", "duration_", ",", "dt_", ",", "DC_"}], "]"}], ":=", 
   
   RowBox[{"Join", "[", 
    RowBox[{
     RowBox[{"DC", "*", 
      RowBox[{"OnesList", "[", 
       FractionBox["duration", "dt"], "]"}]}], ",", "list"}], "]"}]}], 
  ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.918087140900292*^9, 3.918087152686962*^9}, 
   3.918087442597662*^9, 3.9228811738789945`*^9, 3.930647333100189*^9},
 CellLabel->
  "In[515]:=",ExpressionUUID->"d55bedb8-8592-4830-bdf9-efd3319a67ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SliceAndPolarize", "[", 
    RowBox[{
    "shapeX_", ",", "shapeY_", ",", "zField_", ",", "timestep_", ",", 
     "runtime_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"dt", "=", "timestep"}], ",", "sliceX", ",", "sliceY", ",", 
       "endSliceX", ",", "endSliceY", ",", "fullX", ",", "fullY", ",", 
       "U1List", ",", "U2List", ",", "UFList", ",", "output"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sliceX", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"shapeX", ",", 
         RowBox[{"Floor", "[", 
          RowBox[{"2.5", "/", "dt"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sliceY", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"shapeY", ",", 
         RowBox[{"Floor", "[", 
          RowBox[{"2.5", "/", "dt"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"endSliceX", "=", 
       RowBox[{"shapeX", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "sliceX", "]"}], "*", 
            RowBox[{"Floor", "[", 
             RowBox[{"2.5", "/", "dt"}], "]"}]}], "+", "1"}], ";;"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"endSliceY", "=", 
       RowBox[{"shapeY", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "sliceY", "]"}], "*", 
            RowBox[{"Floor", "[", 
             RowBox[{"2.5", "/", "dt"}], "]"}]}], "+", "1"}], ";;"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endSliceX", "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fullX", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"sliceX", ",", 
            RowBox[{"{", "endSliceX", "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"fullY", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"sliceY", ",", 
            RowBox[{"{", "endSliceY", "}"}]}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fullX", "=", "sliceX"}], ";", "\[IndentingNewLine]", 
         RowBox[{"fullY", "=", "sliceY"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"U1List", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Dot", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"U1", "[", 
             RowBox[{"zField", ",", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullY", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", "dt"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"fullX", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"U2List", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Dot", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"U2", "[", 
             RowBox[{"zField", ",", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullY", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", "dt"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"fullX", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"UFList", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Dot", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"UF", "[", 
             RowBox[{"zField", ",", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullY", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", "dt"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"fullX", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"Last", "@", 
        RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
         RowBox[{"U1List", 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "isomer", " ", "1"}], 
           "*)"}], ",", "\[IndentingNewLine]", "U2List", 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
           "*)"}], ",", "\[IndentingNewLine]", "UFList", 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
           "*)"}], ",", "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
          RowBox[{"(*", 
           RowBox[{
           "initial", " ", "conditions", " ", "for", " ", "bound", " ", "and",
             " ", "free", " ", "species"}], "*)"}], ",", 
          "\[IndentingNewLine]", "16", 
          RowBox[{"(*", 
           RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",", 
          "2", 
          RowBox[{"(*", 
           RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
          "\[IndentingNewLine]", 
          FractionBox["1", "20"], 
          RowBox[{"(*", 
           FractionBox[
            RowBox[{"[", "Ir", "]"}], 
            RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
          RowBox[{"(*", 
           RowBox[{
            FractionBox[
             RowBox[{"[", "Ir", "]"}], 
             RowBox[{"[", "H2", "]"}]], ",", " ", 
            RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"OnesList", "[", 
           RowBox[{"Length", "[", "fullX", "]"}], "]"}], 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
            ",", " ", 
            RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}], "*", "dt"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}], " ", 
          RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", 
          RowBox[{"Round", "[", 
           FractionBox["runtime", 
            RowBox[{
             RowBox[{"Length", "[", "shapeX", "]"}], "*", "dt"}]], "]"}]}], 
         "]"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.897663341617141*^9, 3.897663400829555*^9}, {
   3.89766343223979*^9, 3.897663596005979*^9}, {3.8976637188799458`*^9, 
   3.897663867028489*^9}, {3.897664097687756*^9, 3.89766410341527*^9}, {
   3.8976641893196087`*^9, 3.897664189437289*^9}, {3.89766422679838*^9, 
   3.897664248872109*^9}, {3.8976644941141987`*^9, 3.897664514952142*^9}, {
   3.897664620799899*^9, 3.897664624204414*^9}, {3.897664819162992*^9, 
   3.897664821604323*^9}, {3.897665093501042*^9, 3.897665121984194*^9}, {
   3.897665194151698*^9, 3.897665206333824*^9}, {3.8976657623721943`*^9, 
   3.897665783924513*^9}, {3.897665851327829*^9, 3.8976658581974773`*^9}, {
   3.8976659210695066`*^9, 3.89766598524052*^9}, {3.897666103194623*^9, 
   3.897666106222719*^9}, {3.897666173966855*^9, 3.897666241124629*^9}, {
   3.89945818259793*^9, 3.899458184187174*^9}, {3.9000743431557407`*^9, 
   3.900074414671432*^9}, 3.900508881057332*^9, {3.900666146852747*^9, 
   3.900666171593573*^9}, {3.902481442755933*^9, 3.902481451945203*^9}, 
   3.910432233056232*^9, 3.910432368967661*^9, 3.910432404447651*^9, 
   3.9156165338407297`*^9, 3.915616577056099*^9, 3.9228811738789945`*^9, 
   3.930647333100367*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[516]:=",ExpressionUUID->"27a9a475-a59a-46fd-8c65-54ec4d01e7ba"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ShapePolarize", "[", 
    RowBox[{
    "shapeX_", ",", "shapeY_", ",", "shapeZ_", ",", "timestep_", ",", 
     "runtime_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"dt", "=", "timestep"}], ",", "sliceX", ",", "sliceY", ",", 
       "sliceZ", ",", "endSliceX", ",", "endSliceY", ",", "endSliceZ", ",", 
       "fullX", ",", "fullY", ",", "fullZ", ",", "U1List", ",", "U2List", ",",
        "UFList", ",", "output"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sliceX", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"shapeX", ",", 
         RowBox[{"Floor", "[", 
          RowBox[{"2.5", "/", "dt"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sliceY", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"shapeY", ",", 
         RowBox[{"Floor", "[", 
          RowBox[{"2.5", "/", "dt"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sliceZ", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"shapeZ", ",", 
         RowBox[{"Floor", "[", 
          RowBox[{"2.5", "/", "dt"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"endSliceX", "=", 
       RowBox[{"shapeX", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "sliceX", "]"}], "*", 
            RowBox[{"Floor", "[", 
             RowBox[{"2.5", "/", "dt"}], "]"}]}], "+", "1"}], ";;"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"endSliceY", "=", 
       RowBox[{"shapeY", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "sliceY", "]"}], "*", 
            RowBox[{"Floor", "[", 
             RowBox[{"2.5", "/", "dt"}], "]"}]}], "+", "1"}], ";;"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"endSliceZ", "=", 
       RowBox[{"shapeZ", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "sliceZ", "]"}], "*", 
            RowBox[{"Floor", "[", 
             RowBox[{"2.5", "/", "dt"}], "]"}]}], "+", "1"}], ";;"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endSliceX", "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fullX", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"sliceX", ",", 
            RowBox[{"{", "endSliceX", "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"fullY", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"sliceY", ",", 
            RowBox[{"{", "endSliceY", "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"fullZ", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"sliceZ", ",", 
            RowBox[{"{", "endSliceZ", "}"}]}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fullX", "=", "sliceX"}], ";", "\[IndentingNewLine]", 
         RowBox[{"fullY", "=", "sliceY"}], ";", "\[IndentingNewLine]", 
         RowBox[{"fullZ", "=", "sliceZ"}]}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"U1List", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Dot", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"U1", "[", 
             RowBox[{
              RowBox[{"fullZ", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullY", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", "dt"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"fullX", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"U2List", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Dot", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"U2", "[", 
             RowBox[{
              RowBox[{"fullZ", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullY", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", "dt"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"fullX", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"UFList", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Dot", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"UF", "[", 
             RowBox[{
              RowBox[{"fullZ", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullY", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", "dt"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"fullX", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"Last", "@", 
        RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
         RowBox[{"U1List", 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "isomer", " ", "1"}], 
           "*)"}], ",", "\[IndentingNewLine]", "U2List", 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
           "*)"}], ",", "\[IndentingNewLine]", "UFList", 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
           "*)"}], ",", "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
          RowBox[{"(*", 
           RowBox[{
           "initial", " ", "conditions", " ", "for", " ", "bound", " ", "and",
             " ", "free", " ", "species"}], "*)"}], ",", 
          "\[IndentingNewLine]", "16", 
          RowBox[{"(*", 
           RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",", 
          "2", 
          RowBox[{"(*", 
           RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
          "\[IndentingNewLine]", 
          FractionBox["1", "20"], 
          RowBox[{"(*", 
           FractionBox[
            RowBox[{"[", "Ir", "]"}], 
            RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
          RowBox[{"(*", 
           RowBox[{
            FractionBox[
             RowBox[{"[", "Ir", "]"}], 
             RowBox[{"[", "H2", "]"}]], ",", " ", 
            RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"OnesList", "[", 
           RowBox[{"Length", "[", "fullX", "]"}], "]"}], 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
            ",", " ", 
            RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}], "*", "dt"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}], " ", 
          RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", 
          RowBox[{"Round", "[", 
           FractionBox["runtime", 
            RowBox[{
             RowBox[{"Length", "[", "shapeX", "]"}], "*", "dt"}]], "]"}]}], 
         "]"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.9149338664222116`*^9, 3.91493393945013*^9}, {
   3.914933988243093*^9, 3.914934013569446*^9}, 3.91561653384102*^9, 
   3.9156165770564013`*^9, 3.9228811738789945`*^9, 3.930647333100565*^9},
 CellLabel->
  "In[517]:=",ExpressionUUID->"ed2cf405-dc0f-41c2-b22b-2bf97822e167"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ShapePolarizeTrace", "[", 
    RowBox[{
    "shapeX_", ",", "shapeY_", ",", "shapeZ_", ",", "timestep_", ",", 
     "runtime_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"dt", "=", "timestep"}], ",", "sliceX", ",", "sliceY", ",", 
       "sliceZ", ",", "endSliceX", ",", "endSliceY", ",", "endSliceZ", ",", 
       "fullX", ",", "fullY", ",", "fullZ", ",", "U1List", ",", "U2List", ",",
        "UFList", ",", "output"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sliceX", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"shapeX", ",", 
         RowBox[{"Floor", "[", 
          RowBox[{"2.5", "/", "dt"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sliceY", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"shapeY", ",", 
         RowBox[{"Floor", "[", 
          RowBox[{"2.5", "/", "dt"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sliceZ", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"shapeZ", ",", 
         RowBox[{"Floor", "[", 
          RowBox[{"2.5", "/", "dt"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"endSliceX", "=", 
       RowBox[{"shapeX", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "sliceX", "]"}], "*", 
            RowBox[{"Floor", "[", 
             RowBox[{"2.5", "/", "dt"}], "]"}]}], "+", "1"}], ";;"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"endSliceY", "=", 
       RowBox[{"shapeY", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "sliceY", "]"}], "*", 
            RowBox[{"Floor", "[", 
             RowBox[{"2.5", "/", "dt"}], "]"}]}], "+", "1"}], ";;"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"endSliceZ", "=", 
       RowBox[{"shapeZ", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "sliceZ", "]"}], "*", 
            RowBox[{"Floor", "[", 
             RowBox[{"2.5", "/", "dt"}], "]"}]}], "+", "1"}], ";;"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endSliceX", "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fullX", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"sliceX", ",", 
            RowBox[{"{", "endSliceX", "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"fullY", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"sliceY", ",", 
            RowBox[{"{", "endSliceY", "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"fullZ", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"sliceZ", ",", 
            RowBox[{"{", "endSliceZ", "}"}]}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fullX", "=", "sliceX"}], ";", "\[IndentingNewLine]", 
         RowBox[{"fullY", "=", "sliceY"}], ";", "\[IndentingNewLine]", 
         RowBox[{"fullZ", "=", "sliceZ"}]}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"U1List", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Dot", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"U1", "[", 
             RowBox[{
              RowBox[{"fullZ", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullY", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", "dt"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"fullX", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"U2List", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Dot", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"U2", "[", 
             RowBox[{
              RowBox[{"fullZ", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullY", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", "dt"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"fullX", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"UFList", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Dot", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"UF", "[", 
             RowBox[{
              RowBox[{"fullZ", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullY", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", "dt"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"fullX", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
        RowBox[{"U1List", 
         RowBox[{"(*", 
          RowBox[{"propagators", " ", "for", " ", "isomer", " ", "1"}], 
          "*)"}], ",", "\[IndentingNewLine]", "U2List", 
         RowBox[{"(*", 
          RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
          "*)"}], ",", "\[IndentingNewLine]", "UFList", 
         RowBox[{"(*", 
          RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
          "*)"}], ",", "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
         RowBox[{"(*", 
          RowBox[{
          "initial", " ", "conditions", " ", "for", " ", "bound", " ", "and", 
           " ", "free", " ", "species"}], "*)"}], ",", "\[IndentingNewLine]", 
         "16", 
         RowBox[{"(*", 
          RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",", 
         "2", 
         RowBox[{"(*", 
          RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
         "\[IndentingNewLine]", 
         FractionBox["1", "20"], 
         RowBox[{"(*", 
          FractionBox[
           RowBox[{"[", "Ir", "]"}], 
           RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
         RowBox[{"(*", 
          RowBox[{
           FractionBox[
            RowBox[{"[", "Ir", "]"}], 
            RowBox[{"[", "H2", "]"}]], ",", " ", 
           RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"OnesList", "[", 
          RowBox[{"Length", "[", "fullX", "]"}], "]"}], 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
           ",", " ", 
           RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"fullX", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "]"}], "*", "dt"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}], " ", 
         RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", 
         RowBox[{"Round", "[", 
          FractionBox["runtime", 
           RowBox[{
            RowBox[{"Length", "[", "shapeX", "]"}], "*", "dt"}]], "]"}]}], 
        "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.915020903734435*^9, 3.915020910177924*^9}, 
   3.9156165338412943`*^9, 3.915616577056698*^9, 3.922881173886609*^9, 
   3.93064733310076*^9},
 CellLabel->
  "In[518]:=",ExpressionUUID->"b668ca8d-e1dc-4be5-88ba-34dd8a59fa2c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SmartPolTrace", "[", 
    RowBox[{
    "shapeX_", ",", "shapeY_", ",", "zField_", ",", "timestep_", ",", 
     "runtime_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"dt", "=", "timestep"}], ",", "sliceX", ",", "sliceY", ",", 
       "endSliceX", ",", "endSliceY", ",", "fullX", ",", "fullY", ",", 
       "U1List", ",", "U2List", ",", "UFList", ",", "output"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sliceX", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"shapeX", ",", 
         RowBox[{"Floor", "[", 
          RowBox[{"2.5", "/", "dt"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sliceY", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"shapeY", ",", 
         RowBox[{"Floor", "[", 
          RowBox[{"2.5", "/", "dt"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"endSliceX", "=", 
       RowBox[{"shapeX", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "sliceX", "]"}], "*", 
            RowBox[{"Floor", "[", 
             RowBox[{"2.5", "/", "dt"}], "]"}]}], "+", "1"}], ";;"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"endSliceY", "=", 
       RowBox[{"shapeY", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "sliceY", "]"}], "*", 
            RowBox[{"Floor", "[", 
             RowBox[{"2.5", "/", "dt"}], "]"}]}], "+", "1"}], ";;"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endSliceX", "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fullX", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"sliceX", ",", 
            RowBox[{"{", "endSliceX", "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"fullY", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"sliceY", ",", 
            RowBox[{"{", "endSliceY", "}"}]}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fullX", "=", "sliceX"}], ";", "\[IndentingNewLine]", 
         RowBox[{"fullY", "=", "sliceY"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"U1List", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Dot", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"U1", "[", 
             RowBox[{"zField", ",", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullY", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", "dt"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"fullX", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"U2List", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Dot", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"U2", "[", 
             RowBox[{"zField", ",", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullY", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", "dt"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"fullX", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"UFList", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Dot", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"UF", "[", 
             RowBox[{"zField", ",", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullY", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", "dt"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"fullX", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
        RowBox[{"U1List", 
         RowBox[{"(*", 
          RowBox[{"propagators", " ", "for", " ", "isomer", " ", "1"}], 
          "*)"}], ",", "\[IndentingNewLine]", "U2List", 
         RowBox[{"(*", 
          RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
          "*)"}], ",", "\[IndentingNewLine]", "UFList", 
         RowBox[{"(*", 
          RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
          "*)"}], ",", "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
         RowBox[{"(*", 
          RowBox[{
          "initial", " ", "conditions", " ", "for", " ", "bound", " ", "and", 
           " ", "free", " ", "species"}], "*)"}], ",", "\[IndentingNewLine]", 
         "16", 
         RowBox[{"(*", 
          RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",", 
         "2", 
         RowBox[{"(*", 
          RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
         "\[IndentingNewLine]", 
         FractionBox["1", "20"], 
         RowBox[{"(*", 
          FractionBox[
           RowBox[{"[", "Ir", "]"}], 
           RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
         RowBox[{"(*", 
          RowBox[{
           FractionBox[
            RowBox[{"[", "Ir", "]"}], 
            RowBox[{"[", "H2", "]"}]], ",", " ", 
           RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"OnesList", "[", 
          RowBox[{"Length", "[", "fullX", "]"}], "]"}], 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
           ",", " ", 
           RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"fullX", "[", 
              RowBox[{"[", "j", "]"}], "]"}], "]"}], "*", "dt"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}], " ", 
         RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", 
         RowBox[{"Round", "[", 
          FractionBox["runtime", 
           RowBox[{
            RowBox[{"Length", "[", "shapeX", "]"}], "*", "dt"}]], "]"}]}], 
        "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.897663341617141*^9, 3.897663400829555*^9}, {
   3.89766343223979*^9, 3.897663596005979*^9}, {3.8976637188799458`*^9, 
   3.897663867028489*^9}, {3.897664097687756*^9, 3.89766410341527*^9}, {
   3.8976641893196087`*^9, 3.897664189437289*^9}, {3.89766422679838*^9, 
   3.897664248872109*^9}, {3.8976644941141987`*^9, 3.897664514952142*^9}, {
   3.897664620799899*^9, 3.897664624204414*^9}, {3.897664819162992*^9, 
   3.897664821604323*^9}, {3.897665093501042*^9, 3.897665121984194*^9}, {
   3.897665194151698*^9, 3.897665206333824*^9}, {3.8976657623721943`*^9, 
   3.897665783924513*^9}, {3.897665851327829*^9, 3.8976658581974773`*^9}, {
   3.8976659210695066`*^9, 3.89766598524052*^9}, {3.897666103194623*^9, 
   3.897666106222719*^9}, {3.897666173966855*^9, 3.897666241124629*^9}, {
   3.89945818259793*^9, 3.899458184187174*^9}, {3.899458261062908*^9, 
   3.8994582720322533`*^9}, 3.900508881057534*^9, {3.900666176598168*^9, 
   3.900666177418934*^9}, {3.902481442756379*^9, 3.902481451945642*^9}, 
   3.910432233056566*^9, 3.910432368968051*^9, 3.910432404448008*^9, 
   3.915616533841536*^9, 3.915616577056981*^9, 3.922881173886609*^9, 
   3.930647333100951*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[519]:=",ExpressionUUID->"f7073153-7689-4998-9ea5-d69415b78e1f"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ResonantShapeMagic", "[", 
    RowBox[{"ParameterTable_", ",", "timestep_", ",", "request_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"genP", "=", "ParameterTable"}], ",", 
       RowBox[{"dt", "=", "timestep"}], ",", 
       RowBox[{"req", "=", "request"}], ",", "T", ",", "domain", ",", "FFx", 
       ",", "FFy", ",", "FreqX", ",", "FreqY", ",", "GaussX", ",", "GaussY", 
       ",", "FreqPx", ",", "GaussPx", ",", "FreqPy", ",", "GaussPy", ",", 
       "XPeriod", ",", "YPeriod", ",", "shapesX", ",", "shapesY", ",", 
       "output"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"T", "=", 
       RowBox[{"genP", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"duration", " ", "of", " ", "subperiod"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"domain", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Round", "[", 
          RowBox[{"T", ",", "dt"}], "]"}], ",", "dt"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"FFx", "=", 
       RowBox[{
        RowBox[{"\[Gamma]H", "*", 
         RowBox[{"Abs", "[", 
          RowBox[{"genP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "-", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"FFy", "=", 
       RowBox[{
        RowBox[{"\[Gamma]H", "*", 
         RowBox[{"Abs", "[", 
          RowBox[{"genP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "-", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"genP", "[", 
          RowBox[{"[", "7", "]"}], "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"GaussPx", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"10", "+", "j"}], "]"}], "]"}], ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"20", "+", "j"}], "]"}], "]"}], ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"30", "+", "j"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", "7", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"GaussX", "=", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{"GaussPx", ",", "T", ",", "dt"}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"GaussX", "=", 
          RowBox[{"OnesList", "[", 
           RowBox[{"Length", "[", "domain", "]"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"genP", "[", 
          RowBox[{"[", "8", "]"}], "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"GaussPy", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"15", "+", "j"}], "]"}], "]"}], ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"25", "+", "j"}], "]"}], "]"}], ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"35", "+", "j"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", "8", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"GaussY", "=", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{"GaussPy", ",", "T", ",", "dt"}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"GaussY", "=", 
          RowBox[{"OnesList", "[", 
           RowBox[{"Length", "[", "domain", "]"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"XPeriod", "=", 
       RowBox[{"Force", "[", 
        RowBox[{
         RowBox[{"GaussX", "*", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sin", "[", 
             RowBox[{
              RowBox[{"2", "\[Pi]", "*", "FFx", "*", "j", "*", "0.001"}], "-", 
              RowBox[{"genP", "[", 
               RowBox[{"[", "5", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "domain"}], "}"}]}], "]"}]}], ",", 
         RowBox[{"genP", "[", 
          RowBox[{"[", "9", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"YPeriod", "=", 
       RowBox[{"Force", "[", 
        RowBox[{
         RowBox[{"GaussY", "*", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sin", "[", 
             RowBox[{
              RowBox[{"2", "\[Pi]", "*", "FFy", "*", "j", "*", "0.001"}], "-", 
              RowBox[{"genP", "[", 
               RowBox[{"[", "6", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "domain"}], "}"}]}], "]"}]}], ",", 
         RowBox[{"genP", "[", 
          RowBox[{"[", "10", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"shapesX", "=", 
       RowBox[{"AddDelay", "[", 
        RowBox[{
         RowBox[{"PhaseCycle", "[", 
          RowBox[{"XPeriod", ",", "T", ",", "dt"}], "]"}], ",", 
         RowBox[{"Round", "[", 
          RowBox[{
           FractionBox[
            RowBox[{"4", "*", "T"}], "3"], ",", "dt"}], "]"}], ",", "dt"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"shapesY", "=", 
       RowBox[{"AddDelay", "[", 
        RowBox[{
         RowBox[{"PhaseCycle", "[", 
          RowBox[{"YPeriod", ",", "T", ",", "dt"}], "]"}], ",", 
         RowBox[{"Round", "[", 
          RowBox[{
           FractionBox[
            RowBox[{"4", "*", "T"}], "3"], ",", "dt"}], "]"}], ",", "dt"}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Graph\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"Show", "[", 
           RowBox[{
            RowBox[{"TracePlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "XPeriod", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "XPeriod"}], 
                "}"}], "\[Transpose]"}], ",", "Red", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Length", "[", "XPeriod", "]"}], "-", "1"}], ")"}],
                  "*", "dt"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"TracePlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "YPeriod", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "YPeriod"}], 
                "}"}], "\[Transpose]"}], ",", "Blue", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Length", "[", "YPeriod", "]"}], "-", "1"}], ")"}],
                  "*", "dt"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<FullGraph\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"Show", "[", 
           RowBox[{
            RowBox[{"TracePlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesX"}], 
                "}"}], "\[Transpose]"}], ",", "Red", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], ")"}],
                  "*", "dt"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"TracePlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesY", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesY"}], 
                "}"}], "\[Transpose]"}], ",", "Blue", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], ")"}],
                  "*", "dt"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Generate\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"{", 
           RowBox[{"shapesX", ",", "shapesY"}], "}"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Subperiod\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"{", 
           RowBox[{"XPeriod", ",", "YPeriod"}], "}"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Envelope\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"PhaseCycle", "[", 
              RowBox[{
               RowBox[{"Force", "[", 
                RowBox[{"GaussX", ",", 
                 RowBox[{"genP", "[", 
                  RowBox[{"[", "9", "]"}], "]"}]}], "]"}], ",", "T", ",", 
               "dt"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", 
               RowBox[{"Round", "[", 
                FractionBox["T", "dt"], "]"}]}], "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"PhaseCycle", "[", 
              RowBox[{
               RowBox[{"Force", "[", 
                RowBox[{"GaussY", ",", 
                 RowBox[{"genP", "[", 
                  RowBox[{"[", "10", "]"}], "]"}]}], "]"}], ",", "T", ",", 
               "dt"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", 
               RowBox[{"Round", "[", 
                FractionBox["T", "dt"], "]"}]}], "]"}], "]"}]}], "}"}]}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<ShortPol\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"SliceAndPolarize", "[", 
           RowBox[{"shapesX", ",", "shapesY", ",", 
            RowBox[{"genP", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "dt", ",", "2000"}], 
           "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Pol\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"SliceAndPolarize", "[", 
           RowBox[{"shapesX", ",", "shapesY", ",", 
            RowBox[{"genP", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "dt", ",", "20000"}], 
           "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<FullPol\>\""}], ",", "\[IndentingNewLine]", 
        
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"SliceAndPolarize", "[", 
           RowBox[{"shapesX", ",", "shapesY", ",", 
            RowBox[{"genP", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "dt", ",", "60000"}], 
           "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<FullPolTrace\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"TracePlot", "[", 
           RowBox[{
            RowBox[{"SmartPolTrace", "[", 
             RowBox[{"shapesX", ",", "shapesY", ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", "dt", ",", "60000"}], 
             "]"}], ",", "Black", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<t (s)\>\"", ",", "\"\<Polarization (%)\>\""}], 
             "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0.001", ",", "60"}], "}"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<FullPolData\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"SmartPolTrace", "[", 
           RowBox[{"shapesX", ",", "shapesY", ",", 
            RowBox[{"genP", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "dt", ",", "60000"}], 
           "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "output"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.898686887684305*^9, 3.8986868915736237`*^9}, {
   3.89868704507716*^9, 3.898687077723716*^9}, {3.898687277668741*^9, 
   3.898687297970234*^9}, {3.898687666145282*^9, 3.898687741317892*^9}, {
   3.898687775025009*^9, 3.8986878134039087`*^9}, {3.898687848994335*^9, 
   3.898687885062668*^9}, {3.8986879640563602`*^9, 3.8986879780309896`*^9}, {
   3.898688099048427*^9, 3.898688100054284*^9}, {3.898688997983235*^9, 
   3.8986890394031153`*^9}, {3.8986897414454603`*^9, 3.898689742048707*^9}, {
   3.898690162344576*^9, 3.898690179788801*^9}, {3.898690235160018*^9, 
   3.8986902418989773`*^9}, {3.898691096623752*^9, 3.8986911009220667`*^9}, {
   3.8986918787047586`*^9, 3.898691886157893*^9}, {3.8986919403424683`*^9, 
   3.898691944132638*^9}, {3.8986920199420757`*^9, 3.898692023233127*^9}, {
   3.898694334583128*^9, 3.89869434111427*^9}, {3.898761623802924*^9, 
   3.8987616240685263`*^9}, {3.898762456262665*^9, 3.8987624851119328`*^9}, {
   3.898762554189785*^9, 3.8987625913520184`*^9}, {3.898763431405457*^9, 
   3.898763457848084*^9}, {3.898763692369323*^9, 3.89876377391595*^9}, {
   3.8987648066312723`*^9, 3.898764860428542*^9}, {3.898764957304953*^9, 
   3.8987649618244467`*^9}, {3.898765445725625*^9, 3.8987654712404003`*^9}, {
   3.898765676592231*^9, 3.898765701635931*^9}, {3.898769757861511*^9, 
   3.8987697590362663`*^9}, {3.898771192659006*^9, 3.898771213986372*^9}, {
   3.89877127742327*^9, 3.898771284638698*^9}, {3.89877146634558*^9, 
   3.8987715089827843`*^9}, {3.898771573219493*^9, 3.898771599887946*^9}, 
   3.898771846690943*^9, {3.8987719521608353`*^9, 3.898771983330193*^9}, {
   3.8987733966787987`*^9, 3.898773423582493*^9}, {3.898773480137854*^9, 
   3.8987735450941143`*^9}, {3.898773601582097*^9, 3.898773652619749*^9}, {
   3.898773799333528*^9, 3.898773824789906*^9}, {3.8987738908336163`*^9, 
   3.898773892233152*^9}, {3.8987759215238123`*^9, 3.898776070406436*^9}, {
   3.89877631210802*^9, 3.898776351233097*^9}, {3.898776468859049*^9, 
   3.898776489203074*^9}, {3.898776541610297*^9, 3.8987765976831503`*^9}, {
   3.89877681660769*^9, 3.8987768671179237`*^9}, {3.898776909952506*^9, 
   3.898777058296803*^9}, {3.898777115026227*^9, 3.8987771230963793`*^9}, {
   3.898777200556857*^9, 3.89877720248965*^9}, {3.898777783118925*^9, 
   3.898777821763422*^9}, {3.898777876832839*^9, 3.898777932042293*^9}, {
   3.89877805310434*^9, 3.89877805500247*^9}, {3.8987789063211117`*^9, 
   3.89877891089211*^9}, {3.89878011425095*^9, 3.89878013549641*^9}, {
   3.898780178161189*^9, 3.8987802111860456`*^9}, {3.898786827979855*^9, 
   3.8987868962950697`*^9}, {3.898787023120987*^9, 3.898787030165827*^9}, {
   3.8987873600237627`*^9, 3.8987873672231417`*^9}, {3.899382510091044*^9, 
   3.8993825140079107`*^9}, {3.899569453925643*^9, 3.899569494294929*^9}, {
   3.899569633660782*^9, 3.8995696490386667`*^9}, {3.8997962646237783`*^9, 
   3.899796283679985*^9}, {3.8998148067366323`*^9, 3.899814837114667*^9}, {
   3.899814907156892*^9, 3.899814908888393*^9}, {3.899816061344083*^9, 
   3.899816144481058*^9}, {3.8998162039843082`*^9, 3.8998162133401012`*^9}, 
   3.899816366385544*^9, 3.899816413717369*^9, {3.899816585957464*^9, 
   3.899816625937108*^9}, {3.89981666602444*^9, 3.899816733075267*^9}, {
   3.899817283291964*^9, 3.8998173081384478`*^9}, {3.899818070073407*^9, 
   3.899818074097562*^9}, {3.900073894257307*^9, 3.900073914620632*^9}, 
   3.90050888105772*^9, {3.900660430855464*^9, 3.9006604362673597`*^9}, {
   3.900684612612667*^9, 3.9006846338271847`*^9}, {3.900684838296792*^9, 
   3.900684851075384*^9}, {3.9024814427569857`*^9, 3.902481451946238*^9}, 
   3.9104322330570087`*^9, 3.9104323689685802`*^9, 3.910432404448511*^9, 
   3.915616533841812*^9, 3.9156165770572567`*^9, 3.922881173886609*^9, 
   3.930647333101137*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[520]:=",ExpressionUUID->"57b3e728-2728-4025-ad12-ff204ec0c834"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"TimePlot", "[", 
    RowBox[{"data_", ",", "dt_", ",", "start_", ",", "color_", ",", "axes_"}],
     "]"}], ":=", 
   RowBox[{"TracePlot", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"start", ",", 
          RowBox[{"start", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Length", "[", "data", "]"}], "-", "1"}], ")"}], "*", 
            "dt"}]}], ",", "dt"}], "]"}], ",", "data"}], "}"}], 
      "\[Transpose]"}], ",", "color", ",", "axes", ",", 
     RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.898765129582816*^9, 3.898765309301024*^9}, {
   3.898765382525897*^9, 3.898765389006624*^9}, 3.900508881057899*^9, {
   3.902481442757235*^9, 3.9024814519464808`*^9}, 3.9104322330571947`*^9, 
   3.910432368968809*^9, 3.910432404448719*^9, 3.9156165338420963`*^9, 
   3.915616577057537*^9, 3.922881173886609*^9, 3.930647333101323*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[521]:=",ExpressionUUID->"2168007a-bba5-49f4-b98e-f00f4938b368"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DashedPlot", "[", 
    RowBox[{"data_", ",", "dt_", ",", "start_", ",", "color_", ",", "axes_"}],
     "]"}], ":=", 
   RowBox[{"TracePlot", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"start", ",", 
          RowBox[{"start", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Length", "[", "data", "]"}], "-", "1"}], ")"}], "*", 
            "dt"}]}], ",", "dt"}], "]"}], ",", "data"}], "}"}], 
      "\[Transpose]"}], ",", 
     RowBox[{"{", 
      RowBox[{"color", ",", "Dashed"}], "}"}], ",", "axes", ",", 
     RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.917430317923977*^9, 3.917430329172867*^9}, 
   3.918087442597969*^9, 3.922881173886609*^9, 3.930647333101521*^9},
 CellLabel->
  "In[522]:=",ExpressionUUID->"5fd5d118-3a93-4cdb-b85f-c1801c41b5cf"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DiscreteTimePlot", "[", 
    RowBox[{"data_", ",", "dt_", ",", "start_", ",", "color_", ",", "axes_"}],
     "]"}], ":=", 
   RowBox[{"PointPlot", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Range", "[", 
         RowBox[{"start", ",", 
          RowBox[{"start", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"Length", "[", "data", "]"}], "-", "1"}], ")"}], "*", 
            "dt"}]}], ",", "dt"}], "]"}], ",", "data"}], "}"}], 
      "\[Transpose]"}], ",", "color", ",", "axes", ",", 
     RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.898765129582816*^9, 3.898765309301024*^9}, {
   3.898765382525897*^9, 3.898765389006624*^9}, {3.899817629453147*^9, 
   3.8998176347196913`*^9}, 3.900508881058076*^9, {3.902481442757472*^9, 
   3.902481451946732*^9}, 3.910432233057375*^9, 3.9104323689711018`*^9, 
   3.9104324044489202`*^9, 3.915616533842367*^9, 3.915616577057816*^9, 
   3.922881173886609*^9, 3.9306473331017303`*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[523]:=",ExpressionUUID->"cb2f0189-dbf8-45a3-92c3-33633d912f7c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Gaussian", "[", 
    RowBox[{
    "width_", ",", " ", "height_", ",", "center_", ",", " ", "xVal_"}], "]"}],
    ":=", 
   RowBox[{"height", "*", 
    RowBox[{"Exp", "[", 
     RowBox[{
      RowBox[{"-", "1"}], "*", "width", "*", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"xVal", "-", "center"}], ")"}], "2"]}], "]"}]}]}], 
  ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.898766960192206*^9, 3.898766984492003*^9}, {
   3.8987670351358957`*^9, 3.8987670590673227`*^9}, {3.898768668096902*^9, 
   3.898768673274067*^9}, {3.89876875834328*^9, 3.898768761687029*^9}, {
   3.898768927440938*^9, 3.8987689327300863`*^9}, 3.9005088810582523`*^9, {
   3.902481442757709*^9, 3.902481451946974*^9}, 3.9104322330575542`*^9, 
   3.910432368971343*^9, 3.91043240444911*^9, 3.9156165338426447`*^9, 
   3.915616577058091*^9, 3.922881173886609*^9, 3.930647333101906*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[524]:=",ExpressionUUID->"5a009af1-c158-4dd4-98a0-dbf5181638f5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"GaussianPulse", "[", 
   RowBox[{
   "width_", ",", "height_", ",", " ", "center_", ",", "period_", ",", 
    "step_"}], "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"W", " ", "=", " ", "width"}], ",", 
      RowBox[{"H", " ", "=", " ", "height"}], ",", 
      RowBox[{"C", "=", "center"}], ",", 
      RowBox[{"T", "=", "period"}], ",", 
      RowBox[{"dt", " ", "=", " ", "step"}], ",", "output"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"output", " ", "=", " ", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Gaussian", "[", 
        RowBox[{"W", ",", "H", ",", "C", ",", "i"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", 
         RowBox[{"Round", "[", 
          RowBox[{"T", ",", "dt"}], "]"}], ",", "dt"}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.886165519563325*^9, 3.886165763981221*^9}, {
   3.8861657970459013`*^9, 3.8861659191225643`*^9}, 3.886166040745327*^9, {
   3.886166590074039*^9, 3.886166629035474*^9}, {3.886166659525557*^9, 
   3.886166756738914*^9}, {3.886166794361842*^9, 3.886166815733926*^9}, {
   3.886166860062192*^9, 3.886166862026309*^9}, {3.8861675745492563`*^9, 
   3.8861675926271887`*^9}, {3.8901200150334377`*^9, 3.89012002508379*^9}, {
   3.8987671239427643`*^9, 3.898767142554927*^9}, {3.898767276085767*^9, 
   3.898767324438588*^9}, {3.898768297909523*^9, 3.898768303669903*^9}, {
   3.898768641399984*^9, 3.8987686797511463`*^9}, {3.898768768827669*^9, 
   3.898768814134336*^9}, {3.898768858184854*^9, 3.8987688615853643`*^9}, {
   3.8987689407893333`*^9, 3.898769003140555*^9}, {3.898769101404891*^9, 
   3.898769138786179*^9}, 3.900508881058443*^9, {3.900684436033853*^9, 
   3.9006844385797586`*^9}, {3.902481442757966*^9, 3.902481451947228*^9}, 
   3.910432233057745*^9, 3.910432368971595*^9, 3.910432404449329*^9, 
   3.915616533842928*^9, 3.915616577058365*^9, 3.922881173886609*^9, 
   3.9306473331020813`*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[525]:=",ExpressionUUID->"bbe6f365-18c5-4165-95cb-8bcbee3692c6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"GaussAmpMod", "[", 
   RowBox[{"parameters_", ",", "period_", ",", "timestep_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"P", "=", "parameters"}], ",", 
      RowBox[{"T", "=", "period"}], ",", 
      RowBox[{"dt", "=", "timestep"}], ",", "output"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"output", "=", 
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{"GaussianPulse", "[", 
        RowBox[{
         RowBox[{"P", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
         RowBox[{"P", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", 
         RowBox[{"P", "[", 
          RowBox[{"[", 
           RowBox[{"i", ",", "3"}], "]"}], "]"}], ",", 
         RowBox[{"Round", "[", 
          RowBox[{"T", ",", "dt"}], "]"}], ",", "dt"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "[", "P", "]"}]}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.898769173646935*^9, 3.898769197538867*^9}, {
   3.8987692450686417`*^9, 3.898769246504319*^9}, {3.898769282710656*^9, 
   3.898769355409584*^9}, {3.898769385906643*^9, 3.8987694255032787`*^9}, {
   3.898769486979247*^9, 3.898769502157157*^9}, {3.898769665512642*^9, 
   3.898769671514152*^9}, {3.89876970223284*^9, 3.8987697087648897`*^9}, {
   3.898769901330782*^9, 3.8987699276249647`*^9}, {3.8987699646017637`*^9, 
   3.898769964738915*^9}, 3.9005088810586443`*^9, {3.900684542934745*^9, 
   3.9006845442058897`*^9}, {3.902481442758264*^9, 3.902481451947513*^9}, 
   3.9104322330579367`*^9, 3.91043236897185*^9, 3.910432404449546*^9, 
   3.915616533843217*^9, 3.915616577058647*^9, 3.922881173886609*^9, 
   3.930647333102265*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[526]:=",ExpressionUUID->"c9c7aee0-6501-4a4b-b3b4-d3dacdf186fa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"BuildFreqs", "[", 
   RowBox[{
   "parameters_", ",", "fundamentalFrequency_", ",", "period_", ",", 
    "timestep_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"P", "=", "parameters"}], ",", 
      RowBox[{"F", "=", "fundamentalFrequency"}], ",", 
      RowBox[{"T", "=", "period"}], ",", 
      RowBox[{"dt", "=", "timestep"}], ",", "base", ",", "output"}], "}"}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"output", "=", 
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"P", "[", 
           RowBox[{"[", 
            RowBox[{"j", ",", "1"}], "]"}], "]"}], "*", 
          RowBox[{"Sin", "[", 
           RowBox[{
            RowBox[{"2", "\[Pi]", "*", "F", "*", 
             RowBox[{"(", 
              RowBox[{"j", "+", "1"}], ")"}], "*", "i"}], "-", 
            RowBox[{"P", "[", 
             RowBox[{"[", 
              RowBox[{"j", ",", "2"}], "]"}], "]"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "0", ",", 
           RowBox[{"Round", "[", 
            RowBox[{"T", ",", "dt"}], "]"}], ",", "dt"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"j", ",", "1", ",", 
         RowBox[{"Length", "[", "P", "]"}]}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.898769753811803*^9, 3.89876989233046*^9}, 
   3.8987699748742027`*^9, {3.89877031558193*^9, 3.898770317798361*^9}, {
   3.898770462410486*^9, 3.8987704783213043`*^9}, {3.8987705197894506`*^9, 
   3.898770633944005*^9}, {3.898770684574059*^9, 3.898770698401334*^9}, {
   3.8987707527095747`*^9, 3.898770755082326*^9}, {3.8987709051299562`*^9, 
   3.898770935836643*^9}, 3.9005088810588293`*^9, {3.900684548190146*^9, 
   3.900684548331499*^9}, {3.902481442758542*^9, 3.902481451947776*^9}, 
   3.9104322330581284`*^9, 3.910432368972093*^9, 3.9104324044497547`*^9, 
   3.915616533843499*^9, 3.9156165770589237`*^9, 3.922881173886609*^9, 
   3.930647333102446*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[527]:=",ExpressionUUID->"92e9d14d-8b4a-41c5-a4a4-c314736154e5"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Force", "[", 
    RowBox[{"signal_", ",", "power_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"Normalizer", "[", "signal", "]"}], "*", "power"}]}], 
  ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.8987701501659737`*^9, 3.898770172564289*^9}, 
   3.900508881059012*^9, {3.902481442758773*^9, 3.902481451948016*^9}, 
   3.910432233058298*^9, 3.910432368972311*^9, 3.9104324044499483`*^9, 
   3.915616533843779*^9, 3.915616577059203*^9, 3.922881173886609*^9, 
   3.930647333102622*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[528]:=",ExpressionUUID->"55b0a844-6e2a-451f-9b0b-3d28ee1fbc86"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Filter", "[", 
    RowBox[{"list_", ",", "threshold_", ",", " ", "request_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"L", "=", "list"}], ",", 
       RowBox[{"T", "=", "threshold"}], ",", "fL", ",", "fI", ",", 
       RowBox[{"req", "=", "request"}], ",", "output"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"fL", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"fI", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "<=", 
         RowBox[{"Length", "[", "L", "]"}]}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"L", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ">", "T"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AppendTo", "[", 
             RowBox[{"fL", ",", 
              RowBox[{"L", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"fI", ",", "i"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Element\>\""}], ",", 
        RowBox[{
         RowBox[{"output", "=", "fL"}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Index\>\""}], ",", 
        RowBox[{
         RowBox[{"output", "=", "fI"}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "output"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.8999039899895372`*^9, 3.899904200413259*^9}, {
   3.8999042640801697`*^9, 3.8999042645232487`*^9}, 3.9005088810591908`*^9, {
   3.9024814427590513`*^9, 3.902481451948291*^9}, 3.9104322330585003`*^9, 
   3.9104323689725637`*^9, 3.910432404450183*^9, 3.9156165338440647`*^9, 
   3.915616577059496*^9, 3.922881173886609*^9, 3.930647333102797*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 CellLabel->
  "In[529]:=",ExpressionUUID->"eddc831d-9390-4ee9-80db-02e3671aa45a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"RSMAverageHamiltonian", "[", 
    RowBox[{
    "parameters_", ",", "timestep_", ",", "auxiliaryJ_", ",", 
     "channelRequest_", ",", "delayRequest_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"P", "=", "parameters"}], ",", 
       RowBox[{"dt", "=", "timestep"}], ",", 
       RowBox[{"CR", "=", "channelRequest"}], ",", 
       RowBox[{"DR", "=", "delayRequest"}], ",", "\[Theta]", ",", "\[Nu]N", 
       ",", "\[Nu]H", ",", 
       RowBox[{"J", "=", "auxiliaryJ"}], ",", "I", ",", "A", ",", "B", ",", 
       "C", ",", "output"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"CR", "==", "\"\<X\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Theta]", "=", 
          FractionBox[
           RowBox[{"180", "*", "\[Gamma]H", "*", 
            RowBox[{"Total", "[", 
             RowBox[{
              RowBox[{"ResonantShapeMagic", "[", 
               RowBox[{"P", ",", "dt", ",", "\"\<Envelope\>\""}], "]"}], "[", 
              
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "*", "dt"}], "1000"]}], 
         ";", " ", 
         RowBox[{"(*", "degrees", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"\[Nu]N", "=", 
          RowBox[{
           RowBox[{"\[Gamma]N", "*", 
            RowBox[{"Abs", "[", 
             RowBox[{"P", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "-", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"\[Gamma]H", "*", 
              RowBox[{"Abs", "[", 
               RowBox[{"P", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "-", 
             RowBox[{"P", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}], ")"}]}]}], ";", 
         RowBox[{"(*", "Hz", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"\[Nu]H", "=", 
          RowBox[{"P", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}], ";"}]}], " ", 
       RowBox[{"(*", "Hz", "*)"}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"CR", "==", "\"\<Y\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"\[Theta]", "=", 
          FractionBox[
           RowBox[{"180", "*", "\[Gamma]H", "*", 
            RowBox[{"Total", "[", 
             RowBox[{
              RowBox[{"ResonantShapeMagic", "[", 
               RowBox[{"P", ",", "dt", ",", "\"\<Envelope\>\""}], "]"}], "[", 
              
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "*", "dt"}], "1000"]}], 
         ";", " ", 
         RowBox[{"(*", "degrees", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"\[Nu]N", "=", 
          RowBox[{
           RowBox[{"\[Gamma]N", "*", 
            RowBox[{"Abs", "[", 
             RowBox[{"P", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "-", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"\[Gamma]H", "*", 
              RowBox[{"Abs", "[", 
               RowBox[{"P", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "-", 
             RowBox[{"P", "[", 
              RowBox[{"[", "4", "]"}], "]"}]}], ")"}]}]}], ";", 
         RowBox[{"(*", "Hz", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"\[Nu]H", "=", 
          RowBox[{"P", "[", 
           RowBox[{"[", "4", "]"}], "]"}]}], ";"}]}], " ", 
       RowBox[{"(*", "Hz", "*)"}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"I", "=", 
       FractionBox[
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"2", "\[Theta]"}], "]"}], "-", 
         RowBox[{"Sin", "[", "\[Theta]", "]"}]}], "\[Theta]"]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"A", "=", "\[Nu]N"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"DR", "==", "\"\<No Delay\>\""}], ",", "\[IndentingNewLine]", 
        
        RowBox[{
         RowBox[{"B", "=", 
          RowBox[{"\[Nu]H", "*", "I"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"C", "=", 
          RowBox[{"J", "*", "I"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"DR", "==", "\"\<With Delay\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"B", "=", 
          FractionBox[
           RowBox[{"\[Nu]H", "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"3", "I"}], "+", "1"}], ")"}]}], "4"]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"C", "=", 
          FractionBox[
           RowBox[{"J", "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"3", "I"}], "+", "1"}], ")"}]}], "4"]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"StringForm", "[", 
        RowBox[{
        "\"\<`1` \!\(\*SubscriptBox[\(S\), \(z\)]\) + `2` \!\(\*SubscriptBox[\
\(I\), \(z\)]\) + `3` \!\(\*SubscriptBox[\(I\), \
\(z\)]\)\!\(\*SubscriptBox[\(S\), \(z\)]\)\>\"", ",", 
         RowBox[{"Round", "[", 
          RowBox[{"A", ",", "0.0001"}], "]"}], ",", 
         RowBox[{"Round", "[", 
          RowBox[{"B", ",", "0.0001"}], "]"}], ",", 
         RowBox[{"Round", "[", 
          RowBox[{"C", ",", "0.0001"}], "]"}]}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.900580855345851*^9, 3.900582405436839*^9, {3.900582525691217*^9, 
   3.900582599221718*^9}, {3.900582633822196*^9, 3.900582673806778*^9}, {
   3.9005827331666803`*^9, 3.900582992797325*^9}, {3.900583255699739*^9, 
   3.900583298846998*^9}, {3.900583373038166*^9, 3.900583417275872*^9}, {
   3.900583629416684*^9, 3.900583723080104*^9}, {3.900584054440856*^9, 
   3.900584135010436*^9}, {3.9005841667314987`*^9, 3.900584195743218*^9}, {
   3.900584238841755*^9, 3.9005842624719543`*^9}, {3.9005842971598063`*^9, 
   3.9005845943531027`*^9}, {3.900584639639245*^9, 3.900584681553575*^9}, {
   3.900584721549426*^9, 3.900584725925117*^9}, {3.900584795703372*^9, 
   3.900585088590146*^9}, {3.900660221200687*^9, 3.900660290503244*^9}, {
   3.900670952442913*^9, 3.9006709930134153`*^9}, {3.902481442759433*^9, 
   3.902481451948694*^9}, 3.910432233058909*^9, 3.910432368972937*^9, 
   3.910432404450513*^9, 3.915616533844367*^9, 3.9156165770598087`*^9, 
   3.922881173886609*^9, 3.930647333102994*^9},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[530]:=",ExpressionUUID->"4679aaf0-a8a4-4404-aff3-0a979de4f459"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CustomDelayRSM", "[", 
    RowBox[{
    "ParameterTable_", ",", "timestep_", ",", "delay_", ",", "request_"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"genP", "=", "ParameterTable"}], ",", 
       RowBox[{"dt", "=", "timestep"}], ",", 
       RowBox[{"req", "=", "request"}], ",", 
       RowBox[{"D", "=", "delay"}], ",", "T", ",", "domain", ",", "FFx", ",", 
       "FFy", ",", "FreqX", ",", "FreqY", ",", "GaussX", ",", "GaussY", ",", 
       "FreqPx", ",", "GaussPx", ",", "FreqPy", ",", "GaussPy", ",", 
       "XPeriod", ",", "YPeriod", ",", "shapesX", ",", "shapesY", ",", 
       "output"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"T", "=", 
       RowBox[{"genP", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"duration", " ", "of", " ", "subperiod"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"domain", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Round", "[", 
          RowBox[{"T", ",", "dt"}], "]"}], ",", "dt"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"FFx", "=", 
       RowBox[{
        RowBox[{"\[Gamma]H", "*", 
         RowBox[{"Abs", "[", 
          RowBox[{"genP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "-", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"FFy", "=", 
       RowBox[{
        RowBox[{"\[Gamma]H", "*", 
         RowBox[{"Abs", "[", 
          RowBox[{"genP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "-", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"genP", "[", 
          RowBox[{"[", "7", "]"}], "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"GaussPx", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"10", "+", "j"}], "]"}], "]"}], ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"20", "+", "j"}], "]"}], "]"}], ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"30", "+", "j"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", "7", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"GaussX", "=", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{"GaussPx", ",", "T", ",", "dt"}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"GaussX", "=", 
          RowBox[{"OnesList", "[", 
           RowBox[{"Length", "[", "domain", "]"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"genP", "[", 
          RowBox[{"[", "8", "]"}], "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"GaussPy", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"15", "+", "j"}], "]"}], "]"}], ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"25", "+", "j"}], "]"}], "]"}], ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"35", "+", "j"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", "8", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"GaussY", "=", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{"GaussPy", ",", "T", ",", "dt"}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"GaussY", "=", 
          RowBox[{"OnesList", "[", 
           RowBox[{"Length", "[", "domain", "]"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"XPeriod", "=", 
       RowBox[{"Force", "[", 
        RowBox[{
         RowBox[{"GaussX", "*", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sin", "[", 
             RowBox[{
              RowBox[{"2", "\[Pi]", "*", "FFx", "*", "j", "*", "0.001"}], "-", 
              RowBox[{"genP", "[", 
               RowBox[{"[", "5", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "domain"}], "}"}]}], "]"}]}], ",", 
         RowBox[{"genP", "[", 
          RowBox[{"[", "9", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"YPeriod", "=", 
       RowBox[{"Force", "[", 
        RowBox[{
         RowBox[{"GaussY", "*", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sin", "[", 
             RowBox[{
              RowBox[{"2", "\[Pi]", "*", "FFy", "*", "j", "*", "0.001"}], "-", 
              RowBox[{"genP", "[", 
               RowBox[{"[", "6", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "domain"}], "}"}]}], "]"}]}], ",", 
         RowBox[{"genP", "[", 
          RowBox[{"[", "10", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"shapesX", "=", 
       RowBox[{"AddDelay", "[", 
        RowBox[{
         RowBox[{"PhaseCycle", "[", 
          RowBox[{"XPeriod", ",", "T", ",", "dt"}], "]"}], ",", 
         RowBox[{"Round", "[", 
          RowBox[{"D", ",", "dt"}], "]"}], ",", "dt"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"shapesY", "=", 
       RowBox[{"AddDelay", "[", 
        RowBox[{
         RowBox[{"PhaseCycle", "[", 
          RowBox[{"YPeriod", ",", "T", ",", "dt"}], "]"}], ",", 
         RowBox[{"Round", "[", 
          RowBox[{"D", ",", "dt"}], "]"}], ",", "dt"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Graph\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"Show", "[", 
           RowBox[{
            RowBox[{"TracePlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "XPeriod", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "XPeriod"}], 
                "}"}], "\[Transpose]"}], ",", "Red", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Length", "[", "XPeriod", "]"}], "-", "1"}], ")"}],
                  "*", "dt"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"TracePlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "YPeriod", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "YPeriod"}], 
                "}"}], "\[Transpose]"}], ",", "Blue", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Length", "[", "YPeriod", "]"}], "-", "1"}], ")"}],
                  "*", "dt"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<FullGraph\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"Show", "[", 
           RowBox[{
            RowBox[{"TracePlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesX"}], 
                "}"}], "\[Transpose]"}], ",", "Red", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], ")"}],
                  "*", "dt"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"TracePlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesY", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesY"}], 
                "}"}], "\[Transpose]"}], ",", "Blue", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], ")"}],
                  "*", "dt"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Generate\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"{", 
           RowBox[{"shapesX", ",", "shapesY"}], "}"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Subperiod\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"{", 
           RowBox[{"XPeriod", ",", "YPeriod"}], "}"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Envelope\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"PhaseCycle", "[", 
              RowBox[{
               RowBox[{"Force", "[", 
                RowBox[{"GaussX", ",", 
                 RowBox[{"genP", "[", 
                  RowBox[{"[", "9", "]"}], "]"}]}], "]"}], ",", "T", ",", 
               "dt"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", 
               RowBox[{"Round", "[", 
                FractionBox["T", "dt"], "]"}]}], "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"PhaseCycle", "[", 
              RowBox[{
               RowBox[{"Force", "[", 
                RowBox[{"GaussY", ",", 
                 RowBox[{"genP", "[", 
                  RowBox[{"[", "10", "]"}], "]"}]}], "]"}], ",", "T", ",", 
               "dt"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", 
               RowBox[{"Round", "[", 
                FractionBox["T", "dt"], "]"}]}], "]"}], "]"}]}], "}"}]}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<ShortPol\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"SliceAndPolarize", "[", 
           RowBox[{"shapesX", ",", "shapesY", ",", 
            RowBox[{"genP", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "dt", ",", "2000"}], 
           "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Pol\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"SliceAndPolarize", "[", 
           RowBox[{"shapesX", ",", "shapesY", ",", 
            RowBox[{"genP", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "dt", ",", "20000"}], 
           "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<FullPol\>\""}], ",", "\[IndentingNewLine]", 
        
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"SliceAndPolarize", "[", 
           RowBox[{"shapesX", ",", "shapesY", ",", 
            RowBox[{"genP", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "dt", ",", "60000"}], 
           "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<FullPolTrace\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"TracePlot", "[", 
           RowBox[{
            RowBox[{"SmartPolTrace", "[", 
             RowBox[{"shapesX", ",", "shapesY", ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", "dt", ",", "60000"}], 
             "]"}], ",", "Black", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<t (s)\>\"", ",", "\"\<Polarization (%)\>\""}], 
             "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0.001", ",", "60"}], "}"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<FullPolData\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"SmartPolTrace", "[", 
           RowBox[{"shapesX", ",", "shapesY", ",", 
            RowBox[{"genP", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "dt", ",", "60000"}], 
           "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "output"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.900580855345851*^9, 3.900582405436839*^9, {3.900582525691217*^9, 
   3.900582599221718*^9}, {3.900582633822196*^9, 3.900582673806778*^9}, {
   3.9005827331666803`*^9, 3.900582992797325*^9}, {3.900583255699739*^9, 
   3.900583298846998*^9}, {3.900583373038166*^9, 3.900583417275872*^9}, {
   3.900583629416684*^9, 3.900583723080104*^9}, {3.900584054440856*^9, 
   3.900584135010436*^9}, {3.9005841667314987`*^9, 3.900584195743218*^9}, {
   3.900584238841755*^9, 3.9005842624719543`*^9}, {3.9005842971598063`*^9, 
   3.9005845943531027`*^9}, {3.900584639639245*^9, 3.900584681553575*^9}, {
   3.900584721549426*^9, 3.900584725925117*^9}, {3.900584795703372*^9, 
   3.900585088590146*^9}, {3.900660221200687*^9, 3.900660290503244*^9}, {
   3.900670952442913*^9, 3.90067096436651*^9}, {3.902563938030075*^9, 
   3.9025639777787437`*^9}, {3.902564031092112*^9, 3.902564066060812*^9}, 
   3.9025641649957733`*^9, 3.910432233059366*^9, 3.91043236897353*^9, 
   3.910432404451023*^9, 3.915616533844678*^9, 3.91561657706012*^9, 
   3.922881173886609*^9, 3.9306473331031933`*^9},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[531]:=",ExpressionUUID->"c5b2fdf2-5b86-48c0-b1ac-aad404f29253"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ExModPolarize", "[", 
    RowBox[{
    "shapeX_", ",", "shapeY_", ",", "zField_", ",", "kN_", ",", "kH_", ",", 
     "timestep_", ",", "runtime_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"dt", "=", "timestep"}], ",", "sliceX", ",", "sliceY", ",", 
       "endSliceX", ",", "endSliceY", ",", "fullX", ",", "fullY", ",", 
       "U1List", ",", "U2List", ",", "UFList", ",", "output"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sliceX", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"shapeX", ",", 
         RowBox[{"Floor", "[", 
          RowBox[{"2.5", "/", "dt"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sliceY", "=", 
       RowBox[{"Partition", "[", 
        RowBox[{"shapeY", ",", 
         RowBox[{"Floor", "[", 
          RowBox[{"2.5", "/", "dt"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"endSliceX", "=", 
       RowBox[{"shapeX", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "sliceX", "]"}], "*", 
            RowBox[{"Floor", "[", 
             RowBox[{"2.5", "/", "dt"}], "]"}]}], "+", "1"}], ";;"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"endSliceY", "=", 
       RowBox[{"shapeY", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "sliceY", "]"}], "*", 
            RowBox[{"Floor", "[", 
             RowBox[{"2.5", "/", "dt"}], "]"}]}], "+", "1"}], ";;"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "endSliceX", "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fullX", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"sliceX", ",", 
            RowBox[{"{", "endSliceX", "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"fullY", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"sliceY", ",", 
            RowBox[{"{", "endSliceY", "}"}]}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"fullX", "=", "sliceX"}], ";", "\[IndentingNewLine]", 
         RowBox[{"fullY", "=", "sliceY"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"U1List", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Dot", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"U1", "[", 
             RowBox[{"zField", ",", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullY", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", "dt"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"fullX", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"U2List", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Dot", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"U2", "[", 
             RowBox[{"zField", ",", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullY", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", "dt"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"fullX", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"UFList", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Dot", "@@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"UF", "[", 
             RowBox[{"zField", ",", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", 
              RowBox[{"fullY", "[", 
               RowBox[{"[", 
                RowBox[{"k", ",", "l"}], "]"}], "]"}], ",", "dt"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"fullX", "[", 
                RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", 
           RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"Last", "@", 
        RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
         RowBox[{"U1List", 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "isomer", " ", "1"}], 
           "*)"}], ",", "\[IndentingNewLine]", "U2List", 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
           "*)"}], ",", "\[IndentingNewLine]", "UFList", 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
           "*)"}], ",", "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
          RowBox[{"(*", 
           RowBox[{
           "initial", " ", "conditions", " ", "for", " ", "bound", " ", "and",
             " ", "free", " ", "species"}], "*)"}], ",", 
          "\[IndentingNewLine]", "kN", 
          RowBox[{"(*", 
           RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",", 
          "kH", 
          RowBox[{"(*", 
           RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
          "\[IndentingNewLine]", 
          FractionBox["1", "20"], 
          RowBox[{"(*", 
           FractionBox[
            RowBox[{"[", "Ir", "]"}], 
            RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
          RowBox[{"(*", 
           RowBox[{
            FractionBox[
             RowBox[{"[", "Ir", "]"}], 
             RowBox[{"[", "H2", "]"}]], ",", " ", 
            RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"OnesList", "[", 
           RowBox[{"Length", "[", "fullX", "]"}], "]"}], 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
            ",", " ", 
            RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"fullX", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}], "*", "dt"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"Length", "[", "fullX", "]"}]}], "}"}]}], "]"}], " ", 
          RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", 
          RowBox[{"Round", "[", 
           FractionBox["runtime", 
            RowBox[{
             RowBox[{"Length", "[", "shapeX", "]"}], "*", "dt"}]], "]"}]}], 
         "]"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.902565539658937*^9, 3.902565606523452*^9}, 
   3.910432233059711*^9, 3.9104323689739656`*^9, 3.910432404451412*^9, 
   3.915616533844976*^9, 3.915616577060424*^9, 3.922881173886609*^9, 
   3.930647333103387*^9},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[532]:=",ExpressionUUID->"e14ad085-8a96-413d-852b-fa01d9853b78"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ModXY4CosPC", "[", 
    RowBox[{"period_", ",", "power_", ",", "point_", ",", "mod_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"T", "=", "period"}], ",", 
       RowBox[{"t", "=", "point"}], ",", "domain", ",", "output"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"output", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"t", "<", "T"}], "\[Or]", 
         RowBox[{"t", ">", 
          RowBox[{"3", "T"}]}]}], ",", 
        RowBox[{"1", "-", 
         SuperscriptBox[
          RowBox[{"(", 
           RowBox[{"Cos", "[", 
            FractionBox[
             RowBox[{"\[Pi]", "*", "t"}], "T"], "]"}], ")"}], "power"]}], ",", 
        RowBox[{"mod", "*", 
         RowBox[{"(", 
          RowBox[{
           SuperscriptBox[
            RowBox[{"(", 
             RowBox[{"Cos", "[", 
              FractionBox[
               RowBox[{"\[Pi]", "*", "t"}], "T"], "]"}], ")"}], "power"], "-",
            "1"}], ")"}]}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.900580855345851*^9, 3.900582405436839*^9, {3.900582525691217*^9, 
   3.900582599221718*^9}, {3.900582633822196*^9, 3.900582673806778*^9}, {
   3.9005827331666803`*^9, 3.900582992797325*^9}, {3.900583255699739*^9, 
   3.900583298846998*^9}, {3.900583373038166*^9, 3.900583417275872*^9}, {
   3.900583629416684*^9, 3.900583723080104*^9}, {3.900584054440856*^9, 
   3.900584135010436*^9}, {3.9005841667314987`*^9, 3.900584195743218*^9}, {
   3.900584238841755*^9, 3.9005842624719543`*^9}, {3.9005842971598063`*^9, 
   3.9005845943531027`*^9}, {3.900584639639245*^9, 3.900584681553575*^9}, {
   3.900584721549426*^9, 3.900584725925117*^9}, {3.900584795703372*^9, 
   3.900585088590146*^9}, {3.900660221200687*^9, 3.900660290503244*^9}, {
   3.900670952442913*^9, 3.90067096436651*^9}, {3.902563938030075*^9, 
   3.9025639777787437`*^9}, {3.902564031092112*^9, 3.902564066060812*^9}, 
   3.9025641649957733`*^9, {3.903019295296772*^9, 3.90301929710882*^9}, {
   3.903019377036001*^9, 3.9030194030692472`*^9}, {3.9030195884258223`*^9, 
   3.903019591769457*^9}, {3.903019627833281*^9, 3.903019630424999*^9}, {
   3.90301985666756*^9, 3.903019891380674*^9}, 3.910432233059946*^9, 
   3.910432368974246*^9, 3.910432404451647*^9, 3.915616533845274*^9, 
   3.915616577060741*^9, 3.922881173886609*^9, 3.930647333103587*^9},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[533]:=",ExpressionUUID->"9591084c-447e-4dc9-9333-424042a546d2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ModPhaseCycle", "[", 
    RowBox[{"pulse_", ",", "period_", ",", "dt_", ",", " ", "mod_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"stitch", ",", "times", ",", 
       RowBox[{"P", "=", "period"}], ",", "cycledStitch", ",", "output"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"stitch", "=", 
       RowBox[{"Delete", "[", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{"pulse", ",", "pulse", ",", "pulse", ",", "pulse"}], "]"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Floor", "[", 
             RowBox[{"period", "/", 
              RowBox[{"(", "dt", ")"}]}], "]"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"2", "*", 
             RowBox[{"Floor", "[", 
              RowBox[{"period", "/", 
               RowBox[{"(", "dt", ")"}]}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"3", "*", 
             RowBox[{"Floor", "[", 
              RowBox[{"period", "/", 
               RowBox[{"(", "dt", ")"}]}], "]"}]}], "}"}]}], "}"}]}], "]"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"0", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "stitch", "]"}], "*", "dt"}], "-", "dt"}], 
         ",", "dt"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cycledStitch", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"stitch", "[", 
           RowBox[{"[", "j", "]"}], "]"}], "*", 
          RowBox[{"ModXY4CosPC", "[", 
           RowBox[{"P", ",", "12", ",", 
            RowBox[{"times", "[", 
             RowBox[{"[", "j", "]"}], "]"}], ",", "mod"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           RowBox[{"Length", "[", "times", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"output", "=", "cycledStitch"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.903019900189475*^9, 3.9030199210040073`*^9}, 
   3.903020171344355*^9, 3.910432233060186*^9, 3.910432368974526*^9, 
   3.910432404451898*^9, 3.915616533845582*^9, 3.915616577061056*^9, 
   3.922881173886609*^9, 3.93064733310378*^9},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[534]:=",ExpressionUUID->"e97f879f-d841-42aa-9078-5c9b69cdb3e0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"CustomCycleRSM", "[", 
    RowBox[{
    "ParameterTable_", ",", "scaleBar_", ",", "timestep_", ",", "request_"}], 
    "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"genP", "=", "ParameterTable"}], ",", 
       RowBox[{"dt", "=", "timestep"}], ",", 
       RowBox[{"A", "=", "scaleBar"}], ",", 
       RowBox[{"req", "=", "request"}], ",", "T", ",", "domain", ",", "FFx", 
       ",", "FFy", ",", "FreqX", ",", "FreqY", ",", "GaussX", ",", "GaussY", 
       ",", "FreqPx", ",", "GaussPx", ",", "FreqPy", ",", "GaussPy", ",", 
       "XPeriod", ",", "YPeriod", ",", "shapesX", ",", "shapesY", ",", 
       "output"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"T", "=", 
       RowBox[{"genP", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"duration", " ", "of", " ", "subperiod"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"domain", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Round", "[", 
          RowBox[{"T", ",", "dt"}], "]"}], ",", "dt"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"FFx", "=", 
       RowBox[{
        RowBox[{"\[Gamma]H", "*", 
         RowBox[{"Abs", "[", 
          RowBox[{"genP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "-", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"FFy", "=", 
       RowBox[{
        RowBox[{"\[Gamma]H", "*", 
         RowBox[{"Abs", "[", 
          RowBox[{"genP", "[", 
           RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "-", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"genP", "[", 
          RowBox[{"[", "7", "]"}], "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"GaussPx", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"10", "+", "j"}], "]"}], "]"}], ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"20", "+", "j"}], "]"}], "]"}], ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"30", "+", "j"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", "7", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"GaussX", "=", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{"GaussPx", ",", "T", ",", "dt"}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"GaussX", "=", 
          RowBox[{"OnesList", "[", 
           RowBox[{"Length", "[", "domain", "]"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"genP", "[", 
          RowBox[{"[", "8", "]"}], "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"GaussPy", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"15", "+", "j"}], "]"}], "]"}], ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"25", "+", "j"}], "]"}], "]"}], ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", 
                RowBox[{"35", "+", "j"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", "8", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"GaussY", "=", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{"GaussPy", ",", "T", ",", "dt"}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"GaussY", "=", 
          RowBox[{"OnesList", "[", 
           RowBox[{"Length", "[", "domain", "]"}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"XPeriod", "=", 
       RowBox[{"Force", "[", 
        RowBox[{
         RowBox[{"GaussX", "*", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sin", "[", 
             RowBox[{
              RowBox[{"2", "\[Pi]", "*", "FFx", "*", "j", "*", "0.001"}], "-", 
              RowBox[{"genP", "[", 
               RowBox[{"[", "5", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "domain"}], "}"}]}], "]"}]}], ",", 
         RowBox[{"genP", "[", 
          RowBox[{"[", "9", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"YPeriod", "=", 
       RowBox[{"Force", "[", 
        RowBox[{
         RowBox[{"GaussY", "*", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Sin", "[", 
             RowBox[{
              RowBox[{"2", "\[Pi]", "*", "FFy", "*", "j", "*", "0.001"}], "-", 
              RowBox[{"genP", "[", 
               RowBox[{"[", "6", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "domain"}], "}"}]}], "]"}]}], ",", 
         RowBox[{"genP", "[", 
          RowBox[{"[", "10", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"shapesX", "=", 
       RowBox[{"AddDelay", "[", 
        RowBox[{
         RowBox[{"ModPhaseCycle", "[", 
          RowBox[{"XPeriod", ",", "T", ",", "dt", ",", "A"}], "]"}], ",", 
         RowBox[{"Round", "[", 
          RowBox[{
           FractionBox[
            RowBox[{"4", "*", "T"}], "3"], ",", "dt"}], "]"}], ",", "dt"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"shapesY", "=", 
       RowBox[{"AddDelay", "[", 
        RowBox[{
         RowBox[{"ModPhaseCycle", "[", 
          RowBox[{"YPeriod", ",", "T", ",", "dt", ",", "A"}], "]"}], ",", 
         RowBox[{"Round", "[", 
          RowBox[{
           FractionBox[
            RowBox[{"4", "*", "T"}], "3"], ",", "dt"}], "]"}], ",", "dt"}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Graph\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"Show", "[", 
           RowBox[{
            RowBox[{"TracePlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "XPeriod", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "XPeriod"}], 
                "}"}], "\[Transpose]"}], ",", "Red", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Length", "[", "XPeriod", "]"}], "-", "1"}], ")"}],
                  "*", "dt"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"TracePlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "YPeriod", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "YPeriod"}], 
                "}"}], "\[Transpose]"}], ",", "Blue", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Length", "[", "YPeriod", "]"}], "-", "1"}], ")"}],
                  "*", "dt"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<FullGraph\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"Show", "[", 
           RowBox[{
            RowBox[{"TracePlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesX"}], 
                "}"}], "\[Transpose]"}], ",", "Red", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], ")"}],
                  "*", "dt"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"TracePlot", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesY", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesY"}], 
                "}"}], "\[Transpose]"}], ",", "Blue", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], ")"}],
                  "*", "dt"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Generate\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"{", 
           RowBox[{"shapesX", ",", "shapesY"}], "}"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Subperiod\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"{", 
           RowBox[{"XPeriod", ",", "YPeriod"}], "}"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Envelope\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"PhaseCycle", "[", 
              RowBox[{
               RowBox[{"Force", "[", 
                RowBox[{"GaussX", ",", 
                 RowBox[{"genP", "[", 
                  RowBox[{"[", "9", "]"}], "]"}]}], "]"}], ",", "T", ",", 
               "dt"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", 
               RowBox[{"Round", "[", 
                FractionBox["T", "dt"], "]"}]}], "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"PhaseCycle", "[", 
              RowBox[{
               RowBox[{"Force", "[", 
                RowBox[{"GaussY", ",", 
                 RowBox[{"genP", "[", 
                  RowBox[{"[", "10", "]"}], "]"}]}], "]"}], ",", "T", ",", 
               "dt"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{"1", ";;", 
               RowBox[{"Round", "[", 
                FractionBox["T", "dt"], "]"}]}], "]"}], "]"}]}], "}"}]}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<ShortPol\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"SliceAndPolarize", "[", 
           RowBox[{"shapesX", ",", "shapesY", ",", 
            RowBox[{"genP", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "dt", ",", "2000"}], 
           "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Pol\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"SliceAndPolarize", "[", 
           RowBox[{"shapesX", ",", "shapesY", ",", 
            RowBox[{"genP", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "dt", ",", "20000"}], 
           "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<FullPol\>\""}], ",", "\[IndentingNewLine]", 
        
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"SliceAndPolarize", "[", 
           RowBox[{"shapesX", ",", "shapesY", ",", 
            RowBox[{"genP", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "dt", ",", "60000"}], 
           "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<FullPolTrace\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"TracePlot", "[", 
           RowBox[{
            RowBox[{"SmartPolTrace", "[", 
             RowBox[{"shapesX", ",", "shapesY", ",", 
              RowBox[{"genP", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", "dt", ",", "60000"}], 
             "]"}], ",", "Black", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<t (s)\>\"", ",", "\"\<Polarization (%)\>\""}], 
             "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0.001", ",", "60"}], "}"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<FullPolData\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"SmartPolTrace", "[", 
           RowBox[{"shapesX", ",", "shapesY", ",", 
            RowBox[{"genP", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "dt", ",", "60000"}], 
           "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "output"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.900580855345851*^9, 3.900582405436839*^9, {3.900582525691217*^9, 
   3.900582599221718*^9}, {3.900582633822196*^9, 3.900582673806778*^9}, {
   3.9005827331666803`*^9, 3.900582992797325*^9}, {3.900583255699739*^9, 
   3.900583298846998*^9}, {3.900583373038166*^9, 3.900583417275872*^9}, {
   3.900583629416684*^9, 3.900583723080104*^9}, {3.900584054440856*^9, 
   3.900584135010436*^9}, {3.9005841667314987`*^9, 3.900584195743218*^9}, {
   3.900584238841755*^9, 3.9005842624719543`*^9}, {3.9005842971598063`*^9, 
   3.9005845943531027`*^9}, {3.900584639639245*^9, 3.900584681553575*^9}, {
   3.900584721549426*^9, 3.900584725925117*^9}, {3.900584795703372*^9, 
   3.900585088590146*^9}, {3.900660221200687*^9, 3.900660290503244*^9}, {
   3.900670952442913*^9, 3.90067096436651*^9}, {3.902563938030075*^9, 
   3.9025639777787437`*^9}, {3.902564031092112*^9, 3.902564066060812*^9}, 
   3.9025641649957733`*^9, {3.903019295296772*^9, 3.90301929710882*^9}, {
   3.903019377036001*^9, 3.9030194030692472`*^9}, {3.9030201484922132`*^9, 
   3.90302016251243*^9}, {3.903022177497047*^9, 3.903022216483069*^9}, 
   3.910432233060643*^9, 3.910432368975088*^9, 3.910432404452407*^9, 
   3.91561653384588*^9, 3.915616577061365*^9, 3.922881173886609*^9, 
   3.930647333103986*^9},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[535]:=",ExpressionUUID->"89e34077-c5d1-4899-8b3c-f3172084fa68"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"FastBPXY16PropagationLockedPeriod", "[", 
     RowBox[{"period_", ",", "gaussPW_", ",", "timestep_", ",", "runtime_"}], 
     "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"T", "=", "period"}], ",", 
        RowBox[{"PW", "=", "gaussPW"}], ",", 
        RowBox[{"dt", "=", "timestep"}], ",", "N", ",", "B", ",", "Bz", ",", 
        "\[Phi]", ",", "\[Tau]", ",", "\[Tau]P", ",", "T0", ",", "domain", 
        ",", "pulse", ",", "U1LongD", ",", "U1D", ",", "U1Bx", ",", "U1Bxb", 
        ",", "U1By", ",", "U1Byb", ",", "U2LongD", ",", "U2D", ",", "U2Bx", 
        ",", "U2Bxb", ",", "U2By", ",", "U2Byb", ",", "UFLongD", ",", "UFD", 
        ",", "UFBx", ",", "UFBxb", ",", "UFBy", ",", "UFByb", ",", "output"}],
        "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"B", " ", "=", 
        RowBox[{
         FractionBox["8", 
          RowBox[{"\[Gamma]H", "*", "PW", "*", "0.001"}]], "*", 
         RowBox[{"Sqrt", "[", 
          FractionBox["1", 
           RowBox[{"2", "*", "\[Pi]"}]], "]"}]}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"pulse", " ", "power"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Bz", " ", "=", " ", "B"}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"z", "-", 
         RowBox[{"field", " ", "power"}]}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Tau]", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox["T", "4"], ",", "dt"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"duration", " ", "of", " ", "delay"}], " ", "-", " ", 
         RowBox[{"encoded", " ", "in", " ", "T", " ", "and", " ", "PW"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"T0", " ", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox[
           RowBox[{"3", "*", "\[Tau]"}], "4"], ",", "dt"}], "]"}]}], " ", ";", 
       RowBox[{"(*", 
        RowBox[{
        "duration", " ", "of", " ", "one", " ", "XY4", " ", "subperiod"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[Tau]P", " ", "=", 
        RowBox[{"Round", "[", " ", 
         RowBox[{
          FractionBox[
           RowBox[{"T0", "-", 
            RowBox[{"8", "*", "PW"}]}], "3"], ",", "dt"}], "]"}]}], ";", " ", 
       
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"duration", " ", "of", " ", "inter"}], "-", 
         RowBox[{"pulse", " ", "delay"}]}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"pulse", "=", 
        RowBox[{
         RowBox[{"GaussAmpMod", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
              FractionBox["32", 
               SuperscriptBox["PW", "2"]], ",", "B", ",", 
              FractionBox["PW", "2"]}], "}"}], "}"}], ",", "PW", ",", "dt"}], 
          "]"}], "*", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Cos", "[", 
            RowBox[{"2", "\[Pi]", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"\[Gamma]H", "*", "Bz"}], "+", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  FractionBox["160", "PW"], "*", "i"}], "-", "80"}], ")"}]}], 
              ")"}], "*", "i", "*", "0.001"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "0", ",", "PW", ",", "dt"}], "}"}]}], "]"}]}]}],
        ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"U1LongD", "=", 
        RowBox[{"U1", "[", 
         RowBox[{
          RowBox[{"-", "1.8"}], ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1D", "=", 
        RowBox[{"U1", "[", 
         RowBox[{
          RowBox[{"-", "1.8"}], ",", "0", ",", "0", ",", "\[Tau]P"}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"U1Bx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{
             FractionBox["B", "2"], ",", 
             RowBox[{"pulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "pulse", "]"}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"U1Bxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{
             FractionBox["B", "2"], ",", 
             RowBox[{"-", 
              RowBox[{"pulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "pulse", "]"}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"U1By", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{
             FractionBox["B", "2"], ",", "0", ",", 
             RowBox[{"pulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "pulse", "]"}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"U1Byb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{
             FractionBox["B", "2"], ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"pulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "pulse", "]"}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"U2LongD", "=", 
        RowBox[{"U2", "[", 
         RowBox[{
          RowBox[{"-", "1.8"}], ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2D", "=", 
        RowBox[{"U2", "[", 
         RowBox[{
          RowBox[{"-", "1.8"}], ",", "0", ",", "0", ",", "\[Tau]P"}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"U2Bx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{
             FractionBox["B", "2"], ",", 
             RowBox[{"pulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "pulse", "]"}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"U2Bxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{
             FractionBox["B", "2"], ",", 
             RowBox[{"-", 
              RowBox[{"pulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "pulse", "]"}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"U2By", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{
             FractionBox["B", "2"], ",", "0", ",", 
             RowBox[{"pulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "pulse", "]"}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"U2Byb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{
             FractionBox["B", "2"], ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"pulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "pulse", "]"}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"UFLongD", "=", 
        RowBox[{"UF", "[", 
         RowBox[{
          RowBox[{"-", "1.8"}], ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFD", "=", 
        RowBox[{"UF", "[", 
         RowBox[{
          RowBox[{"-", "1.8"}], ",", "0", ",", "0", ",", "\[Tau]P"}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"UFBx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{
             FractionBox["B", "2"], ",", 
             RowBox[{"pulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "pulse", "]"}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"UFBxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{
             FractionBox["B", "2"], ",", 
             RowBox[{"-", 
              RowBox[{"pulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "pulse", "]"}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"UFBy", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{
             FractionBox["B", "2"], ",", "0", ",", 
             RowBox[{"pulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "pulse", "]"}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"UFByb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{
             FractionBox["B", "2"], ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"pulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "pulse", "]"}]}], "}"}]}], "]"}]}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"output", "=", 
        RowBox[{"Last", "@", 
         RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "U1LongD", ",", "U1Bx", ",", "U1Bxb", ",", "U1D", ",", "U1By", 
             ",", "U1Byb", ",", "U1D", ",", "U1Bx", ",", "U1Bxb", ",", "U1D", 
             ",", "U1By", ",", "U1Byb", ",", "U1Bxb", ",", "U1Bx", ",", "U1D",
              ",", "U1Byb", ",", "U1By", ",", "U1D", ",", "U1Bxb", ",", 
             "U1Bx", ",", "U1D", ",", "U1Byb", ",", "U1By", ",", "U1Bxb", ",",
              "U1Bx", ",", "U1D", ",", "U1Byb", ",", "U1By", ",", "U1D", ",", 
             "U1Bxb", ",", "U1Bx", ",", "U1D", ",", "U1Byb", ",", "U1By", ",",
              "U1Bx", ",", "U1Bxb", ",", "U1D", ",", "U1By", ",", "U1Byb", 
             ",", "U1D", ",", "U1Bx", ",", "U1Bxb", ",", "U1D", ",", "U1By", 
             ",", "U1Byb"}], "}"}], 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "isomer", " ", "1"}], 
            "*)"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
            "U2LongD", ",", "U2Bx", ",", "U2Bxb", ",", "U2D", ",", "U2By", 
             ",", "U2Byb", ",", "U2D", ",", "U2Bx", ",", "U2Bxb", ",", "U2D", 
             ",", "U2By", ",", "U2Byb", ",", "U2Bxb", ",", "U2Bx", ",", "U2D",
              ",", "U2Byb", ",", "U2By", ",", "U2D", ",", "U2Bxb", ",", 
             "U2Bx", ",", "U2D", ",", "U2Byb", ",", "U2By", ",", "U2Bxb", ",",
              "U2Bx", ",", "U2D", ",", "U2Byb", ",", "U2By", ",", "U2D", ",", 
             "U2Bxb", ",", "U2Bx", ",", "U2D", ",", "U2Byb", ",", "U2By", ",",
              "U2Bx", ",", "U2Bxb", ",", "U2D", ",", "U2By", ",", "U2Byb", 
             ",", "U2D", ",", "U2Bx", ",", "U2Bxb", ",", "U2D", ",", "U2By", 
             ",", "U2Byb"}], "}"}], 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
            "*)"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
            "UFLongD", ",", "UFBx", ",", "UFBxb", ",", "UFD", ",", "UFBy", 
             ",", "UFByb", ",", "UFD", ",", "UFBx", ",", "UFBxb", ",", "UFD", 
             ",", "UFBy", ",", "UFByb", ",", "UFBxb", ",", "UFBx", ",", "UFD",
              ",", "UFByb", ",", "UFBy", ",", "UFD", ",", "UFBxb", ",", 
             "UFBx", ",", "UFD", ",", "UFByb", ",", "UFBy", ",", "UFBxb", ",",
              "UFBx", ",", "UFD", ",", "UFByb", ",", "UFBy", ",", "UFD", ",", 
             "UFBxb", ",", "UFBx", ",", "UFD", ",", "UFByb", ",", "UFBy", ",",
              "UFBx", ",", "UFBxb", ",", "UFD", ",", "UFBy", ",", "UFByb", 
             ",", "UFD", ",", "UFBx", ",", "UFBxb", ",", "UFD", ",", "UFBy", 
             ",", "UFByb"}], "}"}], 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
            "*)"}], ",", "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
           RowBox[{"(*", 
            RowBox[{
            "initial", " ", "conditions", " ", "for", " ", "bound", " ", 
             "and", " ", "free", " ", "species"}], "*)"}], ",", 
           "\[IndentingNewLine]", "16", 
           RowBox[{"(*", 
            RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",",
            "2", 
           RowBox[{"(*", 
            RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
           "\[IndentingNewLine]", 
           FractionBox["1", "20"], 
           RowBox[{"(*", 
            FractionBox[
             RowBox[{"[", "Ir", "]"}], 
             RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
           RowBox[{"(*", 
            RowBox[{
             FractionBox[
              RowBox[{"[", "Ir", "]"}], 
              RowBox[{"[", "H2", "]"}]], ",", " ", 
             RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
            "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", 
             ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", 
             "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", 
             ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", 
             "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", 
             ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", 
             "1", ",", "1", ",", "1", ",", "1", ",", "1", ",", "1"}], "}"}], 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
             ",", " ", 
             RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "\[Tau]", ",", "PW", ",", "PW", ",", "\[Tau]P", ",", "PW", ",", 
             "PW", ",", "\[Tau]P", ",", "PW", ",", "PW", ",", "\[Tau]P", ",", 
             "PW", ",", "PW", ",", "PW", ",", "PW", ",", "\[Tau]P", ",", "PW",
              ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "PW", ",", "\[Tau]P",
              ",", "PW", ",", "PW", ",", "PW", ",", "PW", ",", "\[Tau]P", ",",
              "PW", ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "PW", ",", 
             "\[Tau]P", ",", "PW", ",", "PW", ",", "PW", ",", "PW", ",", 
             "\[Tau]P", ",", "PW", ",", "PW", ",", "\[Tau]P", ",", "PW", ",", 
             "PW", ",", "\[Tau]P", ",", "PW", ",", "PW"}], "}"}], 
           RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", 
           RowBox[{"Round", "[", 
            FractionBox["runtime", "T"], "]"}]}], "]"}]}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",\

 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.900580855345851*^9, 3.900582405436839*^9, {3.900582525691217*^9, 
   3.900582599221718*^9}, {3.900582633822196*^9, 3.900582673806778*^9}, {
   3.9005827331666803`*^9, 3.900582992797325*^9}, {3.900583255699739*^9, 
   3.900583298846998*^9}, {3.900583373038166*^9, 3.900583417275872*^9}, {
   3.900583629416684*^9, 3.900583723080104*^9}, {3.900584054440856*^9, 
   3.900584135010436*^9}, {3.9005841667314987`*^9, 3.900584195743218*^9}, {
   3.900584238841755*^9, 3.9005842624719543`*^9}, {3.9005842971598063`*^9, 
   3.9005845943531027`*^9}, {3.900584639639245*^9, 3.900584681553575*^9}, {
   3.900584721549426*^9, 3.900584725925117*^9}, {3.900584795703372*^9, 
   3.900585088590146*^9}, {3.900660221200687*^9, 3.900660290503244*^9}, {
   3.900670952442913*^9, 3.90067096436651*^9}, {3.902563938030075*^9, 
   3.9025639777787437`*^9}, {3.902564031092112*^9, 3.902564066060812*^9}, 
   3.9025641649957733`*^9, {3.903019295296772*^9, 3.90301929710882*^9}, {
   3.903019377036001*^9, 3.9030194030692472`*^9}, {3.9030201484922132`*^9, 
   3.90302016251243*^9}, {3.9030202564894*^9, 3.903020296965027*^9}, 
   3.903022244302541*^9, 3.9046475433272142`*^9, {3.9046478410396423`*^9, 
   3.9046478480720053`*^9}, {3.904648057196312*^9, 3.90464805868918*^9}, {
   3.904648366849901*^9, 3.904648368348587*^9}, {3.904648444895329*^9, 
   3.9046484817750587`*^9}, 3.904649747582617*^9, {3.904649794442531*^9, 
   3.904649849534974*^9}, {3.9046499307597713`*^9, 3.904649938003138*^9}, {
   3.904650076167879*^9, 3.904650088837571*^9}, {3.904650176147087*^9, 
   3.904650218774405*^9}, {3.9046509408538923`*^9, 3.904651052906501*^9}, {
   3.90465112730208*^9, 3.904651149043313*^9}, {3.904651368771426*^9, 
   3.904651422684654*^9}, {3.904651455231081*^9, 3.904651456024313*^9}, {
   3.904651500065998*^9, 3.904651521203361*^9}, {3.904651603100375*^9, 
   3.904651830293479*^9}, {3.904651893432475*^9, 3.904651894263661*^9}, {
   3.904651932357397*^9, 3.904651986347093*^9}, {3.9046520542382317`*^9, 
   3.904652071454166*^9}, {3.904652158052786*^9, 3.904652239208932*^9}, {
   3.904652277374984*^9, 3.904652285332891*^9}, {3.904652343684256*^9, 
   3.9046524069554358`*^9}, {3.904652440517556*^9, 3.904652519713702*^9}, {
   3.904652552543211*^9, 3.9046526352173767`*^9}, {3.904652684939281*^9, 
   3.904652854823515*^9}, {3.904652889265086*^9, 3.904653059791809*^9}, {
   3.9046533029343567`*^9, 3.904653309267363*^9}, {3.904653451803244*^9, 
   3.9046534609163094`*^9}, {3.904653663587493*^9, 3.904653685570816*^9}, {
   3.9046537769445744`*^9, 3.9046537938675127`*^9}, {3.9046538319546137`*^9, 
   3.904653841136348*^9}, {3.904825340182719*^9, 3.904825381511484*^9}, {
   3.904825420086461*^9, 3.9048254230474167`*^9}, {3.904825513730876*^9, 
   3.904825546124176*^9}, 3.904825623299837*^9, {3.904825830332336*^9, 
   3.904825830510722*^9}, {3.904825919890212*^9, 3.904825920140286*^9}, {
   3.904826237754408*^9, 3.904826237977922*^9}, 3.904830471276381*^9, {
   3.904831405045595*^9, 3.9048314102476597`*^9}, {3.9049027475874033`*^9, 
   3.90490278165556*^9}, {3.9052650582806892`*^9, 3.9052650615424557`*^9}, {
   3.9052651017302113`*^9, 3.905265158431285*^9}, {3.905265212948326*^9, 
   3.905265216035543*^9}, {3.9066409121269054`*^9, 3.906641001786029*^9}, {
   3.906641053054123*^9, 3.9066410737867427`*^9}, {3.9066423917817945`*^9, 
   3.906642399419865*^9}, {3.90664302250134*^9, 3.906643024123335*^9}, 
   3.9076735534852324`*^9, 3.910432233061236*^9, 3.9104323689756947`*^9, 
   3.910432404452976*^9, 3.915616533846183*^9, 3.915616577061673*^9, 
   3.922881173886609*^9, 3.9306473331041803`*^9},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[536]:=",ExpressionUUID->"dad7735e-3e03-410d-973f-36f8024eb4eb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Stitch4", "[", "listOfLists_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"L", "=", "listOfLists"}], ",", "ogStitch", ",", "fullStitch", 
       ",", "output"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ogStitch", "=", 
       RowBox[{"Join", "@@", "listOfLists"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"fullStitch", "=", 
       RowBox[{"Delete", "[", 
        RowBox[{"ogStitch", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"L", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "+", "1"}], "]"}], "}"}], ",", 
           
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"L", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
             RowBox[{"Length", "[", 
              RowBox[{"L", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}], "+", "1"}], "}"}], ",", 
           
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"L", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
             RowBox[{"Length", "[", 
              RowBox[{"L", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}], "+", 
             RowBox[{"Length", "[", 
              RowBox[{"L", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "]"}], "+", "1"}], "}"}]}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"output", "=", "fullStitch"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.9037729945242033`*^9, {3.905430683478376*^9, 3.905430692423774*^9}, 
   3.907673553485446*^9, 3.910432233061462*^9, 3.910432368976097*^9, 
   3.910432404453218*^9, 3.915616533846492*^9, 3.915616577062004*^9, {
   3.9156281457957773`*^9, 3.915628148054187*^9}, {3.915628211240491*^9, 
   3.915628213222961*^9}, 3.922881173886609*^9, 3.930647333104375*^9},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[537]:=",ExpressionUUID->"c0efde7f-3ec9-43be-bea2-3afe56c10da8"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"OnePulseShapeMagic", "[", 
     RowBox[{"ParameterTable_", ",", "timestep_", ",", "request_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"genP", "=", "ParameterTable"}], ",", 
        RowBox[{"dt", "=", "timestep"}], ",", 
        RowBox[{"req", "=", "request"}], ",", "T", ",", "PW", ",", "N", ",", 
        "B", ",", "\[Phi]", ",", "\[Tau]", ",", "\[Tau]P", ",", "T0", ",", 
        "domain", ",", "XPeriod", ",", "YPeriod", ",", "shapesX", ",", 
        "shapesY", ",", "output"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"T", "=", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"duration", " ", "of", " ", "full", " ", "period"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"PW", " ", "=", " ", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"duration", " ", "of", " ", "one", " ", "pulsewidth"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"N", " ", "=", " ", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
        "number", " ", "of", " ", "Gaussians", " ", "per", " ", "pulse"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"B", " ", "=", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"pulse", " ", "power"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[Phi]", " ", "=", " ", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "5", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"phase", " ", "cycle", " ", "for", " ", "N"}], " ", "=", 
           " ", 
           RowBox[{"2", " ", "pulses"}]}], ";", " ", 
          RowBox[{"0", " ", "for", " ", "symmetric"}]}], ",", " ", 
         RowBox[{"1", " ", "for", " ", "antisymmetric"}]}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"\[Tau]", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox[
           RowBox[{"T", "-", 
            RowBox[{"16", "*", "PW"}]}], "4"], ",", "dt"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"duration", " ", "of", " ", "delay"}], " ", "-", " ", 
         RowBox[{"encoded", " ", "in", " ", "T", " ", "and", " ", "PW"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[Tau]P", " ", "=", 
        RowBox[{"Round", "[", " ", 
         RowBox[{
          FractionBox["\[Tau]", "4"], ",", "dt"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"duration", " ", "of", " ", "inter"}], "-", 
         RowBox[{"pulse", " ", "delay"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"T0", " ", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"4", "*", "PW"}], "+", 
           RowBox[{"3", "*", "\[Tau]P"}]}], ",", "dt"}], "]"}]}], " ", ";", 
       RowBox[{"(*", 
        RowBox[{
        "duration", " ", "of", " ", "one", " ", "XY4", " ", "subperiod"}], 
        "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"domain", "=", 
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Round", "[", 
           RowBox[{"T", ",", "dt"}], "]"}], ",", "dt"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"N", "==", "1"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"XPeriod", "=", 
           RowBox[{"Quiet", "@", 
            RowBox[{"GaussAmpMod", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  FractionBox["32", 
                   SuperscriptBox["PW", "2"]], ",", "1", ",", 
                  FractionBox["PW", "2"]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  FractionBox["32", 
                   SuperscriptBox["PW", "2"]], ",", "1", ",", 
                  RowBox[{
                   RowBox[{"2", "*", "PW"}], "+", 
                   RowBox[{"2", "*", "\[Tau]P"}], "+", 
                   FractionBox["PW", "2"]}]}], "}"}]}], "}"}], ",", "T0", ",",
               "dt"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"YPeriod", "=", 
           RowBox[{"Quiet", "@", 
            RowBox[{"GaussAmpMod", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  FractionBox["32", 
                   SuperscriptBox["PW", "2"]], ",", "1", ",", 
                  RowBox[{"PW", "+", "\[Tau]P", "+", 
                   FractionBox["PW", "2"]}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  FractionBox["32", 
                   SuperscriptBox["PW", "2"]], ",", "1", ",", 
                  RowBox[{
                   RowBox[{"3", "*", "PW"}], "+", 
                   RowBox[{"3", "*", "\[Tau]P"}], "+", 
                   FractionBox["PW", "2"]}]}], "}"}]}], "}"}], ",", "T0", ",",
               "dt"}], "]"}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"N", "==", "2"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"\[Phi]", "==", "0"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"XPeriod", "=", 
              RowBox[{"Quiet", "@", 
               RowBox[{"GaussAmpMod", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", "1", ",", 
                    FractionBox["PW", "4"]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", "1", ",", 
                    RowBox[{"3", "*", 
                    FractionBox["PW", "4"]}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", "1", ",", 
                    RowBox[{
                    RowBox[{"2", "*", "PW"}], "+", 
                    RowBox[{"2", "*", "\[Tau]P"}], "+", 
                    FractionBox["PW", "4"]}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", "1", ",", 
                    RowBox[{
                    RowBox[{"2", "*", "PW"}], "+", 
                    RowBox[{"2", "*", "\[Tau]P"}], "+", 
                    RowBox[{"3", "*", 
                    FractionBox["PW", "4"]}]}]}], "}"}]}], "}"}], ",", "T0", 
                 ",", "dt"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"YPeriod", "=", 
              RowBox[{"Quiet", "@", 
               RowBox[{"GaussAmpMod", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", "1", ",", 
                    RowBox[{"PW", "+", "\[Tau]P", "+", 
                    FractionBox["PW", "4"]}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", "1", ",", 
                    RowBox[{"PW", "+", "\[Tau]P", "+", 
                    RowBox[{"3", "*", 
                    FractionBox["PW", "4"]}]}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", "1", ",", 
                    RowBox[{
                    RowBox[{"3", "*", "PW"}], "+", 
                    RowBox[{"3", "*", "\[Tau]P"}], "+", 
                    FractionBox["PW", "4"]}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", "1", ",", 
                    RowBox[{
                    RowBox[{"3", "*", "PW"}], "+", 
                    RowBox[{"3", "*", "\[Tau]P"}], "+", 
                    RowBox[{"3", "*", 
                    FractionBox["PW", "4"]}]}]}], "}"}]}], "}"}], ",", "T0", 
                 ",", "dt"}], "]"}]}]}], ";"}]}], "\[IndentingNewLine]", 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"\[Phi]", "==", "1"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"XPeriod", "=", 
              RowBox[{"Quiet", "@", 
               RowBox[{"GaussAmpMod", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", "1", ",", 
                    FractionBox["PW", "4"]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", 
                    RowBox[{"-", "1"}], ",", 
                    RowBox[{"3", "*", 
                    FractionBox["PW", "4"]}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", "1", ",", 
                    RowBox[{
                    RowBox[{"2", "*", "PW"}], "+", 
                    RowBox[{"2", "*", "\[Tau]P"}], "+", 
                    FractionBox["PW", "4"]}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", 
                    RowBox[{"-", "1"}], ",", 
                    RowBox[{
                    RowBox[{"2", "*", "PW"}], "+", 
                    RowBox[{"2", "*", "\[Tau]P"}], "+", 
                    RowBox[{"3", "*", 
                    FractionBox["PW", "4"]}]}]}], "}"}]}], "}"}], ",", "T0", 
                 ",", "dt"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"YPeriod", "=", 
              RowBox[{"Quiet", "@", 
               RowBox[{"GaussAmpMod", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", "1", ",", 
                    RowBox[{"PW", "+", "\[Tau]P", "+", 
                    FractionBox["PW", "4"]}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", 
                    RowBox[{"-", "1"}], ",", 
                    RowBox[{"PW", "+", "\[Tau]P", "+", 
                    RowBox[{"3", "*", 
                    FractionBox["PW", "4"]}]}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", "1", ",", 
                    RowBox[{
                    RowBox[{"3", "*", "PW"}], "+", 
                    RowBox[{"3", "*", "\[Tau]P"}], "+", 
                    FractionBox["PW", "4"]}]}], "}"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    FractionBox[
                    RowBox[{"4", "*", "32"}], 
                    SuperscriptBox["PW", "2"]], ",", 
                    RowBox[{"-", "1"}], ",", 
                    RowBox[{
                    RowBox[{"3", "*", "PW"}], "+", 
                    RowBox[{"3", "*", "\[Tau]P"}], "+", 
                    RowBox[{"3", "*", 
                    FractionBox["PW", "4"]}]}]}], "}"}]}], "}"}], ",", "T0", 
                 ",", "dt"}], "]"}]}]}], ";"}]}], "\[IndentingNewLine]", 
           "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"shapesX", "=", 
        RowBox[{"AddDelay", "[", 
         RowBox[{
          RowBox[{"Force", "[", 
           RowBox[{
            RowBox[{"Stitch4", "[", 
             RowBox[{"{", 
              RowBox[{"XPeriod", ",", 
               RowBox[{
                RowBox[{"-", "1"}], "*", "XPeriod"}], ",", 
               RowBox[{
                RowBox[{"-", "1"}], "*", "XPeriod"}], ",", "XPeriod"}], "}"}],
              "]"}], ",", "B"}], "]"}], ",", "\[Tau]", ",", "dt"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"shapesY", "=", 
        RowBox[{"AddDelay", "[", 
         RowBox[{
          RowBox[{"Force", "[", 
           RowBox[{
            RowBox[{"Stitch4", "[", 
             RowBox[{"{", 
              RowBox[{"YPeriod", ",", 
               RowBox[{
                RowBox[{"-", "1"}], "*", "YPeriod"}], ",", 
               RowBox[{
                RowBox[{"-", "1"}], "*", "YPeriod"}], ",", "YPeriod"}], "}"}],
              "]"}], ",", "B"}], "]"}], ",", "\[Tau]", ",", "dt"}], "]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<Graph\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"Show", "[", 
            RowBox[{
             RowBox[{"TracePlot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Range", "[", 
                   RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "XPeriod", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "XPeriod"}], 
                 "}"}], "\[Transpose]"}], ",", "Red", ",", 
               RowBox[{"{", 
                RowBox[{
                "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", "XPeriod", "]"}], "-", "1"}], 
                   ")"}], "*", "dt"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"TracePlot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Range", "[", 
                   RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "YPeriod", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "YPeriod"}], 
                 "}"}], "\[Transpose]"}], ",", "Blue", ",", 
               RowBox[{"{", 
                RowBox[{
                "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", "YPeriod", "]"}], "-", "1"}], 
                   ")"}], "*", "dt"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<FullGraph\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"Show", "[", 
            RowBox[{
             RowBox[{"TracePlot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Range", "[", 
                   RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesX"}], 
                 "}"}], "\[Transpose]"}], ",", "Red", ",", 
               RowBox[{"{", 
                RowBox[{
                "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], 
                   ")"}], "*", "dt"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"TracePlot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Range", "[", 
                   RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesY", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesY"}], 
                 "}"}], "\[Transpose]"}], ",", "Blue", ",", 
               RowBox[{"{", 
                RowBox[{
                "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], 
                   ")"}], "*", "dt"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<Generate\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"{", 
            RowBox[{"shapesX", ",", "shapesY"}], "}"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<Subperiod\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"{", 
            RowBox[{"XPeriod", ",", "YPeriod"}], "}"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<ShortPol\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"SliceAndPolarize", "[", 
            RowBox[{
            "shapesX", ",", "shapesY", ",", "B", ",", "dt", ",", "2000"}], 
            "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<Pol\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"SliceAndPolarize", "[", 
            RowBox[{
            "shapesX", ",", "shapesY", ",", "B", ",", "dt", ",", "20000"}], 
            "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<FullPol\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"SliceAndPolarize", "[", 
            RowBox[{
            "shapesX", ",", "shapesY", ",", "B", ",", "dt", ",", "60000"}], 
            "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<FullPolTrace\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"TracePlot", "[", 
            RowBox[{
             RowBox[{"SmartPolTrace", "[", 
              RowBox[{
              "shapesX", ",", "shapesY", ",", "B", ",", "dt", ",", "60000"}], 
              "]"}], ",", "Black", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<t (s)\>\"", ",", "\"\<Polarization (%)\>\""}], 
              "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0.001", ",", "60"}], "}"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<FullPolData\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"SmartPolTrace", "[", 
            RowBox[{
            "shapesX", ",", "shapesY", ",", "B", ",", "dt", ",", "60000"}], 
            "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "output"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",\

 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.900580855345851*^9, 3.900582405436839*^9, {3.900582525691217*^9, 
   3.900582599221718*^9}, {3.900582633822196*^9, 3.900582673806778*^9}, {
   3.9005827331666803`*^9, 3.900582992797325*^9}, {3.900583255699739*^9, 
   3.900583298846998*^9}, {3.900583373038166*^9, 3.900583417275872*^9}, {
   3.900583629416684*^9, 3.900583723080104*^9}, {3.900584054440856*^9, 
   3.900584135010436*^9}, {3.9005841667314987`*^9, 3.900584195743218*^9}, {
   3.900584238841755*^9, 3.9005842624719543`*^9}, {3.9005842971598063`*^9, 
   3.9005845943531027`*^9}, {3.900584639639245*^9, 3.900584681553575*^9}, {
   3.900584721549426*^9, 3.900584725925117*^9}, {3.900584795703372*^9, 
   3.900585088590146*^9}, {3.900660221200687*^9, 3.900660290503244*^9}, {
   3.900670952442913*^9, 3.90067096436651*^9}, {3.902563938030075*^9, 
   3.9025639777787437`*^9}, {3.902564031092112*^9, 3.902564066060812*^9}, 
   3.903010805114746*^9, {3.903012230593152*^9, 3.903012247930551*^9}, {
   3.903012374762082*^9, 3.903012375307864*^9}, 3.9030124057149553`*^9, {
   3.903443873478541*^9, 3.9034438820077477`*^9}, {3.903443943211705*^9, 
   3.9034439490221653`*^9}, {3.903449779971607*^9, 3.9034497838750257`*^9}, {
   3.9034502043216047`*^9, 3.903450219615345*^9}, {3.90352102896943*^9, 
   3.903521030184499*^9}, {3.9036198970551*^9, 3.9036199968315783`*^9}, {
   3.9036200573141747`*^9, 3.9036201880885*^9}, {3.903689990942814*^9, 
   3.903690013775507*^9}, {3.9036922299120207`*^9, 3.903692272867366*^9}, {
   3.903692729147436*^9, 3.903692753577423*^9}, {3.903692796323489*^9, 
   3.90369290491924*^9}, {3.903692968545385*^9, 3.9036929686509132`*^9}, {
   3.903693043032003*^9, 3.9036932392353077`*^9}, {3.9036932775573587`*^9, 
   3.903693416376142*^9}, {3.9036937136929827`*^9, 3.903693850414905*^9}, {
   3.903772208058812*^9, 3.903772242110189*^9}, {3.903772391977173*^9, 
   3.903772468447204*^9}, {3.903772502530051*^9, 3.903772552954425*^9}, {
   3.9037726099986553`*^9, 3.903772752003084*^9}, {3.903772881161965*^9, 
   3.9037728877425117`*^9}, {3.903773071692569*^9, 3.9037731092710123`*^9}, {
   3.903773197387085*^9, 3.9037732103047667`*^9}, {3.903773256584978*^9, 
   3.903773269906248*^9}, {3.903773450806162*^9, 3.903773487172432*^9}, 
   3.907673553485647*^9, {3.909740734186707*^9, 3.909740736812913*^9}, 
   3.9104322330621223`*^9, 3.910432368976783*^9, 3.9104324044538603`*^9, 
   3.915616533846799*^9, 3.915616577062332*^9, 3.922881173886609*^9, 
   3.930647333104566*^9},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[538]:=",ExpressionUUID->"97bd99b7-7f34-4813-9bd1-7c3a841d649c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"XY16Polarize", "[", 
     RowBox[{
     "T_", ",", "PW_", ",", "Bx_", ",", "By_", ",", "Bz_", ",", 
      "maxFreqSweep_", ",", "B0_", ",", "dt_", ",", "runtime_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "N", ",", "B", ",", "\[Phi]", ",", "\[Tau]", ",", "\[Tau]P", ",", "T0",
         ",", "domain", ",", 
        RowBox[{"maxF", "=", "maxFreqSweep"}], ",", "freqMod", ",", 
        "phaseMod", ",", "cosTable", ",", "xPulse", ",", "yPulse", ",", 
        "U1LongD", ",", "U1D", ",", "U1Bx", ",", "U1Bxb", ",", "U1By", ",", 
        "U1Byb", ",", "U2LongD", ",", "U2D", ",", "U2Bx", ",", "U2Bxb", ",", 
        "U2By", ",", "U2Byb", ",", "UFLongD", ",", "UFD", ",", "UFBx", ",", 
        "UFBxb", ",", "UFBy", ",", "UFByb", ",", "output"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Tau]", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox["T", "4"], ",", "dt"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"duration", " ", "of", " ", "delay"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"T0", " ", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox[
           RowBox[{"3", "*", "\[Tau]"}], "4"], ",", "dt"}], "]"}]}], " ", ";", 
       RowBox[{"(*", 
        RowBox[{
        "duration", " ", "of", " ", "one", " ", "XY4", " ", "subperiod"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[Tau]P", " ", "=", 
        RowBox[{"Round", "[", " ", 
         RowBox[{
          FractionBox[
           RowBox[{"T0", "-", 
            RowBox[{"4", "*", "PW"}]}], "3"], ",", "dt"}], "]"}]}], ";", " ", 
       
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"duration", " ", "of", " ", "inter"}], "-", 
         RowBox[{"pulse", " ", "delay"}]}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"domain", " ", "=", 
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Round", "[", 
           RowBox[{"PW", ",", "dt"}], "]"}], ",", "dt"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"domain", " ", "of", " ", "one", " ", "pulsewidth"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"freqMod", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             FractionBox[
              RowBox[{"2", "*", "maxF"}], "PW"], "*", "i"}], "-", "maxF"}], 
           ")"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "domain"}], "}"}]}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
        "maxF", " ", "is", " ", "in", " ", "units", " ", "of", " ", "kHz"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"phaseMod", "=", 
        RowBox[{"2", "\[Pi]", "*", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"freqMod", "[", 
               RowBox[{"[", "j", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", 
                FractionBox["i", "dt"]}], "}"}]}], "]"}], "*", "dt"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "domain"}], "}"}]}], "]"}]}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"phaseMod", " ", "=", " ", 
        RowBox[{"phaseMod", "-", 
         RowBox[{"Min", "[", "phaseMod", "]"}]}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"corrected", " ", "phase", " ", "modulation"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"cosTable", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Cos", "[", 
           RowBox[{
            RowBox[{"2", "*", "\[Pi]", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[Gamma]H", "*", "Bz"}], "+", 
                 RowBox[{"1000", "*", 
                  RowBox[{"freqMod", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}]}], ")"}], "*", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"domain", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "-", 
                 FractionBox["PW", "2"]}], ")"}], "*", "0.001"}], ")"}]}], 
            "+", 
            RowBox[{"phaseMod", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "domain", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"xPulse", "=", 
        RowBox[{
         RowBox[{"Quiet", "@", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               FractionBox["32", 
                SuperscriptBox["PW", "2"]], ",", "Bx", ",", 
               FractionBox["PW", "2"]}], "}"}], "}"}], ",", "PW", ",", "dt"}],
            "]"}]}], "*", "cosTable"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"yPulse", "=", 
        RowBox[{
         RowBox[{"Quiet", "@", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               FractionBox["32", 
                SuperscriptBox["PW", "2"]], ",", "By", ",", 
               FractionBox["PW", "2"]}], "}"}], "}"}], ",", "PW", ",", "dt"}],
            "]"}]}], "*", "cosTable"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"U1LongD", "=", 
        RowBox[{"U1", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U1D", "=", 
        RowBox[{"U1", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]P"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U1Bx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"xPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1By", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"yPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1Bxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"-", 
              RowBox[{"xPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1Byb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"yPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"U2LongD", "=", 
        RowBox[{"U2", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U2D", "=", 
        RowBox[{"U2", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]P"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U2Bx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"xPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2By", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"yPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2Bxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"-", 
              RowBox[{"xPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2Byb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"yPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"UFLongD", "=", 
        RowBox[{"UF", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"UFD", "=", 
        RowBox[{"UF", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]P"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"UFBx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"xPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFBy", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"yPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFBxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"-", 
              RowBox[{"xPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFByb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"yPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"output", "=", 
        RowBox[{"Last", "@", 
         RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "U1LongD", ",", "U1Bx", ",", "U1D", ",", "U1By", ",", "U1D", ",", 
             "U1Bx", ",", "U1D", ",", "U1By", ",", "U1Bxb", ",", "U1D", ",", 
             "U1Byb", ",", "U1D", ",", "U1Bxb", ",", "U1D", ",", "U1Byb", ",",
              "U1Bxb", ",", "U1D", ",", "U1Byb", ",", "U1D", ",", "U1Bxb", 
             ",", "U1D", ",", "U1Byb", ",", "U1Bx", ",", "U1D", ",", "U1By", 
             ",", "U1D", ",", "U1Bx", ",", "U1D", ",", "U1By"}], "}"}], 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "isomer", " ", "1"}], 
            "*)"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
            "U2LongD", ",", "U2Bx", ",", "U2D", ",", "U2By", ",", "U2D", ",", 
             "U2Bx", ",", "U2D", ",", "U2By", ",", "U2Bxb", ",", "U2D", ",", 
             "U2Byb", ",", "U2D", ",", "U2Bxb", ",", "U2D", ",", "U2Byb", ",",
              "U2Bxb", ",", "U2D", ",", "U2Byb", ",", "U2D", ",", "U2Bxb", 
             ",", "U2D", ",", "U2Byb", ",", "U2Bx", ",", "U2D", ",", "U2By", 
             ",", "U2D", ",", "U2Bx", ",", "U2D", ",", "U2By"}], "}"}], 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
            "*)"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
            "UFLongD", ",", "UFBx", ",", "UFD", ",", "UFBy", ",", "UFD", ",", 
             "UFBx", ",", "UFD", ",", "UFBy", ",", "UFBxb", ",", "UFD", ",", 
             "UFByb", ",", "UFD", ",", "UFBxb", ",", "UFD", ",", "UFByb", ",",
              "UFBxb", ",", "UFD", ",", "UFByb", ",", "UFD", ",", "UFBxb", 
             ",", "UFD", ",", "UFByb", ",", "UFBx", ",", "UFD", ",", "UFBy", 
             ",", "UFD", ",", "UFBx", ",", "UFD", ",", "UFBy"}], "}"}], 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
            "*)"}], ",", "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
           RowBox[{"(*", 
            RowBox[{
            "initial", " ", "conditions", " ", "for", " ", "bound", " ", 
             "and", " ", "free", " ", "species"}], "*)"}], ",", 
           "\[IndentingNewLine]", "16", 
           RowBox[{"(*", 
            RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",",
            "2", 
           RowBox[{"(*", 
            RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
           "\[IndentingNewLine]", 
           FractionBox["1", "20"], 
           RowBox[{"(*", 
            FractionBox[
             RowBox[{"[", "Ir", "]"}], 
             RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
           RowBox[{"(*", 
            RowBox[{
             FractionBox[
              RowBox[{"[", "Ir", "]"}], 
              RowBox[{"[", "H2", "]"}]], ",", " ", 
             RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"OnesList", "[", "29", "]"}], 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
             ",", " ", 
             RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "\[Tau]", ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", 
             ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "PW", ",", "\[Tau]P", 
             ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", ",", "PW", 
             ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", ",", "PW", 
             ",", "\[Tau]P", ",", "PW", ",", "PW", ",", "\[Tau]P", ",", "PW", 
             ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", ",", "PW"}], "}"}], 
           RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", 
           RowBox[{"Round", "[", 
            FractionBox["runtime", "T"], "]"}]}], "]"}]}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",\

 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.900580855345851*^9, 3.900582405436839*^9, {3.900582525691217*^9, 
   3.900582599221718*^9}, {3.900582633822196*^9, 3.900582673806778*^9}, {
   3.9005827331666803`*^9, 3.900582992797325*^9}, {3.900583255699739*^9, 
   3.900583298846998*^9}, {3.900583373038166*^9, 3.900583417275872*^9}, {
   3.900583629416684*^9, 3.900583723080104*^9}, {3.900584054440856*^9, 
   3.900584135010436*^9}, {3.9005841667314987`*^9, 3.900584195743218*^9}, {
   3.900584238841755*^9, 3.9005842624719543`*^9}, {3.9005842971598063`*^9, 
   3.9005845943531027`*^9}, {3.900584639639245*^9, 3.900584681553575*^9}, {
   3.900584721549426*^9, 3.900584725925117*^9}, {3.900584795703372*^9, 
   3.900585088590146*^9}, {3.900660221200687*^9, 3.900660290503244*^9}, {
   3.900670952442913*^9, 3.90067096436651*^9}, {3.902563938030075*^9, 
   3.9025639777787437`*^9}, {3.902564031092112*^9, 3.902564066060812*^9}, 
   3.9025641649957733`*^9, {3.903019295296772*^9, 3.90301929710882*^9}, {
   3.903019377036001*^9, 3.9030194030692472`*^9}, {3.9030201484922132`*^9, 
   3.90302016251243*^9}, {3.9030202564894*^9, 3.903020296965027*^9}, 
   3.903022244302541*^9, 3.9046475433272142`*^9, {3.9046478410396423`*^9, 
   3.9046478480720053`*^9}, {3.904648057196312*^9, 3.90464805868918*^9}, {
   3.904648366849901*^9, 3.904648368348587*^9}, {3.904648444895329*^9, 
   3.9046484817750587`*^9}, 3.904649747582617*^9, {3.904649794442531*^9, 
   3.904649849534974*^9}, {3.9046499307597713`*^9, 3.904649938003138*^9}, {
   3.904650076167879*^9, 3.904650088837571*^9}, {3.904650176147087*^9, 
   3.904650218774405*^9}, {3.9046509408538923`*^9, 3.904651052906501*^9}, {
   3.90465112730208*^9, 3.904651149043313*^9}, {3.904651368771426*^9, 
   3.904651422684654*^9}, {3.904651455231081*^9, 3.904651456024313*^9}, {
   3.904651500065998*^9, 3.904651521203361*^9}, {3.904651603100375*^9, 
   3.904651830293479*^9}, {3.904651893432475*^9, 3.904651894263661*^9}, {
   3.904651932357397*^9, 3.904651986347093*^9}, {3.9046520542382317`*^9, 
   3.904652071454166*^9}, {3.904652158052786*^9, 3.904652239208932*^9}, {
   3.904652277374984*^9, 3.904652285332891*^9}, {3.904652343684256*^9, 
   3.9046524069554358`*^9}, {3.904652440517556*^9, 3.904652519713702*^9}, {
   3.904652552543211*^9, 3.9046526352173767`*^9}, {3.904652684939281*^9, 
   3.904652854823515*^9}, {3.904652889265086*^9, 3.904653059791809*^9}, {
   3.9046533029343567`*^9, 3.904653309267363*^9}, {3.904653451803244*^9, 
   3.9046534609163094`*^9}, {3.904653663587493*^9, 3.904653685570816*^9}, {
   3.9046537769445744`*^9, 3.9046537938675127`*^9}, {3.9046538319546137`*^9, 
   3.904653841136348*^9}, {3.904825340182719*^9, 3.904825381511484*^9}, {
   3.904825420086461*^9, 3.9048254230474167`*^9}, {3.904825513730876*^9, 
   3.904825546124176*^9}, 3.904825623299837*^9, {3.904825830332336*^9, 
   3.904825830510722*^9}, {3.904825919890212*^9, 3.904825920140286*^9}, {
   3.904826237754408*^9, 3.904826237977922*^9}, 3.904830471276381*^9, {
   3.904831405045595*^9, 3.9048314102476597`*^9}, {3.9049027475874033`*^9, 
   3.90490278165556*^9}, {3.9052650582806892`*^9, 3.9052650615424557`*^9}, {
   3.9052651017302113`*^9, 3.905265158431285*^9}, {3.905265212948326*^9, 
   3.905265216035543*^9}, {3.9066409121269054`*^9, 3.906641001786029*^9}, {
   3.906641053054123*^9, 3.9066410737867427`*^9}, {3.9066423917817945`*^9, 
   3.906642399419865*^9}, {3.90664302250134*^9, 3.906643024123335*^9}, 
   3.9076735534852324`*^9, {3.908283193766592*^9, 3.908283227684514*^9}, {
   3.908283315626425*^9, 3.908283352816839*^9}, {3.908283549289136*^9, 
   3.9082836123199577`*^9}, {3.908283657203041*^9, 3.9082836930404787`*^9}, {
   3.908283782810361*^9, 3.9082838161418324`*^9}, {3.908285776915271*^9, 
   3.908285820465694*^9}, {3.908285959924933*^9, 3.90828601033962*^9}, {
   3.908286259079455*^9, 3.908286271689782*^9}, {3.908824840631631*^9, 
   3.908824853502262*^9}, {3.908825586094879*^9, 3.908825657227935*^9}, {
   3.9088256917835007`*^9, 3.9088257330106773`*^9}, {3.908825787711007*^9, 
   3.908825868364313*^9}, {3.908825987433092*^9, 3.9088259876369753`*^9}, {
   3.90882605949216*^9, 3.908826085248372*^9}, {3.9088262066672373`*^9, 
   3.90882620829137*^9}, {3.908826248824243*^9, 3.908826411121233*^9}, {
   3.908826460358778*^9, 3.908826574500527*^9}, {3.908826608314764*^9, 
   3.9088267221022253`*^9}, {3.908826752375697*^9, 3.908826836874978*^9}, {
   3.910112966314968*^9, 3.9101129674076853`*^9}, 3.910432233065796*^9, 
   3.910432368977376*^9, 3.910432404454432*^9, 3.915616533847116*^9, 
   3.915616577062652*^9, 3.922881173886609*^9, 3.9306473331047697`*^9},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[539]:=",ExpressionUUID->"6234e170-3c6f-4c7b-a151-a420ce28efc6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"XY16PolTrace", "[", 
     RowBox[{
     "T_", ",", "PW_", ",", "Bx_", ",", "By_", ",", "Bz_", ",", 
      "maxFreqSweep_", ",", "B0_", ",", "dt_", ",", "runtime_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "N", ",", "B", ",", "\[Phi]", ",", "\[Tau]", ",", "\[Tau]P", ",", "T0",
         ",", "domain", ",", 
        RowBox[{"maxF", "=", "maxFreqSweep"}], ",", "freqMod", ",", 
        "phaseMod", ",", "cosTable", ",", "xPulse", ",", "yPulse", ",", 
        "U1LongD", ",", "U1D", ",", "U1Bx", ",", "U1Bxb", ",", "U1By", ",", 
        "U1Byb", ",", "U2LongD", ",", "U2D", ",", "U2Bx", ",", "U2Bxb", ",", 
        "U2By", ",", "U2Byb", ",", "UFLongD", ",", "UFD", ",", "UFBx", ",", 
        "UFBxb", ",", "UFBy", ",", "UFByb", ",", "output"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Tau]", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox["T", "4"], ",", "dt"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"duration", " ", "of", " ", "delay"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"T0", " ", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox[
           RowBox[{"3", "*", "\[Tau]"}], "4"], ",", "dt"}], "]"}]}], " ", ";", 
       RowBox[{"(*", 
        RowBox[{
        "duration", " ", "of", " ", "one", " ", "XY4", " ", "subperiod"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[Tau]P", " ", "=", 
        RowBox[{"Round", "[", " ", 
         RowBox[{
          FractionBox[
           RowBox[{"T0", "-", 
            RowBox[{"4", "*", "PW"}]}], "3"], ",", "dt"}], "]"}]}], ";", " ", 
       
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"duration", " ", "of", " ", "inter"}], "-", 
         RowBox[{"pulse", " ", "delay"}]}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"domain", " ", "=", 
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Round", "[", 
           RowBox[{"PW", ",", "dt"}], "]"}], ",", "dt"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"domain", " ", "of", " ", "one", " ", "pulsewidth"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"freqMod", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             FractionBox[
              RowBox[{"2", "*", "maxF"}], "PW"], "*", "i"}], "-", "maxF"}], 
           ")"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "domain"}], "}"}]}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
        "maxF", " ", "is", " ", "in", " ", "units", " ", "of", " ", "kHz"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"phaseMod", "=", 
        RowBox[{"2", "\[Pi]", "*", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"freqMod", "[", 
               RowBox[{"[", "j", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", 
                FractionBox["i", "dt"]}], "}"}]}], "]"}], "*", "dt"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "domain"}], "}"}]}], "]"}]}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"phaseMod", " ", "=", " ", 
        RowBox[{"phaseMod", "-", 
         RowBox[{"Min", "[", "phaseMod", "]"}]}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"corrected", " ", "phase", " ", "modulation"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"cosTable", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Cos", "[", 
           RowBox[{
            RowBox[{"2", "*", "\[Pi]", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[Gamma]H", "*", "Bz"}], "+", 
                 RowBox[{"1000", "*", 
                  RowBox[{"freqMod", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}]}], ")"}], "*", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"domain", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "-", 
                 FractionBox["PW", "2"]}], ")"}], "*", "0.001"}], ")"}]}], 
            "+", 
            RowBox[{"phaseMod", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "domain", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"xPulse", "=", 
        RowBox[{
         RowBox[{"Quiet", "@", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               FractionBox["32", 
                SuperscriptBox["PW", "2"]], ",", "Bx", ",", 
               FractionBox["PW", "2"]}], "}"}], "}"}], ",", "PW", ",", "dt"}],
            "]"}]}], "*", "cosTable"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"yPulse", "=", 
        RowBox[{
         RowBox[{"Quiet", "@", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               FractionBox["32", 
                SuperscriptBox["PW", "2"]], ",", "By", ",", 
               FractionBox["PW", "2"]}], "}"}], "}"}], ",", "PW", ",", "dt"}],
            "]"}]}], "*", "cosTable"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"U1LongD", "=", 
        RowBox[{"U1", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U1D", "=", 
        RowBox[{"U1", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]P"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U1Bx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"xPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1By", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"yPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1Bxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"-", 
              RowBox[{"xPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1Byb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"yPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"U2LongD", "=", 
        RowBox[{"U2", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U2D", "=", 
        RowBox[{"U2", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]P"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U2Bx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"xPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2By", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"yPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2Bxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"-", 
              RowBox[{"xPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2Byb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"yPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"UFLongD", "=", 
        RowBox[{"UF", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"UFD", "=", 
        RowBox[{"UF", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]P"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"UFBx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"xPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFBy", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"yPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFBxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"-", 
              RowBox[{"xPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFByb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"yPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"output", "=", 
        RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "U1LongD", ",", "U1Bx", ",", "U1D", ",", "U1By", ",", "U1D", ",", 
            "U1Bx", ",", "U1D", ",", "U1By", ",", "U1Bxb", ",", "U1D", ",", 
            "U1Byb", ",", "U1D", ",", "U1Bxb", ",", "U1D", ",", "U1Byb", ",", 
            "U1Bxb", ",", "U1D", ",", "U1Byb", ",", "U1D", ",", "U1Bxb", ",", 
            "U1D", ",", "U1Byb", ",", "U1Bx", ",", "U1D", ",", "U1By", ",", 
            "U1D", ",", "U1Bx", ",", "U1D", ",", "U1By"}], "}"}], 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "isomer", " ", "1"}], 
           "*)"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
           "U2LongD", ",", "U2Bx", ",", "U2D", ",", "U2By", ",", "U2D", ",", 
            "U2Bx", ",", "U2D", ",", "U2By", ",", "U2Bxb", ",", "U2D", ",", 
            "U2Byb", ",", "U2D", ",", "U2Bxb", ",", "U2D", ",", "U2Byb", ",", 
            "U2Bxb", ",", "U2D", ",", "U2Byb", ",", "U2D", ",", "U2Bxb", ",", 
            "U2D", ",", "U2Byb", ",", "U2Bx", ",", "U2D", ",", "U2By", ",", 
            "U2D", ",", "U2Bx", ",", "U2D", ",", "U2By"}], "}"}], 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
           "*)"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
           "UFLongD", ",", "UFBx", ",", "UFD", ",", "UFBy", ",", "UFD", ",", 
            "UFBx", ",", "UFD", ",", "UFBy", ",", "UFBxb", ",", "UFD", ",", 
            "UFByb", ",", "UFD", ",", "UFBxb", ",", "UFD", ",", "UFByb", ",", 
            "UFBxb", ",", "UFD", ",", "UFByb", ",", "UFD", ",", "UFBxb", ",", 
            "UFD", ",", "UFByb", ",", "UFBx", ",", "UFD", ",", "UFBy", ",", 
            "UFD", ",", "UFBx", ",", "UFD", ",", "UFBy"}], "}"}], 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
           "*)"}], ",", "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
          RowBox[{"(*", 
           RowBox[{
           "initial", " ", "conditions", " ", "for", " ", "bound", " ", "and",
             " ", "free", " ", "species"}], "*)"}], ",", 
          "\[IndentingNewLine]", "16", 
          RowBox[{"(*", 
           RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",", 
          "2", 
          RowBox[{"(*", 
           RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
          "\[IndentingNewLine]", 
          FractionBox["1", "20"], 
          RowBox[{"(*", 
           FractionBox[
            RowBox[{"[", "Ir", "]"}], 
            RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
          RowBox[{"(*", 
           RowBox[{
            FractionBox[
             RowBox[{"[", "Ir", "]"}], 
             RowBox[{"[", "H2", "]"}]], ",", " ", 
            RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"OnesList", "[", "29", "]"}], 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
            ",", " ", 
            RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
          RowBox[{"{", 
           RowBox[{
           "\[Tau]", ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", 
            ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "PW", ",", "\[Tau]P", 
            ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", ",", "PW", 
            ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", ",", "PW", 
            ",", "\[Tau]P", ",", "PW", ",", "PW", ",", "\[Tau]P", ",", "PW", 
            ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", ",", "PW"}], "}"}], 
          RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", 
          RowBox[{"Round", "[", 
           FractionBox["runtime", "T"], "]"}]}], "]"}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",\

 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.900580855345851*^9, 3.900582405436839*^9, {3.900582525691217*^9, 
   3.900582599221718*^9}, {3.900582633822196*^9, 3.900582673806778*^9}, {
   3.9005827331666803`*^9, 3.900582992797325*^9}, {3.900583255699739*^9, 
   3.900583298846998*^9}, {3.900583373038166*^9, 3.900583417275872*^9}, {
   3.900583629416684*^9, 3.900583723080104*^9}, {3.900584054440856*^9, 
   3.900584135010436*^9}, {3.9005841667314987`*^9, 3.900584195743218*^9}, {
   3.900584238841755*^9, 3.9005842624719543`*^9}, {3.9005842971598063`*^9, 
   3.9005845943531027`*^9}, {3.900584639639245*^9, 3.900584681553575*^9}, {
   3.900584721549426*^9, 3.900584725925117*^9}, {3.900584795703372*^9, 
   3.900585088590146*^9}, {3.900660221200687*^9, 3.900660290503244*^9}, {
   3.900670952442913*^9, 3.90067096436651*^9}, {3.902563938030075*^9, 
   3.9025639777787437`*^9}, {3.902564031092112*^9, 3.902564066060812*^9}, 
   3.9025641649957733`*^9, {3.903019295296772*^9, 3.90301929710882*^9}, {
   3.903019377036001*^9, 3.9030194030692472`*^9}, {3.9030201484922132`*^9, 
   3.90302016251243*^9}, {3.9030202564894*^9, 3.903020296965027*^9}, 
   3.903022244302541*^9, 3.9046475433272142`*^9, {3.9046478410396423`*^9, 
   3.9046478480720053`*^9}, {3.904648057196312*^9, 3.90464805868918*^9}, {
   3.904648366849901*^9, 3.904648368348587*^9}, {3.904648444895329*^9, 
   3.9046484817750587`*^9}, 3.904649747582617*^9, {3.904649794442531*^9, 
   3.904649849534974*^9}, {3.9046499307597713`*^9, 3.904649938003138*^9}, {
   3.904650076167879*^9, 3.904650088837571*^9}, {3.904650176147087*^9, 
   3.904650218774405*^9}, {3.9046509408538923`*^9, 3.904651052906501*^9}, {
   3.90465112730208*^9, 3.904651149043313*^9}, {3.904651368771426*^9, 
   3.904651422684654*^9}, {3.904651455231081*^9, 3.904651456024313*^9}, {
   3.904651500065998*^9, 3.904651521203361*^9}, {3.904651603100375*^9, 
   3.904651830293479*^9}, {3.904651893432475*^9, 3.904651894263661*^9}, {
   3.904651932357397*^9, 3.904651986347093*^9}, {3.9046520542382317`*^9, 
   3.904652071454166*^9}, {3.904652158052786*^9, 3.904652239208932*^9}, {
   3.904652277374984*^9, 3.904652285332891*^9}, {3.904652343684256*^9, 
   3.9046524069554358`*^9}, {3.904652440517556*^9, 3.904652519713702*^9}, {
   3.904652552543211*^9, 3.9046526352173767`*^9}, {3.904652684939281*^9, 
   3.904652854823515*^9}, {3.904652889265086*^9, 3.904653059791809*^9}, {
   3.9046533029343567`*^9, 3.904653309267363*^9}, {3.904653451803244*^9, 
   3.9046534609163094`*^9}, {3.904653663587493*^9, 3.904653685570816*^9}, {
   3.9046537769445744`*^9, 3.9046537938675127`*^9}, {3.9046538319546137`*^9, 
   3.904653841136348*^9}, {3.904825340182719*^9, 3.904825381511484*^9}, {
   3.904825420086461*^9, 3.9048254230474167`*^9}, {3.904825513730876*^9, 
   3.904825546124176*^9}, 3.904825623299837*^9, {3.904825830332336*^9, 
   3.904825830510722*^9}, {3.904825919890212*^9, 3.904825920140286*^9}, {
   3.904826237754408*^9, 3.904826237977922*^9}, 3.904830471276381*^9, {
   3.904831405045595*^9, 3.9048314102476597`*^9}, {3.9049027475874033`*^9, 
   3.90490278165556*^9}, {3.9052650582806892`*^9, 3.9052650615424557`*^9}, {
   3.9052651017302113`*^9, 3.905265158431285*^9}, {3.905265212948326*^9, 
   3.905265216035543*^9}, {3.9066409121269054`*^9, 3.906641001786029*^9}, {
   3.906641053054123*^9, 3.9066410737867427`*^9}, {3.9066423917817945`*^9, 
   3.906642399419865*^9}, {3.90664302250134*^9, 3.906643024123335*^9}, 
   3.9076735534852324`*^9, {3.908283193766592*^9, 3.908283227684514*^9}, {
   3.908283315626425*^9, 3.908283352816839*^9}, {3.908283549289136*^9, 
   3.9082836123199577`*^9}, {3.908283657203041*^9, 3.9082836930404787`*^9}, {
   3.908283782810361*^9, 3.9082838161418324`*^9}, {3.908285776915271*^9, 
   3.908285820465694*^9}, {3.908285959924933*^9, 3.90828601033962*^9}, {
   3.908286259079455*^9, 3.908286271689782*^9}, {3.908824840631631*^9, 
   3.908824853502262*^9}, {3.908825586094879*^9, 3.908825657227935*^9}, {
   3.9088256917835007`*^9, 3.9088257330106773`*^9}, {3.908825787711007*^9, 
   3.908825868364313*^9}, {3.908825987433092*^9, 3.9088259876369753`*^9}, {
   3.90882605949216*^9, 3.908826085248372*^9}, {3.9088262066672373`*^9, 
   3.90882620829137*^9}, {3.908826248824243*^9, 3.908826411121233*^9}, {
   3.908826460358778*^9, 3.908826574500527*^9}, {3.908826608314764*^9, 
   3.9088267221022253`*^9}, {3.908826752375697*^9, 3.908826836874978*^9}, {
   3.910112966314968*^9, 3.9101129674076853`*^9}, 3.910432233065796*^9, 
   3.910432368977376*^9, 3.910432404454432*^9, 3.915616533847116*^9, 
   3.915616577062652*^9, 3.922881173886609*^9, {3.9249577643939905`*^9, 
   3.924957785688412*^9}, 3.930647333104965*^9},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[540]:=",ExpressionUUID->"d4947b96-9f24-4bc8-b1be-409a44320aa0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"JModXY16PolTrace", "[", 
     RowBox[{
     "T_", ",", "PW_", ",", "Bx_", ",", "By_", ",", "Bz_", ",", 
      "maxFreqSweep_", ",", "B0_", ",", "dt_", ",", "runtime_", ",", 
      "Jaux_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "N", ",", "B", ",", "\[Phi]", ",", "\[Tau]", ",", "\[Tau]P", ",", "T0",
         ",", "domain", ",", 
        RowBox[{"maxF", "=", "maxFreqSweep"}], ",", 
        RowBox[{"J", "=", "Jaux"}], ",", "freqMod", ",", "phaseMod", ",", 
        "cosTable", ",", "xPulse", ",", "yPulse", ",", "U1LongD", ",", "U1D", 
        ",", "U1Bx", ",", "U1Bxb", ",", "U1By", ",", "U1Byb", ",", "U2LongD", 
        ",", "U2D", ",", "U2Bx", ",", "U2Bxb", ",", "U2By", ",", "U2Byb", ",",
         "UFLongD", ",", "UFD", ",", "UFBx", ",", "UFBxb", ",", "UFBy", ",", 
        "UFByb", ",", "output"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Tau]", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox["T", "4"], ",", "dt"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"duration", " ", "of", " ", "delay"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"T0", " ", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox[
           RowBox[{"3", "*", "\[Tau]"}], "4"], ",", "dt"}], "]"}]}], " ", ";", 
       RowBox[{"(*", 
        RowBox[{
        "duration", " ", "of", " ", "one", " ", "XY4", " ", "subperiod"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[Tau]P", " ", "=", 
        RowBox[{"Round", "[", " ", 
         RowBox[{
          FractionBox[
           RowBox[{"T0", "-", 
            RowBox[{"4", "*", "PW"}]}], "3"], ",", "dt"}], "]"}]}], ";", " ", 
       
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"duration", " ", "of", " ", "inter"}], "-", 
         RowBox[{"pulse", " ", "delay"}]}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"domain", " ", "=", 
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Round", "[", 
           RowBox[{"PW", ",", "dt"}], "]"}], ",", "dt"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"domain", " ", "of", " ", "one", " ", "pulsewidth"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"freqMod", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             FractionBox[
              RowBox[{"2", "*", "maxF"}], "PW"], "*", "i"}], "-", "maxF"}], 
           ")"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "domain"}], "}"}]}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
        "maxF", " ", "is", " ", "in", " ", "units", " ", "of", " ", "kHz"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"phaseMod", "=", 
        RowBox[{"2", "\[Pi]", "*", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"freqMod", "[", 
               RowBox[{"[", "j", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", 
                FractionBox["i", "dt"]}], "}"}]}], "]"}], "*", "dt"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "domain"}], "}"}]}], "]"}]}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"phaseMod", " ", "=", " ", 
        RowBox[{"phaseMod", "-", 
         RowBox[{"Min", "[", "phaseMod", "]"}]}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"corrected", " ", "phase", " ", "modulation"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"cosTable", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Cos", "[", 
           RowBox[{
            RowBox[{"2", "*", "\[Pi]", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[Gamma]H", "*", "Bz"}], "+", 
                 RowBox[{"1000", "*", 
                  RowBox[{"freqMod", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}]}], ")"}], "*", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"domain", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "-", 
                 FractionBox["PW", "2"]}], ")"}], "*", "0.001"}], ")"}]}], 
            "+", 
            RowBox[{"phaseMod", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "domain", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"xPulse", "=", 
        RowBox[{
         RowBox[{"Quiet", "@", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               FractionBox["32", 
                SuperscriptBox["PW", "2"]], ",", "Bx", ",", 
               FractionBox["PW", "2"]}], "}"}], "}"}], ",", "PW", ",", "dt"}],
            "]"}]}], "*", "cosTable"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"yPulse", "=", 
        RowBox[{
         RowBox[{"Quiet", "@", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               FractionBox["32", 
                SuperscriptBox["PW", "2"]], ",", "By", ",", 
               FractionBox["PW", "2"]}], "}"}], "}"}], ",", "PW", ",", "dt"}],
            "]"}]}], "*", "cosTable"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"U1LongD", "=", 
        RowBox[{"U1", "[", 
         RowBox[{"J", ",", "B0", ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"U1D", "=", 
        RowBox[{"U1", "[", 
         RowBox[{"J", ",", "B0", ",", "0", ",", "0", ",", "\[Tau]P"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"U1Bx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"J", ",", "Bz", ",", 
             RowBox[{"xPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1By", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"J", ",", "Bz", ",", "0", ",", 
             RowBox[{"yPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1Bxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"J", ",", "Bz", ",", 
             RowBox[{"-", 
              RowBox[{"xPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1Byb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"J", ",", "Bz", ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"yPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"U2LongD", "=", 
        RowBox[{"U2", "[", 
         RowBox[{"J", ",", "B0", ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"U2D", "=", 
        RowBox[{"U2", "[", 
         RowBox[{"J", ",", "B0", ",", "0", ",", "0", ",", "\[Tau]P"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"U2Bx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"J", ",", "Bz", ",", 
             RowBox[{"xPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2By", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"J", ",", "Bz", ",", "0", ",", 
             RowBox[{"yPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2Bxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"J", ",", "Bz", ",", 
             RowBox[{"-", 
              RowBox[{"xPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2Byb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"J", ",", "Bz", ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"yPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"UFLongD", "=", 
        RowBox[{"UF", "[", 
         RowBox[{"J", ",", "B0", ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"UFD", "=", 
        RowBox[{"UF", "[", 
         RowBox[{"J", ",", "B0", ",", "0", ",", "0", ",", "\[Tau]P"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"UFBx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"J", ",", "Bz", ",", 
             RowBox[{"xPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFBy", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"J", ",", "Bz", ",", "0", ",", 
             RowBox[{"yPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFBxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"J", ",", "Bz", ",", 
             RowBox[{"-", 
              RowBox[{"xPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFByb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"J", ",", "Bz", ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"yPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"output", "=", 
        RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "U1LongD", ",", "U1Bx", ",", "U1D", ",", "U1By", ",", "U1D", ",", 
            "U1Bx", ",", "U1D", ",", "U1By", ",", "U1Bxb", ",", "U1D", ",", 
            "U1Byb", ",", "U1D", ",", "U1Bxb", ",", "U1D", ",", "U1Byb", ",", 
            "U1Bxb", ",", "U1D", ",", "U1Byb", ",", "U1D", ",", "U1Bxb", ",", 
            "U1D", ",", "U1Byb", ",", "U1Bx", ",", "U1D", ",", "U1By", ",", 
            "U1D", ",", "U1Bx", ",", "U1D", ",", "U1By"}], "}"}], 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "isomer", " ", "1"}], 
           "*)"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
           "U2LongD", ",", "U2Bx", ",", "U2D", ",", "U2By", ",", "U2D", ",", 
            "U2Bx", ",", "U2D", ",", "U2By", ",", "U2Bxb", ",", "U2D", ",", 
            "U2Byb", ",", "U2D", ",", "U2Bxb", ",", "U2D", ",", "U2Byb", ",", 
            "U2Bxb", ",", "U2D", ",", "U2Byb", ",", "U2D", ",", "U2Bxb", ",", 
            "U2D", ",", "U2Byb", ",", "U2Bx", ",", "U2D", ",", "U2By", ",", 
            "U2D", ",", "U2Bx", ",", "U2D", ",", "U2By"}], "}"}], 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
           "*)"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
           "UFLongD", ",", "UFBx", ",", "UFD", ",", "UFBy", ",", "UFD", ",", 
            "UFBx", ",", "UFD", ",", "UFBy", ",", "UFBxb", ",", "UFD", ",", 
            "UFByb", ",", "UFD", ",", "UFBxb", ",", "UFD", ",", "UFByb", ",", 
            "UFBxb", ",", "UFD", ",", "UFByb", ",", "UFD", ",", "UFBxb", ",", 
            "UFD", ",", "UFByb", ",", "UFBx", ",", "UFD", ",", "UFBy", ",", 
            "UFD", ",", "UFBx", ",", "UFD", ",", "UFBy"}], "}"}], 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
           "*)"}], ",", "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
          RowBox[{"(*", 
           RowBox[{
           "initial", " ", "conditions", " ", "for", " ", "bound", " ", "and",
             " ", "free", " ", "species"}], "*)"}], ",", 
          "\[IndentingNewLine]", "16", 
          RowBox[{"(*", 
           RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",", 
          "2", 
          RowBox[{"(*", 
           RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
          "\[IndentingNewLine]", 
          FractionBox["1", "20"], 
          RowBox[{"(*", 
           FractionBox[
            RowBox[{"[", "Ir", "]"}], 
            RowBox[{"[", "L", "]"}]], "*)"}], ",", "0", 
          RowBox[{"(*", 
           RowBox[{
            FractionBox[
             RowBox[{"[", "Ir", "]"}], 
             RowBox[{"[", "H2", "]"}]], ",", " ", 
            RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"OnesList", "[", "29", "]"}], 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
            ",", " ", 
            RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
          RowBox[{"{", 
           RowBox[{
           "\[Tau]", ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", 
            ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "PW", ",", "\[Tau]P", 
            ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", ",", "PW", 
            ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", ",", "PW", 
            ",", "\[Tau]P", ",", "PW", ",", "PW", ",", "\[Tau]P", ",", "PW", 
            ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", ",", "PW"}], "}"}], 
          RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", 
          RowBox[{"Round", "[", 
           FractionBox["runtime", "T"], "]"}]}], "]"}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",\

 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.900580855345851*^9, 3.900582405436839*^9, {3.900582525691217*^9, 
   3.900582599221718*^9}, {3.900582633822196*^9, 3.900582673806778*^9}, {
   3.9005827331666803`*^9, 3.900582992797325*^9}, {3.900583255699739*^9, 
   3.900583298846998*^9}, {3.900583373038166*^9, 3.900583417275872*^9}, {
   3.900583629416684*^9, 3.900583723080104*^9}, {3.900584054440856*^9, 
   3.900584135010436*^9}, {3.9005841667314987`*^9, 3.900584195743218*^9}, {
   3.900584238841755*^9, 3.9005842624719543`*^9}, {3.9005842971598063`*^9, 
   3.9005845943531027`*^9}, {3.900584639639245*^9, 3.900584681553575*^9}, {
   3.900584721549426*^9, 3.900584725925117*^9}, {3.900584795703372*^9, 
   3.900585088590146*^9}, {3.900660221200687*^9, 3.900660290503244*^9}, {
   3.900670952442913*^9, 3.90067096436651*^9}, {3.902563938030075*^9, 
   3.9025639777787437`*^9}, {3.902564031092112*^9, 3.902564066060812*^9}, 
   3.9025641649957733`*^9, {3.903019295296772*^9, 3.90301929710882*^9}, {
   3.903019377036001*^9, 3.9030194030692472`*^9}, {3.9030201484922132`*^9, 
   3.90302016251243*^9}, {3.9030202564894*^9, 3.903020296965027*^9}, 
   3.903022244302541*^9, 3.9046475433272142`*^9, {3.9046478410396423`*^9, 
   3.9046478480720053`*^9}, {3.904648057196312*^9, 3.90464805868918*^9}, {
   3.904648366849901*^9, 3.904648368348587*^9}, {3.904648444895329*^9, 
   3.9046484817750587`*^9}, 3.904649747582617*^9, {3.904649794442531*^9, 
   3.904649849534974*^9}, {3.9046499307597713`*^9, 3.904649938003138*^9}, {
   3.904650076167879*^9, 3.904650088837571*^9}, {3.904650176147087*^9, 
   3.904650218774405*^9}, {3.9046509408538923`*^9, 3.904651052906501*^9}, {
   3.90465112730208*^9, 3.904651149043313*^9}, {3.904651368771426*^9, 
   3.904651422684654*^9}, {3.904651455231081*^9, 3.904651456024313*^9}, {
   3.904651500065998*^9, 3.904651521203361*^9}, {3.904651603100375*^9, 
   3.904651830293479*^9}, {3.904651893432475*^9, 3.904651894263661*^9}, {
   3.904651932357397*^9, 3.904651986347093*^9}, {3.9046520542382317`*^9, 
   3.904652071454166*^9}, {3.904652158052786*^9, 3.904652239208932*^9}, {
   3.904652277374984*^9, 3.904652285332891*^9}, {3.904652343684256*^9, 
   3.9046524069554358`*^9}, {3.904652440517556*^9, 3.904652519713702*^9}, {
   3.904652552543211*^9, 3.9046526352173767`*^9}, {3.904652684939281*^9, 
   3.904652854823515*^9}, {3.904652889265086*^9, 3.904653059791809*^9}, {
   3.9046533029343567`*^9, 3.904653309267363*^9}, {3.904653451803244*^9, 
   3.9046534609163094`*^9}, {3.904653663587493*^9, 3.904653685570816*^9}, {
   3.9046537769445744`*^9, 3.9046537938675127`*^9}, {3.9046538319546137`*^9, 
   3.904653841136348*^9}, {3.904825340182719*^9, 3.904825381511484*^9}, {
   3.904825420086461*^9, 3.9048254230474167`*^9}, {3.904825513730876*^9, 
   3.904825546124176*^9}, 3.904825623299837*^9, {3.904825830332336*^9, 
   3.904825830510722*^9}, {3.904825919890212*^9, 3.904825920140286*^9}, {
   3.904826237754408*^9, 3.904826237977922*^9}, 3.904830471276381*^9, {
   3.904831405045595*^9, 3.9048314102476597`*^9}, {3.9049027475874033`*^9, 
   3.90490278165556*^9}, {3.9052650582806892`*^9, 3.9052650615424557`*^9}, {
   3.9052651017302113`*^9, 3.905265158431285*^9}, {3.905265212948326*^9, 
   3.905265216035543*^9}, {3.9066409121269054`*^9, 3.906641001786029*^9}, {
   3.906641053054123*^9, 3.9066410737867427`*^9}, {3.9066423917817945`*^9, 
   3.906642399419865*^9}, {3.90664302250134*^9, 3.906643024123335*^9}, 
   3.9076735534852324`*^9, {3.908283193766592*^9, 3.908283227684514*^9}, {
   3.908283315626425*^9, 3.908283352816839*^9}, {3.908283549289136*^9, 
   3.9082836123199577`*^9}, {3.908283657203041*^9, 3.9082836930404787`*^9}, {
   3.908283782810361*^9, 3.9082838161418324`*^9}, {3.908285776915271*^9, 
   3.908285820465694*^9}, {3.908285959924933*^9, 3.90828601033962*^9}, {
   3.908286259079455*^9, 3.908286271689782*^9}, {3.908824840631631*^9, 
   3.908824853502262*^9}, {3.908825586094879*^9, 3.908825657227935*^9}, {
   3.9088256917835007`*^9, 3.9088257330106773`*^9}, {3.908825787711007*^9, 
   3.908825868364313*^9}, {3.908825987433092*^9, 3.9088259876369753`*^9}, {
   3.90882605949216*^9, 3.908826085248372*^9}, {3.9088262066672373`*^9, 
   3.90882620829137*^9}, {3.908826248824243*^9, 3.908826411121233*^9}, {
   3.908826460358778*^9, 3.908826574500527*^9}, {3.908826608314764*^9, 
   3.9088267221022253`*^9}, {3.908826752375697*^9, 3.908826836874978*^9}, {
   3.910112966314968*^9, 3.9101129674076853`*^9}, 3.910432233065796*^9, 
   3.910432368977376*^9, 3.910432404454432*^9, {3.910787015334166*^9, 
   3.910787022158268*^9}, 3.915616533847426*^9, 3.91561657706301*^9, 
   3.922881173886609*^9, {3.9233137093667483`*^9, 3.9233138105328093`*^9}, 
   3.9306473331051683`*^9},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[541]:=",ExpressionUUID->"f5b41ece-2430-40ba-94c3-b294f9563d83"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"XY16ShapeMagic", "[", 
     RowBox[{"ParameterTable_", ",", "timestep_", ",", "request_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"genP", "=", "ParameterTable"}], ",", 
        RowBox[{"dt", "=", "timestep"}], ",", 
        RowBox[{"req", "=", "request"}], ",", "T", ",", "PW", ",", "N", ",", 
        "Bx", ",", "By", ",", "Bz", ",", "\[CapitalDelta]\[CapitalOmega]", 
        ",", "B0", ",", "\[Phi]", ",", "\[Tau]", ",", "\[Tau]P", ",", "T0", 
        ",", "domain", ",", "pulse", ",", "XPeriod", ",", "YPeriod", ",", 
        "ZPeriod", ",", "shapesX", ",", "shapesY", ",", "shapesZ", ",", 
        "output"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      
      RowBox[{
       RowBox[{"T", "=", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"duration", " ", "of", " ", "full", " ", "period"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"PW", " ", "=", " ", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"duration", " ", "of", " ", "one", " ", "pulsewidth"}], " ", 
         "-", " ", "\[Micro]T"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Bx", " ", "=", " ", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "X", " ", "pulse", " ", "power", " ", "during", " ", "pulses"}], " ",
          "-", " ", "\[Micro]T"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"By", " ", "=", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Y", " ", "pulse", " ", "power", " ", "during", " ", "pulses"}], " ",
          "-", " ", "\[Micro]T"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Bz", " ", "=", " ", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "5", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Z", " ", "pulse", " ", "power", " ", "during", " ", "pulses"}], " ",
          "-", " ", "\[Micro]T"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[CapitalDelta]\[CapitalOmega]", " ", "=", " ", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "6", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"bandwidth", " ", "of", " ", "frequency", " ", "sweep"}], 
         " ", "-", " ", "kHz"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"B0", " ", "=", " ", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "7", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Z", " ", "field", " ", "during", " ", "delays"}], " ", "-", 
         " ", "\[Micro]T"}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Tau]", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox["T", "4"], ",", "dt"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"duration", " ", "of", " ", "delay"}], " ", "-", " ", 
         RowBox[{"encoded", " ", "in", " ", "T", " ", "and", " ", "PW"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"T0", " ", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox[
           RowBox[{"3", "*", "\[Tau]"}], "4"], ",", "dt"}], "]"}]}], " ", ";", 
       RowBox[{"(*", 
        RowBox[{
        "duration", " ", "of", " ", "one", " ", "XY4", " ", "subperiod"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[Tau]P", " ", "=", 
        RowBox[{"Round", "[", " ", 
         RowBox[{
          FractionBox[
           RowBox[{"T0", "-", 
            RowBox[{"4", "*", "PW"}]}], "3"], ",", "dt"}], "]"}]}], ";", " ", 
       
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"duration", " ", "of", " ", "inter"}], "-", 
         RowBox[{"pulse", " ", "delay"}]}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"domain", "=", 
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Round", "[", 
           RowBox[{"PW", ",", "dt"}], "]"}], ",", "dt"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"pulse", "=", 
        RowBox[{
         RowBox[{"AdiabaticGaussian", "[", 
          RowBox[{
          "PW", ",", "Bx", ",", "Bz", ",", "\[CapitalDelta]\[CapitalOmega]", 
           ",", "dt", ",", "\"\<Generate\>\""}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"XPeriod", "=", 
        RowBox[{"Stitch4", "[", 
         RowBox[{"{", 
          RowBox[{"pulse", ",", 
           RowBox[{"Zeros", "[", 
            RowBox[{"Round", "[", 
             FractionBox[
              RowBox[{
               RowBox[{"2", "*", "\[Tau]P"}], "+", "PW"}], "dt"], "]"}], 
            "]"}], ",", "pulse", ",", 
           RowBox[{"Zeros", "[", 
            RowBox[{"Round", "[", 
             FractionBox[
              RowBox[{"\[Tau]P", "+", "PW"}], "dt"], "]"}], "]"}]}], "}"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"YPeriod", "=", 
        RowBox[{"Stitch4", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Zeros", "[", 
            RowBox[{"Round", "[", 
             FractionBox[
              RowBox[{"\[Tau]P", "+", "PW"}], "dt"], "]"}], "]"}], ",", 
           "pulse", ",", 
           RowBox[{"Zeros", "[", 
            RowBox[{"Round", "[", 
             FractionBox[
              RowBox[{
               RowBox[{"2", "*", "\[Tau]P"}], "+", "PW"}], "dt"], "]"}], 
            "]"}], ",", "pulse"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ZPeriod", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Bz", "*", 
            RowBox[{"RectFunction", "[", 
             RowBox[{"0", ",", "PW", ",", "t"}], "]"}]}], "+", 
           RowBox[{"B0", "*", 
            RowBox[{"RectFunction", "[", 
             RowBox[{"PW", ",", 
              RowBox[{"PW", "+", "\[Tau]P"}], ",", "t"}], "]"}]}], "+", 
           RowBox[{"Bz", "*", 
            RowBox[{"RectFunction", "[", 
             RowBox[{
              RowBox[{"PW", "+", "\[Tau]P"}], ",", 
              RowBox[{
               RowBox[{"2", "*", "PW"}], "+", "\[Tau]P"}], ",", "t"}], 
             "]"}]}], "+", 
           RowBox[{"B0", "*", 
            RowBox[{"RectFunction", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"2", "*", "PW"}], "+", "\[Tau]P"}], ",", 
              RowBox[{
               RowBox[{"2", "*", "PW"}], "+", 
               RowBox[{"2", "*", "\[Tau]P"}]}], ",", "t"}], "]"}]}], "+", 
           RowBox[{"Bz", "*", 
            RowBox[{"RectFunction", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"2", "*", "PW"}], "+", 
               RowBox[{"2", "*", "\[Tau]P"}]}], ",", 
              RowBox[{
               RowBox[{"3", "*", "PW"}], "+", 
               RowBox[{"2", "*", "\[Tau]P"}]}], ",", "t"}], "]"}]}], "+", 
           RowBox[{"B0", "*", 
            RowBox[{"RectFunction", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"3", "*", "PW"}], "+", 
               RowBox[{"2", "*", "\[Tau]P"}]}], ",", 
              RowBox[{
               RowBox[{"3", "*", "PW"}], "+", 
               RowBox[{"3", "*", "\[Tau]P"}]}], ",", "t"}], "]"}]}], "+", 
           RowBox[{"Bz", "*", 
            RowBox[{"RectFunction", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"3", "*", "PW"}], "+", 
               RowBox[{"3", "*", "\[Tau]P"}]}], ",", 
              RowBox[{
               RowBox[{"4", "*", "PW"}], "+", 
               RowBox[{"3", "*", "\[Tau]P"}]}], ",", "t"}], "]"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"t", ",", "0", ",", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", "XPeriod", "]"}], "-", "1"}], ")"}], 
             "*", "dt"}], ",", "dt"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"shapesX", "=", 
        RowBox[{"AddDelay", "[", 
         RowBox[{
          RowBox[{"Stitch4", "[", 
           RowBox[{"{", 
            RowBox[{"XPeriod", ",", 
             RowBox[{
              RowBox[{"-", "1"}], "*", "XPeriod"}], ",", 
             RowBox[{
              RowBox[{"-", "1"}], "*", "XPeriod"}], ",", "XPeriod"}], "}"}], 
           "]"}], ",", "\[Tau]", ",", "dt"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"shapesY", "=", 
        RowBox[{"AddDelay", "[", 
         RowBox[{
          RowBox[{"Stitch4", "[", 
           RowBox[{"{", 
            RowBox[{"YPeriod", ",", 
             RowBox[{
              RowBox[{"-", "1"}], "*", "YPeriod"}], ",", 
             RowBox[{
              RowBox[{"-", "1"}], "*", "YPeriod"}], ",", "YPeriod"}], "}"}], 
           "]"}], ",", "\[Tau]", ",", "dt"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"shapesZ", "=", 
        RowBox[{"AddDCDelay", "[", 
         RowBox[{
          RowBox[{"Stitch4", "[", 
           RowBox[{"{", 
            RowBox[{
            "ZPeriod", ",", "ZPeriod", ",", "ZPeriod", ",", "ZPeriod"}], 
            "}"}], "]"}], ",", "\[Tau]", ",", "dt", ",", "B0"}], "]"}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<Generate\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"{", 
            RowBox[{"shapesX", ",", "shapesY", ",", "shapesZ"}], "}"}]}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<Graph\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"Show", "[", 
            RowBox[{
             RowBox[{"TracePlot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Range", "[", 
                   RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "XPeriod", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "XPeriod"}], 
                 "}"}], "\[Transpose]"}], ",", "Red", ",", 
               RowBox[{"{", 
                RowBox[{
                "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", "XPeriod", "]"}], "-", "1"}], 
                   ")"}], "*", "dt"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"TracePlot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Range", "[", 
                   RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "YPeriod", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "YPeriod"}], 
                 "}"}], "\[Transpose]"}], ",", "Blue", ",", 
               RowBox[{"{", 
                RowBox[{
                "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", "YPeriod", "]"}], "-", "1"}], 
                   ")"}], "*", "dt"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<FullGraph\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"Show", "[", 
            RowBox[{
             RowBox[{"TracePlot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Range", "[", 
                   RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesX"}], 
                 "}"}], "\[Transpose]"}], ",", "Red", ",", 
               RowBox[{"{", 
                RowBox[{
                "\"\<Time (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], 
                   ")"}], "*", "dt"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"TracePlot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Range", "[", 
                   RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesY", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesY"}], 
                 "}"}], "\[Transpose]"}], ",", "Blue", ",", 
               RowBox[{"{", 
                RowBox[{
                "\"\<Time (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], 
                   ")"}], "*", "dt"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"TracePlot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Range", "[", 
                   RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesZ", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesZ"}], 
                 "}"}], "\[Transpose]"}], ",", "Black", ",", 
               RowBox[{"{", 
                RowBox[{
                "\"\<Time (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", "shapesZ", "]"}], "-", "1"}], 
                   ")"}], "*", "dt"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<ShortPol\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"XY16Polarize", "[", 
            RowBox[{"T", ",", "PW", ",", "Bx", ",", "By", ",", "Bz", ",", 
             FractionBox["\[CapitalDelta]\[CapitalOmega]", "2"], ",", "B0", 
             ",", "dt", ",", "2000"}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<Pol\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"XY16Polarize", "[", 
            RowBox[{"T", ",", "PW", ",", "Bx", ",", "By", ",", "Bz", ",", 
             FractionBox["\[CapitalDelta]\[CapitalOmega]", "2"], ",", "B0", 
             ",", "dt", ",", "20000"}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<FullPol\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"XY16Polarize", "[", 
            RowBox[{"T", ",", "PW", ",", "Bx", ",", "By", ",", "Bz", ",", 
             FractionBox["\[CapitalDelta]\[CapitalOmega]", "2"], ",", "B0", 
             ",", "dt", ",", "60000"}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<FullPolTrace\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"XY16PolTrace", "[", 
            RowBox[{"T", ",", "PW", ",", "Bx", ",", "By", ",", "Bz", ",", 
             FractionBox["\[CapitalDelta]\[CapitalOmega]", "2"], ",", "B0", 
             ",", "dt", ",", "60000"}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "output"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.89704490560113*^9, 3.897044941810536*^9}, {
   3.897047951151103*^9, 3.897047951452484*^9}, {3.897048144240698*^9, 
   3.8970482312424297`*^9}, {3.8970482855237417`*^9, 
   3.8970483243806267`*^9}, {3.8970483621469803`*^9, 3.897048573160529*^9}, {
   3.897048706713324*^9, 3.897048709576819*^9}, {3.89704903362179*^9, 
   3.8970490422726717`*^9}, {3.897049161608699*^9, 3.897049196148707*^9}, {
   3.8970496709044943`*^9, 3.8970496722345743`*^9}, {3.897050423262704*^9, 
   3.897050426426649*^9}, {3.897050542387467*^9, 3.897050568573604*^9}, {
   3.897050613855695*^9, 3.897050882023191*^9}, {3.8970509222091417`*^9, 
   3.897051084186138*^9}, {3.8970511239703207`*^9, 3.897051202341874*^9}, {
   3.897051364499699*^9, 3.8970515939125633`*^9}, {3.897051678672974*^9, 
   3.897051798347341*^9}, {3.897052057358809*^9, 3.897052117701976*^9}, {
   3.897052177767589*^9, 3.897052217653767*^9}, {3.897052261060299*^9, 
   3.897052273807811*^9}, {3.897052395148117*^9, 3.897052530341085*^9}, {
   3.8970526483718576`*^9, 3.897052657976996*^9}, {3.89705271513301*^9, 
   3.897052716272588*^9}, {3.897052870546041*^9, 3.897052884569233*^9}, {
   3.897052966063035*^9, 3.897053016090858*^9}, {3.897053103369545*^9, 
   3.897053126957243*^9}, {3.897053214342381*^9, 3.89705323727245*^9}, {
   3.8970532916833553`*^9, 3.897053291898093*^9}, {3.897053468052842*^9, 
   3.897053473270308*^9}, {3.897053631676797*^9, 3.8970536529720497`*^9}, {
   3.897053918333879*^9, 3.89705392467406*^9}, {3.897054104227902*^9, 
   3.897054133322616*^9}, {3.897054177037314*^9, 3.897054302870544*^9}, {
   3.897054357304744*^9, 3.8970543592004766`*^9}, {3.8970544052091503`*^9, 
   3.897054491344906*^9}, {3.897054531569837*^9, 3.897054566580721*^9}, {
   3.8970546076958303`*^9, 3.897054609315817*^9}, {3.897054734689783*^9, 
   3.897054761770708*^9}, {3.897055273743992*^9, 3.897055280882004*^9}, {
   3.897055674123695*^9, 3.897055779030328*^9}, {3.897056081056839*^9, 
   3.89705609177207*^9}, {3.8970561999417877`*^9, 3.897056204415772*^9}, {
   3.89705623705486*^9, 3.8970562383169603`*^9}, {3.897056307594467*^9, 
   3.89705633952733*^9}, {3.897056511546081*^9, 3.89705654874193*^9}, {
   3.8970570479448013`*^9, 3.8970570663277607`*^9}, {3.897057117472597*^9, 
   3.897057142166602*^9}, {3.897057807940278*^9, 3.897057808146186*^9}, {
   3.8970578716232033`*^9, 3.897057872306917*^9}, {3.897057917598881*^9, 
   3.89705791765858*^9}, {3.897058284210682*^9, 3.8970582937205267`*^9}, {
   3.897058736704432*^9, 3.897058739317483*^9}, {3.897058779475258*^9, 
   3.897058780299033*^9}, {3.897059301307345*^9, 3.897059310642701*^9}, {
   3.897059868198091*^9, 3.8970599261843147`*^9}, {3.897060469585746*^9, 
   3.897060476329668*^9}, {3.897061739461603*^9, 3.8970617603841467`*^9}, {
   3.897556078870557*^9, 3.897556085615953*^9}, {3.897668013211834*^9, 
   3.897668013373135*^9}, {3.897668059476141*^9, 3.897668084854025*^9}, {
   3.8976683841954613`*^9, 3.8976683845501823`*^9}, {3.897668541437504*^9, 
   3.897668546992078*^9}, {3.8976687354144907`*^9, 3.897668735951025*^9}, {
   3.897668905687088*^9, 3.89766890958139*^9}, {3.898074455083661*^9, 
   3.898074551349617*^9}, 3.898074658606371*^9, {3.898074720927762*^9, 
   3.898074776885275*^9}, 3.900508881056334*^9, {3.9024814427540607`*^9, 
   3.9024814519434357`*^9}, {3.905857899772901*^9, 3.905857903788488*^9}, {
   3.9058579704934397`*^9, 3.90585800767901*^9}, 3.907672738407749*^9, {
   3.9082816861893806`*^9, 3.908281690787983*^9}, {3.908281729120899*^9, 
   3.908281781348572*^9}, {3.908281911821432*^9, 3.908281953302647*^9}, {
   3.9082820066032352`*^9, 3.90828207845829*^9}, {3.9082821981280317`*^9, 
   3.90828228909753*^9}, {3.908282421498495*^9, 3.908282434403425*^9}, {
   3.9082825038683233`*^9, 3.908282533278871*^9}, {3.908283073305688*^9, 
   3.908283156936194*^9}, {3.908283281396204*^9, 3.90828328484109*^9}, {
   3.908286216163319*^9, 3.9082862182324467`*^9}, {3.90828625160331*^9, 
   3.908286253013625*^9}, {3.908286337882105*^9, 3.9082863624331627`*^9}, {
   3.908286437103731*^9, 3.908286507355048*^9}, {3.9082866663891077`*^9, 
   3.908286673111751*^9}, {3.908286782717143*^9, 3.908286828331365*^9}, {
   3.9082868664018803`*^9, 3.908286895045343*^9}, {3.908462170876747*^9, 
   3.9084621975349503`*^9}, {3.908462238981485*^9, 3.9084622764667463`*^9}, {
   3.908824857162471*^9, 3.9088248670044413`*^9}, {3.908824924359915*^9, 
   3.908824931238607*^9}, {3.908825528960331*^9, 3.908825541959325*^9}, {
   3.908826096520185*^9, 3.908826161475666*^9}, {3.908826198071656*^9, 
   3.9088261986190434`*^9}, {3.908826228904416*^9, 3.908826235296082*^9}, {
   3.9088268495210953`*^9, 3.908826868169338*^9}, {3.908826903599905*^9, 
   3.908826943049591*^9}, {3.909829759465205*^9, 3.909829769349416*^9}, {
   3.909830292975931*^9, 3.909830307281293*^9}, 3.910432200497737*^9, 
   3.910432368977953*^9, 3.910432404454981*^9, {3.910785528796425*^9, 
   3.9107855349453077`*^9}, {3.910787037934001*^9, 3.910787047696712*^9}, 
   3.915616533847721*^9, 3.915616577063332*^9, {3.915625709957796*^9, 
   3.915625748473772*^9}, {3.9156258330416613`*^9, 3.9156258696418343`*^9}, {
   3.915625942088072*^9, 3.915626045736123*^9}, {3.9156260804032383`*^9, 
   3.91562614771209*^9}, {3.915626255168811*^9, 3.91562628388745*^9}, 
   3.915626324746128*^9, {3.915626360762203*^9, 3.9156263610999823`*^9}, {
   3.915626803722272*^9, 3.9156268412616463`*^9}, {3.9156272100266438`*^9, 
   3.915627239182658*^9}, {3.9156272751474943`*^9, 3.9156273233651257`*^9}, {
   3.91562735721032*^9, 3.915627357825882*^9}, {3.915627598831493*^9, 
   3.9156276207492323`*^9}, {3.915627678561462*^9, 3.915627695564123*^9}, {
   3.915627806624207*^9, 3.915627816311995*^9}, {3.915628084750349*^9, 
   3.9156280917412*^9}, {3.9156282977442913`*^9, 3.9156283190802917`*^9}, {
   3.915628387404181*^9, 3.9156284497106113`*^9}, {3.915628513268024*^9, 
   3.91562852147047*^9}, {3.915629235830986*^9, 3.915629254601261*^9}, {
   3.916863183226318*^9, 3.916863231362734*^9}, {3.916884296739684*^9, 
   3.9168842989581213`*^9}, {3.9168845007642736`*^9, 3.9168845016298423`*^9}, 
   3.922881173886609*^9, {3.9233138521927633`*^9, 3.9233139119534645`*^9}, {
   3.923314027762518*^9, 3.9233140291393394`*^9}, 3.930647333105352*^9},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[542]:=",ExpressionUUID->"8eb53fe3-94bd-4a74-acb9-adf23c5f4ecb"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"AdiabaticGaussian", "[", 
    RowBox[{
    "PW_", ",", "Bx_", ",", "Bz_", ",", "maxFreqSweep_", ",", "dt_", ",", 
     "request_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"req", "=", "request"}], ",", "N", ",", "B", ",", "\[Phi]", 
       ",", "\[Tau]", ",", "\[Beta]H", ",", "\[Beta]N", ",", "resultH", ",", 
       "resultN", ",", "\[Tau]P", ",", "T0", ",", "domain", ",", 
       RowBox[{"maxF", "=", "maxFreqSweep"}], ",", "freqMod", ",", "phaseMod",
        ",", "cosTable", ",", "xPulse", ",", "yPulse", ",", ",", "zPulse", 
       ",", "output"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"domain", " ", "=", 
       RowBox[{"Range", "[", 
        RowBox[{"0", ",", 
         RowBox[{"Round", "[", 
          RowBox[{"PW", ",", "dt"}], "]"}], ",", "dt"}], "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"domain", " ", "of", " ", "one", " ", "pulsewidth"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"freqMod", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            FractionBox[
             RowBox[{"2", "*", "maxF"}], "PW"], "*", "i"}], "-", "maxF"}], 
          ")"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "domain"}], "}"}]}], "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
       "maxF", " ", "is", " ", "in", " ", "units", " ", "of", " ", "kHz"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"phaseMod", "=", 
       RowBox[{"2", "\[Pi]", "*", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{"freqMod", "[", 
              RowBox[{"[", "j", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", 
               FractionBox["i", "dt"]}], "}"}]}], "]"}], "*", "dt"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "domain"}], "}"}]}], "]"}]}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"phaseMod", " ", "=", " ", 
       RowBox[{"phaseMod", "-", 
        RowBox[{"Min", "[", "phaseMod", "]"}]}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"corrected", " ", "phase", " ", "modulation"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"cosTable", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Cos", "[", 
          RowBox[{
           RowBox[{"2", "*", "\[Pi]", "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"\[Gamma]H", "*", "Bz"}], "+", 
                RowBox[{"1000", "*", 
                 RowBox[{"freqMod", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}]}], ")"}], "*", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"domain", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "-", 
                FractionBox["PW", "2"]}], ")"}], "*", "0.001"}], ")"}]}], "+", 
           RowBox[{"phaseMod", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "domain", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"xPulse", " ", "=", " ", 
       RowBox[{
        RowBox[{"Quiet", "@", 
         RowBox[{"GaussAmpMod", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"{", 
             RowBox[{
              FractionBox["32", 
               SuperscriptBox["PW", "2"]], ",", "Bx", ",", 
              FractionBox["PW", "2"]}], "}"}], "}"}], ",", 
           RowBox[{"Round", "[", 
            RowBox[{"PW", ",", "dt"}], "]"}], ",", "dt"}], "]"}]}], "*", 
        "cosTable"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"yPulse", "=", 
       RowBox[{"Zeros", "[", 
        RowBox[{"Length", "[", "xPulse", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"zPulse", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Bz", " ", "*", 
          RowBox[{"(", 
           RowBox[{"RectFunction", "[", 
            RowBox[{"0", ",", "PW", ",", "i"}], "]"}], ")"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "domain"}], "}"}]}], "]"}]}], " ", ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Generate\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"output", "=", 
          RowBox[{"{", 
           RowBox[{"xPulse", ",", "yPulse", ",", "zPulse"}], "}"}]}], ";"}]}],
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Graph\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"zPulse", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "=", "0"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"zPulse", "[", 
           RowBox[{"[", 
            RowBox[{"-", "1"}], "]"}], "]"}], "=", "0"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"output", "=", 
          RowBox[{"Show", "[", 
           RowBox[{
            RowBox[{"TimePlot", "[", 
             RowBox[{"xPulse", ",", "dt", ",", "0", ",", "Red", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<Time (ms)\>\"", ",", "\"\<Amplitude (\[Mu]T)\>\""}], 
               "}"}]}], "]"}], ",", 
            RowBox[{"TimePlot", "[", 
             RowBox[{"yPulse", ",", "dt", ",", "0", ",", "Blue", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<Time (ms)\>\"", ",", "\"\<Amplitude (\[Mu]T)\>\""}], 
               "}"}]}], "]"}], ",", 
            RowBox[{"TimePlot", "[", 
             RowBox[{"zPulse", ",", "dt", ",", "0", ",", "Black", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<Time (ms)\>\"", ",", "\"\<Amplitude (\[Mu]T)\>\""}], 
               "}"}]}], "]"}], ",", 
            RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<H Flip Angle\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"resultH", " ", "=", " ", 
          RowBox[{"SoloMagnetizationTracker", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"xPulse", ",", "yPulse", ",", "zPulse"}], "}"}], ",", 
            "\[Gamma]H", ",", 
            RowBox[{"OperatorNF", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "z"}], "}"}]}], "]"}], ",", " ", 
            RowBox[{"OperatorNF", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "z"}], "}"}]}], "]"}], ",", "dt"}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"\[Beta]H", "=", 
          RowBox[{
           FractionBox[
            RowBox[{"(", 
             RowBox[{"100", "-", 
              RowBox[{"Last", "@", "resultH"}]}], ")"}], "100"], "*", 
           FractionBox["\[Pi]", "2"], "*", 
           FractionBox["180", "\[Pi]"]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"output", "=", "\[Beta]H"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<N Flip Angle\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"resultN", " ", "=", " ", 
          RowBox[{"SoloMagnetizationTracker", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"xPulse", ",", "yPulse", ",", "zPulse"}], "}"}], ",", 
            "\[Gamma]N", ",", 
            RowBox[{"OperatorNF", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "z"}], "}"}]}], "]"}], ",", " ", 
            RowBox[{"OperatorNF", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "z"}], "}"}]}], "]"}], ",", "dt"}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"\[Beta]N", "=", 
          RowBox[{
           FractionBox[
            RowBox[{"(", 
             RowBox[{"100", "-", 
              RowBox[{"Last", "@", "resultN"}]}], ")"}], "100"], "*", 
           FractionBox["\[Pi]", "2"], "*", 
           FractionBox["180", "\[Pi]"]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"output", "=", "\[Beta]N"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"req", "==", "\"\<Inversion Profile\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"resultH", " ", "=", " ", 
          RowBox[{"SoloMagnetizationTracker", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"xPulse", ",", "yPulse", ",", "zPulse"}], "}"}], ",", 
            "\[Gamma]H", ",", 
            RowBox[{"OperatorNF", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "z"}], "}"}]}], "]"}], ",", " ", 
            RowBox[{"OperatorNF", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "z"}], "}"}]}], "]"}], ",", "dt"}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"resultN", " ", "=", " ", 
          RowBox[{"SoloMagnetizationTracker", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"xPulse", ",", "yPulse", ",", "zPulse"}], "}"}], ",", 
            "\[Gamma]N", ",", 
            RowBox[{"OperatorNF", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "z"}], "}"}]}], "]"}], ",", " ", 
            RowBox[{"OperatorNF", "[", 
             RowBox[{"1", ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "z"}], "}"}]}], "]"}], ",", "dt"}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"output", "=", 
          RowBox[{"Show", "[", 
           RowBox[{
            RowBox[{"TimePlot", "[", 
             RowBox[{"resultH", ",", "dt", ",", "0", ",", "Red", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<Time (ms)\>\"", ",", 
                "\"\<\!\(\*SubscriptBox[\(M\), \(z\)]\) (% of \
\!\(\*SubscriptBox[\(M\), \(0\)]\))\>\""}], "}"}]}], "]"}], ",", 
            RowBox[{"TimePlot", "[", 
             RowBox[{"resultN", ",", "dt", ",", "0", ",", "Blue", ",", 
              RowBox[{"{", 
               RowBox[{
               "\"\<Time (ms)\>\"", ",", 
                "\"\<\!\(\*SubscriptBox[\(M\), \(z\)]\) (% of \
\!\(\*SubscriptBox[\(M\), \(0\)]\))\>\""}], "}"}]}], "]"}], ",", 
            RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", "output"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.900580855345851*^9, 3.900582405436839*^9, {3.900582525691217*^9, 
   3.900582599221718*^9}, {3.900582633822196*^9, 3.900582673806778*^9}, {
   3.9005827331666803`*^9, 3.900582992797325*^9}, {3.900583255699739*^9, 
   3.900583298846998*^9}, {3.900583373038166*^9, 3.900583417275872*^9}, {
   3.900583629416684*^9, 3.900583723080104*^9}, {3.900584054440856*^9, 
   3.900584135010436*^9}, {3.9005841667314987`*^9, 3.900584195743218*^9}, {
   3.900584238841755*^9, 3.9005842624719543`*^9}, {3.9005842971598063`*^9, 
   3.9005845943531027`*^9}, {3.900584639639245*^9, 3.900584681553575*^9}, {
   3.900584721549426*^9, 3.900584725925117*^9}, {3.900584795703372*^9, 
   3.900585088590146*^9}, {3.900660221200687*^9, 3.900660290503244*^9}, {
   3.900670952442913*^9, 3.90067096436651*^9}, {3.902563938030075*^9, 
   3.9025639777787437`*^9}, {3.902564031092112*^9, 3.902564066060812*^9}, 
   3.9025641649957733`*^9, {3.903019295296772*^9, 3.90301929710882*^9}, {
   3.903019377036001*^9, 3.9030194030692472`*^9}, {3.9030201484922132`*^9, 
   3.90302016251243*^9}, {3.9030202564894*^9, 3.903020296965027*^9}, 
   3.903022244302541*^9, 3.9046475433272142`*^9, {3.9046478410396423`*^9, 
   3.9046478480720053`*^9}, {3.904648057196312*^9, 3.90464805868918*^9}, {
   3.904648366849901*^9, 3.904648368348587*^9}, {3.904648444895329*^9, 
   3.9046484817750587`*^9}, 3.904649747582617*^9, {3.904649794442531*^9, 
   3.904649849534974*^9}, {3.9046499307597713`*^9, 3.904649938003138*^9}, {
   3.904650076167879*^9, 3.904650088837571*^9}, {3.904650176147087*^9, 
   3.904650218774405*^9}, {3.9046509408538923`*^9, 3.904651052906501*^9}, {
   3.90465112730208*^9, 3.904651149043313*^9}, {3.904651368771426*^9, 
   3.904651422684654*^9}, {3.904651455231081*^9, 3.904651456024313*^9}, {
   3.904651500065998*^9, 3.904651521203361*^9}, {3.904651603100375*^9, 
   3.904651830293479*^9}, {3.904651893432475*^9, 3.904651894263661*^9}, {
   3.904651932357397*^9, 3.904651986347093*^9}, {3.9046520542382317`*^9, 
   3.904652071454166*^9}, {3.904652158052786*^9, 3.904652239208932*^9}, {
   3.904652277374984*^9, 3.904652285332891*^9}, {3.904652343684256*^9, 
   3.9046524069554358`*^9}, {3.904652440517556*^9, 3.904652519713702*^9}, {
   3.904652552543211*^9, 3.9046526352173767`*^9}, {3.904652684939281*^9, 
   3.904652854823515*^9}, {3.904652889265086*^9, 3.904653059791809*^9}, {
   3.9046533029343567`*^9, 3.904653309267363*^9}, {3.904653451803244*^9, 
   3.9046534609163094`*^9}, {3.904653663587493*^9, 3.904653685570816*^9}, {
   3.9046537769445744`*^9, 3.9046537938675127`*^9}, {3.9046538319546137`*^9, 
   3.904653841136348*^9}, {3.904825340182719*^9, 3.904825381511484*^9}, {
   3.904825420086461*^9, 3.9048254230474167`*^9}, {3.904825513730876*^9, 
   3.904825546124176*^9}, 3.904825623299837*^9, {3.904825830332336*^9, 
   3.904825830510722*^9}, {3.904825919890212*^9, 3.904825920140286*^9}, {
   3.904826237754408*^9, 3.904826237977922*^9}, 3.904830471276381*^9, {
   3.904831405045595*^9, 3.9048314102476597`*^9}, {3.9049027475874033`*^9, 
   3.90490278165556*^9}, {3.9052650582806892`*^9, 3.9052650615424557`*^9}, {
   3.9052651017302113`*^9, 3.905265158431285*^9}, {3.905265212948326*^9, 
   3.905265216035543*^9}, {3.9066409121269054`*^9, 3.906641001786029*^9}, {
   3.906641053054123*^9, 3.9066410737867427`*^9}, {3.9066423917817945`*^9, 
   3.906642399419865*^9}, {3.90664302250134*^9, 3.906643024123335*^9}, 
   3.9076735534852324`*^9, {3.908283193766592*^9, 3.908283227684514*^9}, {
   3.908283315626425*^9, 3.908283352816839*^9}, {3.908283549289136*^9, 
   3.9082836123199577`*^9}, {3.908283657203041*^9, 3.9082836930404787`*^9}, {
   3.908283782810361*^9, 3.9082838161418324`*^9}, {3.908285776915271*^9, 
   3.908285820465694*^9}, {3.908285959924933*^9, 3.90828601033962*^9}, {
   3.908286259079455*^9, 3.908286271689782*^9}, {3.908824840631631*^9, 
   3.908824853502262*^9}, {3.908825586094879*^9, 3.908825657227935*^9}, {
   3.9088256917835007`*^9, 3.9088257330106773`*^9}, {3.908825787711007*^9, 
   3.908825868364313*^9}, {3.908825987433092*^9, 3.9088259876369753`*^9}, {
   3.90882605949216*^9, 3.908826085248372*^9}, {3.9088262066672373`*^9, 
   3.90882620829137*^9}, {3.908826248824243*^9, 3.908826411121233*^9}, {
   3.908826460358778*^9, 3.908826574500527*^9}, {3.908826608314764*^9, 
   3.9088267221022253`*^9}, {3.908826752375697*^9, 3.908826836874978*^9}, {
   3.908886655754126*^9, 3.9088866840987577`*^9}, {3.9088867179080267`*^9, 
   3.9088867374678087`*^9}, {3.90888832528603*^9, 3.908888353958733*^9}, 
   3.908888489332487*^9, {3.9094460657674637`*^9, 3.909446085619667*^9}, 
   3.909447082877486*^9, {3.909447131001505*^9, 3.9094471963272657`*^9}, {
   3.9094472328839083`*^9, 3.9094472902870407`*^9}, {3.9097406751080933`*^9, 
   3.9097407114898376`*^9}, {3.909740813787829*^9, 3.909741024610445*^9}, {
   3.90974111144377*^9, 3.909741117775856*^9}, {3.909741995972208*^9, 
   3.909741999160046*^9}, 3.90974286824157*^9, {3.909825942945733*^9, 
   3.9098259731256037`*^9}, {3.90982600985121*^9, 3.909826010494049*^9}, 
   3.910432200498034*^9, 3.9104323689781847`*^9, 3.910432404455194*^9, 
   3.915616533848043*^9, 3.9156165770636673`*^9, {3.9156254557617273`*^9, 
   3.915625519192874*^9}, {3.918087193881762*^9, 3.9180872405175533`*^9}, {
   3.918087285735408*^9, 3.9180872963307657`*^9}, {3.918087334180735*^9, 
   3.918087341671929*^9}, {3.918088979308641*^9, 3.9180889797648487`*^9}, {
   3.9227858570876203`*^9, 3.9227858729712973`*^9}, {3.922785978062284*^9, 
   3.922785983727364*^9}, {3.9227860562368264`*^9, 3.9227860789867516`*^9}, 
   3.9228811738951344`*^9, {3.9249569685344563`*^9, 3.924956972333626*^9}, 
   3.9306473331055527`*^9, {3.9307441402088013`*^9, 3.930744145827043*^9}, {
   3.930746136365217*^9, 3.930746137006722*^9}},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[543]:=",ExpressionUUID->"f809d2f8-8c20-4057-92df-d6d3bab65e81"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SpecificXY16Polarize", "[", 
     RowBox[{
     "T_", ",", "PW_", ",", "Bx_", ",", "By_", ",", "Bz_", ",", 
      "maxFreqSweep_", ",", "B0_", ",", "dt_", ",", "runtime_", ",", 
      "experimentalParameters_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "N", ",", "B", ",", "\[Phi]", ",", "\[Tau]", ",", "\[Tau]P", ",", "T0",
         ",", "domain", ",", 
        RowBox[{"maxF", "=", "maxFreqSweep"}], ",", "freqMod", ",", 
        "phaseMod", ",", "cosTable", ",", "IrL", ",", "IrH2", ",", "kN", ",", 
        "kH", ",", "xPulse", ",", "yPulse", ",", "U1LongD", ",", "U1D", ",", 
        "U1Bx", ",", "U1Bxb", ",", "U1By", ",", "U1Byb", ",", "U2LongD", ",", 
        "U2D", ",", "U2Bx", ",", "U2Bxb", ",", "U2By", ",", "U2Byb", ",", 
        "UFLongD", ",", "UFD", ",", "UFBx", ",", "UFBxb", ",", "UFBy", ",", 
        "UFByb", ",", "output"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"IrL", "=", 
        RowBox[{"experimentalParameters", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"IrH2", "=", 
        RowBox[{"experimentalParameters", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"kN", "=", 
        RowBox[{"experimentalParameters", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"kH", "=", 
        RowBox[{"experimentalParameters", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Tau]", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox["T", "4"], ",", "dt"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"duration", " ", "of", " ", "delay"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"T0", " ", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox[
           RowBox[{"3", "*", "\[Tau]"}], "4"], ",", "dt"}], "]"}]}], " ", ";", 
       RowBox[{"(*", 
        RowBox[{
        "duration", " ", "of", " ", "one", " ", "XY4", " ", "subperiod"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[Tau]P", " ", "=", 
        RowBox[{"Round", "[", " ", 
         RowBox[{
          FractionBox[
           RowBox[{"T0", "-", 
            RowBox[{"4", "*", "PW"}]}], "3"], ",", "dt"}], "]"}]}], ";", " ", 
       
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"duration", " ", "of", " ", "inter"}], "-", 
         RowBox[{"pulse", " ", "delay"}]}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"domain", " ", "=", 
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Round", "[", 
           RowBox[{"PW", ",", "dt"}], "]"}], ",", "dt"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"domain", " ", "of", " ", "one", " ", "pulsewidth"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"freqMod", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             FractionBox[
              RowBox[{"2", "*", "maxF"}], "PW"], "*", "i"}], "-", "maxF"}], 
           ")"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "domain"}], "}"}]}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
        "maxF", " ", "is", " ", "in", " ", "units", " ", "of", " ", "kHz"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"phaseMod", "=", 
        RowBox[{"2", "\[Pi]", "*", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"freqMod", "[", 
               RowBox[{"[", "j", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", 
                FractionBox["i", "dt"]}], "}"}]}], "]"}], "*", "dt"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "domain"}], "}"}]}], "]"}]}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"phaseMod", " ", "=", " ", 
        RowBox[{"phaseMod", "-", 
         RowBox[{"Min", "[", "phaseMod", "]"}]}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"corrected", " ", "phase", " ", "modulation"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"cosTable", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Cos", "[", 
           RowBox[{
            RowBox[{"2", "*", "\[Pi]", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[Gamma]H", "*", "Bz"}], "+", 
                 RowBox[{"1000", "*", 
                  RowBox[{"freqMod", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}]}], ")"}], "*", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"domain", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "-", 
                 FractionBox["PW", "2"]}], ")"}], "*", "0.001"}], ")"}]}], 
            "+", 
            RowBox[{"phaseMod", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "domain", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"xPulse", "=", 
        RowBox[{
         RowBox[{"Quiet", "@", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               FractionBox["32", 
                SuperscriptBox["PW", "2"]], ",", "Bx", ",", 
               FractionBox["PW", "2"]}], "}"}], "}"}], ",", "PW", ",", "dt"}],
            "]"}]}], "*", "cosTable"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"yPulse", "=", 
        RowBox[{
         RowBox[{"Quiet", "@", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               FractionBox["32", 
                SuperscriptBox["PW", "2"]], ",", "By", ",", 
               FractionBox["PW", "2"]}], "}"}], "}"}], ",", "PW", ",", "dt"}],
            "]"}]}], "*", "cosTable"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"U1LongD", "=", 
        RowBox[{"U1", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U1D", "=", 
        RowBox[{"U1", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]P"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U1Bx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"xPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1By", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"yPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1Bxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"-", 
              RowBox[{"xPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1Byb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"yPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"U2LongD", "=", 
        RowBox[{"U2", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U2D", "=", 
        RowBox[{"U2", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]P"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U2Bx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"xPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2By", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"yPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2Bxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"-", 
              RowBox[{"xPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2Byb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"yPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"UFLongD", "=", 
        RowBox[{"UF", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"UFD", "=", 
        RowBox[{"UF", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]P"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"UFBx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"xPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFBy", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"yPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFBxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"-", 
              RowBox[{"xPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFByb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"yPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"output", "=", 
        RowBox[{"Last", "@", 
         RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "U1LongD", ",", "U1Bx", ",", "U1D", ",", "U1By", ",", "U1D", ",", 
             "U1Bx", ",", "U1D", ",", "U1By", ",", "U1Bxb", ",", "U1D", ",", 
             "U1Byb", ",", "U1D", ",", "U1Bxb", ",", "U1D", ",", "U1Byb", ",",
              "U1Bxb", ",", "U1D", ",", "U1Byb", ",", "U1D", ",", "U1Bxb", 
             ",", "U1D", ",", "U1Byb", ",", "U1Bx", ",", "U1D", ",", "U1By", 
             ",", "U1D", ",", "U1Bx", ",", "U1D", ",", "U1By"}], "}"}], 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "isomer", " ", "1"}], 
            "*)"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
            "U2LongD", ",", "U2Bx", ",", "U2D", ",", "U2By", ",", "U2D", ",", 
             "U2Bx", ",", "U2D", ",", "U2By", ",", "U2Bxb", ",", "U2D", ",", 
             "U2Byb", ",", "U2D", ",", "U2Bxb", ",", "U2D", ",", "U2Byb", ",",
              "U2Bxb", ",", "U2D", ",", "U2Byb", ",", "U2D", ",", "U2Bxb", 
             ",", "U2D", ",", "U2Byb", ",", "U2Bx", ",", "U2D", ",", "U2By", 
             ",", "U2D", ",", "U2Bx", ",", "U2D", ",", "U2By"}], "}"}], 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
            "*)"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
            "UFLongD", ",", "UFBx", ",", "UFD", ",", "UFBy", ",", "UFD", ",", 
             "UFBx", ",", "UFD", ",", "UFBy", ",", "UFBxb", ",", "UFD", ",", 
             "UFByb", ",", "UFD", ",", "UFBxb", ",", "UFD", ",", "UFByb", ",",
              "UFBxb", ",", "UFD", ",", "UFByb", ",", "UFD", ",", "UFBxb", 
             ",", "UFD", ",", "UFByb", ",", "UFBx", ",", "UFD", ",", "UFBy", 
             ",", "UFD", ",", "UFBx", ",", "UFD", ",", "UFBy"}], "}"}], 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
            "*)"}], ",", "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
           RowBox[{"(*", 
            RowBox[{
            "initial", " ", "conditions", " ", "for", " ", "bound", " ", 
             "and", " ", "free", " ", "species"}], "*)"}], ",", 
           "\[IndentingNewLine]", "kN", 
           RowBox[{"(*", 
            RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",",
            "kH", 
           RowBox[{"(*", 
            RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
           "\[IndentingNewLine]", "IrL", 
           RowBox[{"(*", 
            FractionBox[
             RowBox[{"[", "Ir", "]"}], 
             RowBox[{"[", "L", "]"}]], "*)"}], ",", "IrH2", 
           RowBox[{"(*", 
            RowBox[{
             FractionBox[
              RowBox[{"[", "Ir", "]"}], 
              RowBox[{"[", "H2", "]"}]], ",", " ", 
             RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"OnesList", "[", "29", "]"}], 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
             ",", " ", 
             RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
           RowBox[{"{", 
            RowBox[{
            "\[Tau]", ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", 
             ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "PW", ",", "\[Tau]P", 
             ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", ",", "PW", 
             ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", ",", "PW", 
             ",", "\[Tau]P", ",", "PW", ",", "PW", ",", "\[Tau]P", ",", "PW", 
             ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", ",", "PW"}], "}"}], 
           RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", 
           RowBox[{"Round", "[", 
            FractionBox["runtime", "T"], "]"}]}], "]"}]}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",\

 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.900580855345851*^9, 3.900582405436839*^9, {3.900582525691217*^9, 
   3.900582599221718*^9}, {3.900582633822196*^9, 3.900582673806778*^9}, {
   3.9005827331666803`*^9, 3.900582992797325*^9}, {3.900583255699739*^9, 
   3.900583298846998*^9}, {3.900583373038166*^9, 3.900583417275872*^9}, {
   3.900583629416684*^9, 3.900583723080104*^9}, {3.900584054440856*^9, 
   3.900584135010436*^9}, {3.9005841667314987`*^9, 3.900584195743218*^9}, {
   3.900584238841755*^9, 3.9005842624719543`*^9}, {3.9005842971598063`*^9, 
   3.9005845943531027`*^9}, {3.900584639639245*^9, 3.900584681553575*^9}, {
   3.900584721549426*^9, 3.900584725925117*^9}, {3.900584795703372*^9, 
   3.900585088590146*^9}, {3.900660221200687*^9, 3.900660290503244*^9}, {
   3.900670952442913*^9, 3.90067096436651*^9}, {3.902563938030075*^9, 
   3.9025639777787437`*^9}, {3.902564031092112*^9, 3.902564066060812*^9}, 
   3.9025641649957733`*^9, {3.903019295296772*^9, 3.90301929710882*^9}, {
   3.903019377036001*^9, 3.9030194030692472`*^9}, {3.9030201484922132`*^9, 
   3.90302016251243*^9}, {3.9030202564894*^9, 3.903020296965027*^9}, 
   3.903022244302541*^9, 3.9046475433272142`*^9, {3.9046478410396423`*^9, 
   3.9046478480720053`*^9}, {3.904648057196312*^9, 3.90464805868918*^9}, {
   3.904648366849901*^9, 3.904648368348587*^9}, {3.904648444895329*^9, 
   3.9046484817750587`*^9}, 3.904649747582617*^9, {3.904649794442531*^9, 
   3.904649849534974*^9}, {3.9046499307597713`*^9, 3.904649938003138*^9}, {
   3.904650076167879*^9, 3.904650088837571*^9}, {3.904650176147087*^9, 
   3.904650218774405*^9}, {3.9046509408538923`*^9, 3.904651052906501*^9}, {
   3.90465112730208*^9, 3.904651149043313*^9}, {3.904651368771426*^9, 
   3.904651422684654*^9}, {3.904651455231081*^9, 3.904651456024313*^9}, {
   3.904651500065998*^9, 3.904651521203361*^9}, {3.904651603100375*^9, 
   3.904651830293479*^9}, {3.904651893432475*^9, 3.904651894263661*^9}, {
   3.904651932357397*^9, 3.904651986347093*^9}, {3.9046520542382317`*^9, 
   3.904652071454166*^9}, {3.904652158052786*^9, 3.904652239208932*^9}, {
   3.904652277374984*^9, 3.904652285332891*^9}, {3.904652343684256*^9, 
   3.9046524069554358`*^9}, {3.904652440517556*^9, 3.904652519713702*^9}, {
   3.904652552543211*^9, 3.9046526352173767`*^9}, {3.904652684939281*^9, 
   3.904652854823515*^9}, {3.904652889265086*^9, 3.904653059791809*^9}, {
   3.9046533029343567`*^9, 3.904653309267363*^9}, {3.904653451803244*^9, 
   3.9046534609163094`*^9}, {3.904653663587493*^9, 3.904653685570816*^9}, {
   3.9046537769445744`*^9, 3.9046537938675127`*^9}, {3.9046538319546137`*^9, 
   3.904653841136348*^9}, {3.904825340182719*^9, 3.904825381511484*^9}, {
   3.904825420086461*^9, 3.9048254230474167`*^9}, {3.904825513730876*^9, 
   3.904825546124176*^9}, 3.904825623299837*^9, {3.904825830332336*^9, 
   3.904825830510722*^9}, {3.904825919890212*^9, 3.904825920140286*^9}, {
   3.904826237754408*^9, 3.904826237977922*^9}, 3.904830471276381*^9, {
   3.904831405045595*^9, 3.9048314102476597`*^9}, {3.9049027475874033`*^9, 
   3.90490278165556*^9}, {3.9052650582806892`*^9, 3.9052650615424557`*^9}, {
   3.9052651017302113`*^9, 3.905265158431285*^9}, {3.905265212948326*^9, 
   3.905265216035543*^9}, {3.9066409121269054`*^9, 3.906641001786029*^9}, {
   3.906641053054123*^9, 3.9066410737867427`*^9}, {3.9066423917817945`*^9, 
   3.906642399419865*^9}, {3.90664302250134*^9, 3.906643024123335*^9}, 
   3.9076735534852324`*^9, {3.908283193766592*^9, 3.908283227684514*^9}, {
   3.908283315626425*^9, 3.908283352816839*^9}, {3.908283549289136*^9, 
   3.9082836123199577`*^9}, {3.908283657203041*^9, 3.9082836930404787`*^9}, {
   3.908283782810361*^9, 3.9082838161418324`*^9}, {3.908285776915271*^9, 
   3.908285820465694*^9}, {3.908285959924933*^9, 3.90828601033962*^9}, {
   3.908286259079455*^9, 3.908286271689782*^9}, {3.908824840631631*^9, 
   3.908824853502262*^9}, {3.908825586094879*^9, 3.908825657227935*^9}, {
   3.9088256917835007`*^9, 3.9088257330106773`*^9}, {3.908825787711007*^9, 
   3.908825868364313*^9}, {3.908825987433092*^9, 3.9088259876369753`*^9}, {
   3.90882605949216*^9, 3.908826085248372*^9}, {3.9088262066672373`*^9, 
   3.90882620829137*^9}, {3.908826248824243*^9, 3.908826411121233*^9}, {
   3.908826460358778*^9, 3.908826574500527*^9}, {3.908826608314764*^9, 
   3.9088267221022253`*^9}, {3.908826752375697*^9, 3.908826836874978*^9}, {
   3.910112966314968*^9, 3.9101129674076853`*^9}, 3.910432233065796*^9, 
   3.910432368977376*^9, 3.910432404454432*^9, 3.915616533847116*^9, 
   3.915616577062652*^9, 3.922881173886609*^9, 3.9306473331047697`*^9, {
   3.93074449734542*^9, 3.930744544495429*^9}},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[544]:=",ExpressionUUID->"913ff889-5d49-4088-8b4d-4121b206d6a7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SpecificXY16PolTrace", "[", 
     RowBox[{
     "T_", ",", "PW_", ",", "Bx_", ",", "By_", ",", "Bz_", ",", 
      "maxFreqSweep_", ",", "B0_", ",", "dt_", ",", "runtime_", ",", 
      "experimentalParameters_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "N", ",", "B", ",", "\[Phi]", ",", "\[Tau]", ",", "\[Tau]P", ",", "T0",
         ",", "domain", ",", 
        RowBox[{"maxF", "=", "maxFreqSweep"}], ",", "freqMod", ",", 
        "phaseMod", ",", "cosTable", ",", "IrL", ",", "IrH2", ",", "kN", ",", 
        "kH", ",", "xPulse", ",", "yPulse", ",", "U1LongD", ",", "U1D", ",", 
        "U1Bx", ",", "U1Bxb", ",", "U1By", ",", "U1Byb", ",", "U2LongD", ",", 
        "U2D", ",", "U2Bx", ",", "U2Bxb", ",", "U2By", ",", "U2Byb", ",", 
        "UFLongD", ",", "UFD", ",", "UFBx", ",", "UFBxb", ",", "UFBy", ",", 
        "UFByb", ",", "output"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"IrL", "=", 
        RowBox[{"experimentalParameters", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"IrH2", "=", 
        RowBox[{"experimentalParameters", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"kN", "=", 
        RowBox[{"experimentalParameters", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"kH", "=", 
        RowBox[{"experimentalParameters", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Tau]", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox["T", "4"], ",", "dt"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"duration", " ", "of", " ", "delay"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"T0", " ", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox[
           RowBox[{"3", "*", "\[Tau]"}], "4"], ",", "dt"}], "]"}]}], " ", ";", 
       RowBox[{"(*", 
        RowBox[{
        "duration", " ", "of", " ", "one", " ", "XY4", " ", "subperiod"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[Tau]P", " ", "=", 
        RowBox[{"Round", "[", " ", 
         RowBox[{
          FractionBox[
           RowBox[{"T0", "-", 
            RowBox[{"4", "*", "PW"}]}], "3"], ",", "dt"}], "]"}]}], ";", " ", 
       
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"duration", " ", "of", " ", "inter"}], "-", 
         RowBox[{"pulse", " ", "delay"}]}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"domain", " ", "=", 
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Round", "[", 
           RowBox[{"PW", ",", "dt"}], "]"}], ",", "dt"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"domain", " ", "of", " ", "one", " ", "pulsewidth"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"freqMod", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             FractionBox[
              RowBox[{"2", "*", "maxF"}], "PW"], "*", "i"}], "-", "maxF"}], 
           ")"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "domain"}], "}"}]}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
        "maxF", " ", "is", " ", "in", " ", "units", " ", "of", " ", "kHz"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"phaseMod", "=", 
        RowBox[{"2", "\[Pi]", "*", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Sum", "[", 
             RowBox[{
              RowBox[{"freqMod", "[", 
               RowBox[{"[", "j", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "1", ",", 
                FractionBox["i", "dt"]}], "}"}]}], "]"}], "*", "dt"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "domain"}], "}"}]}], "]"}]}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"phaseMod", " ", "=", " ", 
        RowBox[{"phaseMod", "-", 
         RowBox[{"Min", "[", "phaseMod", "]"}]}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"corrected", " ", "phase", " ", "modulation"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"cosTable", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Cos", "[", 
           RowBox[{
            RowBox[{"2", "*", "\[Pi]", "*", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"\[Gamma]H", "*", "Bz"}], "+", 
                 RowBox[{"1000", "*", 
                  RowBox[{"freqMod", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}]}], ")"}], "*", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"domain", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "-", 
                 FractionBox["PW", "2"]}], ")"}], "*", "0.001"}], ")"}]}], 
            "+", 
            RowBox[{"phaseMod", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "domain", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"xPulse", "=", 
        RowBox[{
         RowBox[{"Quiet", "@", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               FractionBox["32", 
                SuperscriptBox["PW", "2"]], ",", "Bx", ",", 
               FractionBox["PW", "2"]}], "}"}], "}"}], ",", "PW", ",", "dt"}],
            "]"}]}], "*", "cosTable"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"yPulse", "=", 
        RowBox[{
         RowBox[{"Quiet", "@", 
          RowBox[{"GaussAmpMod", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{
               FractionBox["32", 
                SuperscriptBox["PW", "2"]], ",", "By", ",", 
               FractionBox["PW", "2"]}], "}"}], "}"}], ",", "PW", ",", "dt"}],
            "]"}]}], "*", "cosTable"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"U1LongD", "=", 
        RowBox[{"U1", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U1D", "=", 
        RowBox[{"U1", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]P"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U1Bx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"xPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1By", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"yPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1Bxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"-", 
              RowBox[{"xPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U1Byb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U1", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"yPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"U2LongD", "=", 
        RowBox[{"U2", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U2D", "=", 
        RowBox[{"U2", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]P"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"U2Bx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"xPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2By", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"yPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2Bxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"-", 
              RowBox[{"xPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"U2Byb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"U2", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"yPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"UFLongD", "=", 
        RowBox[{"UF", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"UFD", "=", 
        RowBox[{"UF", "[", 
         RowBox[{"B0", ",", "0", ",", "0", ",", "\[Tau]P"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"UFBx", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"xPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "dt"}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFBy", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"yPulse", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFBxb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", 
             RowBox[{"-", 
              RowBox[{"xPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "0", ",", "dt"}], "]"}],
            ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"UFByb", "=", 
        RowBox[{"Dot", "@@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"UF", "[", 
            RowBox[{"Bz", ",", "0", ",", 
             RowBox[{"-", 
              RowBox[{"yPulse", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}], ",", "dt"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "xPulse", "]"}]}], "}"}]}], "]"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"output", "=", 
        RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
           "U1LongD", ",", "U1Bx", ",", "U1D", ",", "U1By", ",", "U1D", ",", 
            "U1Bx", ",", "U1D", ",", "U1By", ",", "U1Bxb", ",", "U1D", ",", 
            "U1Byb", ",", "U1D", ",", "U1Bxb", ",", "U1D", ",", "U1Byb", ",", 
            "U1Bxb", ",", "U1D", ",", "U1Byb", ",", "U1D", ",", "U1Bxb", ",", 
            "U1D", ",", "U1Byb", ",", "U1Bx", ",", "U1D", ",", "U1By", ",", 
            "U1D", ",", "U1Bx", ",", "U1D", ",", "U1By"}], "}"}], 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "isomer", " ", "1"}], 
           "*)"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
           "U2LongD", ",", "U2Bx", ",", "U2D", ",", "U2By", ",", "U2D", ",", 
            "U2Bx", ",", "U2D", ",", "U2By", ",", "U2Bxb", ",", "U2D", ",", 
            "U2Byb", ",", "U2D", ",", "U2Bxb", ",", "U2D", ",", "U2Byb", ",", 
            "U2Bxb", ",", "U2D", ",", "U2Byb", ",", "U2D", ",", "U2Bxb", ",", 
            "U2D", ",", "U2Byb", ",", "U2Bx", ",", "U2D", ",", "U2By", ",", 
            "U2D", ",", "U2Bx", ",", "U2D", ",", "U2By"}], "}"}], 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
           "*)"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
           "UFLongD", ",", "UFBx", ",", "UFD", ",", "UFBy", ",", "UFD", ",", 
            "UFBx", ",", "UFD", ",", "UFBy", ",", "UFBxb", ",", "UFD", ",", 
            "UFByb", ",", "UFD", ",", "UFBxb", ",", "UFD", ",", "UFByb", ",", 
            "UFBxb", ",", "UFD", ",", "UFByb", ",", "UFD", ",", "UFBxb", ",", 
            "UFD", ",", "UFByb", ",", "UFBx", ",", "UFD", ",", "UFBy", ",", 
            "UFD", ",", "UFBx", ",", "UFD", ",", "UFBy"}], "}"}], 
          RowBox[{"(*", 
           RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
           "*)"}], ",", "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
          RowBox[{"(*", 
           RowBox[{
           "initial", " ", "conditions", " ", "for", " ", "bound", " ", "and",
             " ", "free", " ", "species"}], "*)"}], ",", 
          "\[IndentingNewLine]", "kN", 
          RowBox[{"(*", 
           RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",", 
          "kH", 
          RowBox[{"(*", 
           RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
          "\[IndentingNewLine]", "IrL", 
          RowBox[{"(*", 
           FractionBox[
            RowBox[{"[", "Ir", "]"}], 
            RowBox[{"[", "L", "]"}]], "*)"}], ",", "IrH2", 
          RowBox[{"(*", 
           RowBox[{
            FractionBox[
             RowBox[{"[", "Ir", "]"}], 
             RowBox[{"[", "H2", "]"}]], ",", " ", 
            RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"OnesList", "[", "29", "]"}], 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
            ",", " ", 
            RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
          RowBox[{"{", 
           RowBox[{
           "\[Tau]", ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", 
            ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "PW", ",", "\[Tau]P", 
            ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", ",", "PW", 
            ",", "PW", ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", ",", "PW", 
            ",", "\[Tau]P", ",", "PW", ",", "PW", ",", "\[Tau]P", ",", "PW", 
            ",", "\[Tau]P", ",", "PW", ",", "\[Tau]P", ",", "PW"}], "}"}], 
          RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", 
          RowBox[{"Round", "[", 
           FractionBox["runtime", "T"], "]"}]}], "]"}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",\

 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.900580855345851*^9, 3.900582405436839*^9, {3.900582525691217*^9, 
   3.900582599221718*^9}, {3.900582633822196*^9, 3.900582673806778*^9}, {
   3.9005827331666803`*^9, 3.900582992797325*^9}, {3.900583255699739*^9, 
   3.900583298846998*^9}, {3.900583373038166*^9, 3.900583417275872*^9}, {
   3.900583629416684*^9, 3.900583723080104*^9}, {3.900584054440856*^9, 
   3.900584135010436*^9}, {3.9005841667314987`*^9, 3.900584195743218*^9}, {
   3.900584238841755*^9, 3.9005842624719543`*^9}, {3.9005842971598063`*^9, 
   3.9005845943531027`*^9}, {3.900584639639245*^9, 3.900584681553575*^9}, {
   3.900584721549426*^9, 3.900584725925117*^9}, {3.900584795703372*^9, 
   3.900585088590146*^9}, {3.900660221200687*^9, 3.900660290503244*^9}, {
   3.900670952442913*^9, 3.90067096436651*^9}, {3.902563938030075*^9, 
   3.9025639777787437`*^9}, {3.902564031092112*^9, 3.902564066060812*^9}, 
   3.9025641649957733`*^9, {3.903019295296772*^9, 3.90301929710882*^9}, {
   3.903019377036001*^9, 3.9030194030692472`*^9}, {3.9030201484922132`*^9, 
   3.90302016251243*^9}, {3.9030202564894*^9, 3.903020296965027*^9}, 
   3.903022244302541*^9, 3.9046475433272142`*^9, {3.9046478410396423`*^9, 
   3.9046478480720053`*^9}, {3.904648057196312*^9, 3.90464805868918*^9}, {
   3.904648366849901*^9, 3.904648368348587*^9}, {3.904648444895329*^9, 
   3.9046484817750587`*^9}, 3.904649747582617*^9, {3.904649794442531*^9, 
   3.904649849534974*^9}, {3.9046499307597713`*^9, 3.904649938003138*^9}, {
   3.904650076167879*^9, 3.904650088837571*^9}, {3.904650176147087*^9, 
   3.904650218774405*^9}, {3.9046509408538923`*^9, 3.904651052906501*^9}, {
   3.90465112730208*^9, 3.904651149043313*^9}, {3.904651368771426*^9, 
   3.904651422684654*^9}, {3.904651455231081*^9, 3.904651456024313*^9}, {
   3.904651500065998*^9, 3.904651521203361*^9}, {3.904651603100375*^9, 
   3.904651830293479*^9}, {3.904651893432475*^9, 3.904651894263661*^9}, {
   3.904651932357397*^9, 3.904651986347093*^9}, {3.9046520542382317`*^9, 
   3.904652071454166*^9}, {3.904652158052786*^9, 3.904652239208932*^9}, {
   3.904652277374984*^9, 3.904652285332891*^9}, {3.904652343684256*^9, 
   3.9046524069554358`*^9}, {3.904652440517556*^9, 3.904652519713702*^9}, {
   3.904652552543211*^9, 3.9046526352173767`*^9}, {3.904652684939281*^9, 
   3.904652854823515*^9}, {3.904652889265086*^9, 3.904653059791809*^9}, {
   3.9046533029343567`*^9, 3.904653309267363*^9}, {3.904653451803244*^9, 
   3.9046534609163094`*^9}, {3.904653663587493*^9, 3.904653685570816*^9}, {
   3.9046537769445744`*^9, 3.9046537938675127`*^9}, {3.9046538319546137`*^9, 
   3.904653841136348*^9}, {3.904825340182719*^9, 3.904825381511484*^9}, {
   3.904825420086461*^9, 3.9048254230474167`*^9}, {3.904825513730876*^9, 
   3.904825546124176*^9}, 3.904825623299837*^9, {3.904825830332336*^9, 
   3.904825830510722*^9}, {3.904825919890212*^9, 3.904825920140286*^9}, {
   3.904826237754408*^9, 3.904826237977922*^9}, 3.904830471276381*^9, {
   3.904831405045595*^9, 3.9048314102476597`*^9}, {3.9049027475874033`*^9, 
   3.90490278165556*^9}, {3.9052650582806892`*^9, 3.9052650615424557`*^9}, {
   3.9052651017302113`*^9, 3.905265158431285*^9}, {3.905265212948326*^9, 
   3.905265216035543*^9}, {3.9066409121269054`*^9, 3.906641001786029*^9}, {
   3.906641053054123*^9, 3.9066410737867427`*^9}, {3.9066423917817945`*^9, 
   3.906642399419865*^9}, {3.90664302250134*^9, 3.906643024123335*^9}, 
   3.9076735534852324`*^9, {3.908283193766592*^9, 3.908283227684514*^9}, {
   3.908283315626425*^9, 3.908283352816839*^9}, {3.908283549289136*^9, 
   3.9082836123199577`*^9}, {3.908283657203041*^9, 3.9082836930404787`*^9}, {
   3.908283782810361*^9, 3.9082838161418324`*^9}, {3.908285776915271*^9, 
   3.908285820465694*^9}, {3.908285959924933*^9, 3.90828601033962*^9}, {
   3.908286259079455*^9, 3.908286271689782*^9}, {3.908824840631631*^9, 
   3.908824853502262*^9}, {3.908825586094879*^9, 3.908825657227935*^9}, {
   3.9088256917835007`*^9, 3.9088257330106773`*^9}, {3.908825787711007*^9, 
   3.908825868364313*^9}, {3.908825987433092*^9, 3.9088259876369753`*^9}, {
   3.90882605949216*^9, 3.908826085248372*^9}, {3.9088262066672373`*^9, 
   3.90882620829137*^9}, {3.908826248824243*^9, 3.908826411121233*^9}, {
   3.908826460358778*^9, 3.908826574500527*^9}, {3.908826608314764*^9, 
   3.9088267221022253`*^9}, {3.908826752375697*^9, 3.908826836874978*^9}, {
   3.910112966314968*^9, 3.9101129674076853`*^9}, 3.910432233065796*^9, 
   3.910432368977376*^9, 3.910432404454432*^9, 3.915616533847116*^9, 
   3.915616577062652*^9, 3.922881173886609*^9, {3.9249577643939905`*^9, 
   3.924957785688412*^9}, 3.930647333104965*^9, {3.9307443930636578`*^9, 
   3.930744437712468*^9}},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[545]:=",ExpressionUUID->"e7f25c41-4e30-44b1-aae8-25b73de75ae2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SpecificXY16ShapeMagic", "[", 
     RowBox[{
     "ParameterTable_", ",", "timestep_", ",", "request_", ",", 
      "experimentalParameters_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"genP", "=", "ParameterTable"}], ",", 
        RowBox[{"dt", "=", "timestep"}], ",", 
        RowBox[{"req", "=", "request"}], ",", "T", ",", "PW", ",", "N", ",", 
        "Bx", ",", "By", ",", "Bz", ",", "\[CapitalDelta]\[CapitalOmega]", 
        ",", "B0", ",", "\[Phi]", ",", "\[Tau]", ",", "\[Tau]P", ",", "T0", 
        ",", "IrL", ",", "IrH2", ",", "kN", ",", "kH", ",", "domain", ",", 
        "pulse", ",", "XPeriod", ",", "YPeriod", ",", "ZPeriod", ",", 
        "shapesX", ",", "shapesY", ",", "shapesZ", ",", "output"}], "}"}], 
      ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"IrL", "=", 
        RowBox[{"experimentalParameters", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"IrH2", "=", 
        RowBox[{"experimentalParameters", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"kN", "=", 
        RowBox[{"experimentalParameters", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"kH", "=", 
        RowBox[{"experimentalParameters", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"T", "=", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"duration", " ", "of", " ", "full", " ", "period"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"PW", " ", "=", " ", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"duration", " ", "of", " ", "one", " ", "pulsewidth"}], " ", 
         "-", " ", "\[Micro]T"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Bx", " ", "=", " ", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "X", " ", "pulse", " ", "power", " ", "during", " ", "pulses"}], " ",
          "-", " ", "\[Micro]T"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"By", " ", "=", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Y", " ", "pulse", " ", "power", " ", "during", " ", "pulses"}], " ",
          "-", " ", "\[Micro]T"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Bz", " ", "=", " ", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "5", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
         "Z", " ", "pulse", " ", "power", " ", "during", " ", "pulses"}], " ",
          "-", " ", "\[Micro]T"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[CapitalDelta]\[CapitalOmega]", " ", "=", " ", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "6", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"bandwidth", " ", "of", " ", "frequency", " ", "sweep"}], 
         " ", "-", " ", "kHz"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"B0", " ", "=", " ", 
        RowBox[{"genP", "[", 
         RowBox[{"[", "7", "]"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Z", " ", "field", " ", "during", " ", "delays"}], " ", "-", 
         " ", "\[Micro]T"}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Tau]", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox["T", "4"], ",", "dt"}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"duration", " ", "of", " ", "delay"}], " ", "-", " ", 
         RowBox[{"encoded", " ", "in", " ", "T", " ", "and", " ", "PW"}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"T0", " ", "=", 
        RowBox[{"Round", "[", 
         RowBox[{
          FractionBox[
           RowBox[{"3", "*", "\[Tau]"}], "4"], ",", "dt"}], "]"}]}], " ", ";", 
       RowBox[{"(*", 
        RowBox[{
        "duration", " ", "of", " ", "one", " ", "XY4", " ", "subperiod"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[Tau]P", " ", "=", 
        RowBox[{"Round", "[", " ", 
         RowBox[{
          FractionBox[
           RowBox[{"T0", "-", 
            RowBox[{"4", "*", "PW"}]}], "3"], ",", "dt"}], "]"}]}], ";", " ", 
       
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"duration", " ", "of", " ", "inter"}], "-", 
         RowBox[{"pulse", " ", "delay"}]}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"domain", "=", 
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Round", "[", 
           RowBox[{"PW", ",", "dt"}], "]"}], ",", "dt"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"pulse", "=", 
        RowBox[{
         RowBox[{"AdiabaticGaussian", "[", 
          RowBox[{
          "PW", ",", "Bx", ",", "Bz", ",", "\[CapitalDelta]\[CapitalOmega]", 
           ",", "dt", ",", "\"\<Generate\>\""}], "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"XPeriod", "=", 
        RowBox[{"Stitch4", "[", 
         RowBox[{"{", 
          RowBox[{"pulse", ",", 
           RowBox[{"Zeros", "[", 
            RowBox[{"Round", "[", 
             FractionBox[
              RowBox[{
               RowBox[{"2", "*", "\[Tau]P"}], "+", "PW"}], "dt"], "]"}], 
            "]"}], ",", "pulse", ",", 
           RowBox[{"Zeros", "[", 
            RowBox[{"Round", "[", 
             FractionBox[
              RowBox[{"\[Tau]P", "+", "PW"}], "dt"], "]"}], "]"}]}], "}"}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"YPeriod", "=", 
        RowBox[{"Stitch4", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Zeros", "[", 
            RowBox[{"Round", "[", 
             FractionBox[
              RowBox[{"\[Tau]P", "+", "PW"}], "dt"], "]"}], "]"}], ",", 
           "pulse", ",", 
           RowBox[{"Zeros", "[", 
            RowBox[{"Round", "[", 
             FractionBox[
              RowBox[{
               RowBox[{"2", "*", "\[Tau]P"}], "+", "PW"}], "dt"], "]"}], 
            "]"}], ",", "pulse"}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ZPeriod", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Bz", "*", 
            RowBox[{"RectFunction", "[", 
             RowBox[{"0", ",", "PW", ",", "t"}], "]"}]}], "+", 
           RowBox[{"B0", "*", 
            RowBox[{"RectFunction", "[", 
             RowBox[{"PW", ",", 
              RowBox[{"PW", "+", "\[Tau]P"}], ",", "t"}], "]"}]}], "+", 
           RowBox[{"Bz", "*", 
            RowBox[{"RectFunction", "[", 
             RowBox[{
              RowBox[{"PW", "+", "\[Tau]P"}], ",", 
              RowBox[{
               RowBox[{"2", "*", "PW"}], "+", "\[Tau]P"}], ",", "t"}], 
             "]"}]}], "+", 
           RowBox[{"B0", "*", 
            RowBox[{"RectFunction", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"2", "*", "PW"}], "+", "\[Tau]P"}], ",", 
              RowBox[{
               RowBox[{"2", "*", "PW"}], "+", 
               RowBox[{"2", "*", "\[Tau]P"}]}], ",", "t"}], "]"}]}], "+", 
           RowBox[{"Bz", "*", 
            RowBox[{"RectFunction", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"2", "*", "PW"}], "+", 
               RowBox[{"2", "*", "\[Tau]P"}]}], ",", 
              RowBox[{
               RowBox[{"3", "*", "PW"}], "+", 
               RowBox[{"2", "*", "\[Tau]P"}]}], ",", "t"}], "]"}]}], "+", 
           RowBox[{"B0", "*", 
            RowBox[{"RectFunction", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"3", "*", "PW"}], "+", 
               RowBox[{"2", "*", "\[Tau]P"}]}], ",", 
              RowBox[{
               RowBox[{"3", "*", "PW"}], "+", 
               RowBox[{"3", "*", "\[Tau]P"}]}], ",", "t"}], "]"}]}], "+", 
           RowBox[{"Bz", "*", 
            RowBox[{"RectFunction", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"3", "*", "PW"}], "+", 
               RowBox[{"3", "*", "\[Tau]P"}]}], ",", 
              RowBox[{
               RowBox[{"4", "*", "PW"}], "+", 
               RowBox[{"3", "*", "\[Tau]P"}]}], ",", "t"}], "]"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"t", ",", "0", ",", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Length", "[", "XPeriod", "]"}], "-", "1"}], ")"}], 
             "*", "dt"}], ",", "dt"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"shapesX", "=", 
        RowBox[{"AddDelay", "[", 
         RowBox[{
          RowBox[{"Stitch4", "[", 
           RowBox[{"{", 
            RowBox[{"XPeriod", ",", 
             RowBox[{
              RowBox[{"-", "1"}], "*", "XPeriod"}], ",", 
             RowBox[{
              RowBox[{"-", "1"}], "*", "XPeriod"}], ",", "XPeriod"}], "}"}], 
           "]"}], ",", "\[Tau]", ",", "dt"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"shapesY", "=", 
        RowBox[{"AddDelay", "[", 
         RowBox[{
          RowBox[{"Stitch4", "[", 
           RowBox[{"{", 
            RowBox[{"YPeriod", ",", 
             RowBox[{
              RowBox[{"-", "1"}], "*", "YPeriod"}], ",", 
             RowBox[{
              RowBox[{"-", "1"}], "*", "YPeriod"}], ",", "YPeriod"}], "}"}], 
           "]"}], ",", "\[Tau]", ",", "dt"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"shapesZ", "=", 
        RowBox[{"AddDCDelay", "[", 
         RowBox[{
          RowBox[{"Stitch4", "[", 
           RowBox[{"{", 
            RowBox[{
            "ZPeriod", ",", "ZPeriod", ",", "ZPeriod", ",", "ZPeriod"}], 
            "}"}], "]"}], ",", "\[Tau]", ",", "dt", ",", "B0"}], "]"}]}], ";",
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<Generate\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"{", 
            RowBox[{"shapesX", ",", "shapesY", ",", "shapesZ"}], "}"}]}], 
          ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<Graph\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"Show", "[", 
            RowBox[{
             RowBox[{"TracePlot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Range", "[", 
                   RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "XPeriod", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "XPeriod"}], 
                 "}"}], "\[Transpose]"}], ",", "Red", ",", 
               RowBox[{"{", 
                RowBox[{
                "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", "XPeriod", "]"}], "-", "1"}], 
                   ")"}], "*", "dt"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"TracePlot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Range", "[", 
                   RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "YPeriod", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "YPeriod"}], 
                 "}"}], "\[Transpose]"}], ",", "Blue", ",", 
               RowBox[{"{", 
                RowBox[{
                "\"\<t (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", "YPeriod", "]"}], "-", "1"}], 
                   ")"}], "*", "dt"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<FullGraph\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"Show", "[", 
            RowBox[{
             RowBox[{"TracePlot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Range", "[", 
                   RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesX"}], 
                 "}"}], "\[Transpose]"}], ",", "Red", ",", 
               RowBox[{"{", 
                RowBox[{
                "\"\<Time (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], 
                   ")"}], "*", "dt"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"TracePlot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Range", "[", 
                   RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesY", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesY"}], 
                 "}"}], "\[Transpose]"}], ",", "Blue", ",", 
               RowBox[{"{", 
                RowBox[{
                "\"\<Time (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", "shapesX", "]"}], "-", "1"}], 
                   ")"}], "*", "dt"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"TracePlot", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Range", "[", 
                   RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", "shapesZ", "]"}], "-", "1"}], 
                    ")"}], "*", "dt"}], ",", "dt"}], "]"}], ",", "shapesZ"}], 
                 "}"}], "\[Transpose]"}], ",", "Black", ",", 
               RowBox[{"{", 
                RowBox[{
                "\"\<Time (ms)\>\"", ",", "\"\<Amplitude (\[Micro]T)\>\""}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", "shapesZ", "]"}], "-", "1"}], 
                   ")"}], "*", "dt"}]}], "}"}]}], "]"}], ",", 
             RowBox[{"PlotRange", "->", "All"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<ShortPol\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"SpecificXY16Polarize", "[", 
            RowBox[{"T", ",", "PW", ",", "Bx", ",", "By", ",", "Bz", ",", 
             FractionBox["\[CapitalDelta]\[CapitalOmega]", "2"], ",", "B0", 
             ",", "dt", ",", "2000", ",", 
             RowBox[{"{", 
              RowBox[{"IrL", ",", "IrH2", ",", "kN", ",", "kH"}], "}"}]}], 
            "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<Pol\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"SpecificXY16Polarize", "[", 
            RowBox[{"T", ",", "PW", ",", "Bx", ",", "By", ",", "Bz", ",", 
             FractionBox["\[CapitalDelta]\[CapitalOmega]", "2"], ",", "B0", 
             ",", "dt", ",", "20000", ",", 
             RowBox[{"{", 
              RowBox[{"IrL", ",", "IrH2", ",", "kN", ",", "kH"}], "}"}]}], 
            "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<FullPol\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"SpecificXY16Polarize", "[", 
            RowBox[{"T", ",", "PW", ",", "Bx", ",", "By", ",", "Bz", ",", 
             FractionBox["\[CapitalDelta]\[CapitalOmega]", "2"], ",", "B0", 
             ",", "dt", ",", "60000", ",", 
             RowBox[{"{", 
              RowBox[{"IrL", ",", "IrH2", ",", "kN", ",", "kH"}], "}"}]}], 
            "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"req", "==", "\"\<FullPolTrace\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"output", "=", 
           RowBox[{"SpecificXY16PolTrace", "[", 
            RowBox[{"T", ",", "PW", ",", "Bx", ",", "By", ",", "Bz", ",", 
             FractionBox["\[CapitalDelta]\[CapitalOmega]", "2"], ",", "B0", 
             ",", "dt", ",", "60000", ",", 
             RowBox[{"{", 
              RowBox[{"IrL", ",", "IrH2", ",", "kN", ",", "kH"}], "}"}]}], 
            "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "output"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",\

 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{{3.89704490560113*^9, 3.897044941810536*^9}, {
   3.897047951151103*^9, 3.897047951452484*^9}, {3.897048144240698*^9, 
   3.8970482312424297`*^9}, {3.8970482855237417`*^9, 
   3.8970483243806267`*^9}, {3.8970483621469803`*^9, 3.897048573160529*^9}, {
   3.897048706713324*^9, 3.897048709576819*^9}, {3.89704903362179*^9, 
   3.8970490422726717`*^9}, {3.897049161608699*^9, 3.897049196148707*^9}, {
   3.8970496709044943`*^9, 3.8970496722345743`*^9}, {3.897050423262704*^9, 
   3.897050426426649*^9}, {3.897050542387467*^9, 3.897050568573604*^9}, {
   3.897050613855695*^9, 3.897050882023191*^9}, {3.8970509222091417`*^9, 
   3.897051084186138*^9}, {3.8970511239703207`*^9, 3.897051202341874*^9}, {
   3.897051364499699*^9, 3.8970515939125633`*^9}, {3.897051678672974*^9, 
   3.897051798347341*^9}, {3.897052057358809*^9, 3.897052117701976*^9}, {
   3.897052177767589*^9, 3.897052217653767*^9}, {3.897052261060299*^9, 
   3.897052273807811*^9}, {3.897052395148117*^9, 3.897052530341085*^9}, {
   3.8970526483718576`*^9, 3.897052657976996*^9}, {3.89705271513301*^9, 
   3.897052716272588*^9}, {3.897052870546041*^9, 3.897052884569233*^9}, {
   3.897052966063035*^9, 3.897053016090858*^9}, {3.897053103369545*^9, 
   3.897053126957243*^9}, {3.897053214342381*^9, 3.89705323727245*^9}, {
   3.8970532916833553`*^9, 3.897053291898093*^9}, {3.897053468052842*^9, 
   3.897053473270308*^9}, {3.897053631676797*^9, 3.8970536529720497`*^9}, {
   3.897053918333879*^9, 3.89705392467406*^9}, {3.897054104227902*^9, 
   3.897054133322616*^9}, {3.897054177037314*^9, 3.897054302870544*^9}, {
   3.897054357304744*^9, 3.8970543592004766`*^9}, {3.8970544052091503`*^9, 
   3.897054491344906*^9}, {3.897054531569837*^9, 3.897054566580721*^9}, {
   3.8970546076958303`*^9, 3.897054609315817*^9}, {3.897054734689783*^9, 
   3.897054761770708*^9}, {3.897055273743992*^9, 3.897055280882004*^9}, {
   3.897055674123695*^9, 3.897055779030328*^9}, {3.897056081056839*^9, 
   3.89705609177207*^9}, {3.8970561999417877`*^9, 3.897056204415772*^9}, {
   3.89705623705486*^9, 3.8970562383169603`*^9}, {3.897056307594467*^9, 
   3.89705633952733*^9}, {3.897056511546081*^9, 3.89705654874193*^9}, {
   3.8970570479448013`*^9, 3.8970570663277607`*^9}, {3.897057117472597*^9, 
   3.897057142166602*^9}, {3.897057807940278*^9, 3.897057808146186*^9}, {
   3.8970578716232033`*^9, 3.897057872306917*^9}, {3.897057917598881*^9, 
   3.89705791765858*^9}, {3.897058284210682*^9, 3.8970582937205267`*^9}, {
   3.897058736704432*^9, 3.897058739317483*^9}, {3.897058779475258*^9, 
   3.897058780299033*^9}, {3.897059301307345*^9, 3.897059310642701*^9}, {
   3.897059868198091*^9, 3.8970599261843147`*^9}, {3.897060469585746*^9, 
   3.897060476329668*^9}, {3.897061739461603*^9, 3.8970617603841467`*^9}, {
   3.897556078870557*^9, 3.897556085615953*^9}, {3.897668013211834*^9, 
   3.897668013373135*^9}, {3.897668059476141*^9, 3.897668084854025*^9}, {
   3.8976683841954613`*^9, 3.8976683845501823`*^9}, {3.897668541437504*^9, 
   3.897668546992078*^9}, {3.8976687354144907`*^9, 3.897668735951025*^9}, {
   3.897668905687088*^9, 3.89766890958139*^9}, {3.898074455083661*^9, 
   3.898074551349617*^9}, 3.898074658606371*^9, {3.898074720927762*^9, 
   3.898074776885275*^9}, 3.900508881056334*^9, {3.9024814427540607`*^9, 
   3.9024814519434357`*^9}, {3.905857899772901*^9, 3.905857903788488*^9}, {
   3.9058579704934397`*^9, 3.90585800767901*^9}, 3.907672738407749*^9, {
   3.9082816861893806`*^9, 3.908281690787983*^9}, {3.908281729120899*^9, 
   3.908281781348572*^9}, {3.908281911821432*^9, 3.908281953302647*^9}, {
   3.9082820066032352`*^9, 3.90828207845829*^9}, {3.9082821981280317`*^9, 
   3.90828228909753*^9}, {3.908282421498495*^9, 3.908282434403425*^9}, {
   3.9082825038683233`*^9, 3.908282533278871*^9}, {3.908283073305688*^9, 
   3.908283156936194*^9}, {3.908283281396204*^9, 3.90828328484109*^9}, {
   3.908286216163319*^9, 3.9082862182324467`*^9}, {3.90828625160331*^9, 
   3.908286253013625*^9}, {3.908286337882105*^9, 3.9082863624331627`*^9}, {
   3.908286437103731*^9, 3.908286507355048*^9}, {3.9082866663891077`*^9, 
   3.908286673111751*^9}, {3.908286782717143*^9, 3.908286828331365*^9}, {
   3.9082868664018803`*^9, 3.908286895045343*^9}, {3.908462170876747*^9, 
   3.9084621975349503`*^9}, {3.908462238981485*^9, 3.9084622764667463`*^9}, {
   3.908824857162471*^9, 3.9088248670044413`*^9}, {3.908824924359915*^9, 
   3.908824931238607*^9}, {3.908825528960331*^9, 3.908825541959325*^9}, {
   3.908826096520185*^9, 3.908826161475666*^9}, {3.908826198071656*^9, 
   3.9088261986190434`*^9}, {3.908826228904416*^9, 3.908826235296082*^9}, {
   3.9088268495210953`*^9, 3.908826868169338*^9}, {3.908826903599905*^9, 
   3.908826943049591*^9}, {3.909829759465205*^9, 3.909829769349416*^9}, {
   3.909830292975931*^9, 3.909830307281293*^9}, 3.910432200497737*^9, 
   3.910432368977953*^9, 3.910432404454981*^9, {3.910785528796425*^9, 
   3.9107855349453077`*^9}, {3.910787037934001*^9, 3.910787047696712*^9}, 
   3.915616533847721*^9, 3.915616577063332*^9, {3.915625709957796*^9, 
   3.915625748473772*^9}, {3.9156258330416613`*^9, 3.9156258696418343`*^9}, {
   3.915625942088072*^9, 3.915626045736123*^9}, {3.9156260804032383`*^9, 
   3.91562614771209*^9}, {3.915626255168811*^9, 3.91562628388745*^9}, 
   3.915626324746128*^9, {3.915626360762203*^9, 3.9156263610999823`*^9}, {
   3.915626803722272*^9, 3.9156268412616463`*^9}, {3.9156272100266438`*^9, 
   3.915627239182658*^9}, {3.9156272751474943`*^9, 3.9156273233651257`*^9}, {
   3.91562735721032*^9, 3.915627357825882*^9}, {3.915627598831493*^9, 
   3.9156276207492323`*^9}, {3.915627678561462*^9, 3.915627695564123*^9}, {
   3.915627806624207*^9, 3.915627816311995*^9}, {3.915628084750349*^9, 
   3.9156280917412*^9}, {3.9156282977442913`*^9, 3.9156283190802917`*^9}, {
   3.915628387404181*^9, 3.9156284497106113`*^9}, {3.915628513268024*^9, 
   3.91562852147047*^9}, {3.915629235830986*^9, 3.915629254601261*^9}, {
   3.916863183226318*^9, 3.916863231362734*^9}, {3.916884296739684*^9, 
   3.9168842989581213`*^9}, {3.9168845007642736`*^9, 3.9168845016298423`*^9}, 
   3.922881173886609*^9, {3.9233138521927633`*^9, 3.9233139119534645`*^9}, {
   3.923314027762518*^9, 3.9233140291393394`*^9}, 3.930647333105352*^9, {
   3.93074414020901*^9, 3.930744145827406*^9}, {3.930744243344244*^9, 
   3.930744376653113*^9}, {3.930744568402637*^9, 3.930744590636747*^9}},
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[546]:=",ExpressionUUID->"30eb5cae-c786-45a5-adad-c7ba046306ec"],

Cell[BoxData[
 RowBox[{
  RowBox[{"GridProfile", "[", 
   RowBox[{
   "spins_", ",", "timeStep_", ",", "pulseParameters_", ",", "IrLRatio_", ",",
     "IrH2Ratio_", ",", "ligandExchange_", ",", "hydrideExchange_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"N", "=", "spins"}], ",", 
      RowBox[{"dt", "=", "timeStep"}], ",", "T", ",", "PW", ",", "Bx", ",", 
      "Bz", ",", "\[CapitalDelta]\[CapitalOmega]", ",", "B0", ",", 
      RowBox[{"IrL", "=", "IrLRatio"}], ",", 
      RowBox[{"IrH2", "=", "IrH2Ratio"}], ",", 
      RowBox[{"kN", "=", "ligandExchange"}], ",", 
      RowBox[{"kH", "=", "hydrideExchange"}], ",", "opB", ",", "Hflip", ",", 
      "Nflip", ",", "pulseProfile", ",", "fieldSweep", ",", "SHEATHTraceN", 
      ",", "pulseTraceN", ",", "SHEATHTraceH", ",", "pulseTraceH", ",", 
      "graph1", ",", "graph2", ",", "graph3", ",", "graph4", ",", "graph5", 
      ",", "graph6", ",", "tempHead", ",", "temp1", ",", "temp2", ",", 
      "temp3", ",", "temp4", ",", "temp5", ",", "temp6", ",", "tempfig1", ",",
       "tempfig2", ",", "tempfig3", ",", "tempfig4", ",", "tempfig5", ",", 
      "TempTable", ",", "FinalTable", ",", "output"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"T", "=", 
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{"pulseParameters", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", "dt"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PW", "=", 
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{"pulseParameters", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", "dt"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Bx", "=", 
      RowBox[{"pulseParameters", "[", 
       RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Bz", "=", 
      RowBox[{"pulseParameters", "[", 
       RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"\[CapitalDelta]\[CapitalOmega]", "=", 
      RowBox[{"pulseParameters", "[", 
       RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"B0", "=", 
      RowBox[{"pulseParameters", "[", 
       RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"PrintTemporary", "[", 
      RowBox[{"Framed", "[", 
       RowBox[{"Style", "[", 
        RowBox[{
        "\"\<XY-16 Pulse Sequence Evaluation Module\>\"", ",", "Bold", ",", 
         RowBox[{"FontSize", "->", "25"}]}], "]"}], "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"PrintTemporary", "[", 
      RowBox[{"Style", "[", 
       RowBox[{
        RowBox[{"StringForm", "[", 
         RowBox[{
         "\"\<You are running a (`1`+`2`)Y system.\>\"", ",", "N", ",", 
          RowBox[{"N", "-", "2"}]}], "]"}], ",", "Bold", ",", 
        RowBox[{"FontSize", "->", "20"}]}], "]"}], "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"temp1", "=", 
      RowBox[{
      "PrintTemporary", "[", 
       "\"\<Step 1. Determining the effect of one pulse in your sequence...\>\
\"", "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"Hflip", "=", 
      RowBox[{"AdiabaticGaussian", "[", 
       RowBox[{"PW", ",", "Bx", ",", "Bz", ",", 
        FractionBox["\[CapitalDelta]\[CapitalOmega]", "2"], ",", "dt", ",", 
        "\"\<H Flip Angle\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Nflip", "=", 
      RowBox[{"AdiabaticGaussian", "[", 
       RowBox[{"PW", ",", "Bx", ",", "Bz", ",", 
        FractionBox["\[CapitalDelta]\[CapitalOmega]", "2"], ",", "dt", ",", 
        "\"\<N Flip Angle\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"pulseProfile", "=", 
      RowBox[{"AdiabaticGaussian", "[", 
       RowBox[{"PW", ",", "Bx", ",", "Bz", ",", 
        FractionBox["\[CapitalDelta]\[CapitalOmega]", "2"], ",", "dt", ",", 
        "\"\<Inversion Profile\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"graph4", "=", "pulseProfile"}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"TempTable", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\"\<H Flip Angle after Pulse\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1`\[Degree]\>\"", ",", "Hflip"}], "]"}]}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"\"\<N Flip Angle after Pulse\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1`\[Degree]\>\"", ",", "Nflip"}], "]"}]}], "}"}]}], 
       "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"NotebookDelete", "[", "temp1", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"temp2", "=", 
      RowBox[{"PrintTemporary", "[", 
       RowBox[{"StringForm", "[", 
        RowBox[{
        "\"\<Step 1/6 is done! \\nOne pulse flips\!\(\*SuperscriptBox[\(\\\ \
\), \(1\)]\)H by ~`1`\[Degree] and\!\(\*SuperscriptBox[\(\\\ \), \(15\)]\)N \
by ~`2`\[Degree] \\nStep 2. Locating optimal field for\!\(\*SuperscriptBox[\(\
\\\ \), \(15\)]\)N polarization in SHEATH...\>\"", ",", 
         RowBox[{"Round", "[", 
          RowBox[{"Hflip", ",", "0.01"}], "]"}], ",", 
         RowBox[{"Round", "[", 
          RowBox[{"Nflip", ",", "0.01"}], "]"}]}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tempfig1", "=", 
      RowBox[{"PrintTemporary", "[", 
       RowBox[{"GraphicsGrid", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "graph4", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Grid", "[", 
            RowBox[{
             RowBox[{"TempTable", "\[Transpose]"}], ",", 
             RowBox[{"Frame", "->", "All"}]}], "]"}], "}"}]}], "}"}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"OP", "=", 
      RowBox[{"OperatorNF", "[", 
       RowBox[{"N", ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "z"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"OPfree", "=", 
      RowBox[{"OperatorNF", "[", 
       RowBox[{
        RowBox[{"N", "-", "2"}], ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "z"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"fieldSweep", "=", 
      RowBox[{"ParallelTable", "[", 
       RowBox[{
        RowBox[{"Last", "@", 
         RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"U1", "[", 
             RowBox[{"B", ",", "0", ",", "0", ",", "1"}], "]"}], "}"}], ",", 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "isomer", " ", 
             RowBox[{"1", " ", "[", 
              RowBox[{"Bz", ",", "Bx", ",", "By", ",", "dt"}], "]"}]}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"U2", "[", 
             RowBox[{"B", ",", "0", ",", "0", ",", "1"}], "]"}], "}"}], ",", 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"UF", "[", 
             RowBox[{"B", ",", "0", ",", "0", ",", "1"}], "]"}], "}"}], ",", 
           RowBox[{"(*", 
            RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
            "*)"}], "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
           RowBox[{"(*", 
            RowBox[{
            "initial", " ", "conditions", " ", "for", " ", "bound", " ", 
             "and", " ", "free", " ", "species"}], "*)"}], ",", 
           "\[IndentingNewLine]", "kN", 
           RowBox[{"(*", 
            RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",",
            "kH", 
           RowBox[{"(*", 
            RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
           "\[IndentingNewLine]", "IrL", 
           RowBox[{"(*", 
            FractionBox[
             RowBox[{"[", "Ir", "]"}], 
             RowBox[{"[", "L", "]"}]], "*)"}], ",", "IrH2", 
           RowBox[{"(*", 
            RowBox[{
             FractionBox[
              RowBox[{"[", "Ir", "]"}], 
              RowBox[{"[", "H2", "]"}]], ",", " ", 
             RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            FractionBox["20000", "1"], "}"}], 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
             ",", " ", 
             RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
           RowBox[{"{", "1", "}"}], 
           RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", "1"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"B", ",", 
          RowBox[{"-", "5"}], ",", "5", ",", "0.1"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"graph1", "=", 
      RowBox[{"TracePlot", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{
             RowBox[{"-", "5"}], ",", "5", ",", "0.1"}], "]"}], ",", 
           "fieldSweep"}], "}"}], "\[Transpose]"}], ",", "Blue", ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<\!\(\*SubscriptBox[\(B\), \(0\)]\) (\[Micro]T)\>\"", ",", 
          "\"\<Polarization @ 20 s (%)\>\""}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "5"}], ",", "5"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"opB", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Range", "[", 
         RowBox[{
          RowBox[{"-", "5"}], ",", "5", ",", "0.1"}], "]"}], ")"}], "[", 
       RowBox[{"[", 
        RowBox[{"FindMax", "[", "fieldSweep", "]"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"TempTable", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "\"\<Optimal \!\(\*SubscriptBox[\(B\), \(0\)]\) in SHEATH\>\"", ",", 
          
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` \[Micro]T\>\"", ",", "opB"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<H Flip Angle after Pulse\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1`\[Degree]\>\"", ",", "Hflip"}], "]"}]}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"\"\<N Flip Angle after Pulse\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1`\[Degree]\>\"", ",", "Nflip"}], "]"}]}], "}"}]}], 
       "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"NotebookDelete", "[", "temp2", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"NotebookDelete", "[", "tempfig1", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"temp3", "=", 
      RowBox[{"PrintTemporary", "[", 
       RowBox[{"StringForm", "[", 
        RowBox[{
        "\"\<Step 2/6 is done! \\nThe optimal field was `1` \[Micro]T. \
\\nStep 3. Simulating a 60-second SHEATH experiment on\!\(\*SuperscriptBox[\(\
\\\ \), \(15\)]\)N...\>\"", ",", "opB"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"tempfig2", "=", 
      RowBox[{"PrintTemporary", "[", 
       RowBox[{"GraphicsGrid", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "graph1", "}"}], ",", 
          RowBox[{"{", "graph4", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Grid", "[", 
            RowBox[{
             RowBox[{"TempTable", "\[Transpose]"}], ",", 
             RowBox[{"Frame", "->", "All"}]}], "]"}], "}"}]}], "}"}], "]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"SHEATHTraceN", "=", 
      RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"U1", "[", 
          RowBox[{"opB", ",", "0", ",", "0", ",", "1"}], "]"}], "}"}], ",", 
        RowBox[{"(*", 
         RowBox[{"propagators", " ", "for", " ", "isomer", " ", 
          RowBox[{"1", " ", "[", 
           RowBox[{"Bz", ",", "Bx", ",", "By", ",", "dt"}], "]"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"U2", "[", 
          RowBox[{"opB", ",", "0", ",", "0", ",", "1"}], "]"}], "}"}], ",", 
        RowBox[{"(*", 
         RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], "*)"}],
         "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"UF", "[", 
          RowBox[{"opB", ",", "0", ",", "0", ",", "1"}], "]"}], "}"}], ",", 
        RowBox[{"(*", 
         RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
         "*)"}], "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
        RowBox[{"(*", 
         RowBox[{
         "initial", " ", "conditions", " ", "for", " ", "bound", " ", "and", 
          " ", "free", " ", "species"}], "*)"}], ",", "\[IndentingNewLine]", 
        "kN", 
        RowBox[{"(*", 
         RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",", 
        "kH", 
        RowBox[{"(*", 
         RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
        "\[IndentingNewLine]", "IrL", 
        RowBox[{"(*", 
         FractionBox[
          RowBox[{"[", "Ir", "]"}], 
          RowBox[{"[", "L", "]"}]], "*)"}], ",", "IrH2", 
        RowBox[{"(*", 
         RowBox[{
          FractionBox[
           RowBox[{"[", "Ir", "]"}], 
           RowBox[{"[", "H2", "]"}]], ",", " ", 
          RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         FractionBox["60000", "1"], "}"}], 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], ",",
           " ", 
          RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
        RowBox[{"{", "1", "}"}], 
        RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", "1"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"graph2", "=", 
      RowBox[{"TracePlot", "[", 
       RowBox[{"SHEATHTraceN", ",", "Blue", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<Time (s)\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<Polarization @ `1` \[Micro]T (%)\>\"", ",", "opB"}], 
           "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0.001", ",", "60"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"TempTable", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "\"\<Optimal \!\(\*SubscriptBox[\(B\), \(0\)]\) in SHEATH\>\"", ",", 
          
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` \[Micro]T\>\"", ",", "opB"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<H Flip Angle after Pulse\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1`\[Degree]\>\"", ",", "Hflip"}], "]"}]}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"\"\<N Flip Angle after Pulse\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1`\[Degree]\>\"", ",", "Nflip"}], "]"}]}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<SHEATH\!\(\*SuperscriptBox[\(\\\ \), \(15\)]\)N Pol @ 60s\>\"", 
          ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` %\>\"", ",", 
            RowBox[{"Last", "@", "SHEATHTraceN"}]}], "]"}]}], "}"}]}], 
       "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"NotebookDelete", "[", "temp3", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"NotebookDelete", "[", "tempfig2", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"temp4", "=", 
      RowBox[{"PrintTemporary", "[", 
       RowBox[{"StringForm", "[", 
        RowBox[{
        "\"\<Step 3/6 is done! \\nThe final\!\(\*SuperscriptBox[\(\\\ \), \
\(15\)]\)N polarization after SHEATH was `1` %. \\nStep 4. \
Computing\!\(\*SuperscriptBox[\(\\\ \\\ \), \(15\)]\)N polarization buildup \
while applying XY-16 pulse sequence...\>\"", ",", 
         RowBox[{"Round", "[", 
          RowBox[{
           RowBox[{"Last", "@", "SHEATHTraceN"}], ",", "0.01"}], "]"}]}], 
        "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"tempfig3", "=", 
      RowBox[{"PrintTemporary", "[", 
       RowBox[{"GraphicsGrid", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"graph1", ",", " ", "graph2"}], "}"}], ",", 
          RowBox[{"{", "graph4", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Grid", "[", 
             RowBox[{
              RowBox[{"TempTable", "\[Transpose]"}], ",", 
              RowBox[{"Frame", "->", "All"}]}], "]"}], ",", "SpanFromLeft"}], 
           "}"}]}], "}"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"pulseTraceN", "=", 
      RowBox[{"SpecificXY16ShapeMagic", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "T", ",", "PW", ",", "Bx", ",", "Bx", ",", "Bz", ",", 
          "\[CapitalDelta]\[CapitalOmega]", ",", "B0"}], "}"}], ",", "dt", 
        ",", "\"\<FullPolTrace\>\"", ",", 
        RowBox[{"{", 
         RowBox[{"IrL", ",", "IrH2", ",", "kN", ",", "kH"}], "}"}]}], "]"}]}],
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"graph3", "=", 
      RowBox[{"TracePlot", "[", 
       RowBox[{"pulseTraceN", ",", "Blue", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<Time (s)\>\"", ",", "\"\<Polarization\>\""}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"0.001", ",", "60"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"TempTable", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "\"\<Optimal \!\(\*SubscriptBox[\(B\), \(0\)]\) in SHEATH\>\"", ",", 
          
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` \[Micro]T\>\"", ",", "opB"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<H Flip Angle after Pulse\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1`\[Degree]\>\"", ",", "Hflip"}], "]"}]}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"\"\<N Flip Angle after Pulse\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1`\[Degree]\>\"", ",", "Nflip"}], "]"}]}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<SHEATH\!\(\*SuperscriptBox[\(\\\ \), \(15\)]\)N Pol @ 60s\>\"", 
          ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` %\>\"", ",", 
            RowBox[{"Last", "@", "SHEATHTraceN"}]}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<XY-16\!\(\*SuperscriptBox[\(\\\ \), \(15\)]\)N Pol\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` %\>\"", ",", 
            RowBox[{"Mean", "[", 
             RowBox[{"pulseTraceN", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"-", "10"}], ";;"}], "]"}], "]"}], "]"}]}], "]"}]}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<Growth of\!\(\*SuperscriptBox[\(\\\ \), \(15\)]\)N Pol\>\"", 
          ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` x\>\"", ",", 
            RowBox[{"Abs", "[", 
             FractionBox[
              RowBox[{"Mean", "[", 
               RowBox[{"pulseTraceN", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"-", "10"}], ";;"}], "]"}], "]"}], "]"}], 
              RowBox[{"Last", "@", "SHEATHTraceN"}]], "]"}]}], "]"}]}], 
         "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     
     RowBox[{"NotebookDelete", "[", "temp4", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"NotebookDelete", "[", "tempfig3", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"temp5", "=", 
      RowBox[{"PrintTemporary", "[", 
       RowBox[{"StringForm", "[", 
        RowBox[{
        "\"\<Step 4/6 is done! \\nThe final\!\(\*SuperscriptBox[\(\\\ \), \
\(15\)]\)N polarization after pulsing was `1` %. \\nStep 5. Measuring \
auxiliary\!\(\*SuperscriptBox[\(\\\ \), \(1\)]\)H polarization during SHEATH \
experiment...\>\"", ",", 
         RowBox[{"Round", "[", 
          RowBox[{
           RowBox[{"Mean", "[", 
            RowBox[{"pulseTraceN", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"-", "10"}], ";;"}], "]"}], "]"}], "]"}], ",", 
           "0.01"}], "]"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"tempfig4", "=", 
      RowBox[{"PrintTemporary", "[", 
       RowBox[{"GraphicsGrid", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"graph1", ",", " ", "graph2", ",", "graph3"}], "}"}], ",", 
          
          RowBox[{"{", "graph4", "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Grid", "[", 
             RowBox[{
              RowBox[{"TempTable", "\[Transpose]"}], ",", 
              RowBox[{"Frame", "->", "All"}]}], "]"}], ",", "SpanFromLeft", 
            ",", "SpanFromLeft"}], "}"}]}], "}"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"OP", "=", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"OperatorNF", "[", 
         RowBox[{"N", ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "z"}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", 
          RowBox[{"Range", "[", 
           RowBox[{"4", ",", "N"}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"OPfree", "=", 
      RowBox[{"Sum", "[", 
       RowBox[{
        RowBox[{"OperatorNF", "[", 
         RowBox[{
          RowBox[{"N", "-", "2"}], ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "z"}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"k", ",", 
          RowBox[{"Range", "[", 
           RowBox[{"2", ",", 
            RowBox[{"N", "-", "2"}]}], "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"SHEATHTraceH", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"N", "-", "3"}], ")"}], "*", 
       RowBox[{"DMExFR2DualHv", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"U1", "[", 
           RowBox[{"opB", ",", "0", ",", "0", ",", "1"}], "]"}], "}"}], ",", 
         RowBox[{"(*", 
          RowBox[{"propagators", " ", "for", " ", "isomer", " ", 
           RowBox[{"1", " ", "[", 
            RowBox[{"Bz", ",", "Bx", ",", "By", ",", "dt"}], "]"}]}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"U2", "[", 
           RowBox[{"opB", ",", "0", ",", "0", ",", "1"}], "]"}], "}"}], ",", 
         RowBox[{"(*", 
          RowBox[{"propagators", " ", "for", " ", "isomer", " ", "2"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"UF", "[", 
           RowBox[{"opB", ",", "0", ",", "0", ",", "1"}], "]"}], "}"}], ",", 
         RowBox[{"(*", 
          RowBox[{"propagators", " ", "for", " ", "free", " ", "species"}], 
          "*)"}], "\[IndentingNewLine]", "\[Rho]0", ",", "\[Rho]F0", 
         RowBox[{"(*", 
          RowBox[{
          "initial", " ", "conditions", " ", "for", " ", "bound", " ", "and", 
           " ", "free", " ", "species"}], "*)"}], ",", "\[IndentingNewLine]", 
         "kN", 
         RowBox[{"(*", 
          RowBox[{"target", " ", "dissociation", " ", "rate"}], "*)"}], ",", 
         "kH", 
         RowBox[{"(*", 
          RowBox[{"pH2", " ", "association", " ", "rate"}], "*)"}], ",", 
         "\[IndentingNewLine]", "IrL", 
         RowBox[{"(*", 
          FractionBox[
           RowBox[{"[", "Ir", "]"}], 
           RowBox[{"[", "L", "]"}]], "*)"}], ",", "IrH2", 
         RowBox[{"(*", 
          RowBox[{
           FractionBox[
            RowBox[{"[", "Ir", "]"}], 
            RowBox[{"[", "H2", "]"}]], ",", " ", 
           RowBox[{"flowing", " ", "continuously"}]}], "*)"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          FractionBox["60000", "1"], "}"}], 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"number", " ", "of", " ", "simulation", " ", "steps"}], 
           ",", " ", 
           RowBox[{"T", "/", "\[CapitalDelta]t"}]}], "*)"}], ",", 
         RowBox[{"{", "1", "}"}], 
         RowBox[{"(*", "\[CapitalDelta]t", "*)"}], ",", "1"}], "]"}]}]}], ";",
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"graph5", "=", 
      RowBox[{"TracePlot", "[", 
       RowBox[{"SHEATHTraceH", ",", "Red", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<Time (s)\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<Polarization @ `1` \[Micro]T (%)\>\"", ",", "opB"}], 
           "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0.001", ",", "60"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"TempTable", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "\"\<Optimal \!\(\*SubscriptBox[\(B\), \(0\)]\) in SHEATH\>\"", ",", 
          
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` \[Micro]T\>\"", ",", "opB"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<H Flip Angle after Pulse\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1`\[Degree]\>\"", ",", "Hflip"}], "]"}]}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"\"\<N Flip Angle after Pulse\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1`\[Degree]\>\"", ",", "Nflip"}], "]"}]}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<SHEATH\!\(\*SuperscriptBox[\(\\\ \), \(15\)]\)N Pol @ 60s\>\"", 
          ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` %\>\"", ",", 
            RowBox[{"Last", "@", "SHEATHTraceN"}]}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<XY-16\!\(\*SuperscriptBox[\(\\\ \), \(15\)]\)N Pol\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` %\>\"", ",", 
            RowBox[{"Mean", "[", 
             RowBox[{"pulseTraceN", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"-", "10"}], ";;"}], "]"}], "]"}], "]"}]}], "]"}]}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<Growth of\!\(\*SuperscriptBox[\(\\\ \), \(15\)]\)N Pol\>\"", 
          ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` x\>\"", ",", 
            RowBox[{"Abs", "[", 
             FractionBox[
              RowBox[{"Mean", "[", 
               RowBox[{"pulseTraceN", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"-", "10"}], ";;"}], "]"}], "]"}], "]"}], 
              RowBox[{"Last", "@", "SHEATHTraceN"}]], "]"}]}], "]"}]}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<SHEATH\!\(\*SuperscriptBox[\(\\\ \), \(1\)]\)H Pol @ 60s\>\"", 
          ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` %\>\"", ",", 
            RowBox[{"Last", "@", "SHEATHTraceH"}]}], "]"}]}], "}"}]}], 
       "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"NotebookDelete", "[", "temp5", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"NotebookDelete", "[", "tempfig4", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"temp6", "=", 
      RowBox[{"PrintTemporary", "[", 
       RowBox[{"StringForm", "[", 
        RowBox[{
        "\"\<Step 5/6 is done! \\nThe final\!\(\*SuperscriptBox[\(\\\ \), \(1\
\)]\)H polarization after SHEATH was `1` %. \\nStep 6. Calculating \
auxiliary\!\(\*SuperscriptBox[\(\\\ \), \(1\)]\)H polarization while applying \
XY-16 pulse sequence...\>\"", ",", 
         RowBox[{"Round", "[", 
          RowBox[{
           RowBox[{"Last", "@", "SHEATHTraceH"}], ",", "0.01"}], "]"}]}], 
        "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"tempfig5", "=", 
      RowBox[{"PrintTemporary", "[", 
       RowBox[{"GraphicsGrid", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"graph1", ",", " ", "graph2", ",", "graph3"}], "}"}], ",", 
          
          RowBox[{"{", 
           RowBox[{"graph4", ",", "graph5"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Grid", "[", 
             RowBox[{
              RowBox[{"TempTable", "\[Transpose]"}], ",", 
              RowBox[{"Frame", "->", "All"}]}], "]"}], ",", "SpanFromLeft", 
            ",", "SpanFromLeft"}], "}"}]}], "}"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"pulseTraceH", "=", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"N", "-", "3"}], ")"}], "*", 
       RowBox[{"SpecificXY16ShapeMagic", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
          "T", ",", "PW", ",", "Bx", ",", "Bx", ",", "Bz", ",", 
           "\[CapitalDelta]\[CapitalOmega]", ",", "B0"}], "}"}], ",", "dt", 
         ",", "\"\<FullPolTrace\>\"", ",", 
         RowBox[{"{", 
          RowBox[{"IrL", ",", "IrH2", ",", "kN", ",", "kH"}], "}"}]}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"graph6", "=", 
      RowBox[{"TracePlot", "[", 
       RowBox[{"pulseTraceH", ",", "Red", ",", 
        RowBox[{"{", 
         RowBox[{"\"\<Time (s)\>\"", ",", "\"\<Polarization\>\""}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"0.001", ",", "60"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"NotebookDelete", "[", "temp6", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"NotebookDelete", "[", "tempfig5", "]"}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"FinalTable", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "\"\<Optimal \!\(\*SubscriptBox[\(B\), \(0\)]\) in SHEATH\>\"", ",", 
          
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` \[Micro]T\>\"", ",", "opB"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"\"\<H Flip Angle after Pulse\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1`\[Degree]\>\"", ",", "Hflip"}], "]"}]}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{"\"\<N Flip Angle after Pulse\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1`\[Degree]\>\"", ",", "Nflip"}], "]"}]}], "}"}], 
        ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<SHEATH\!\(\*SuperscriptBox[\(\\\ \), \(15\)]\)N Pol @ 60s\>\"", 
          ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` %\>\"", ",", 
            RowBox[{"Last", "@", "SHEATHTraceN"}]}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<XY-16\!\(\*SuperscriptBox[\(\\\ \), \(15\)]\)N Pol\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` %\>\"", ",", 
            RowBox[{"Mean", "[", 
             RowBox[{"pulseTraceN", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"-", "10"}], ";;"}], "]"}], "]"}], "]"}]}], "]"}]}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<Growth of\!\(\*SuperscriptBox[\(\\\ \), \(15\)]\)N Pol\>\"", 
          ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` x\>\"", ",", 
            RowBox[{"Abs", "[", 
             FractionBox[
              RowBox[{"Mean", "[", 
               RowBox[{"pulseTraceN", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"-", "10"}], ";;"}], "]"}], "]"}], "]"}], 
              RowBox[{"Last", "@", "SHEATHTraceN"}]], "]"}]}], "]"}]}], "}"}],
         ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<SHEATH\!\(\*SuperscriptBox[\(\\\ \), \(1\)]\)H Pol @ 60s\>\"", 
          ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` %\>\"", ",", 
            RowBox[{"Last", "@", "SHEATHTraceH"}]}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<XY-16\!\(\*SuperscriptBox[\(\\\ \), \(1\)]\)H Pol (%)\>\"", ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<`1` %\>\"", ",", 
            RowBox[{"Max", "[", 
             RowBox[{"pulseTraceN", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"-", "10"}], ";;"}], "]"}], "]"}], "]"}]}], "]"}]}], 
         "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
         "\"\<Suppression of\!\(\*SuperscriptBox[\(\\\ \), \(1\)]\)H Pol\>\"",
           ",", 
          RowBox[{"StringForm", "[", 
           RowBox[{"\"\<> `1` %\>\"", ",", 
            RowBox[{"100", "*", 
             RowBox[{"(", 
              RowBox[{"1", "-", 
               RowBox[{"Abs", "[", 
                FractionBox[
                 RowBox[{"Max", "[", 
                  RowBox[{"pulseTraceN", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"-", "10"}], ";;"}], "]"}], "]"}], "]"}], 
                 RowBox[{"Last", "@", "SHEATHTraceH"}]], "]"}]}], ")"}]}]}], 
           "]"}]}], "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"output", "=", 
      RowBox[{"GraphicsGrid", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"graph1", ",", "graph2", ",", "graph3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"graph4", ",", "graph5", ",", "graph6"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Grid", "[", 
            RowBox[{
             RowBox[{"FinalTable", "\[Transpose]"}], ",", 
             RowBox[{"Frame", "->", "All"}]}], "]"}], ",", "SpanFromLeft", 
           ",", "SpanFromLeft"}], "}"}]}], "}"}], "]"}]}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{
  3.900580855345851*^9, 3.900582405436839*^9, {3.900582525691217*^9, 
   3.900582599221718*^9}, {3.900582633822196*^9, 3.900582673806778*^9}, {
   3.9005827331666803`*^9, 3.900582992797325*^9}, {3.900583255699739*^9, 
   3.900583298846998*^9}, {3.900583373038166*^9, 3.900583417275872*^9}, {
   3.900583629416684*^9, 3.900583723080104*^9}, {3.900584054440856*^9, 
   3.900584135010436*^9}, {3.9005841667314987`*^9, 3.900584195743218*^9}, {
   3.900584238841755*^9, 3.9005842624719543`*^9}, {3.9005842971598063`*^9, 
   3.9005845943531027`*^9}, {3.900584639639245*^9, 3.900584681553575*^9}, {
   3.900584721549426*^9, 3.900584725925117*^9}, {3.900584795703372*^9, 
   3.900585088590146*^9}, {3.900660221200687*^9, 3.900660290503244*^9}, {
   3.900670952442913*^9, 3.90067096436651*^9}, {3.902563938030075*^9, 
   3.9025639777787437`*^9}, {3.902564031092112*^9, 3.902564066060812*^9}, 
   3.9025641649957733`*^9, {3.903019295296772*^9, 3.90301929710882*^9}, {
   3.903019377036001*^9, 3.9030194030692472`*^9}, {3.9030201484922132`*^9, 
   3.90302016251243*^9}, {3.9030202564894*^9, 3.903020296965027*^9}, 
   3.903022244302541*^9, 3.9046475433272142`*^9, {3.9046478410396423`*^9, 
   3.9046478480720053`*^9}, {3.904648057196312*^9, 3.90464805868918*^9}, {
   3.904648366849901*^9, 3.904648368348587*^9}, {3.904648444895329*^9, 
   3.9046484817750587`*^9}, 3.904649747582617*^9, {3.904649794442531*^9, 
   3.904649849534974*^9}, {3.9046499307597713`*^9, 3.904649938003138*^9}, {
   3.904650076167879*^9, 3.904650088837571*^9}, {3.904650176147087*^9, 
   3.904650218774405*^9}, {3.9046509408538923`*^9, 3.904651052906501*^9}, {
   3.90465112730208*^9, 3.904651149043313*^9}, {3.904651368771426*^9, 
   3.904651422684654*^9}, {3.904651455231081*^9, 3.904651456024313*^9}, {
   3.904651500065998*^9, 3.904651521203361*^9}, {3.904651603100375*^9, 
   3.904651830293479*^9}, {3.904651893432475*^9, 3.904651894263661*^9}, {
   3.904651932357397*^9, 3.904651986347093*^9}, {3.9046520542382317`*^9, 
   3.904652071454166*^9}, {3.904652158052786*^9, 3.904652239208932*^9}, {
   3.904652277374984*^9, 3.904652285332891*^9}, {3.904652343684256*^9, 
   3.9046524069554358`*^9}, {3.904652440517556*^9, 3.904652519713702*^9}, {
   3.904652552543211*^9, 3.9046526352173767`*^9}, {3.904652684939281*^9, 
   3.904652854823515*^9}, {3.904652889265086*^9, 3.904653059791809*^9}, {
   3.9046533029343567`*^9, 3.904653309267363*^9}, {3.904653451803244*^9, 
   3.9046534609163094`*^9}, {3.904653663587493*^9, 3.904653685570816*^9}, {
   3.9046537769445744`*^9, 3.9046537938675127`*^9}, {3.9046538319546137`*^9, 
   3.904653841136348*^9}, {3.904825340182719*^9, 3.904825381511484*^9}, {
   3.904825420086461*^9, 3.9048254230474167`*^9}, {3.904825513730876*^9, 
   3.904825546124176*^9}, 3.904825623299837*^9, {3.904825830332336*^9, 
   3.904825830510722*^9}, {3.904825919890212*^9, 3.904825920140286*^9}, {
   3.904826237754408*^9, 3.904826237977922*^9}, 3.904830471276381*^9, {
   3.904831405045595*^9, 3.9048314102476597`*^9}, {3.9049027475874033`*^9, 
   3.90490278165556*^9}, {3.9052650582806892`*^9, 3.9052650615424557`*^9}, {
   3.9052651017302113`*^9, 3.905265158431285*^9}, {3.905265212948326*^9, 
   3.905265216035543*^9}, {3.9066409121269054`*^9, 3.906641001786029*^9}, {
   3.906641053054123*^9, 3.9066410737867427`*^9}, {3.9066423917817945`*^9, 
   3.906642399419865*^9}, {3.90664302250134*^9, 3.906643024123335*^9}, 
   3.9076735534852324`*^9, {3.908283193766592*^9, 3.908283227684514*^9}, {
   3.908283315626425*^9, 3.908283352816839*^9}, {3.908283549289136*^9, 
   3.9082836123199577`*^9}, {3.908283657203041*^9, 3.9082836930404787`*^9}, {
   3.908283782810361*^9, 3.9082838161418324`*^9}, {3.908285776915271*^9, 
   3.908285820465694*^9}, {3.908285959924933*^9, 3.90828601033962*^9}, {
   3.908286259079455*^9, 3.908286271689782*^9}, {3.908824840631631*^9, 
   3.908824853502262*^9}, {3.908825586094879*^9, 3.908825657227935*^9}, {
   3.9088256917835007`*^9, 3.9088257330106773`*^9}, {3.908825787711007*^9, 
   3.908825868364313*^9}, {3.908825987433092*^9, 3.9088259876369753`*^9}, {
   3.90882605949216*^9, 3.908826085248372*^9}, {3.9088262066672373`*^9, 
   3.90882620829137*^9}, {3.908826248824243*^9, 3.908826411121233*^9}, {
   3.908826460358778*^9, 3.908826574500527*^9}, {3.908826608314764*^9, 
   3.9088267221022253`*^9}, {3.908826752375697*^9, 3.908826836874978*^9}, {
   3.908886655754126*^9, 3.9088866840987577`*^9}, {3.9088867179080267`*^9, 
   3.9088867374678087`*^9}, {3.90888832528603*^9, 3.908888353958733*^9}, 
   3.908888489332487*^9, {3.9094460657674637`*^9, 3.909446085619667*^9}, 
   3.909447082877486*^9, {3.909447131001505*^9, 3.9094471963272657`*^9}, {
   3.9094472328839083`*^9, 3.9094472902870407`*^9}, {3.9097406751080933`*^9, 
   3.9097407114898376`*^9}, {3.909740813787829*^9, 3.909741024610445*^9}, {
   3.90974111144377*^9, 3.909741117775856*^9}, {3.909741995972208*^9, 
   3.909741999160046*^9}, 3.90974286824157*^9, {3.909825942945733*^9, 
   3.9098259731256037`*^9}, {3.90982600985121*^9, 3.909826010494049*^9}, {
   3.93064856406057*^9, 3.9306485653514767`*^9}, {3.930655363082726*^9, 
   3.930655435371353*^9}, {3.9307384923127813`*^9, 3.9307384928484077`*^9}, {
   3.9307386506350803`*^9, 3.9307386541372232`*^9}, {3.930741575546279*^9, 
   3.930741619097093*^9}, {3.9307418239019403`*^9, 3.930742001965764*^9}, {
   3.930742463849763*^9, 3.930742467894651*^9}, {3.930742567175737*^9, 
   3.930742621070118*^9}, {3.930742661160253*^9, 3.930742734226362*^9}, {
   3.93074352407869*^9, 3.930743577379629*^9}, {3.930743653488571*^9, 
   3.930743654017915*^9}, {3.930743695049823*^9, 3.930743791899556*^9}, {
   3.93074385190397*^9, 3.930743978837237*^9}, {3.930744098870344*^9, 
   3.930744099587475*^9}, {3.930744630315422*^9, 3.930744630448978*^9}, {
   3.9307447298911943`*^9, 3.930744748433537*^9}, {3.9307448013005466`*^9, 
   3.930744939043048*^9}, {3.9307449738283157`*^9, 3.930744974061678*^9}, {
   3.9307450200523853`*^9, 3.9307450470285378`*^9}, {3.9307450817200127`*^9, 
   3.930745122807479*^9}, {3.9307451595964746`*^9, 3.930745246323248*^9}, {
   3.930745301215376*^9, 3.930745338464963*^9}, {3.9307453800620317`*^9, 
   3.9307454120045967`*^9}, {3.930745477486351*^9, 3.9307457660141077`*^9}, {
   3.9307463837092123`*^9, 3.9307464496143913`*^9}, {3.9307465045561943`*^9, 
   3.9307466947566853`*^9}, {3.930746728653227*^9, 3.930746754689782*^9}, {
   3.930746801190508*^9, 3.93074687198076*^9}, {3.930746939938676*^9, 
   3.930747048708191*^9}, {3.930747095697888*^9, 3.930747123593659*^9}, {
   3.930747249792959*^9, 3.930747335726975*^9}, {3.9307473879984217`*^9, 
   3.9307476728736973`*^9}, {3.930747718947801*^9, 3.930747896831105*^9}, {
   3.930748107129072*^9, 3.9307481080895653`*^9}, {3.930748140107483*^9, 
   3.930748142511125*^9}, {3.9307481849124823`*^9, 3.930748279121172*^9}, {
   3.9307483186061687`*^9, 3.930748706711849*^9}, {3.93074873769324*^9, 
   3.930748748843123*^9}, {3.930749107511695*^9, 3.930749573107873*^9}, {
   3.930749745808675*^9, 3.930749842971839*^9}, {3.930749903948934*^9, 
   3.930750072423715*^9}, {3.9307501040829687`*^9, 3.9307503826831217`*^9}, {
   3.9307504222281218`*^9, 3.930750492150586*^9}, {3.930750584572101*^9, 
   3.930750611091423*^9}, {3.930750677594294*^9, 3.9307506813797073`*^9}, {
   3.930750800018134*^9, 3.930750942551075*^9}, {3.930751075623458*^9, 
   3.93075107955873*^9}, {3.930751781427211*^9, 3.930751787882078*^9}, {
   3.930751856099049*^9, 3.9307518810902977`*^9}, {3.9307519136192408`*^9, 
   3.930752041033832*^9}, {3.9307520735212812`*^9, 3.930752075565619*^9}, {
   3.930752283850914*^9, 3.930752366276854*^9}, {3.930752401992201*^9, 
   3.93075240633309*^9}, {3.9307525005899887`*^9, 3.9307525039135237`*^9}, {
   3.9307525828949966`*^9, 3.930752584903536*^9}, {3.930752754443993*^9, 
   3.930752806706581*^9}, {3.930752896589679*^9, 3.93075292641327*^9}, {
   3.93075338204909*^9, 3.930753394456254*^9}, {3.9307534465437*^9, 
   3.930753450333108*^9}, {3.930753481135796*^9, 3.93075361885704*^9}, 
   3.9307551919378*^9, {3.930755260659398*^9, 3.930755269849132*^9}, 
   3.930755320551208*^9, {3.930755496864484*^9, 3.930755539440695*^9}, 
   3.930756132382369*^9},
 Background->RGBColor[1, 0.925, 0.925],
 CellLabel->
  "In[547]:=",ExpressionUUID->"1991b57c-edfb-45a8-8cfa-bec71af81f26"],

Cell[BoxData[
 RowBox[{
  RowBox[{"UploadDataToCSV", "[", 
   RowBox[{"data_", ",", "filename_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"file", " ", "=", " ", "filename"}], ",", "origin", ",", "hold",
       ",", "output"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"origin", "=", 
      RowBox[{"Import", "[", "file", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"i", " ", "=", " ", "1"}], ",", 
       RowBox[{"i", "<=", 
        RowBox[{"Length", "[", "data", "]"}]}], ",", 
       RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"AppendTo", "[", 
         RowBox[{"origin", ",", 
          RowBox[{"data", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Export", "[", 
      RowBox[{"file", ",", "origin"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"output", " ", "=", " ", "\"\<Uploaded data to CSV.\>\""}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.},
 CellChangeTimes->{3.9414776717357683`*^9},
 CellLabel->
  "In[548]:=",ExpressionUUID->"3c98e503-a649-4457-a026-ff42e8e458e1"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[StyleBox["RogueSpin Core (written by Jake and Shannon)",
 FontSize->24]], "Chapter",
 CellGroupingRules->{"GroupTogetherGrouping", 10001.},
 CellChangeTimes->{{3.900505957185018*^9, 3.900505958128427*^9}, {
   3.90050600145219*^9, 3.90050601023938*^9}, {3.900506063993947*^9, 
   3.9005061439162292`*^9}, {3.900506338058025*^9, 3.900506361365775*^9}, {
   3.9005063940817842`*^9, 3.9005064016838217`*^9}, {3.900506584322693*^9, 
   3.900506586883003*^9}, {3.900506647712081*^9, 3.90050664929247*^9}, 
   3.900506925627102*^9, 3.900507239786083*^9, 3.900507416031003*^9, {
   3.9005086642168493`*^9, 3.9005086775861397`*^9}, 3.900508769576762*^9, {
   3.900518932540235*^9, 3.900518934922679*^9}},
 FontSize->24,
 FontWeight->"Regular",
 FontColor->GrayLevel[0],
 Background->RGBColor[
  0.88, 1, 0.88],ExpressionUUID->"62c3735b-9c17-4e25-839a-e3bf29ee491d"],

Cell[BoxData[{
 RowBox[{GridBox[{
    {
     RowBox[{
      RowBox[{"KetNames", "[", 
       RowBox[{"list1_", ",", "list2_"}], "]"}], ":=", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"StringJoin", "[", 
          RowBox[{
           RowBox[{
           "list1", "\[LeftDoubleBracket]", "m", "\[RightDoubleBracket]"}], 
           " ", ",", 
           RowBox[{
           "list2", "\[LeftDoubleBracket]", "n", "\[RightDoubleBracket]"}]}], 
          "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "1", ",", 
           RowBox[{"Length", "[", "list1", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "1", ",", 
           RowBox[{"Length", "[", "list2", "]"}]}], "}"}]}], "]"}], "]"}]}]}
   },
   DefaultBaseStyle->"Column",
   GridBoxAlignment->{"Columns" -> {{Left}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"A_", "\[CircleTimes]", "B_"}], ":=", 
    RowBox[{"KroneckerProduct", "[", 
     RowBox[{"A", ",", "B"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Gamma]H", "=", "42.57747892"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Gamma]C", "=", "10.7084"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Gamma]N", "=", 
   RowBox[{"-", "4.316000"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Gamma]P", "=", "17.235"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Gamma]F", "=", "40.042"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Gamma]Xe", "=", 
    RowBox[{"\[Minus]", "11.777"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"BoltzmannP", "[", 
     RowBox[{"\[Omega]_", ",", "T_"}], "]"}], ":=", 
    RowBox[{"Tanh", "[", 
     FractionBox["\[Omega]", 
      RowBox[{"2.0836612", "*", 
       SuperscriptBox["10", "10"], "*", "T"}]], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ones", "[", "n_", "]"}], ":=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"1", ",", 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox["2", "n"], ",", 
       SuperscriptBox["2", "n"]}], "}"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Pij", "=", 
    RowBox[{"(", GridBox[{
       {"1", "0", "0", "0"},
       {"0", "0", "1", "0"},
       {"0", "1", "0", "0"},
       {"0", "0", "0", "1"}
      }], ")"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GeneratePermutation", "[", 
    RowBox[{"spins_", ",", "start_", ",", "position_"}], "]"}], ":=", 
   RowBox[{"Dot", "@@", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"SparseArray", "[", 
        RowBox[{"IdentityMatrix", "[", 
         SuperscriptBox["2", 
          RowBox[{"start", "-", "2", "-", "n"}]], "]"}], "]"}], 
       "\[CircleTimes]", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"SparseArray", "[", "Pij", "]"}], "\[CircleTimes]", 
         RowBox[{"SparseArray", "[", 
          RowBox[{"IdentityMatrix", "[", 
           SuperscriptBox["2", 
            RowBox[{"n", "+", 
             RowBox[{"(", 
              RowBox[{"spins", "-", "start"}], ")"}]}]], "]"}], "]"}]}], 
        ")"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"n", ",", "0", ",", 
        RowBox[{"spins", "-", "1", "-", "position", "-", 
         RowBox[{"(", 
          RowBox[{"spins", "-", "start"}], ")"}]}]}], "}"}]}], "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MoveSpins", "[", 
    RowBox[{"n_", ",", "posO_", ",", "posF_"}], "]"}], ":=", 
   RowBox[{"Dot", "@@", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"GeneratePermutation", "[", 
       RowBox[{"n", ",", 
        RowBox[{"posO", "[", 
         RowBox[{"[", "i", "]"}], "]"}], ",", 
        RowBox[{"posF", "[", 
         RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1", ",", 
        RowBox[{"Length", "@", "posO"}]}], "}"}]}], "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MoveSpinsF", "[", 
    RowBox[{"n_", ",", "posO_"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Length", "@", "posO"}], "\[NotEqual]", "1"}], ",", 
     RowBox[{"Dot", "@@", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"GeneratePermutation", "[", 
         RowBox[{"n", ",", 
          RowBox[{"posO", "[", 
           RowBox[{"[", "i", "]"}], "]"}], ",", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"1", ",", 
             RowBox[{"Length", "@", "posO"}]}], "]"}], "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "@", "posO"}]}], "}"}]}], "]"}]}], ",", 
     RowBox[{"GeneratePermutation", "[", 
      RowBox[{"n", ",", 
       RowBox[{"posO", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", "1"}], "]"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dCoupling", "[", 
    RowBox[{"n1_", ",", "n2_", ",", "r_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"n1", "*", "1*^6"}], ")"}], "1"], 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"n2", "*", "1*^6"}], ")"}], "1"], "*", 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"2", "\[Pi]", " ", "1.0546*^-34"}], ")"}], "1"]}], ")"}], 
      "/", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"r", "*", "1*^-10"}], ")"}], "3"]}], ")"}], "1*^-7"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"\[Rho]Singlet", "=", 
    RowBox[{"SparseArray", "[", 
     RowBox[{"(", GridBox[{
        {"0", "0", "0", "0"},
        {"0", "0.5", 
         RowBox[{"-", "0.5"}], "0"},
        {"0", 
         RowBox[{"-", "0.5"}], "0.5", "0"},
        {"0", "0", "0", "0"}
       }], ")"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RMSD", "[", 
    RowBox[{"true_", ",", "test_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"100", "/", 
      SuperscriptBox[
       RowBox[{"Total", "[", 
        SuperscriptBox[
         RowBox[{"(", "true", ")"}], "2"], "]"}], 
       RowBox[{"1", "/", "2"}]]}], ")"}], 
    SuperscriptBox[
     RowBox[{"Total", "[", 
      SuperscriptBox[
       RowBox[{"(", 
        RowBox[{"true", "-", "test"}], ")"}], "2"], "]"}], 
     RowBox[{"1", "/", "2"}]]}]}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"OperatorN", "[", "specs_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "base", ",", "replace", ",", "operator", ",", "length", ",", "q"}], 
      "}"}], ",", 
     RowBox[{
      RowBox[{"length", "=", 
       FractionBox[
        RowBox[{"Length", "[", "specs", "]"}], "2"]}], ";", 
      RowBox[{"base", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"u", ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "1", ",", "length"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"replace", "=", 
       RowBox[{
        RowBox[{"ReplacePart", "[", 
         RowBox[{"base", ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
             "specs", "\[LeftDoubleBracket]", "n", "\[RightDoubleBracket]"}], 
             "\[Rule]", 
             RowBox[{"specs", "\[LeftDoubleBracket]", 
              RowBox[{"n", "+", "1"}], "\[RightDoubleBracket]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "1", ",", 
              RowBox[{
               RowBox[{"Length", "[", "specs", "]"}], "-", "1"}], ",", "2"}], 
             "}"}]}], "]"}]}], "]"}], "/.", "\[VeryThinSpace]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"z", "\[Rule]", 
           RowBox[{"SparseArray", "[", 
            RowBox[{"0.5`", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], "]"}]}], ",", 
          RowBox[{"x", "\[Rule]", 
           RowBox[{"SparseArray", "[", 
            RowBox[{"0.5`", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "1"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "0"}], "}"}]}], "}"}]}], "]"}]}], ",", 
          RowBox[{"y", "\[Rule]", 
           RowBox[{"SparseArray", "[", 
            RowBox[{"0.5`", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"-", "\[ImaginaryI]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"\[ImaginaryI]", ",", "0"}], "}"}]}], "}"}]}], 
            "]"}]}], ",", 
          RowBox[{"p", "\[Rule]", 
           RowBox[{"SparseArray", "[", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "1"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}]}], "}"}], "]"}]}], ",", 
          RowBox[{"m", "\[Rule]", 
           RowBox[{"SparseArray", "[", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], ",", 
          RowBox[{"u", "\[Rule]", 
           RowBox[{"SparseArray", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"1.`", ",", "0.`"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0.`", ",", "1.`"}], "}"}]}], "}"}], "]"}]}], ",", 
          RowBox[{"zo", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], ",", 
          RowBox[{"xo", "\[Rule]", 
           RowBox[{
            FractionBox["1", "2"], " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", 
                SqrtBox["2"], ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                SqrtBox["2"], ",", "0", ",", 
                SqrtBox["2"]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                SqrtBox["2"], ",", "0"}], "}"}]}], "}"}]}]}], ",", 
          RowBox[{"yo", "\[Rule]", 
           RowBox[{
            FractionBox["1", "2"], " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"-", "\[ImaginaryI]"}], " ", 
                 SqrtBox["2"]}], ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"\[ImaginaryI]", " ", 
                 SqrtBox["2"]}], ",", "0", ",", 
                RowBox[{
                 RowBox[{"-", "\[ImaginaryI]"}], " ", 
                 SqrtBox["2"]}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"\[ImaginaryI]", " ", 
                 SqrtBox["2"]}], ",", "0"}], "}"}]}], "}"}]}]}], ",", 
          RowBox[{"uo", "\[Rule]", 
           RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ",", 
          RowBox[{"zth", "\[Rule]", 
           RowBox[{
            FractionBox["1", "2"], " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"3", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0", ",", "3"}], "}"}]}], 
             "}"}]}]}], ",", 
          RowBox[{"xth", "\[Rule]", 
           RowBox[{
            FractionBox["1", "2"], " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", 
                SqrtBox["3"], ",", "0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                SqrtBox["3"], ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "2", ",", "0", ",", 
                SqrtBox["3"]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", 
                SqrtBox["3"], ",", "0"}], "}"}]}], "}"}]}]}], ",", 
          RowBox[{"yth", "\[Rule]", 
           RowBox[{
            FractionBox["1", "2"], " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"-", "\[ImaginaryI]"}], " ", 
                 SqrtBox["3"]}], ",", "0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"\[ImaginaryI]", " ", 
                 SqrtBox["3"]}], ",", "0", ",", 
                RowBox[{
                 RowBox[{"-", "\[ImaginaryI]"}], " ", "2"}], ",", "0"}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"\[ImaginaryI]", " ", "2"}], ",", "0", ",", 
                RowBox[{
                 RowBox[{"-", "\[ImaginaryI]"}], " ", 
                 SqrtBox["3"]}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", 
                RowBox[{"\[ImaginaryI]", " ", 
                 SqrtBox["3"]}], ",", "0"}], "}"}]}], "}"}]}]}], ",", 
          RowBox[{"uth", "\[Rule]", 
           RowBox[{"IdentityMatrix", "[", "4", "]"}]}]}], "}"}]}]}], ";", 
      RowBox[{"operator", "=", 
       RowBox[{"KroneckerProduct", "[", 
        RowBox[{"Sequence", "@@", "replace"}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"OperatorNF", "[", 
    RowBox[{"length_", ",", "specs_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"base", ",", "replace", ",", "operator", ",", "q"}], "}"}], ",", 
     RowBox[{
      RowBox[{"base", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"u", ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "1", ",", "length"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"replace", "=", 
       RowBox[{
        RowBox[{"ReplacePart", "[", 
         RowBox[{"base", ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
             "specs", "\[LeftDoubleBracket]", "n", "\[RightDoubleBracket]"}], 
             "\[Rule]", 
             RowBox[{"specs", "\[LeftDoubleBracket]", 
              RowBox[{"n", "+", "1"}], "\[RightDoubleBracket]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "1", ",", 
              RowBox[{
               RowBox[{"Length", "[", "specs", "]"}], "-", "1"}], ",", "2"}], 
             "}"}]}], "]"}]}], "]"}], "/.", "\[VeryThinSpace]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"z", "\[Rule]", 
           RowBox[{"SparseArray", "[", 
            RowBox[{"0.5`", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"1", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], "]"}]}], ",", 
          RowBox[{"x", "\[Rule]", 
           RowBox[{"SparseArray", "[", 
            RowBox[{"0.5`", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "1"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "0"}], "}"}]}], "}"}]}], "]"}]}], ",", 
          RowBox[{"y", "\[Rule]", 
           RowBox[{"SparseArray", "[", 
            RowBox[{"0.5`", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"-", "\[ImaginaryI]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"\[ImaginaryI]", ",", "0"}], "}"}]}], "}"}]}], 
            "]"}]}], ",", 
          RowBox[{"p", "\[Rule]", 
           RowBox[{"SparseArray", "[", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "1"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}]}], "}"}], "]"}]}], ",", 
          RowBox[{"m", "\[Rule]", 
           RowBox[{"SparseArray", "[", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "0"}], "}"}]}], "}"}], "]"}]}], ",", 
          RowBox[{"u", "\[Rule]", 
           RowBox[{"SparseArray", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"1.`", ",", "0.`"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0.`", ",", "1.`"}], "}"}]}], "}"}], "]"}]}], ",", 
          RowBox[{"zo", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], ",", 
          RowBox[{"xo", "\[Rule]", 
           RowBox[{
            FractionBox["1", "2"], " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", 
                SqrtBox["2"], ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                SqrtBox["2"], ",", "0", ",", 
                SqrtBox["2"]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                SqrtBox["2"], ",", "0"}], "}"}]}], "}"}]}]}], ",", 
          RowBox[{"yo", "\[Rule]", 
           RowBox[{
            FractionBox["1", "2"], " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"-", "\[ImaginaryI]"}], " ", 
                 SqrtBox["2"]}], ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"\[ImaginaryI]", " ", 
                 SqrtBox["2"]}], ",", "0", ",", 
                RowBox[{
                 RowBox[{"-", "\[ImaginaryI]"}], " ", 
                 SqrtBox["2"]}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"\[ImaginaryI]", " ", 
                 SqrtBox["2"]}], ",", "0"}], "}"}]}], "}"}]}]}], ",", 
          RowBox[{"uo", "\[Rule]", 
           RowBox[{"IdentityMatrix", "[", "3", "]"}]}], ",", 
          RowBox[{"zth", "\[Rule]", 
           RowBox[{
            FractionBox["1", "2"], " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"3", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0", ",", "3"}], "}"}]}], 
             "}"}]}]}], ",", 
          RowBox[{"xth", "\[Rule]", 
           RowBox[{
            FractionBox["1", "2"], " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", 
                SqrtBox["3"], ",", "0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                SqrtBox["3"], ",", "0", ",", "2", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "2", ",", "0", ",", 
                SqrtBox["3"]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", 
                SqrtBox["3"], ",", "0"}], "}"}]}], "}"}]}]}], ",", 
          RowBox[{"yth", "\[Rule]", 
           RowBox[{
            FractionBox["1", "2"], " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{
                 RowBox[{"-", "\[ImaginaryI]"}], " ", 
                 SqrtBox["3"]}], ",", "0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"\[ImaginaryI]", " ", 
                 SqrtBox["3"]}], ",", "0", ",", 
                RowBox[{
                 RowBox[{"-", "\[ImaginaryI]"}], " ", "2"}], ",", "0"}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", 
                RowBox[{"\[ImaginaryI]", " ", "2"}], ",", "0", ",", 
                RowBox[{
                 RowBox[{"-", "\[ImaginaryI]"}], " ", 
                 SqrtBox["3"]}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", 
                RowBox[{"\[ImaginaryI]", " ", 
                 SqrtBox["3"]}], ",", "0"}], "}"}]}], "}"}]}]}], ",", 
          RowBox[{"uth", "\[Rule]", 
           RowBox[{"IdentityMatrix", "[", "4", "]"}]}]}], "}"}]}]}], ";", 
      RowBox[{"operator", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"length", "\[NotEqual]", "1"}], ",", 
         RowBox[{"KroneckerProduct", "[", 
          RowBox[{"Sequence", "@@", "replace"}], "]"}], ",", 
         RowBox[{
         "replace", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
        "]"}]}]}]}], "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 

 RowBox[{
  RowBox[{
   RowBox[{"ZeemanN", "[", 
    RowBox[{"spins_", ",", "Nvals_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"all", ",", "specs", ",", "output"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"all", "=", 
       RowBox[{"Riffle", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{"m", ",", 
           RowBox[{"{", 
            RowBox[{"m", ",", "1", ",", 
             RowBox[{"Length", "[", "spins", "]"}]}], "}"}]}], "]"}], ",", 
         "spins"}], "]"}]}], ";", 
      RowBox[{"specs", "=", 
       RowBox[{"spins", "/.", "\[VeryThinSpace]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"h", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"z", ",", "u"}], "}"}]}], ",", 
          RowBox[{"o", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"zo", ",", "uo"}], "}"}]}], ",", 
          RowBox[{"th", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"zth", ",", "uth"}], "}"}]}]}], "}"}]}]}], ";", 
      RowBox[{"output", "=", 
       RowBox[{"Chop", "[", 
        RowBox[{"Total", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Nvals", "[", 
             RowBox[{"[", "m", "]"}], "]"}], "*", 
            RowBox[{"OperatorN", "[", 
             RowBox[{
              RowBox[{"ReplacePart", "[", 
               RowBox[{"all", ",", 
                RowBox[{
                 RowBox[{"2", " ", "m"}], "\[Rule]", 
                 RowBox[{
                  RowBox[{
                  "specs", "\[LeftDoubleBracket]", "m", 
                   "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}]}]}], "]"}], "/.", 
              "\[VeryThinSpace]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"h", "\[Rule]", "u"}], ",", 
                RowBox[{"o", "\[Rule]", "uo"}], ",", 
                RowBox[{"th", "\[Rule]", "uth"}]}], "}"}]}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"m", ",", "1", ",", 
             RowBox[{"Length", "[", "spins", "]"}]}], "}"}]}], "]"}], "]"}], 
        "]"}]}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"ScalarCouplingStrongN", "[", 
    RowBox[{"coupling_", ",", "spins_", ",", "Jval_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "terms", ",", "specs", ",", "zterms", ",", "yterms", ",", "xterms", ",",
        "extras", ",", "fluff", ",", "temp", ",", "zjoined", ",", "xjoined", 
       ",", "yjoined", ",", "output"}], "}"}], ",", 
     RowBox[{
      RowBox[{"terms", "=", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"Map", "[", 
         RowBox[{"Sort", ",", 
          RowBox[{"Permutations", "[", 
           RowBox[{"coupling", ",", 
            RowBox[{"{", "2", "}"}]}], "]"}], ",", 
          RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
      RowBox[{"specs", "=", 
       RowBox[{"spins", "/.", "\[VeryThinSpace]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"h", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"z", ",", "y", ",", "x", ",", "u"}], "}"}]}], ",", 
          RowBox[{"o", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"zo", ",", "yo", ",", "xo", ",", "uo"}], "}"}]}], ",", 
          RowBox[{"th", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"zth", ",", "yth", ",", "xth", ",", "uth"}], "}"}]}]}], 
         "}"}]}]}], ";", 
      RowBox[{"zterms", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Riffle", "[", 
          RowBox[{
           RowBox[{
           "terms", "\[LeftDoubleBracket]", "m", "\[RightDoubleBracket]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"specs", "\[LeftDoubleBracket]", 
               RowBox[{
                RowBox[{
                "terms", "\[LeftDoubleBracket]", "m", 
                 "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "1", 
                "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
             RowBox[{
              RowBox[{"specs", "\[LeftDoubleBracket]", 
               RowBox[{
                RowBox[{
                "terms", "\[LeftDoubleBracket]", "m", 
                 "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], 
              "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
            "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "1", ",", 
           RowBox[{"Length", "[", "terms", "]"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"yterms", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Riffle", "[", 
          RowBox[{
           RowBox[{
           "terms", "\[LeftDoubleBracket]", "m", "\[RightDoubleBracket]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"specs", "\[LeftDoubleBracket]", 
               RowBox[{
                RowBox[{
                "terms", "\[LeftDoubleBracket]", "m", 
                 "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "1", 
                "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
             RowBox[{
              RowBox[{"specs", "\[LeftDoubleBracket]", 
               RowBox[{
                RowBox[{
                "terms", "\[LeftDoubleBracket]", "m", 
                 "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], 
              "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
            "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "1", ",", 
           RowBox[{"Length", "[", "terms", "]"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"xterms", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Riffle", "[", 
          RowBox[{
           RowBox[{
           "terms", "\[LeftDoubleBracket]", "m", "\[RightDoubleBracket]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"specs", "\[LeftDoubleBracket]", 
               RowBox[{
                RowBox[{
                "terms", "\[LeftDoubleBracket]", "m", 
                 "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "1", 
                "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], 
              "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], ",", 
             RowBox[{
              RowBox[{"specs", "\[LeftDoubleBracket]", 
               RowBox[{
                RowBox[{
                "terms", "\[LeftDoubleBracket]", "m", 
                 "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}], "\[RightDoubleBracket]"}], 
              "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
            "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "1", ",", 
           RowBox[{"Length", "[", "terms", "]"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"temp", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"extras", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"MemberQ", "[", 
                  RowBox[{
                   RowBox[{
                   "zterms", "\[LeftDoubleBracket]", "n", 
                    "\[RightDoubleBracket]"}], ",", "m"}], "]"}], "\[Equal]", 
                 "False"}], ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"Append", "[", 
                  RowBox[{"temp", ",", "m"}], "]"}], "]"}], ",", "None"}], 
               "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"m", ",", "1", ",", 
                RowBox[{"Length", "[", "spins", "]"}]}], "}"}]}], "]"}], ",", 
            "None"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "1", ",", 
           RowBox[{"Length", "[", "terms", "]"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"fluff", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Riffle", "[", 
          RowBox[{
           RowBox[{
           "extras", "\[LeftDoubleBracket]", "n", "\[RightDoubleBracket]"}], 
           ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
              "specs", "\[LeftDoubleBracket]", "m", "\[RightDoubleBracket]"}],
               "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], ",", 
             RowBox[{"{", 
              RowBox[{"m", ",", 
               RowBox[{
               "extras", "\[LeftDoubleBracket]", "n", 
                "\[RightDoubleBracket]"}]}], "}"}]}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "1", ",", 
           RowBox[{"Length", "[", "terms", "]"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"zjoined", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{
           "zterms", "\[LeftDoubleBracket]", "m", "\[RightDoubleBracket]"}], 
           ",", 
           RowBox[{
           "fluff", "\[LeftDoubleBracket]", "m", "\[RightDoubleBracket]"}]}], 
          "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "1", ",", 
           RowBox[{"Length", "[", "zterms", "]"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"yjoined", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{
           "yterms", "\[LeftDoubleBracket]", "m", "\[RightDoubleBracket]"}], 
           ",", 
           RowBox[{
           "fluff", "\[LeftDoubleBracket]", "m", "\[RightDoubleBracket]"}]}], 
          "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "1", ",", 
           RowBox[{"Length", "[", "yterms", "]"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"xjoined", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{
           "xterms", "\[LeftDoubleBracket]", "m", "\[RightDoubleBracket]"}], 
           ",", 
           RowBox[{
           "fluff", "\[LeftDoubleBracket]", "m", "\[RightDoubleBracket]"}]}], 
          "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "1", ",", 
           RowBox[{"Length", "[", "xterms", "]"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"output", "=", 
       RowBox[{"Chop", "[", 
        RowBox[{"Total", "@", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Jval", "[", 
             RowBox[{"[", "m", "]"}], "]"}], "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"OperatorN", "[", 
               RowBox[{
               "zjoined", "\[LeftDoubleBracket]", "m", 
                "\[RightDoubleBracket]"}], "]"}], "+", 
              RowBox[{"OperatorN", "[", 
               RowBox[{
               "yjoined", "\[LeftDoubleBracket]", "m", 
                "\[RightDoubleBracket]"}], "]"}], "+", 
              RowBox[{"OperatorN", "[", 
               RowBox[{
               "xjoined", "\[LeftDoubleBracket]", "m", 
                "\[RightDoubleBracket]"}], "]"}]}], ")"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"m", ",", "1", ",", 
             RowBox[{"Length", "[", "zjoined", "]"}]}], "}"}]}], "]"}]}], 
        "]"}]}]}]}], "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 

 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ScalarCouplingWeakN", "[", 
     RowBox[{"coupling_", ",", "spins_", ",", "Jval_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "terms", ",", "specs", ",", "zterms", ",", "yterms", ",", "xterms", 
        ",", "temp", ",", "extras", ",", "fluff", ",", "zjoined", ",", 
        "xjoined", ",", "yjoined", ",", "output"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"terms", "=", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Map", "[", 
          RowBox[{"Sort", ",", 
           RowBox[{"Permutations", "[", 
            RowBox[{"coupling", ",", 
             RowBox[{"{", "2", "}"}]}], "]"}], ",", 
           RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"specs", "=", 
        RowBox[{"spins", "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"h", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"z", ",", "y", ",", "x", ",", "u"}], "}"}]}], ",", 
           RowBox[{"o", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"zo", ",", "yo", ",", "xo", ",", "uo"}], "}"}]}], ",", 
           RowBox[{"th", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"zth", ",", "yth", ",", "xth", ",", "uth"}], "}"}]}]}], 
          "}"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"zterms", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Riffle", "[", 
           RowBox[{
            RowBox[{"terms", "[", 
             RowBox[{"[", "m", "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"specs", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"terms", "[", 
                   RowBox[{"[", "m", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"specs", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"terms", "[", 
                   RowBox[{"[", "m", "]"}], "]"}], "[", 
                  RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"m", ",", "1", ",", 
            RowBox[{"Length", "[", "terms", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"temp", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"extras", "=", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"DeleteCases", "[", 
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"MemberQ", "[", 
                   RowBox[{
                    RowBox[{"zterms", "[", 
                    RowBox[{"[", "n", "]"}], "]"}], ",", "m"}], "]"}], 
                  "\[Equal]", "False"}], ",", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"Append", "[", 
                   RowBox[{"temp", ",", "m"}], "]"}], "]"}], ",", "None"}], 
                "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"m", ",", "1", ",", 
                 RowBox[{"Length", "[", "spins", "]"}]}], "}"}]}], "]"}], ",",
              "None"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "1", ",", 
            RowBox[{"Length", "[", "terms", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fluff", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Riffle", "[", 
           RowBox[{
            RowBox[{"extras", "[", 
             RowBox[{"[", "n", "]"}], "]"}], ",", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"specs", "[", 
                RowBox[{"[", "m", "]"}], "]"}], "[", 
               RowBox[{"[", "4", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"m", ",", 
                RowBox[{"extras", "[", 
                 RowBox[{"[", "n", "]"}], "]"}]}], "}"}]}], "]"}]}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "1", ",", 
            RowBox[{"Length", "[", "terms", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"zjoined", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"zterms", "[", 
             RowBox[{"[", "m", "]"}], "]"}], ",", 
            RowBox[{"fluff", "[", 
             RowBox[{"[", "m", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"m", ",", "1", ",", 
            RowBox[{"Length", "[", "zterms", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"output", "=", "\[IndentingNewLine]", 
        RowBox[{"Chop", "[", 
         RowBox[{"Total", "[", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"Jval", "[", 
              RowBox[{"[", "m", "]"}], "]"}], "*", 
             RowBox[{"(", 
              RowBox[{"OperatorN", "[", 
               RowBox[{"zjoined", "[", 
                RowBox[{"[", "m", "]"}], "]"}], "]"}], ")"}]}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "1", ",", 
              RowBox[{"Length", "[", "zjoined", "]"}]}], "}"}]}], "]"}], 
          "]"}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"JCouplingStrongN", "[", 
    RowBox[{"list_", ",", "JvalList_", ",", "spins_"}], "]"}], ":=", 
   RowBox[{"Total", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"ScalarCouplingStrongN", "[", 
       RowBox[{
        RowBox[{
        "list", "\[LeftDoubleBracket]", "n", "\[RightDoubleBracket]"}], ",", 
        "spins", ",", 
        RowBox[{"JvalList", "[", 
         RowBox[{"[", "n", "]"}], "]"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"n", ",", "1", ",", 
        RowBox[{"Length", "[", "list", "]"}]}], "}"}]}], "]"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"JCouplingWeakN", "[", 
    RowBox[{"list_", ",", "JvalList_", ",", "spins_"}], "]"}], ":=", 
   RowBox[{"Total", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"ScalarCouplingWeakN", "[", 
       RowBox[{
        RowBox[{
        "list", "\[LeftDoubleBracket]", "n", "\[RightDoubleBracket]"}], ",", 
        "spins", ",", 
        RowBox[{"JvalList", "[", 
         RowBox[{"[", "n", "]"}], "]"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"n", ",", "1", ",", 
        RowBox[{"Length", "[", "list", "]"}]}], "}"}]}], "]"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"moleculeDipolarOps", "[", "n_", "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"#", "\[ConjugateTranspose]"}], ",", "#"}], "}"}], "&"}], "/@", 
    RowBox[{"(", 
     RowBox[{"Join", "@@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"dipolarOps", "[", 
          RowBox[{"n", ",", "#"}], "]"}], "&"}], "/@", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Sort", "/@", 
          RowBox[{"Permutations", "[", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"1", ",", "n"}], "]"}], ",", 
            RowBox[{"{", "2", "}"}]}], "]"}]}], "]"}]}], ")"}]}], ")"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DipolarCoupling", "[", 
   RowBox[{"spins_", ",", "coupling_", ",", "Dval_"}], "]"}], ":=", 
  RowBox[{"Dval", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"OperatorNF", "[", 
      RowBox[{"spins", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"coupling", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", "z", ",", 
         RowBox[{"coupling", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", "z"}], "}"}]}], "]"}], "-", 
     RowBox[{
      FractionBox["1", "4"], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"OperatorNF", "[", 
         RowBox[{"spins", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"coupling", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "p", ",", 
            RowBox[{"coupling", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "m"}], "}"}]}], "]"}], "+", 
        
        RowBox[{"OperatorNF", "[", 
         RowBox[{"spins", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"coupling", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "m", ",", 
            RowBox[{"coupling", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", "p"}], "}"}]}], "]"}]}], 
       ")"}]}]}], ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DipolarCouplingN", "[", 
    RowBox[{"spins_", ",", "couplings_", ",", "Dvals_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "terms", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"terms", "=", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"Sort", "/@", 
         RowBox[{"Permutations", "[", 
          RowBox[{"couplings", ",", 
           RowBox[{"{", "2", "}"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Total", "@", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"DipolarCoupling", "[", 
          RowBox[{"spins", ",", 
           RowBox[{"terms", "[", 
            RowBox[{"[", "n", "]"}], "]"}], ",", 
           RowBox[{"Dvals", "[", 
            RowBox[{"[", "n", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "1", ",", 
           RowBox[{"Length", "@", "Dvals"}]}], "}"}]}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SubspaceID", "[", "input_", "]"}], ":=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{"DeleteCases", "[", "None", "]"}], ",", 
      RowBox[{
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"input", "[", 
              RowBox[{"[", "m", "]"}], "]"}], "[", 
             RowBox[{"[", "n", "]"}], "]"}], "===", "0"}], ",", "None", ",", 
           "n"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "1", ",", 
           RowBox[{"Length", "[", "input", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "1", ",", 
           RowBox[{"Length", "[", "input", "]"}]}], "}"}]}], "]"}], 
       "\[Transpose]"}], ",", "1"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SubspaceExtract", "[", "subspace_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"output", ",", "subReduce"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"subReduce", "[", "list_", "]"}], ":=", 
        RowBox[{"Sort", "[", 
         RowBox[{"DeleteDuplicates", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{"subspace", "[", 
            RowBox[{"[", "list", "]"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"output", "=", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"NestWhile", "[", 
            RowBox[{"subReduce", ",", 
             RowBox[{"subspace", "[", 
              RowBox[{"[", "n", "]"}], "]"}], ",", "UnsameQ", ",", "2"}], 
            "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"DeleteDuplicates", "[", 
               RowBox[{"Flatten", "[", "subspace", "]"}], "]"}], "]"}]}], 
            "}"}]}], "]"}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"NSubspaceID", "[", "input_", "]"}], ":=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{"DeleteCases", "[", "None", "]"}], ",", 
      RowBox[{
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"input", "[", 
              RowBox[{"[", "m", "]"}], "]"}], "[", 
             RowBox[{"[", "n", "]"}], "]"}], "===", "0.0"}], ",", "None", ",",
            "n"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "1", ",", 
           RowBox[{"Length", "[", "input", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "1", ",", 
           RowBox[{"Length", "[", "input", "]"}]}], "}"}]}], "]"}], 
       "\[Transpose]"}], ",", "1"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SubspaceExtractN", "[", "subspace_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"output", ",", "subReduce"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"subReduce", "[", "list_", "]"}], ":=", 
        RowBox[{"Sort", "[", 
         RowBox[{"DeleteDuplicates", "[", 
          RowBox[{"Flatten", "[", 
           RowBox[{"subspace", "[", 
            RowBox[{"[", "list", "]"}], "]"}], "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"output", "=", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"NestWhile", "[", 
            RowBox[{"subReduce", ",", 
             RowBox[{"subspace", "[", 
              RowBox[{"[", "n", "]"}], "]"}], ",", "UnsameQ", ",", "2"}], 
            "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"n", ",", "1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"DeleteDuplicates", "[", 
               RowBox[{"Flatten", "[", "subspace", "]"}], "]"}], "]"}]}], 
            "}"}]}], "]"}], "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ViewSubspaces", "[", 
     RowBox[{"H_", ",", "names_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "output", ",", "stemp", ",", "subspaces", ",", "manifoldrules", ",", 
        "manifoldnames"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"stemp", "=", 
        RowBox[{"SubspaceID", "[", "H", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"subspaces", "=", 
        RowBox[{"SubspaceExtract", "[", "stemp", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"manifoldrules", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", "subspaces", "]"}], "[", 
            RowBox[{"[", "m", "]"}], "]"}], "\[Rule]", 
           RowBox[{"names", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{"Flatten", "[", "subspaces", "]"}], "[", 
              RowBox[{"[", "m", "]"}], "]"}], "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"m", ",", "1", ",", 
            RowBox[{"Length", "[", "H", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"manifoldnames", "=", 
        RowBox[{"subspaces", "/.", "manifoldrules"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"output", "=", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"FullSimplify", "[", 
            RowBox[{"TableForm", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"H", "[", 
                  RowBox[{"[", "m", "]"}], "]"}], "[", 
                 RowBox[{"[", "n", "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"m", ",", 
                  RowBox[{"subspaces", "[", 
                   RowBox[{"[", "j", "]"}], "]"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"n", ",", 
                  RowBox[{"subspaces", "[", 
                   RowBox[{"[", "j", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
              RowBox[{"TableHeadings", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"manifoldnames", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], ",", 
                 RowBox[{"manifoldnames", "[", 
                  RowBox[{"[", "j", "]"}], "]"}]}], "}"}]}]}], "]"}], "]"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"Length", "[", "subspaces", "]"}]}], "}"}]}], "]"}], "//",
          "TableForm"}]}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Diagonalize", "[", "matrix_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"u", ",", "Dmatrix"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"u", "=", 
        RowBox[{"Transpose", "[", 
         RowBox[{"Eigenvectors", "[", "matrix", "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Dmatrix", "=", 
        RowBox[{
         RowBox[{"Inverse", "[", "u", "]"}], ".", "matrix", ".", "u"}]}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Commute", "[", 
     RowBox[{"A_", ",", "B_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"A", ".", "B"}], " ", "-", " ", 
     RowBox[{"B", ".", "A"}]}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"DMExFR2Block", "[", 
    RowBox[{
    "U_", ",", "Ufree_", ",", "\[Rho]0_", ",", "\[Rho]free0_", ",", "kdN_", 
     ",", "kaH_", ",", "conc_", ",", "tf_", ",", "loops_", ",", "subs_", ",", 
     "subsfree_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Rho]", ",", "\[Rho]free", ",", "magnetizationbound", ",", 
       "magnetizationfree", ",", "state", ",", "output", ",", "i", ",", "ri", 
       ",", "Ul", ",", "Ulfree", ",", "tl", ",", "tlfree", ",", "j", ",", 
       "loopmag", ",", "k", ",", "l", ",", "\[Rho]last", ",", "boundlast", 
       ",", "tflist", ",", "tffree", ",", "m", ",", "\[Rho]lastfree", ",", 
       "boundlastfree", ",", "modkdN", ",", "modkaH", ",", "\[Rho]freetemp", 
       ",", "\[Rho]Traced", ",", "\[Rho]Tracedfree"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Calculates", " ", "the", " ", "loops", " ", "for", " ", "the", " ", 
       "simulation"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ul", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"U", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Ulfree", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"Ufree", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"tl", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"tf", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Storage", " ", "buckets"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"state", "=", "\[Rho]0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Rho]free", "=", "\[Rho]free0"}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"magnetizationbound", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"magnetizationfree", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"loopmag", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"{", "}"}], "}"}], ",", "loops"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Rho]last", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"boundlast", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"modkdN", "=", 
       RowBox[{"kdN", " ", 
        RowBox[{"Exp", "[", 
         RowBox[{"-", 
          FractionBox["kdN", "2000"]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"modkaH", "=", 
       RowBox[{"kaH", " ", 
        RowBox[{"Exp", "[", 
         RowBox[{"-", 
          FractionBox["kaH", "2000"]}], "]"}]}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Performs", " ", "the", " ", "propagation", " ", "through", " ", "the",
         " ", "loops"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "\[LessEqual]", 
         RowBox[{"Length", "[", "tl", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Does", " ", "dissipative", " ", "exchange", " ", "through", " ", 
          "loop"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"i", "=", "1"}], ";", 
            RowBox[{"\[Rho]", "=", "state"}]}], ",", 
           RowBox[{"i", "\[LessEqual]", 
            RowBox[{"tl", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}], ",", 
           RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\[Rho]", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"DensityStepFast", "[", 
                RowBox[{
                 RowBox[{"Normal", "[", 
                  RowBox[{
                   RowBox[{"Ul", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "[", 
                   RowBox[{"[", "k", "]"}], "]"}], "]"}], ",", 
                 RowBox[{"Normal", "[", 
                  RowBox[{"\[Rho]", "[", 
                   RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", 
                 RowBox[{"Length", "@", 
                  RowBox[{"(", 
                   RowBox[{"Ul", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ")"}]}]}], "}"}]}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"DensityStepFast", "[", 
                RowBox[{
                 RowBox[{"Normal", "[", 
                  RowBox[{
                   RowBox[{"Ulfree", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "[", 
                   RowBox[{"[", "k", "]"}], "]"}], "]"}], ",", 
                 RowBox[{"Normal", "[", 
                  RowBox[{"\[Rho]free", "[", 
                   RowBox[{"[", "k", "]"}], "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", 
                 RowBox[{"Length", "@", 
                  RowBox[{"(", 
                   RowBox[{"Ulfree", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ")"}]}]}], "}"}]}], 
              "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]", "=", 
             RowBox[{
              RowBox[{"ReconstructM", "[", "\[Rho]", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"subs", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", 
                RowBox[{"subs", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]Traced", "=", 
             RowBox[{"\[Rho]Tr", "[", "\[Rho]", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{
              RowBox[{"ReconstructM", "[", "\[Rho]free", "]"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"subsfree", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], ",", 
                RowBox[{"subsfree", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]freetemp", "=", "\[Rho]free"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{"\[Rho]free", "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"modkdN", "*", "conc"}], ")"}], "/", "1000"}], 
                 ")"}], 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"MixDensityFree", "[", "\[Rho]Traced", "]"}], "-", 
                  "\[Rho]free"}], ")"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1", "-", 
                   RowBox[{"modkdN", "/", "1000"}]}], ")"}], "\[Rho]"}], "+", 
                
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"modkdN", "/", "1000"}], ")"}], 
                 RowBox[{"MixDensityRebind", "[", 
                  RowBox[{"\[Rho]Traced", ",", "\[Rho]freetemp", ",", 
                   RowBox[{"modkaH", "/", "modkdN"}]}], "]"}]}]}], ")"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"RelaxFree", "[", "\[Rho]free", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]", "=", 
             RowBox[{"RelaxBound", "[", 
              RowBox[{"\[Rho]", ",", "\[Rho]Traced"}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"\[Rho]", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"subs", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "n", "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"subs", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "n", "]"}], "]"}]}], "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "1", ",", 
                 RowBox[{"Length", "@", 
                  RowBox[{"(", 
                   RowBox[{"subs", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ")"}]}]}], "}"}]}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"\[Rho]free", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"subsfree", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "n", "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"subsfree", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "n", "]"}], "]"}]}], "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "1", ",", 
                 RowBox[{"Length", "@", 
                  RowBox[{"(", 
                   RowBox[{"subsfree", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ")"}]}]}], "}"}]}], 
              "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"magnetizationbound", ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"1", "/", 
                 RowBox[{"(", 
                  RowBox[{"1", "+", 
                   FractionBox["1", "conc"]}], ")"}]}], ")"}], "*", 
               RowBox[{"Re", "@", 
                RowBox[{"Total", "@", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"Tr", "[", 
                    RowBox[{
                    RowBox[{"\[Rho]", "[", 
                    RowBox[{"[", "k", "]"}], "]"}], ".", 
                    RowBox[{"OP", "[", 
                    RowBox[{"[", "k", "]"}], "]"}]}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"k", ",", "1", ",", 
                    RowBox[{"Length", "@", 
                    RowBox[{"(", 
                    RowBox[{"Ul", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ")"}]}]}], "}"}]}], 
                  "]"}]}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"magnetizationfree", ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 FractionBox["1", "conc"], "/", 
                 RowBox[{"(", 
                  RowBox[{"1", "+", 
                   FractionBox["1", "conc"]}], ")"}]}], ")"}], "*", 
               RowBox[{"Re", "@", 
                RowBox[{"Total", "@", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"Tr", "[", 
                    RowBox[{
                    RowBox[{"\[Rho]free", "[", 
                    RowBox[{"[", "k", "]"}], "]"}], ".", 
                    RowBox[{"OPfree", "[", 
                    RowBox[{"[", "k", "]"}], "]"}]}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"k", ",", "1", ",", 
                    RowBox[{"Length", "@", 
                    RowBox[{"(", 
                    RowBox[{"Ulfree", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], ")"}]}]}], "}"}]}], 
                  "]"}]}]}]}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"state", "=", "\[Rho]"}]}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"magnetizationfree", "+", "magnetizationbound"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DMExFR2BlockDualHv", "[", 
    RowBox[{
    "U1_", ",", "U2_", ",", "Ufree_", ",", "\[Rho]0_", ",", "\[Rho]free0_", 
     ",", "kdN_", ",", "kaH_", ",", "conc_", ",", "concH2_", ",", "tf_", ",", 
     "tStep_", ",", "loops_", ",", "subs_", ",", "subsfree_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Ul1", ",", "Ul2", ",", "Ulfree", ",", "tl", ",", "tStepl", ",", 
       "state1", ",", "state2", ",", "\[Rho]free", ",", "\[Rho]H2", ",", 
       "ttl", ",", "magnetizationbound", ",", "magnetizationfree", ",", "j", 
       ",", "i", ",", "\[Rho]1", ",", "\[Rho]2", ",", "\[Rho]Traced1", ",", 
       "\[Rho]Traced2", ",", "\[Rho]freetemp", ",", "\[Rho]H2temp", ",", 
       "modkdN", ",", "modkaH", ",", "modkdC", ",", "output"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ul1", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"U1", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Ul2", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"U2", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Ulfree", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"Ufree", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"tl", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"tf", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tStepl", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"tStep", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Rho]1", "=", "\[Rho]0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Rho]2", "=", "\[Rho]0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Rho]free", "=", "\[Rho]free0"}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"\[Rho]H2", "=", "\[Rho]H20"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"ttl", "=", 
       RowBox[{"Total", "[", "tl", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"magnetizationbound", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", "ttl"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"magnetizationfree", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", "ttl"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "\[LessEqual]", 
         RowBox[{"Length", "[", "tl", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", 
           RowBox[{"i", "\[LessEqual]", 
            RowBox[{
            "tl", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}], 
           ",", 
           RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\[Rho]1", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"ConjugateTranspose", "[", 
                 RowBox[{"Ul1", "\[LeftDoubleBracket]", 
                  RowBox[{"j", ",", "k"}], "\[RightDoubleBracket]"}], "]"}], 
                ".", 
                RowBox[{"\[Rho]1", "[", 
                 RowBox[{"[", "k", "]"}], "]"}], ".", 
                RowBox[{"Ul1", "\[LeftDoubleBracket]", 
                 RowBox[{"j", ",", "k"}], "\[RightDoubleBracket]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{"Ul1", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]2", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"ConjugateTranspose", "[", 
                 RowBox[{"Ul2", "\[LeftDoubleBracket]", 
                  RowBox[{"j", ",", "k"}], "\[RightDoubleBracket]"}], "]"}], 
                ".", 
                RowBox[{"\[Rho]2", "[", 
                 RowBox[{"[", "k", "]"}], "]"}], ".", 
                RowBox[{"Ul2", "\[LeftDoubleBracket]", 
                 RowBox[{"j", ",", "k"}], "\[RightDoubleBracket]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{"Ul2", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"ConjugateTranspose", "[", 
                 RowBox[{"Ulfree", "\[LeftDoubleBracket]", 
                  RowBox[{"j", ",", "k"}], "\[RightDoubleBracket]"}], "]"}], 
                ".", 
                RowBox[{"\[Rho]free", "[", 
                 RowBox[{"[", "k", "]"}], "]"}], ".", 
                RowBox[{"Ulfree", "\[LeftDoubleBracket]", 
                 RowBox[{"j", ",", "k"}], "\[RightDoubleBracket]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{"Ulfree", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]1", "=", 
             RowBox[{
              RowBox[{"ReconstructM", "[", "\[Rho]1", "]"}], 
              "\[LeftDoubleBracket]", 
              RowBox[{
               RowBox[{
               "subs", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
                ",", 
               RowBox[{
               "subs", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"\[Rho]2", "=", 
             RowBox[{
              RowBox[{"ReconstructM", "[", "\[Rho]2", "]"}], 
              "\[LeftDoubleBracket]", 
              RowBox[{
               RowBox[{
               "subs", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
                ",", 
               RowBox[{
               "subs", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{
              RowBox[{"ReconstructM", "[", "\[Rho]free", "]"}], 
              "\[LeftDoubleBracket]", 
              RowBox[{
               RowBox[{
               "subsfree", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}], ",", 
               RowBox[{
               "subsfree", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}]}], ";",
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]Traced1", "=", 
             RowBox[{"\[Rho]Tr", "[", "\[Rho]1", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]Traced2", "=", 
             RowBox[{"\[Rho]Tr", "[", "\[Rho]2", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]freetemp", "=", "\[Rho]free"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]H2temp", "=", "\[Rho]H2"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"modkdN", "=", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"kdN", "*", 
                RowBox[{"tStepl", "[", 
                 RowBox[{"[", "j", "]"}], "]"}]}], ")"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"-", 
                FractionBox[
                 RowBox[{"(", 
                  RowBox[{"kdN", "*", 
                   RowBox[{"tStepl", "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}], ")"}], "2000"]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"modkaH", "=", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"kaH", "*", 
                RowBox[{"tStepl", "[", 
                 RowBox[{"[", "j", "]"}], "]"}]}], ")"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"-", 
                FractionBox[
                 RowBox[{"(", 
                  RowBox[{"kaH", "*", 
                   RowBox[{"tStepl", "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}], ")"}], "2000"]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"modkdC", "=", "modkdN"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]H2", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{"\[Rho]H2", "+", 
               FractionBox[
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"modkaH", " ", "concH2"}], ")"}], " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"MixDensityH2", "[", 
                    RowBox[{"\[Rho]Traced1", ",", "\[Rho]Traced2"}], "]"}], 
                   "-", "\[Rho]H2"}], ")"}]}], "1000"]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{"\[Rho]free", "+", 
               RowBox[{
                FractionBox["1", "1000"], 
                RowBox[{"(", 
                 RowBox[{"modkdN", " ", "conc"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"MixDensityFree", "[", 
                   RowBox[{"\[Rho]Traced1", ",", "\[Rho]Traced2"}], "]"}], 
                  "-", "\[Rho]free"}], ")"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]1", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  FractionBox["modkdN", "1000"], "-", 
                  FractionBox["modkdC", "1000"]}], ")"}], " ", "\[Rho]1"}], 
               "+", 
               RowBox[{
                FractionBox["1", "1000"], "modkdN", " ", 
                RowBox[{"MixDensityRebind", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}], "+", 
               RowBox[{
                FractionBox["1", "1000"], "modkdC", " ", 
                RowBox[{"MixDensityRebindC", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]2", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  FractionBox["modkdN", "1000"], "-", 
                  FractionBox["modkdC", "1000"]}], ")"}], " ", "\[Rho]2"}], 
               "+", 
               RowBox[{
                FractionBox["1", "1000"], "modkdN", " ", 
                RowBox[{"MixDensityRebind", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}], "+", 
               RowBox[{
                FractionBox["1", "1000"], "modkdC", " ", 
                RowBox[{"MixDensityRebindC", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"RelaxFree", "[", 
              RowBox[{"\[Rho]free", ",", 
               RowBox[{"tStepl", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]1", "=", 
             RowBox[{"RelaxBound", "[", 
              RowBox[{"\[Rho]1", ",", "\[Rho]Traced1", ",", 
               RowBox[{"tStepl", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]2", "=", 
             RowBox[{"RelaxBound", "[", 
              RowBox[{"\[Rho]2", ",", "\[Rho]Traced2", ",", 
               RowBox[{"tStepl", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]1", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"\[Rho]1", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "subs", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "n", 
                  "\[RightDoubleBracket]"}], ",", 
                 RowBox[{
                  RowBox[{
                  "subs", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "n", 
                  "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                  "subs", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]2", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"\[Rho]2", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "subs", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "n", 
                  "\[RightDoubleBracket]"}], ",", 
                 RowBox[{
                  RowBox[{
                  "subs", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "n", 
                  "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                  "subs", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"\[Rho]free", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "subsfree", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "n", 
                  "\[RightDoubleBracket]"}], ",", 
                 RowBox[{
                  RowBox[{
                  "subsfree", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "n", 
                  "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                  "subsfree", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"magnetizationbound", "[", 
              RowBox[{"[", 
               RowBox[{"(", 
                RowBox[{"i", "+", 
                 RowBox[{"Total", "[", 
                  RowBox[{"tl", "[", 
                   RowBox[{"[", 
                    RowBox[{";;", 
                    RowBox[{"(", 
                    RowBox[{"j", "-", "1"}], ")"}]}], "]"}], "]"}], "]"}]}], 
                ")"}], "]"}], "]"}], "=", 
             RowBox[{
              FractionBox["0.5", 
               RowBox[{"1", "+", 
                FractionBox["1", "conc"]}]], 
              RowBox[{"Re", "[", 
               RowBox[{"Total", "[", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"Tr", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    "\[Rho]1", "\[LeftDoubleBracket]", "k", 
                    "\[RightDoubleBracket]"}], ".", 
                    RowBox[{
                    "OP", "\[LeftDoubleBracket]", "k", 
                    "\[RightDoubleBracket]"}]}], "+", 
                    RowBox[{
                    RowBox[{
                    "\[Rho]2", "\[LeftDoubleBracket]", "k", 
                    "\[RightDoubleBracket]"}], ".", 
                    RowBox[{
                    "OP", "\[LeftDoubleBracket]", "k", 
                    "\[RightDoubleBracket]"}]}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"k", ",", "1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    "Ul1", "\[LeftDoubleBracket]", "j", 
                    "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}], "]"}],
                "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"magnetizationfree", "[", 
              RowBox[{"[", 
               RowBox[{"(", 
                RowBox[{"i", "+", 
                 RowBox[{"Total", "[", 
                  RowBox[{"tl", "[", 
                   RowBox[{"[", 
                    RowBox[{";;", 
                    RowBox[{"(", 
                    RowBox[{"j", "-", "1"}], ")"}]}], "]"}], "]"}], "]"}]}], 
                ")"}], "]"}], "]"}], "=", 
             RowBox[{
              FractionBox["1", 
               RowBox[{"conc", " ", 
                RowBox[{"(", 
                 RowBox[{"1", "+", 
                  FractionBox["1", "conc"]}], ")"}]}]], 
              RowBox[{"Re", "[", 
               RowBox[{"Total", "[", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"Tr", "[", 
                   RowBox[{
                    RowBox[{
                    "\[Rho]free", "\[LeftDoubleBracket]", "k", 
                    "\[RightDoubleBracket]"}], ".", 
                    RowBox[{
                    "OPfree", "\[LeftDoubleBracket]", "k", 
                    "\[RightDoubleBracket]"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"k", ",", "1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    "Ulfree", "\[LeftDoubleBracket]", "j", 
                    "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}], "]"}],
                "]"}]}]}], ";"}]}], "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{
        FractionBox["100", 
         RowBox[{"Norm", "[", 
          RowBox[{
           RowBox[{"ReconstructM", "[", "OP", "]"}], "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{
            "subs", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            ",", 
            RowBox[{
            "subs", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
           "\[RightDoubleBracket]"}], "]"}]], " ", 
        RowBox[{"(", 
         RowBox[{"magnetizationfree", "+", "magnetizationbound"}], 
         ")"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DMExFR2BlockDualH", "[", 
    RowBox[{
    "U1_", ",", "U2_", ",", "Ufree_", ",", "\[Rho]0_", ",", "\[Rho]free0_", 
     ",", "kdN_", ",", "kaH_", ",", "conc_", ",", "concH2_", ",", "tf_", ",", 
     "loops_", ",", "subs_", ",", "subsfree_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Rho]1", ",", "\[Rho]2", ",", "\[Rho]free", ",", "magnetizationbound",
        ",", "magnetizationfree", ",", "state1", ",", "state2", ",", "output",
        ",", "i", ",", "ri", ",", "Ul1", ",", "Ul2", ",", "Ulfree", ",", "tl",
        ",", "tlfree", ",", "j", ",", "loopmag", ",", "k", ",", "l", ",", 
       "\[Rho]last", ",", "boundlast", ",", "tflist", ",", "tffree", ",", "m",
        ",", "\[Rho]lastfree", ",", "boundlastfree", ",", "modkdN", ",", 
       "modkaH", ",", "\[Rho]freetemp", ",", "\[Rho]Traced1", ",", 
       "\[Rho]Traced2", ",", "\[Rho]Tracedfree", ",", "magnetizationN", ",", 
       "magnetizationP", ",", "\[Rho]H2", ",", "\[Rho]H2temp", ",", 
       "modkdC"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ul1", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"U1", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Ul2", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"U2", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Ulfree", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"Ufree", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"tl", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"tf", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"state1", "=", "\[Rho]0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"state2", "=", "\[Rho]0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Rho]free", "=", "\[Rho]free0"}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"\[Rho]H2", "=", "\[Rho]H20"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"magnetizationbound", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"magnetizationfree", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"modkdN", "=", 
       RowBox[{"kdN", " ", 
        RowBox[{"Exp", "[", 
         RowBox[{"-", 
          FractionBox["kdN", "2000"]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"modkaH", "=", 
       RowBox[{"kaH", " ", 
        RowBox[{"Exp", "[", 
         RowBox[{"-", 
          FractionBox["kaH", "2000"]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"modkdC", "=", "modkdN"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "\[LessEqual]", 
         RowBox[{"Length", "[", "tl", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"i", "=", "1"}], ";", 
            RowBox[{"\[Rho]1", "=", "state1"}], ";", 
            RowBox[{"\[Rho]2", "=", "state2"}]}], ",", 
           RowBox[{"i", "\[LessEqual]", 
            RowBox[{
            "tl", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}], 
           ",", 
           RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\[Rho]1", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"DensityStepFast", "[", 
                RowBox[{
                 RowBox[{"Normal", "[", 
                  RowBox[{
                   RowBox[{
                   "Ul1", "\[LeftDoubleBracket]", "j", 
                    "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "k", 
                   "\[RightDoubleBracket]"}], "]"}], ",", 
                 RowBox[{"Normal", "[", 
                  RowBox[{
                  "\[Rho]1", "\[LeftDoubleBracket]", "k", 
                   "\[RightDoubleBracket]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                  "Ul1", "\[LeftDoubleBracket]", "j", 
                   "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]2", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"DensityStepFast", "[", 
                RowBox[{
                 RowBox[{"Normal", "[", 
                  RowBox[{
                   RowBox[{
                   "Ul2", "\[LeftDoubleBracket]", "j", 
                    "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "k", 
                   "\[RightDoubleBracket]"}], "]"}], ",", 
                 RowBox[{"Normal", "[", 
                  RowBox[{
                  "\[Rho]2", "\[LeftDoubleBracket]", "k", 
                   "\[RightDoubleBracket]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                  "Ul2", "\[LeftDoubleBracket]", "j", 
                   "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"DensityStepFast", "[", 
                RowBox[{
                 RowBox[{"Normal", "[", 
                  RowBox[{
                   RowBox[{
                   "Ulfree", "\[LeftDoubleBracket]", "j", 
                    "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "k", 
                   "\[RightDoubleBracket]"}], "]"}], ",", 
                 RowBox[{"Normal", "[", 
                  RowBox[{
                  "\[Rho]free", "\[LeftDoubleBracket]", "k", 
                   "\[RightDoubleBracket]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"k", ",", "1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                  "Ulfree", "\[LeftDoubleBracket]", "j", 
                   "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]1", "=", 
             RowBox[{
              RowBox[{"ReconstructM", "[", "\[Rho]1", "]"}], 
              "\[LeftDoubleBracket]", 
              RowBox[{
               RowBox[{
               "subs", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
                ",", 
               RowBox[{
               "subs", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"\[Rho]2", "=", 
             RowBox[{
              RowBox[{"ReconstructM", "[", "\[Rho]2", "]"}], 
              "\[LeftDoubleBracket]", 
              RowBox[{
               RowBox[{
               "subs", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}],
                ",", 
               RowBox[{
               "subs", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}]}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{
              RowBox[{"ReconstructM", "[", "\[Rho]free", "]"}], 
              "\[LeftDoubleBracket]", 
              RowBox[{
               RowBox[{
               "subsfree", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}], ",", 
               RowBox[{
               "subsfree", "\[LeftDoubleBracket]", "2", 
                "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}]}], ";",
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]Traced1", "=", 
             RowBox[{"\[Rho]Tr", "[", "\[Rho]1", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]Traced2", "=", 
             RowBox[{"\[Rho]Tr", "[", "\[Rho]2", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]freetemp", "=", "\[Rho]free"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]H2temp", "=", "\[Rho]H2"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]H2", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{"\[Rho]H2", "+", 
               RowBox[{
                FractionBox[
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"modkaH", " ", "concH2"}], ")"}], " "}], "1000"], 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"MixDensityH2", "[", 
                   RowBox[{"\[Rho]Traced1", ",", "\[Rho]Traced2"}], "]"}], 
                  "-", "\[Rho]H2"}], ")"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{"\[Rho]free", "+", 
               RowBox[{
                FractionBox[
                 RowBox[{"(", 
                  RowBox[{"modkdN", " ", "conc"}], ")"}], "1000"], 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"MixDensityFree", "[", 
                   RowBox[{"\[Rho]Traced1", ",", "\[Rho]Traced2"}], "]"}], 
                  "-", "\[Rho]free"}], ")"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]1", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  FractionBox["modkdN", "1000"], "-", 
                  FractionBox["modkdC", "1000"]}], ")"}], " ", "\[Rho]1"}], 
               "+", 
               RowBox[{
                FractionBox["modkdN", "1000"], " ", 
                RowBox[{"MixDensityRebind", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}], "+", 
               RowBox[{
                FractionBox["modkdC", "1000"], " ", 
                RowBox[{"MixDensityRebindC", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", "\[Rho]1", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]2", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  FractionBox["modkdN", "1000"], "-", 
                  FractionBox["modkdC", "1000"]}], ")"}], " ", "\[Rho]2"}], 
               "+", 
               RowBox[{
                FractionBox["modkdN", "1000"], " ", 
                RowBox[{"MixDensityRebind", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}], "+", 
               RowBox[{
                FractionBox["modkdC", "1000"], 
                RowBox[{"MixDensityRebindC", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", "\[Rho]2", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"RelaxFree", "[", "\[Rho]free", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]1", "=", 
             RowBox[{"RelaxBound", "[", 
              RowBox[{"\[Rho]1", ",", "\[Rho]Traced1"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]2", "=", 
             RowBox[{"RelaxBound", "[", 
              RowBox[{"\[Rho]2", ",", "\[Rho]Traced2"}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]1", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"\[Rho]1", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "subs", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "n", 
                  "\[RightDoubleBracket]"}], ",", 
                 RowBox[{
                  RowBox[{
                  "subs", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "n", 
                  "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                  "subs", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]2", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"\[Rho]2", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "subs", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "n", 
                  "\[RightDoubleBracket]"}], ",", 
                 RowBox[{
                  RowBox[{
                  "subs", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "n", 
                  "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                  "subs", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"\[Rho]free", "\[LeftDoubleBracket]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                  "subsfree", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "n", 
                  "\[RightDoubleBracket]"}], ",", 
                 RowBox[{
                  RowBox[{
                  "subsfree", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "\[LeftDoubleBracket]", "n", 
                  "\[RightDoubleBracket]"}]}], "\[RightDoubleBracket]"}], ",", 
               RowBox[{"{", 
                RowBox[{"n", ",", "1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                  "subsfree", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"magnetizationbound", ",", 
              RowBox[{"0.5", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  FractionBox["1", 
                   RowBox[{"1", "+", 
                    FractionBox["1", "conc"]}]], 
                  RowBox[{"Re", "[", 
                   RowBox[{"Total", "[", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Tr", "[", 
                    RowBox[{
                    RowBox[{
                    "\[Rho]1", "\[LeftDoubleBracket]", "k", 
                    "\[RightDoubleBracket]"}], ".", 
                    RowBox[{
                    "OP", "\[LeftDoubleBracket]", "k", 
                    "\[RightDoubleBracket]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"k", ",", "1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    "Ul1", "\[LeftDoubleBracket]", "j", 
                    "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}], "]"}],
                    "]"}]}], "+", 
                 RowBox[{
                  FractionBox["1", 
                   RowBox[{"1", "+", 
                    FractionBox["1", "conc"]}]], 
                  RowBox[{"Re", "[", 
                   RowBox[{"Total", "[", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Tr", "[", 
                    RowBox[{
                    RowBox[{
                    "\[Rho]2", "\[LeftDoubleBracket]", "k", 
                    "\[RightDoubleBracket]"}], ".", 
                    RowBox[{
                    "OP", "\[LeftDoubleBracket]", "k", 
                    "\[RightDoubleBracket]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"k", ",", "1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    "Ul1", "\[LeftDoubleBracket]", "j", 
                    "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}], "]"}],
                    "]"}]}]}], ")"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"magnetizationfree", ",", 
              RowBox[{
               FractionBox["1", 
                RowBox[{"conc", " ", 
                 RowBox[{"(", 
                  RowBox[{"1", "+", 
                   FractionBox["1", "conc"]}], ")"}]}]], 
               RowBox[{"Re", "[", 
                RowBox[{"Total", "[", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"Tr", "[", 
                    RowBox[{
                    RowBox[{
                    "\[Rho]free", "\[LeftDoubleBracket]", "k", 
                    "\[RightDoubleBracket]"}], ".", 
                    RowBox[{
                    "OPfree", "\[LeftDoubleBracket]", "k", 
                    "\[RightDoubleBracket]"}]}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"k", ",", "1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    "Ulfree", "\[LeftDoubleBracket]", "j", 
                    "\[RightDoubleBracket]"}], "]"}]}], "}"}]}], "]"}], "]"}],
                 "]"}]}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"state1", "=", "\[Rho]1"}], ";", "\[IndentingNewLine]", 
         RowBox[{"state2", "=", "\[Rho]2"}], ";"}]}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "]"}], ";", 
      RowBox[{"output", "=", 
       RowBox[{"magnetizationfree", "+", "magnetizationbound"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"LvNSolve", "[", 
    RowBox[{"U1_", ",", "\[Rho]0_", ",", "tf_", ",", "loops_"}], "]"}], ":=", 
   
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Rho]1", ",", "\[Rho]2", ",", "\[Rho]free", ",", "magnetization", ",",
        "state1", ",", "state2", ",", "output", ",", "i", ",", "ri", ",", 
       "Ul1", ",", "Ul2", ",", "Ulfree", ",", "tl", ",", "tlfree", ",", "j", 
       ",", "loopmag", ",", "k", ",", "l", ",", "\[Rho]last", ",", 
       "boundlast", ",", "tflist", ",", "tffree", ",", "m", ",", 
       "\[Rho]lastfree", ",", "boundlastfree", ",", "modkdN", ",", "modkaH", 
       ",", "\[Rho]freetemp", ",", "\[Rho]Traced1", ",", "\[Rho]Traced2", ",",
        "\[Rho]Tracedfree", ",", "\[Rho]H2", ",", "\[Rho]H2temp", ",", 
       "modkdC"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ul1", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"U1", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tl", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"tf", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state1", "=", "\[Rho]0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"magnetization", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "\[LessEqual]", 
         RowBox[{"Length", "[", "tl", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"i", "=", "1"}], ";", 
            RowBox[{"\[Rho]1", "=", "state1"}]}], ",", 
           RowBox[{"i", "\[LessEqual]", 
            RowBox[{
            "tl", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}], 
           ",", 
           RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\[Rho]1", "=", 
             RowBox[{
              RowBox[{"ConjugateTranspose", "[", 
               RowBox[{
               "Ul1", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
               "]"}], ".", "\[Rho]1", ".", 
              RowBox[{
              "Ul1", "\[LeftDoubleBracket]", "j", 
               "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"magnetization", ",", 
              RowBox[{"Tr", "[", 
               RowBox[{"\[Rho]1", ".", "OP"}], "]"}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"state1", "=", "\[Rho]1"}], ";"}]}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"output", "=", "magnetization"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DMExFR2DualHv", "[", 
    RowBox[{
    "U1_", ",", "U2_", ",", "Ufree_", ",", "\[Rho]0_", ",", "\[Rho]free0_", 
     ",", "kdN_", ",", "kaH_", ",", "conc_", ",", "concH2_", ",", "tf_", ",", 
     "tStep_", ",", "loops_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Ul1", ",", "Ul2", ",", "Ulfree", ",", "tl", ",", "tStepl", ",", 
       "state1", ",", "state2", ",", "\[Rho]free", ",", "\[Rho]H2", ",", 
       "ttl", ",", "magnetizationbound", ",", "magnetizationfree", ",", "j", 
       ",", "i", ",", "\[Rho]1", ",", "\[Rho]2", ",", "\[Rho]Traced1", ",", 
       "\[Rho]Traced2", ",", "\[Rho]freetemp", ",", "\[Rho]H2temp", ",", 
       "modkdN", ",", "modkaH", ",", "modkdC", ",", "output"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ul1", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"U1", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Ul2", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"U2", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Ulfree", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"Ufree", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"tl", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"tf", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tStepl", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"tStep", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Rho]1", "=", "\[Rho]0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Rho]2", "=", "\[Rho]0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Rho]free", "=", "\[Rho]free0"}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"\[Rho]H2", "=", "\[Rho]H20"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"ttl", "=", 
       RowBox[{"Total", "[", "tl", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"magnetizationbound", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", "ttl"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"magnetizationfree", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"0.0", ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "1", ",", "ttl"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "\[LessEqual]", 
         RowBox[{"Length", "[", "tl", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", 
           RowBox[{"i", "\[LessEqual]", 
            RowBox[{
            "tl", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}], 
           ",", 
           RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\[Rho]1", "=", 
             RowBox[{
              RowBox[{"ConjugateTranspose", "[", 
               RowBox[{
               "Ul1", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
               "]"}], ".", "\[Rho]1", ".", 
              RowBox[{
              "Ul1", "\[LeftDoubleBracket]", "j", 
               "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]2", "=", 
             RowBox[{
              RowBox[{"ConjugateTranspose", "[", 
               RowBox[{
               "Ul2", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
               "]"}], ".", "\[Rho]2", ".", 
              RowBox[{
              "Ul2", "\[LeftDoubleBracket]", "j", 
               "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{
              RowBox[{"ConjugateTranspose", "[", 
               RowBox[{
               "Ulfree", "\[LeftDoubleBracket]", "j", 
                "\[RightDoubleBracket]"}], "]"}], ".", "\[Rho]free", ".", 
              RowBox[{
              "Ulfree", "\[LeftDoubleBracket]", "j", 
               "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]Traced1", "=", 
             RowBox[{"\[Rho]Tr", "[", "\[Rho]1", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]Traced2", "=", 
             RowBox[{"\[Rho]Tr", "[", "\[Rho]2", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]freetemp", "=", "\[Rho]free"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]H2temp", "=", "\[Rho]H2"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"modkdN", "=", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"kdN", "*", 
                RowBox[{"tStepl", "[", 
                 RowBox[{"[", "j", "]"}], "]"}]}], ")"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"-", 
                FractionBox[
                 RowBox[{"(", 
                  RowBox[{"kdN", "*", 
                   RowBox[{"tStepl", "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}], ")"}], "2000"]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"modkaH", "=", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"kaH", "*", 
                RowBox[{"tStepl", "[", 
                 RowBox[{"[", "j", "]"}], "]"}]}], ")"}], " ", 
              RowBox[{"Exp", "[", 
               RowBox[{"-", 
                FractionBox[
                 RowBox[{"(", 
                  RowBox[{"kaH", "*", 
                   RowBox[{"tStepl", "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}], ")"}], "2000"]}], 
               "]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"modkdC", "=", "modkdN"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]H2", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{"\[Rho]H2", "+", 
               FractionBox[
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"modkaH", " ", "concH2"}], ")"}], " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"MixDensityH2", "[", 
                    RowBox[{"\[Rho]Traced1", ",", "\[Rho]Traced2"}], "]"}], 
                   "-", "\[Rho]H2"}], ")"}]}], "1000"]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{"\[Rho]free", "+", 
               RowBox[{
                FractionBox["1", "1000"], 
                RowBox[{"(", 
                 RowBox[{"modkdN", " ", "conc"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"MixDensityFree", "[", 
                   RowBox[{"\[Rho]Traced1", ",", "\[Rho]Traced2"}], "]"}], 
                  "-", "\[Rho]free"}], ")"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]1", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  FractionBox["modkdN", "1000"], "-", 
                  FractionBox["modkdC", "1000"]}], ")"}], " ", "\[Rho]1"}], 
               "+", 
               RowBox[{
                FractionBox["1", "1000"], "modkdN", " ", 
                RowBox[{"MixDensityRebind", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}], "+", 
               RowBox[{
                FractionBox["1", "1000"], "modkdC", " ", 
                RowBox[{"MixDensityRebindC", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]2", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  FractionBox["modkdN", "1000"], "-", 
                  FractionBox["modkdC", "1000"]}], ")"}], " ", "\[Rho]2"}], 
               "+", 
               RowBox[{
                FractionBox["1", "1000"], "modkdN", " ", 
                RowBox[{"MixDensityRebind", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}], "+", 
               RowBox[{
                FractionBox["1", "1000"], "modkdC", " ", 
                RowBox[{"MixDensityRebindC", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"RelaxFree", "[", 
              RowBox[{"\[Rho]free", ",", 
               RowBox[{"tStepl", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]1", "=", 
             RowBox[{"RelaxBound", "[", 
              RowBox[{"\[Rho]1", ",", "\[Rho]Traced1", ",", 
               RowBox[{"tStepl", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]2", "=", 
             RowBox[{"RelaxBound", "[", 
              RowBox[{"\[Rho]2", ",", "\[Rho]Traced2", ",", 
               RowBox[{"tStepl", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"magnetizationbound", "[", 
              RowBox[{"[", 
               RowBox[{"(", 
                RowBox[{"i", "+", 
                 RowBox[{"Total", "[", 
                  RowBox[{"tl", "[", 
                   RowBox[{"[", 
                    RowBox[{";;", 
                    RowBox[{"(", 
                    RowBox[{"j", "-", "1"}], ")"}]}], "]"}], "]"}], "]"}]}], 
                ")"}], "]"}], "]"}], "=", 
             RowBox[{"0.5", " ", 
              RowBox[{"(", 
               RowBox[{
                FractionBox[
                 RowBox[{"Re", "[", 
                  RowBox[{"Tr", "[", 
                   RowBox[{"\[Rho]1", ".", "OP"}], "]"}], "]"}], 
                 RowBox[{"1", "+", 
                  FractionBox["1", "conc"]}]], "+", 
                FractionBox[
                 RowBox[{"Re", "[", 
                  RowBox[{"Tr", "[", 
                   RowBox[{"\[Rho]2", ".", "OP"}], "]"}], "]"}], 
                 RowBox[{"1", "+", 
                  FractionBox["1", "conc"]}]]}], ")"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"magnetizationfree", "[", 
              RowBox[{"[", 
               RowBox[{"(", 
                RowBox[{"i", "+", 
                 RowBox[{"Total", "[", 
                  RowBox[{"tl", "[", 
                   RowBox[{"[", 
                    RowBox[{";;", 
                    RowBox[{"(", 
                    RowBox[{"j", "-", "1"}], ")"}]}], "]"}], "]"}], "]"}]}], 
                ")"}], "]"}], "]"}], "=", 
             FractionBox[
              RowBox[{"Re", "[", 
               RowBox[{"Tr", "[", 
                RowBox[{"\[Rho]free", ".", "OPfree"}], "]"}], "]"}], 
              RowBox[{"conc", " ", 
               RowBox[{"(", 
                RowBox[{"1", "+", 
                 FractionBox["1", "conc"]}], ")"}]}]]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{
        FractionBox["100", 
         RowBox[{"Norm", "[", "OP", "]"}]], 
        RowBox[{"(", 
         RowBox[{"magnetizationfree", "+", "magnetizationbound"}], 
         ")"}]}]}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DMExFR2DualH", "[", 
    RowBox[{
    "U1_", ",", "U2_", ",", "Ufree_", ",", "\[Rho]0_", ",", "\[Rho]free0_", 
     ",", "kdN_", ",", "kaH_", ",", "conc_", ",", "concH2_", ",", "tf_", ",", 
     "loops_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Rho]1", ",", "\[Rho]2", ",", "\[Rho]free", ",", "magnetizationbound",
        ",", "magnetizationfree", ",", "state1", ",", "state2", ",", "output",
        ",", "i", ",", "ri", ",", "Ul1", ",", "Ul2", ",", "Ulfree", ",", "tl",
        ",", "tlfree", ",", "j", ",", "loopmag", ",", "k", ",", "l", ",", 
       "\[Rho]last", ",", "boundlast", ",", "tflist", ",", "tffree", ",", "m",
        ",", "\[Rho]lastfree", ",", "boundlastfree", ",", "modkdN", ",", 
       "modkaH", ",", "\[Rho]freetemp", ",", "\[Rho]Traced1", ",", 
       "\[Rho]Traced2", ",", "\[Rho]Tracedfree", ",", "magnetizationN", ",", 
       "magnetizationP", ",", "\[Rho]H2", ",", "\[Rho]H2temp", ",", 
       "modkdC"}], "}"}], ",", 
     RowBox[{
      RowBox[{"Ul1", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"U1", ",", "loops"}], "]"}]}], ";", 
      RowBox[{"Ul2", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"U2", ",", "loops"}], "]"}]}], ";", 
      RowBox[{"Ulfree", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"Ufree", ",", "loops"}], "]"}]}], ";", 
      RowBox[{"tl", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"tf", ",", "loops"}], "]"}]}], ";", 
      RowBox[{"state1", "=", "\[Rho]0"}], ";", 
      RowBox[{"state2", "=", "\[Rho]0"}], ";", 
      RowBox[{"\[Rho]free", "=", "\[Rho]free0"}], ";", 
      RowBox[{"\[Rho]H2", "=", "\[Rho]H20"}], ";", 
      RowBox[{"magnetizationbound", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"magnetizationfree", "=", 
       RowBox[{"{", "}"}]}], ";", 
      RowBox[{"modkdN", "=", 
       RowBox[{"kdN", " ", 
        RowBox[{"Exp", "[", 
         RowBox[{"-", 
          FractionBox["kdN", "2000"]}], "]"}]}]}], ";", 
      RowBox[{"modkaH", "=", 
       RowBox[{"kaH", " ", 
        RowBox[{"Exp", "[", 
         RowBox[{"-", 
          FractionBox["kaH", "2000"]}], "]"}]}]}], ";", 
      RowBox[{"modkdC", "=", "modkdN"}], ";", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "\[LessEqual]", 
         RowBox[{"Length", "[", "tl", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"i", "=", "1"}], ";", 
            RowBox[{"\[Rho]1", "=", "state1"}], ";", 
            RowBox[{"\[Rho]2", "=", "state2"}]}], ",", 
           RowBox[{"i", "\[LessEqual]", 
            RowBox[{
            "tl", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}], 
           ",", 
           RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\[Rho]1", "=", 
             RowBox[{
              RowBox[{"ConjugateTranspose", "[", 
               RowBox[{
               "Ul1", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
               "]"}], ".", "\[Rho]1", ".", 
              RowBox[{
              "Ul1", "\[LeftDoubleBracket]", "j", 
               "\[RightDoubleBracket]"}]}]}], ";", 
            RowBox[{"\[Rho]2", "=", 
             RowBox[{
              RowBox[{"ConjugateTranspose", "[", 
               RowBox[{
               "Ul2", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
               "]"}], ".", "\[Rho]2", ".", 
              RowBox[{
              "Ul2", "\[LeftDoubleBracket]", "j", 
               "\[RightDoubleBracket]"}]}]}], ";", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{
              RowBox[{"ConjugateTranspose", "[", 
               RowBox[{
               "Ulfree", "\[LeftDoubleBracket]", "j", 
                "\[RightDoubleBracket]"}], "]"}], ".", "\[Rho]free", ".", 
              RowBox[{
              "Ulfree", "\[LeftDoubleBracket]", "j", 
               "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]Traced1", "=", 
             RowBox[{"\[Rho]Tr", "[", "\[Rho]1", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]Traced2", "=", 
             RowBox[{"\[Rho]Tr", "[", "\[Rho]2", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]freetemp", "=", "\[Rho]free"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"\[Rho]H2temp", "=", "\[Rho]H2"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]H2", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{"\[Rho]H2", "+", 
               FractionBox[
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"modkaH", " ", "concH2"}], ")"}], " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"MixDensityH2", "[", 
                    RowBox[{"\[Rho]Traced1", ",", "\[Rho]Traced2"}], "]"}], 
                   "-", "\[Rho]H2"}], ")"}]}], "1000"]}], "]"}]}], ";", 
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{"\[Rho]free", "+", 
               RowBox[{
                FractionBox["1", "1000"], 
                RowBox[{"(", 
                 RowBox[{"modkdN", " ", "conc"}], ")"}], " ", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"MixDensityFree", "[", 
                   RowBox[{"\[Rho]Traced1", ",", "\[Rho]Traced2"}], "]"}], 
                  "-", "\[Rho]free"}], ")"}]}]}], "]"}]}], ";", 
            RowBox[{"\[Rho]1", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  FractionBox["modkdN", "1000"], "-", 
                  FractionBox["modkdC", "1000"]}], ")"}], " ", "\[Rho]1"}], 
               "+", 
               RowBox[{
                FractionBox["1", "1000"], "modkdN", " ", 
                RowBox[{"MixDensityRebind", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}], "+", 
               RowBox[{
                FractionBox["1", "1000"], "modkdC", " ", 
                RowBox[{"MixDensityRebindC", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", "\[Rho]1", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}]}], "]"}]}], ";", 
            
            RowBox[{"\[Rho]2", "=", 
             RowBox[{"TraceNormalize", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  FractionBox["modkdN", "1000"], "-", 
                  FractionBox["modkdC", "1000"]}], ")"}], " ", "\[Rho]2"}], 
               "+", 
               RowBox[{
                FractionBox["1", "1000"], "modkdN", " ", 
                RowBox[{"MixDensityRebind", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}], "+", 
               RowBox[{
                FractionBox["1", "1000"], "modkdC", " ", 
                RowBox[{"MixDensityRebindC", "[", 
                 RowBox[{
                 "\[Rho]Traced1", ",", "\[Rho]Traced2", ",", "\[Rho]freetemp",
                   ",", "\[Rho]H2temp", ",", "\[Rho]2", ",", 
                  FractionBox["modkaH", "modkdN"]}], "]"}]}]}], "]"}]}], ";", 
            
            RowBox[{"\[Rho]free", "=", 
             RowBox[{"RelaxFree", "[", "\[Rho]free", "]"}]}], ";", 
            RowBox[{"\[Rho]1", "=", 
             RowBox[{"RelaxBound", "[", 
              RowBox[{"\[Rho]1", ",", "\[Rho]Traced1"}], "]"}]}], ";", 
            RowBox[{"\[Rho]2", "=", 
             RowBox[{"RelaxBound", "[", 
              RowBox[{"\[Rho]2", ",", "\[Rho]Traced2"}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"magnetizationbound", ",", 
              RowBox[{"0.5`", " ", 
               RowBox[{"(", 
                RowBox[{
                 FractionBox[
                  RowBox[{"Re", "[", 
                   RowBox[{"Tr", "[", 
                    RowBox[{"\[Rho]1", ".", "OP"}], "]"}], "]"}], 
                  RowBox[{"1", "+", 
                   FractionBox["1", "conc"]}]], "+", 
                 FractionBox[
                  RowBox[{"Re", "[", 
                   RowBox[{"Tr", "[", 
                    RowBox[{"\[Rho]2", ".", "OP"}], "]"}], "]"}], 
                  RowBox[{"1", "+", 
                   FractionBox["1", "conc"]}]]}], ")"}]}]}], "]"}], ";", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"magnetizationfree", ",", 
              FractionBox[
               RowBox[{"Re", "[", 
                RowBox[{"Re", "[", 
                 RowBox[{"Tr", "[", 
                  RowBox[{"\[Rho]free", ".", "OPfree"}], "]"}], "]"}], "]"}], 
               
               RowBox[{"conc", " ", 
                RowBox[{"(", 
                 RowBox[{"1", "+", 
                  FractionBox["1", "conc"]}], ")"}]}]]}], "]"}], ";"}]}], 
          "]"}], ";", 
         RowBox[{"state1", "=", "\[Rho]1"}], ";", 
         RowBox[{"state2", "=", "\[Rho]2"}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"magnetizationfree", "+", "magnetizationbound"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RelaxTriplet", "[", "\[Rho]_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"leng", ",", "tempM", ",", "\[Rho]temp"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"leng", "=", 
       RowBox[{"Length", "[", "\[Rho]", "]"}]}], ";", 
      RowBox[{"\[Rho]temp", "=", "\[Rho]"}], ";", 
      RowBox[{"tempM", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{"0.`", " ", 
          RowBox[{"IdentityMatrix", "[", "leng", "]"}]}], "+", 
         RowBox[{"0.`", " ", "\[ImaginaryI]"}]}], "]"}]}], ";", 
      RowBox[{
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"1", ";;", 
          FractionBox["leng", "4"]}], ",", 
         RowBox[{"1", ";;", 
          FractionBox["leng", "4"]}]}], "\[RightDoubleBracket]"}], "=", 
       RowBox[{
        FractionBox["1", "3"], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"\[Rho]temp", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"1", ";;", 
             FractionBox["leng", "4"]}], ",", 
            RowBox[{"1", ";;", 
             FractionBox["leng", "4"]}]}], "\[RightDoubleBracket]"}], "+", 
          RowBox[{"\[Rho]temp", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{
             RowBox[{
              FractionBox["leng", "4"], "+", "1"}], ";;", 
             FractionBox["leng", "2"]}], ",", 
            RowBox[{
             RowBox[{
              FractionBox["leng", "4"], "+", "1"}], ";;", 
             FractionBox["leng", "2"]}]}], "\[RightDoubleBracket]"}], "+", 
          RowBox[{"\[Rho]temp", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{
             RowBox[{
              FractionBox["leng", "2"], "+", "1"}], ";;", 
             FractionBox[
              RowBox[{"3", " ", "leng"}], "4"]}], ",", 
            RowBox[{
             RowBox[{
              FractionBox["leng", "2"], "+", "1"}], ";;", 
             FractionBox[
              RowBox[{"3", " ", "leng"}], "4"]}]}], 
           "\[RightDoubleBracket]"}]}], ")"}]}]}], ";", 
      RowBox[{
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{
          RowBox[{
           FractionBox["leng", "4"], "+", "1"}], ";;", 
          FractionBox["leng", "2"]}], ",", 
         RowBox[{
          RowBox[{
           FractionBox["leng", "4"], "+", "1"}], ";;", 
          FractionBox["leng", "2"]}]}], "\[RightDoubleBracket]"}], "=", 
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"1", ";;", 
          FractionBox["leng", "4"]}], ",", 
         RowBox[{"1", ";;", 
          FractionBox["leng", "4"]}]}], "\[RightDoubleBracket]"}]}], ";", 
      RowBox[{
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{
          RowBox[{
           FractionBox["leng", "2"], "+", "1"}], ";;", 
          FractionBox[
           RowBox[{"3", " ", "leng"}], "4"]}], ",", 
         RowBox[{
          RowBox[{
           FractionBox["leng", "2"], "+", "1"}], ";;", 
          FractionBox[
           RowBox[{"3", " ", "leng"}], "4"]}]}], "\[RightDoubleBracket]"}], 
       "=", 
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"1", ";;", 
          FractionBox["leng", "4"]}], ",", 
         RowBox[{"1", ";;", 
          FractionBox["leng", "4"]}]}], "\[RightDoubleBracket]"}]}], ";", 
      RowBox[{
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}], ",", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}]}], 
        "\[RightDoubleBracket]"}], "=", 
       RowBox[{"\[Rho]", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}], ",", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}]}], 
        "\[RightDoubleBracket]"}]}], ";", 
      RowBox[{
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"1", ";;", 
          FractionBox[
           RowBox[{"3", " ", "leng"}], "4"]}], ",", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}]}], 
        "\[RightDoubleBracket]"}], "=", 
       RowBox[{
        FractionBox["1", "2"], " ", 
        RowBox[{"\[Rho]", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", 
           FractionBox[
            RowBox[{"3", " ", "leng"}], "4"]}], ",", 
          RowBox[{
           RowBox[{
            FractionBox[
             RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}]}], 
         "\[RightDoubleBracket]"}]}]}], ";", 
      RowBox[{
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}], ",", 
         RowBox[{"1", ";;", 
          FractionBox[
           RowBox[{"3", " ", "leng"}], "4"]}]}], "\[RightDoubleBracket]"}], 
       "=", 
       RowBox[{
        FractionBox["1", "2"], " ", 
        RowBox[{"ConjugateTranspose", "[", 
         RowBox[{"\[Rho]", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", 
            FractionBox[
             RowBox[{"3", " ", "leng"}], "4"]}], ",", 
           RowBox[{
            RowBox[{
             FractionBox[
              RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}]}], 
          "\[RightDoubleBracket]"}], "]"}]}]}], ";", 
      RowBox[{"SparseArray", "[", 
       RowBox[{"UstT", ".", "tempM", ".", "Ust"}], "]"}]}]}], "]"}]}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RelaxTriplet2", "[", "\[Rho]_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"leng", ",", "tempM", ",", "\[Rho]temp"}], "}"}], ",", 
     RowBox[{
      RowBox[{"leng", "=", 
       RowBox[{"Length", "[", "\[Rho]", "]"}]}], ";", 
      RowBox[{"\[Rho]temp", "=", "\[Rho]"}], ";", 
      RowBox[{"tempM", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{"0.`", " ", 
          RowBox[{"IdentityMatrix", "[", "leng", "]"}]}], "+", 
         RowBox[{"0.`", " ", "\[ImaginaryI]"}]}], "]"}]}], ";", 
      RowBox[{
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"1", ";;", 
          FractionBox["leng", "4"]}], ",", 
         RowBox[{"1", ";;", 
          FractionBox["leng", "4"]}]}], "\[RightDoubleBracket]"}], "=", 
       RowBox[{
        FractionBox["1", "3"], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"\[Rho]temp", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{"1", ";;", 
             FractionBox["leng", "4"]}], ",", 
            RowBox[{"1", ";;", 
             FractionBox["leng", "4"]}]}], "\[RightDoubleBracket]"}], "+", 
          RowBox[{"\[Rho]temp", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{
             RowBox[{
              FractionBox["leng", "4"], "+", "1"}], ";;", 
             FractionBox["leng", "2"]}], ",", 
            RowBox[{
             RowBox[{
              FractionBox["leng", "4"], "+", "1"}], ";;", 
             FractionBox["leng", "2"]}]}], "\[RightDoubleBracket]"}], "+", 
          RowBox[{"\[Rho]temp", "\[LeftDoubleBracket]", 
           RowBox[{
            RowBox[{
             RowBox[{
              FractionBox["leng", "2"], "+", "1"}], ";;", 
             FractionBox[
              RowBox[{"3", " ", "leng"}], "4"]}], ",", 
            RowBox[{
             RowBox[{
              FractionBox["leng", "2"], "+", "1"}], ";;", 
             FractionBox[
              RowBox[{"3", " ", "leng"}], "4"]}]}], 
           "\[RightDoubleBracket]"}]}], ")"}]}]}], ";", 
      RowBox[{
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{
          RowBox[{
           FractionBox["leng", "4"], "+", "1"}], ";;", 
          FractionBox["leng", "2"]}], ",", 
         RowBox[{
          RowBox[{
           FractionBox["leng", "4"], "+", "1"}], ";;", 
          FractionBox["leng", "2"]}]}], "\[RightDoubleBracket]"}], "=", 
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"1", ";;", 
          FractionBox["leng", "4"]}], ",", 
         RowBox[{"1", ";;", 
          FractionBox["leng", "4"]}]}], "\[RightDoubleBracket]"}]}], ";", 
      RowBox[{
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{
          RowBox[{
           FractionBox["leng", "2"], "+", "1"}], ";;", 
          FractionBox[
           RowBox[{"3", " ", "leng"}], "4"]}], ",", 
         RowBox[{
          RowBox[{
           FractionBox["leng", "2"], "+", "1"}], ";;", 
          FractionBox[
           RowBox[{"3", " ", "leng"}], "4"]}]}], "\[RightDoubleBracket]"}], 
       "=", 
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"1", ";;", 
          FractionBox["leng", "4"]}], ",", 
         RowBox[{"1", ";;", 
          FractionBox["leng", "4"]}]}], "\[RightDoubleBracket]"}]}], ";", 
      RowBox[{
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}], ",", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}]}], 
        "\[RightDoubleBracket]"}], "=", 
       RowBox[{"\[Rho]", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}], ",", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}]}], 
        "\[RightDoubleBracket]"}]}], ";", 
      RowBox[{
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{"1", ";;", 
          FractionBox[
           RowBox[{"3", " ", "leng"}], "4"]}], ",", 
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}]}], 
        "\[RightDoubleBracket]"}], "=", 
       RowBox[{
        FractionBox["1", "2"], " ", 
        RowBox[{"\[Rho]", "\[LeftDoubleBracket]", 
         RowBox[{
          RowBox[{"1", ";;", 
           FractionBox[
            RowBox[{"3", " ", "leng"}], "4"]}], ",", 
          RowBox[{
           RowBox[{
            FractionBox[
             RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}]}], 
         "\[RightDoubleBracket]"}]}]}], ";", 
      RowBox[{
       RowBox[{"tempM", "\[LeftDoubleBracket]", 
        RowBox[{
         RowBox[{
          RowBox[{
           FractionBox[
            RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}], ",", 
         RowBox[{"1", ";;", 
          FractionBox[
           RowBox[{"3", " ", "leng"}], "4"]}]}], "\[RightDoubleBracket]"}], 
       "=", 
       RowBox[{
        FractionBox["1", "2"], " ", 
        RowBox[{"ConjugateTranspose", "[", 
         RowBox[{"\[Rho]", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{"1", ";;", 
            FractionBox[
             RowBox[{"3", " ", "leng"}], "4"]}], ",", 
           RowBox[{
            RowBox[{
             FractionBox[
              RowBox[{"3", " ", "leng"}], "4"], "+", "1"}], ";;", "leng"}]}], 
          "\[RightDoubleBracket]"}], "]"}]}]}], ";", "tempM"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReconstructM", "[", "m_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ac", ",", "Hbd"}], "}"}], ",", 
     RowBox[{
      RowBox[{"ac", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", "0", "}"}], ",", 
         RowBox[{"Accumulate", "[", 
          RowBox[{"Length", "/@", "m"}], "]"}]}], "]"}]}], ";", 
      RowBox[{"Hbd", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"0.`", "\[VeryThinSpace]", "+", 
           RowBox[{"0.`", " ", "\[ImaginaryI]"}]}], ")"}], " ", 
         RowBox[{"IdentityMatrix", "[", 
          RowBox[{"Last", "[", "ac", "]"}], "]"}]}], "]"}]}], ";", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Hbd", "\[LeftDoubleBracket]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
             "ac", "\[LeftDoubleBracket]", "n", "\[RightDoubleBracket]"}], 
             "+", "1"}], ";;", 
            RowBox[{"ac", "\[LeftDoubleBracket]", 
             RowBox[{"n", "+", "1"}], "\[RightDoubleBracket]"}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{
             "ac", "\[LeftDoubleBracket]", "n", "\[RightDoubleBracket]"}], 
             "+", "1"}], ";;", 
            RowBox[{"ac", "\[LeftDoubleBracket]", 
             RowBox[{"n", "+", "1"}], "\[RightDoubleBracket]"}]}]}], 
          "\[RightDoubleBracket]"}], "=", 
         RowBox[{
         "m", "\[LeftDoubleBracket]", "n", "\[RightDoubleBracket]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "1", ",", 
          RowBox[{"Length", "[", "m", "]"}]}], "}"}]}], "]"}], ";", 
      RowBox[{"SparseArray", "@", "Hbd"}]}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Loops", "[", 
    RowBox[{"arg_", ",", "l_"}], "]"}], ":=", 
   RowBox[{"Join", "[", 
    RowBox[{"Sequence", "@@", 
     RowBox[{"Table", "[", 
      RowBox[{"arg", ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", "1", ",", "l"}], "}"}]}], "]"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"TraceNormalize", "[", "\[Rho]_", "]"}], ":=", 
    RowBox[{"\[Rho]", "/", 
     RowBox[{"Tr", "[", "\[Rho]", "]"}]}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LvNSolveR", "[", 
    RowBox[{"U1_", ",", "\[Rho]0_", ",", "tf_", ",", "loops_"}], "]"}], ":=", 
   
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Rho]1", ",", "\[Rho]2", ",", "\[Rho]free", ",", "magnetization", ",",
        "state1", ",", "state2", ",", "output", ",", "i", ",", "ri", ",", 
       "Ul1", ",", "Ul2", ",", "Ulfree", ",", "tl", ",", "tlfree", ",", "j", 
       ",", "loopmag", ",", "k", ",", "l", ",", "\[Rho]last", ",", 
       "boundlast", ",", "tflist", ",", "tffree", ",", "m", ",", 
       "\[Rho]lastfree", ",", "boundlastfree", ",", "modkdN", ",", "modkaH", 
       ",", "\[Rho]freetemp", ",", "\[Rho]Traced1", ",", "\[Rho]Traced2", ",",
        "\[Rho]Tracedfree", ",", "\[Rho]H2", ",", "\[Rho]H2temp", ",", 
       "modkdC"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Ul1", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"U1", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tl", "=", 
       RowBox[{"Loops", "[", 
        RowBox[{"tf", ",", "loops"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state1", "=", "\[Rho]0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"magnetization", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "\[LessEqual]", 
         RowBox[{"Length", "[", "tl", "]"}]}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"i", "=", "1"}], ";", 
            RowBox[{"\[Rho]1", "=", "state1"}]}], ",", 
           RowBox[{"i", "\[LessEqual]", 
            RowBox[{
            "tl", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}], 
           ",", 
           RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"\[Rho]1", "=", 
             RowBox[{
              RowBox[{"ConjugateTranspose", "[", 
               RowBox[{
               "Ul1", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}], 
               "]"}], ".", "\[Rho]1", ".", 
              RowBox[{
              "Ul1", "\[LeftDoubleBracket]", "j", 
               "\[RightDoubleBracket]"}]}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"\[Rho]1", "=", 
             RowBox[{"\[Rho]1", "-", 
              RowBox[{
               FractionBox["\[CapitalDelta]t", "1000"], "*", 
               RowBox[{"RedfieldR", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"\[Rho]1", "-", "\[Rho]Finf"}], ")"}], ",", 
                 "relaxOps", ",", "relaxRates"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"magnetization", ",", 
              RowBox[{"Re", "@", 
               RowBox[{"Tr", "[", 
                RowBox[{"\[Rho]1", ".", "OP"}], "]"}]}]}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"state1", "=", "\[Rho]1"}], ";"}]}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"output", "=", "magnetization"}]}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dipolarOps", "[", 
    RowBox[{"n_", ",", "specs_"}], "]"}], ":=", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"-", 
       FractionBox["2", "3"]}], 
      RowBox[{"OperatorNF", "[", 
       RowBox[{"n", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"specs", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "z", ",", 
          RowBox[{"specs", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "z"}], "}"}]}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      FractionBox["1", "6"], 
      RowBox[{"OperatorNF", "[", 
       RowBox[{"n", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"specs", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "p", ",", 
          RowBox[{"specs", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "m"}], "}"}]}], "]"}]}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"OperatorNF", "[", 
      RowBox[{"n", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"specs", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", "m", ",", 
         RowBox[{"specs", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", "p"}], "}"}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"OperatorNF", "[", 
      RowBox[{"n", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"specs", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", "z", ",", 
         RowBox[{"specs", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", "p"}], "}"}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"OperatorNF", "[", 
      RowBox[{"n", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"specs", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", "p", ",", 
         RowBox[{"specs", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", "z"}], "}"}]}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"OperatorNF", "[", 
      RowBox[{"n", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"specs", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", "p", ",", 
         RowBox[{"specs", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", "p"}], "}"}]}], "]"}]}], 
    "\[IndentingNewLine]", "}"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dipolarRate", "[", 
    RowBox[{"n_", 
     RowBox[{"(*", 
      RowBox[{"Hz", "/", "\[Mu]T"}], "*)"}], ",", "r_", 
     RowBox[{"(*", "\[CapitalARing]", "*)"}], ",", "\[Tau]c_", 
     RowBox[{"(*", "ps", "*)"}], ",", "\[Omega]_"}], 
    RowBox[{"(*", "Hz", "*)"}], "]"}], ":=", 
   RowBox[{
    SuperscriptBox[
     RowBox[{"(", 
      RowBox[{"2", "\[Pi]"}], ")"}], "2"], 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       SuperscriptBox[
        RowBox[{"dCoupling", "[", 
         RowBox[{
          RowBox[{"n", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"n", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "r"}], "]"}], "2"], 
       RowBox[{"(", 
        RowBox[{"2", "\[Tau]c", "*", "1*^-12"}], ")"}]}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"dCoupling", "[", 
         RowBox[{
          RowBox[{"n", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"n", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "r"}], "]"}], "2"], 
       RowBox[{"(", 
        FractionBox[
         RowBox[{"2", 
          RowBox[{"(", 
           RowBox[{"\[Tau]c", "*", "1*^-12"}], ")"}]}], 
         RowBox[{"1", "+", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"\[Omega]", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "-", 
               RowBox[{"\[Omega]", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "*", 
             RowBox[{"(", 
              RowBox[{"\[Tau]c", "*", "1*^-12"}], ")"}]}], ")"}], "2"]}]], 
        ")"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"dCoupling", "[", 
         RowBox[{
          RowBox[{"n", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"n", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "r"}], "]"}], "2"], 
       RowBox[{"(", 
        FractionBox[
         RowBox[{"2", 
          RowBox[{"(", 
           RowBox[{"\[Tau]c", "*", "1*^-12"}], ")"}]}], 
         RowBox[{"1", "+", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"\[Omega]", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "-", 
               RowBox[{"\[Omega]", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "*", 
             RowBox[{"(", 
              RowBox[{"\[Tau]c", "*", "1*^-12"}], ")"}]}], ")"}], "2"]}]], 
        ")"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"dCoupling", "[", 
         RowBox[{
          RowBox[{"n", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"n", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "r"}], "]"}], "2"], 
       RowBox[{"(", 
        FractionBox[
         RowBox[{"2", 
          RowBox[{"(", 
           RowBox[{"\[Tau]c", "*", "1*^-12"}], ")"}]}], 
         RowBox[{"1", "+", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             RowBox[{"\[Omega]", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "*", 
             RowBox[{"(", 
              RowBox[{"\[Tau]c", "*", "1*^-12"}], ")"}]}], ")"}], "2"]}]], 
        ")"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"dCoupling", "[", 
         RowBox[{
          RowBox[{"n", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"n", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "r"}], "]"}], "2"], 
       RowBox[{"(", 
        FractionBox[
         RowBox[{"2", 
          RowBox[{"(", 
           RowBox[{"\[Tau]c", "*", "1*^-12"}], ")"}]}], 
         RowBox[{"1", "+", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             RowBox[{"\[Omega]", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "*", 
             RowBox[{"(", 
              RowBox[{"\[Tau]c", "*", "1*^-12"}], ")"}]}], ")"}], "2"]}]], 
        ")"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       SuperscriptBox[
        RowBox[{"dCoupling", "[", 
         RowBox[{
          RowBox[{"n", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"n", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "r"}], "]"}], "2"], 
       RowBox[{"(", 
        FractionBox[
         RowBox[{"2", 
          RowBox[{"(", 
           RowBox[{"\[Tau]c", "*", "1*^-12"}], ")"}]}], 
         RowBox[{"1", "+", 
          SuperscriptBox[
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"\[Omega]", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", 
               RowBox[{"\[Omega]", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "*", 
             RowBox[{"(", 
              RowBox[{"\[Tau]c", "*", "1*^-12"}], ")"}]}], ")"}], "2"]}]], 
        ")"}]}]}], "\[IndentingNewLine]", "}"}]}]}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RedfieldR", "[", 
    RowBox[{"\[Rho]_", ",", "Ak_", ",", "Jk_"}], "]"}], ":=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Jk", "[", 
       RowBox[{"[", "i", "]"}], "]"}], "*", 
      RowBox[{"Commute", "[", 
       RowBox[{
        RowBox[{"Ak", "[", 
         RowBox[{"[", 
          RowBox[{"i", ",", "1"}], "]"}], "]"}], ",", 
        RowBox[{"Commute", "[", 
         RowBox[{
          RowBox[{"Ak", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", "\[Rho]"}], "]"}]}], 
       "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "Ak", "]"}]}], "}"}]}], "]"}]}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Alpha]", "=", 
   RowBox[{"(", GridBox[{
      {"1"},
      {"0"}
     }], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Beta]", "=", 
   RowBox[{"(", GridBox[{
      {"0"},
      {"1"}
     }], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Z", "=", 
   RowBox[{"{", 
    RowBox[{"\[Alpha]", ",", "\[Beta]"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"st", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"\[Alpha]", "\[CircleTimes]", "\[Alpha]"}], ")"}], ",", 
     RowBox[{
      FractionBox["1", 
       SqrtBox["2"]], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[Alpha]", "\[CircleTimes]", "\[Beta]"}], "+", 
        RowBox[{"\[Beta]", "\[CircleTimes]", "\[Alpha]"}]}], ")"}]}], ",", 
     RowBox[{"(", 
      RowBox[{"\[Beta]", "\[CircleTimes]", "\[Beta]"}], ")"}], ",", 
     RowBox[{
      FractionBox["1", 
       SqrtBox["2"]], 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\[Alpha]", "\[CircleTimes]", "\[Beta]"}], "-", 
        RowBox[{"\[Beta]", "\[CircleTimes]", "\[Alpha]"}]}], ")"}]}]}], 
    "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"stinv", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"(", GridBox[{
         {"1"},
         {"0"},
         {"0"},
         {"0"}
        }], ")"}], ",", 
      RowBox[{
       FractionBox["1", 
        SqrtBox["2"]], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", GridBox[{
            {"0"},
            {"1"},
            {"0"},
            {"0"}
           }], ")"}], "+", 
         RowBox[{"(", GridBox[{
            {"0"},
            {"0"},
            {"0"},
            {"1"}
           }], ")"}]}], ")"}]}], ",", 
      RowBox[{
       FractionBox["1", 
        SqrtBox["2"]], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", GridBox[{
            {"0"},
            {"1"},
            {"0"},
            {"0"}
           }], ")"}], "-", 
         RowBox[{"(", GridBox[{
            {"0"},
            {"0"},
            {"0"},
            {"1"}
           }], ")"}]}], ")"}]}], ",", 
      RowBox[{"(", GridBox[{
         {"0"},
         {"0"},
         {"1"},
         {"0"}
        }], ")"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"stinv2", "=", 
    RowBox[{"KetBasis", "[", 
     RowBox[{"{", 
      RowBox[{"stinv", ",", "stinv"}], "}"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"KetBasis", "[", "list_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"iterators", ",", "m", ",", "n"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"iterators", "=", 
       RowBox[{"{", 
        RowBox[{"m", ",", "n"}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Partition", "[", 
       RowBox[{
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"KroneckerProduct", "[", 
              RowBox[{"Sequence", "@@", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"list", "[", 
                   RowBox[{"[", "j", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"iterators", "[", 
                    RowBox[{"[", "j", "]"}], "]"}], "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", "1", ",", 
                   RowBox[{"Length", "@", "list"}]}], "}"}]}], "]"}]}], "]"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"m", ",", "1", ",", 
               RowBox[{"Length", "@", 
                RowBox[{"list", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"n", ",", "1", ",", 
               RowBox[{"Length", "@", 
                RowBox[{"list", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}]}], "]"}], "]"}], 
          ",", "1"}], "]"}], ",", 
        RowBox[{
         RowBox[{"Length", "@", 
          RowBox[{"list", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "*", 
         RowBox[{"Length", "@", 
          RowBox[{"list", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}]}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"KetsPartialTr", "[", 
    RowBox[{"l_", ",", "specs_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "base", ",", "replace", ",", "operator", ",", "length", ",", "q"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"base", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"u", ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "1", ",", "l"}], "}"}]}], "]"}]}], ";", 
      RowBox[{"replace", "=", 
       RowBox[{
        RowBox[{"ReplacePart", "[", 
         RowBox[{"base", ",", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
             "specs", "\[LeftDoubleBracket]", "m", "\[RightDoubleBracket]"}], 
             "\[Rule]", 
             RowBox[{"specs", "\[LeftDoubleBracket]", 
              RowBox[{"m", "+", "1"}], "\[RightDoubleBracket]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "1", ",", 
              RowBox[{
               RowBox[{"Length", "[", "specs", "]"}], "-", "1"}], ",", "2"}], 
             "}"}]}], "]"}]}], "]"}], "/.", "\[VeryThinSpace]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"h\[Alpha]", "\[Rule]", 
           RowBox[{"SparseArray", "[", 
            RowBox[{"(", GridBox[{
               {"1.0"},
               {"0.0"}
              }], ")"}], "]"}]}], ",", 
          RowBox[{"h\[Beta]", "\[Rule]", 
           RowBox[{"SparseArray", "[", 
            RowBox[{"(", GridBox[{
               {"0.0"},
               {"1.0"}
              }], ")"}], "]"}]}], ",", 
          RowBox[{"u", "\[Rule]", 
           RowBox[{"SparseArray", "[", 
            RowBox[{"(", GridBox[{
               {"1.0", "0.0"},
               {"0.0", "1.0"}
              }], ")"}], "]"}]}]}], "}"}]}]}], ";", 
      RowBox[{"operator", "=", 
       RowBox[{"KroneckerProduct", "[", 
        RowBox[{"Sequence", "@@", "replace"}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TraceSystem", "[", 
    RowBox[{"\[Rho]_", ",", "spins_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "n", ",", "permut", ",", "input", ",", "kpt", ",", "\[Rho]red"}], "}"}],
      ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Log2", "[", 
        RowBox[{"Length", "[", "\[Rho]", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"permut", "=", 
       RowBox[{"Permutations", "[", 
        RowBox[{
         RowBox[{"Flatten", "@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"h\[Alpha]", ",", "h\[Beta]"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "1", ",", 
              RowBox[{"Length", "@", "spins"}]}], "}"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"Length", "@", "spins"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"input", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Riffle", "[", 
          RowBox[{"spins", ",", 
           RowBox[{"permut", "[", 
            RowBox[{"[", "n", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "1", ",", 
           RowBox[{"Length", "@", "permut"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kpt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"KetsPartialTr", "[", 
          RowBox[{"n", ",", 
           RowBox[{"input", "[", 
            RowBox[{"[", "m", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "1", ",", 
           RowBox[{"Length", "@", "permut"}]}], "}"}]}], "]"}]}], ";", "\n", 
      "\[IndentingNewLine]", 
      RowBox[{"Total", "@", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"kpt", "[", 
             RowBox[{"[", "m", "]"}], "]"}], "\[Transpose]"}], ".", "\[Rho]", 
           ".", 
           RowBox[{"kpt", "[", 
            RowBox[{"[", "m", "]"}], "]"}]}], "+", 
          RowBox[{
           RowBox[{
            RowBox[{"kpt", "[", 
             RowBox[{"[", 
              RowBox[{"m", "+", "1"}], "]"}], "]"}], "\[Transpose]"}], ".", 
           "\[Rho]", ".", 
           RowBox[{"kpt", "[", 
            RowBox[{"[", 
             RowBox[{"m", "+", "1"}], "]"}], "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "1", ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"Length", "@", "kpt"}], ")"}], "-", "1"}], ",", "2"}], 
          "}"}]}], "]"}]}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GenerateKPT", "[", 
    RowBox[{"\[Rho]_", ",", "spins_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"n", ",", "permut", ",", "input", ",", "kpt"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"Log2", "[", 
        RowBox[{"Length", "[", "\[Rho]", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"permut", "=", 
       RowBox[{"Permutations", "[", 
        RowBox[{
         RowBox[{"Flatten", "@", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"h\[Alpha]", ",", "h\[Beta]"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"m", ",", "1", ",", 
              RowBox[{"Length", "@", "spins"}]}], "}"}]}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"Length", "@", "spins"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"input", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Riffle", "[", 
          RowBox[{"spins", ",", 
           RowBox[{"permut", "[", 
            RowBox[{"[", "n", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"n", ",", "1", ",", 
           RowBox[{"Length", "@", "permut"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"kpt", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"KetsPartialTr", "[", 
          RowBox[{"n", ",", 
           RowBox[{"input", "[", 
            RowBox[{"[", "m", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", "1", ",", 
           RowBox[{"Length", "@", "permut"}]}], "}"}]}], "]"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TraceSystemN", "[", 
    RowBox[{"\[Rho]_", ",", "kptTr_", ",", "kpt_"}], "]"}], ":=", 
   RowBox[{"Total", "[", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
        "kptTr", "\[LeftDoubleBracket]", "m", "\[RightDoubleBracket]"}], ".", 
        "\[Rho]", ".", 
        RowBox[{
        "kpt", "\[LeftDoubleBracket]", "m", "\[RightDoubleBracket]"}]}], "+", 
       
       RowBox[{
        RowBox[{"kptTr", "\[LeftDoubleBracket]", 
         RowBox[{"m", "+", "1"}], "\[RightDoubleBracket]"}], ".", "\[Rho]", 
        ".", 
        RowBox[{"kpt", "\[LeftDoubleBracket]", 
         RowBox[{"m", "+", "1"}], "\[RightDoubleBracket]"}]}]}], ",", 
      RowBox[{"{", 
       RowBox[{"m", ",", "1", ",", 
        RowBox[{
         RowBox[{"Length", "[", "kpt", "]"}], "-", "1"}], ",", "2"}], "}"}]}],
      "]"}], "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AdjM", "[", "m_", "]"}], ":=", 
  RowBox[{"Table", "[", 
   RowBox[{
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"m", "[", 
         RowBox[{"[", 
          RowBox[{"i", ",", "j"}], "]"}], "]"}], "\[NotEqual]", 
        RowBox[{"0.", "+", 
         RowBox[{"0.", " ", "\[ImaginaryI]"}]}]}], "&&", 
       RowBox[{"i", "\[NotEqual]", "j"}]}], ",", "1", ",", "0"}], "]"}], ",", 
    
    RowBox[{"{", 
     RowBox[{"i", ",", "1", ",", 
      RowBox[{"Length", "@", "m"}]}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"j", ",", "1", ",", 
      RowBox[{"Length", "@", "m"}]}], "}"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindSubspaces", "[", "m_", "]"}], ":=", 
   RowBox[{"SortBy", "[", 
    RowBox[{
     RowBox[{"ConnectedComponents", "@", 
      RowBox[{"AdjacencyGraph", "[", 
       RowBox[{"AdjM", "[", "m", "]"}], "]"}]}], ",", "First"}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"AdjM2", "[", "m_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "nzp", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nzp", "=", 
       RowBox[{"m", "[", "\"\<NonzeroPositions\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"SparseArray", "[", 
       RowBox[{
        RowBox[{"nzp", "->", 
         RowBox[{"Table", "[", 
          RowBox[{"1", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "nzp", "]"}]}], "}"}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Length", "[", "m", "]"}], ",", 
          RowBox[{"Length", "[", "m", "]"}]}], "}"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FindSubspacesSparse", "[", "m_", "]"}], ":=", 
   RowBox[{"SortBy", "[", 
    RowBox[{
     RowBox[{"ConnectedComponents", "[", 
      RowBox[{"AdjacencyGraph", "[", 
       RowBox[{"AdjM2", "[", 
        RowBox[{"Chop", "[", "m", "]"}], "]"}], "]"}], "]"}], ",", "First"}], 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BlockDiagonalize", "[", "m_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ac", ",", "Hbd", ",", "subspaces"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"subspaces", "=", 
       RowBox[{"FindSubspaces", "[", "m", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ac", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", "0", "}"}], ",", 
         RowBox[{"Accumulate", "@", 
          RowBox[{"(", 
           RowBox[{"Length", "/@", "subspaces"}], ")"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Hbd", "=", 
       RowBox[{"0.0", " ", 
        RowBox[{"IdentityMatrix", "[", 
         RowBox[{"Last", "@", "ac"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Hbd", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ac", "[", 
               RowBox[{"[", "n", "]"}], "]"}], "+", "1"}], ";;", 
             RowBox[{"ac", "[", 
              RowBox[{"[", 
               RowBox[{"n", "+", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"ac", "[", 
               RowBox[{"[", "n", "]"}], "]"}], "+", "1"}], ";;", 
             RowBox[{"ac", "[", 
              RowBox[{"[", 
               RowBox[{"n", "+", "1"}], "]"}], "]"}]}]}], "]"}], "]"}], "=", 
         RowBox[{"m", "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"subspaces", "[", 
             RowBox[{"[", "n", "]"}], "]"}], ",", 
            RowBox[{"subspaces", "[", 
             RowBox[{"[", "n", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "1", ",", 
          RowBox[{"Length", "@", "subspaces"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "Hbd"}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"BlockDiagO", "[", 
    RowBox[{"m_", ",", "subspaces_"}], "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"m", "[", 
      RowBox[{"[", 
       RowBox[{
        RowBox[{"subspaces", "[", 
         RowBox[{"[", "n", "]"}], "]"}], ",", 
        RowBox[{"subspaces", "[", 
         RowBox[{"[", "n", "]"}], "]"}]}], "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"n", ",", "1", ",", 
       RowBox[{"Length", "@", "subspaces"}]}], "}"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExtractBlocks", "[", "m_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ac", ",", "Hbd", ",", "subspaces"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"subspaces", "=", 
       RowBox[{"FindSubspaces", "[", "m", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ac", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"{", "0", "}"}], ",", 
         RowBox[{"Accumulate", "@", 
          RowBox[{"(", 
           RowBox[{"Length", "/@", "subspaces"}], ")"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"m", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"subspaces", "[", 
            RowBox[{"[", "n", "]"}], "]"}], ",", 
           RowBox[{"subspaces", "[", 
            RowBox[{"[", "n", "]"}], "]"}]}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"n", ",", "1", ",", 
          RowBox[{"Length", "@", "subspaces"}]}], "}"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PartialTr", "[", 
    RowBox[{"\[Rho]in_", ",", "n_"}], "]"}], ":=", 
   RowBox[{"Total", "@", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{"\[Rho]in", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"m", ";;", 
          RowBox[{"m", "+", 
           FractionBox[
            RowBox[{"Length", "[", "\[Rho]in", "]"}], 
            SuperscriptBox["2", "n"]], "-", "1"}]}], ",", 
         RowBox[{"m", ";;", 
          RowBox[{"m", "+", 
           FractionBox[
            RowBox[{"Length", "[", "\[Rho]in", "]"}], 
            SuperscriptBox["2", "n"]], "-", "1"}]}]}], "]"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"m", ",", 
        RowBox[{"Range", "[", 
         RowBox[{"1", ",", 
          RowBox[{"Length", "[", "\[Rho]in", "]"}], ",", 
          FractionBox[
           RowBox[{"Length", "[", "\[Rho]in", "]"}], 
           SuperscriptBox["2", "n"]]}], "]"}]}], "}"}]}], "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"InvertDiagonalization", "[", "subspaces_", "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"SortBy", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Range", "[", 
            RowBox[{"1", ",", 
             RowBox[{"Length", "@", "subspaces"}]}], "]"}], ",", 
           RowBox[{"Flatten", "@", "subspaces"}]}], "}"}], "\[Transpose]"}], 
        ",", "Last"}], "]"}], "\[Transpose]"}], "[", 
     RowBox[{"[", "1", "]"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ZeroFill", "[", "data_", "]"}], ":=", 
   RowBox[{"Join", "[", 
    RowBox[{"data", ",", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"0.", "+", 
        RowBox[{"0.", " ", "I"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"m", ",", "1", ",", 
         RowBox[{"Length", "@", "data"}]}], "}"}]}], "]"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Phase", "[", 
    RowBox[{"data_", ",", "\[Theta]0_"}], "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"data", "[", 
       RowBox[{"[", "t", "]"}], "]"}], 
      RowBox[{"Exp", "[", 
       RowBox[{"I", " ", "\[Theta]0", " ", 
        RowBox[{"\[Pi]", "/", "180."}]}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "1", ",", 
       RowBox[{"Length", "@", "data"}]}], "}"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Apodize", "[", "data_", "]"}], ":=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"data", "\[LeftDoubleBracket]", "t", "\[RightDoubleBracket]"}], 
      " ", 
      RowBox[{"Exp", "[", 
       RowBox[{"-", 
        FractionBox[
         RowBox[{"6", " ", "t"}], "4096"]}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "1", ",", 
       RowBox[{"Length", "[", "data", "]"}]}], "}"}]}], "]"}]}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"LinearPhase", "[", 
    RowBox[{"data1_", ",", "data2_", ",", "deg_", ",", "int_"}], "]"}], ":=", 
   
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"data1", "[", 
        RowBox[{"[", "m", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"Exp", "[", 
         RowBox[{
          FractionBox[
           RowBox[{"I", " ", "\[Pi]"}], "180"], 
          RowBox[{"(", 
           RowBox[{
            FractionBox["deg", "int"], "*", 
            RowBox[{"data1", "[", 
             RowBox[{"[", "m", "]"}], "]"}]}], ")"}]}], "]"}], 
        RowBox[{"data2", "[", 
         RowBox[{"[", "m", "]"}], "]"}]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"m", ",", "1", ",", 
       RowBox[{"Length", "@", "data1"}]}], "}"}]}], "]"}]}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"FT", "[", 
    RowBox[{"data_", ",", "\[Theta]0_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "n", ",", "ft", ",", "specdata", ",", "sr", ",", "freqs", ",", 
       "output"}], "}"}], ",", 
     RowBox[{
      RowBox[{"n", "=", 
       RowBox[{"2", " ", 
        RowBox[{"Length", "[", "data", "]"}]}]}], ";", 
      RowBox[{"sr", "=", "4096.`"}], ";", 
      RowBox[{"freqs", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         FractionBox[
          RowBox[{
           RowBox[{"(", 
            RowBox[{"m", "-", "1"}], ")"}], " ", "sr"}], "n"], ",", 
         RowBox[{"{", 
          RowBox[{"m", ",", 
           RowBox[{
            FractionBox["1", "2"], " ", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"-", "n"}], "+", "4"}], ")"}]}], ",", 
           FractionBox[
            RowBox[{"n", "+", "2"}], "2"]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"ft", "=", 
       RowBox[{"RotateRight", "[", 
        RowBox[{
         RowBox[{"Fourier", "[", 
          RowBox[{
           RowBox[{"ZeroFill", "[", 
            RowBox[{"Apodize", "[", 
             RowBox[{"Phase", "[", 
              RowBox[{"data", ",", "\[Theta]0"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"FourierParameters", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"0", ",", "1"}], "}"}]}]}], "]"}], ",", 
         RowBox[{
          FractionBox["n", "2"], "-", "1"}]}], "]"}]}], ";", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", 
          FractionBox["freqs", "4.0"]}], ",", "ft"}], "}"}], "]"}]}]}], 
    "]"}]}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"searchLiouvillePath", "[", 
    RowBox[{"\[Rho]_", ",", "H_", ",", "order_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "d\[Rho]", ",", "comm", ",", "dProjections", ",", "projections", ",", 
       "dStates", ",", "i", ",", "powerDependences", ",", "initialStates", 
       ",", "pos", ",", "commNorms", ",", "opNorms", ",", "reSort", ",", 
       "fullStates", ",", "pDepTemp", ",", "graphEntries", ",", "graphVals", 
       ",", "reNorm", ",", "reNormOperators", ",", "commG", ",", 
       "powerCorrections", ",", "termsL", ",", "termsLcorrected", ",", 
       "termsR", ",", "termsRcorrected", ",", "activeTerms", ",", 
       "termCount"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"d\[Rho]", "=", 
       RowBox[{"{", 
        RowBox[{"{", "\[Rho]", "}"}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dStates", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"powerDependences", "=", 
       RowBox[{"{", 
        RowBox[{"{", "1", "}"}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"termCount", "=", 
       RowBox[{"{", 
        RowBox[{"{", "1", "}"}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"graphEntries", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", "order"}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"Style", "[", 
           RowBox[{
            RowBox[{"\"\<Derivative \>\"", "<>", 
             RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\<:\>\""}], ",", 
            "Bold"}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"i", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"initialStates", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Rationalize", "@", 
                RowBox[{"Chop", "[", 
                 RowBox[{"Tr", "[", 
                  RowBox[{"\[Rho]", ".", 
                   RowBox[{"LiouvilleOperators", "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "2", ",", 
                 RowBox[{"Length", "@", "LiouvilleOperators"}]}], "}"}]}], 
              "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"dStates", ",", 
              RowBox[{"{", 
               RowBox[{"Total", "[", 
                RowBox[{
                 RowBox[{"stateNamesN", "[", 
                  RowBox[{"[", 
                   RowBox[{"2", ";;"}], "]"}], "]"}], "*", "initialStates"}], 
                "]"}], "}"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"d\[Rho]", ",", 
           RowBox[{"{", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"termCount", ",", 
           RowBox[{"{", "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"dProjections", "=", 
          RowBox[{
          "Table", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"comm", "=", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Chop", "[", 
                 RowBox[{"I", " ", 
                  RowBox[{"Commute", "[", 
                   RowBox[{
                    RowBox[{"d\[Rho]", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "l"}], "]"}], "]"}], ",", 
                    RowBox[{"H", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", ",", "2", ",", "m"}], "]"}], "]"}]}], 
                   "]"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"m", ",", "1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"H", "[", 
                    RowBox[{"[", 
                    RowBox[{"n", ",", "2"}], "]"}], "]"}], "]"}]}], "}"}]}], 
               "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"activeTerms", "=", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"#", "==", 
                   RowBox[{"0", 
                    RowBox[{"IdentityMatrix", "[", 
                    RowBox[{"Length", "[", "\[Rho]", "]"}], "]"}]}]}], ",", 
                  "0", ",", "1"}], "]"}], "&"}], "/@", "comm"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"AppendTo", "[", 
              RowBox[{
               RowBox[{"termCount", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
               RowBox[{"Total", "@", "activeTerms"}]}], "]"}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"comm", "=", 
              RowBox[{"Total", "@", "comm"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"comm", "\[Equal]", 
                RowBox[{"0", 
                 RowBox[{"IdentityMatrix", "[", 
                  RowBox[{"Length", "[", "\[Rho]", "]"}], "]"}]}]}], ",", 
               "None", ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"AppendTo", "[", 
                 RowBox[{
                  RowBox[{"d\[Rho]", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", "comm"}], 
                 "]"}], ";", "\[IndentingNewLine]", 
                RowBox[{"projections", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"Chop", "[", 
                    RowBox[{"Tr", "[", 
                    RowBox[{"comm", ".", 
                    RowBox[{"LiouvilleOperators", "[", 
                    RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"j", ",", "2", ",", 
                    RowBox[{"Length", "@", "LiouvilleOperators"}]}], "}"}]}], 
                  "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"projections", "=", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"#", "\[NotEqual]", "0"}], ",", 
                    RowBox[{
                    RowBox[{"Sign", "[", "#", "]"}], "1"}], ",", "0"}], "]"}],
                    "&"}], "/@", "projections"}]}]}]}], "\[IndentingNewLine]",
               "]"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"{", 
             RowBox[{"l", ",", "1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"d\[Rho]", "[", 
                RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"n", ",", "1", ",", 
              RowBox[{"Length", "@", "H"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"termCount", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "#", "]"}], "\[GreaterEqual]", 
               RowBox[{"Length", "@", "H"}]}], ",", 
              RowBox[{"Partition", "[", 
               RowBox[{"#", ",", 
                RowBox[{"Length", "@", "H"}]}], "]"}], ",", "#"}], "]"}], 
            "&"}], "/@", "termCount"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"fullStates", "=", 
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{"DeleteCases", "[", "Null", "]"}], ",", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"dProjections", "[", 
                  RowBox[{"[", 
                   RowBox[{"l", ",", "m"}], "]"}], "]"}], "//", "ListQ"}], 
                ",", 
                RowBox[{"Total", "[", 
                 RowBox[{
                  RowBox[{"stateNamesN", "[", 
                   RowBox[{"[", 
                    RowBox[{"2", ";;"}], "]"}], "]"}], "*", 
                  RowBox[{"dProjections", "[", 
                   RowBox[{"[", 
                    RowBox[{"l", ",", "m"}], "]"}], "]"}]}], "]"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"l", ",", "1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"d\[Rho]", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"m", ",", "1", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"dProjections", "[", 
                  RowBox[{"[", "l", "]"}], "]"}]}]}], "}"}]}], "]"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"dStates", ",", "fullStates"}], "]"}], ";", 
         StyleBox["\[IndentingNewLine]",
          FontWeight->"Bold"], 
         StyleBox["\[IndentingNewLine]",
          FontWeight->"Bold"], 
         StyleBox[
          RowBox[{"pos", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"DeleteCases", "[", "None", "]"}], "[", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"dProjections", "[", 
                    RowBox[{"[", 
                    RowBox[{"l", ",", "n"}], "]"}], "]"}], "//", "ListQ"}], 
                  ",", "n", ",", "None"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"n", ",", "1", ",", 
                  RowBox[{"Length", "@", 
                   RowBox[{"dProjections", "[", 
                    RowBox[{"[", "l", "]"}], "]"}]}]}], "}"}]}], "]"}], "]"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"l", ",", "1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"d\[Rho]", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}],
          FontWeight->"Bold"], 
         StyleBox[";",
          FontWeight->"Bold"], 
         StyleBox["\[IndentingNewLine]",
          FontWeight->"Bold"], 
         StyleBox["\[IndentingNewLine]",
          FontWeight->"Bold"], 
         StyleBox[
          RowBox[{"pDepTemp", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"H", "\[Transpose]"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", 
                RowBox[{"pos", "[", 
                 RowBox[{"[", "j", "]"}], "]"}]}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", "1", ",", 
               RowBox[{"Length", "@", "pos"}]}], "}"}]}], "]"}]}],
          FontWeight->"Bold"], 
         StyleBox[";",
          FontWeight->"Bold"], 
         StyleBox["\[IndentingNewLine]",
          FontWeight->"Bold"], 
         StyleBox["\[IndentingNewLine]",
          FontWeight->"Bold"], 
         StyleBox[
          RowBox[{"graphVals", "=", "\[IndentingNewLine]", 
           RowBox[{"Join", "@@", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"{", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"Simplify", "[", 
                  RowBox[{"dStates", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"2", "i"}], "-", "1"}], ",", "m"}], 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"indexes", " ", "starting", " ", "state"}], ",", 
                    " ", 
                    RowBox[{"Length", "@", 
                    RowBox[{"dStates", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "i"}], "-", "1"}], "]"}], "]"}]}]}], "*)"}], 
                    "]"}], "]"}], "]"}], "\[Rule]", 
                 RowBox[{"Simplify", "@", 
                  RowBox[{"fullStates", "[", 
                   RowBox[{"[", 
                    RowBox[{"m", ",", "n"}], 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{
                    "number", " ", "of", " ", "terms", " ", "generated", " ", 
                    "from", " ", "that", " ", "starting", " ", "state"}], ",",
                     " ", 
                    RowBox[{"max", " ", "4"}]}], "*)"}], "]"}], "]"}]}]}], 
                ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"pDepTemp", "[", 
                 RowBox[{"[", 
                  RowBox[{"m", ",", "n"}], "]"}], "]"}], ",", 
                "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"dStates", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"2", "i"}], "-", "1"}], ",", "m"}], "]"}], "]"}], 
                    "]"}], "<", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Map", "[", 
                    RowBox[{
                    RowBox[{"DeleteCases", "[", "0", "]"}], ",", 
                    RowBox[{"termCount", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"m", ",", "n"}], "]"}], "]"}], "*", 
                    RowBox[{"Length", "[", 
                    RowBox[{"fullStates", "[", 
                    RowBox[{"[", 
                    RowBox[{"m", ",", "n"}], "]"}], "]"}], "]"}]}], ")"}]}], 
                  ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"Map", "[", 
                    RowBox[{
                    RowBox[{"DeleteCases", "[", "0", "]"}], ",", 
                    RowBox[{"termCount", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"m", ",", "n"}], "]"}], "]"}], ",", 
                  "\[IndentingNewLine]", "1"}], "]"}]}], 
               "\[IndentingNewLine]", "\[IndentingNewLine]", "}"}], ",", 
              "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"m", ",", "1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"dStates", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"2", "i"}], "-", "1"}], "]"}], "]"}], "]"}]}], 
               "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"n", ",", "1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"fullStates", "[", 
                  RowBox[{"[", "m", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}]}],
          
          FontWeight->"Bold"], 
         StyleBox[";",
          FontWeight->"Bold"], 
         StyleBox["\[IndentingNewLine]",
          FontWeight->"Bold"], 
         StyleBox["\[IndentingNewLine]",
          FontWeight->"Bold"], 
         StyleBox[
          RowBox[{"AppendTo", "[", 
           RowBox[{"graphEntries", ",", "graphVals"}], "]"}],
          FontWeight->"Bold"], 
         StyleBox[";",
          FontWeight->"Bold"], 
         StyleBox["\[IndentingNewLine]",
          FontWeight->"Bold"], 
         StyleBox[
          RowBox[{"graphEntries", "=", 
           RowBox[{"DeleteDuplicates", "[", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Flatten", "@", "graphEntries"}], ",", "3"}], "]"}], 
            "]"}]}],
          FontWeight->"Bold"], 
         StyleBox[";",
          FontWeight->"Bold"], 
         StyleBox["\[IndentingNewLine]",
          FontWeight->"Bold"], 
         StyleBox[
          RowBox[{"Print", "[", 
           RowBox[{"\"\<The number of graph terms in derivative \>\"", "<>", 
            RowBox[{"ToString", "[", "i", "]"}], "<>", "\"\< is: \>\"", "<>", 
            
            RowBox[{"ToString", "[", 
             RowBox[{"Length", "[", "graphEntries", "]"}], "]"}]}], "]"}],
          FontWeight->"Bold"], 
         StyleBox[";",
          FontWeight->"Bold"], 
         StyleBox["\[IndentingNewLine]",
          FontWeight->"Bold"], 
         StyleBox["\[IndentingNewLine]",
          FontWeight->"Bold"], 
         RowBox[{"reSort", "=", 
          RowBox[{"GatherBy", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Flatten", "@", "fullStates"}], ",", 
               RowBox[{"Flatten", "@", "pDepTemp"}], ",", 
               RowBox[{"d\[Rho]", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "}"}], 
             "\[Transpose]"}], ",", "First"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"reSort", "=", 
          FractionBox[
           RowBox[{"Total", "/@", "reSort"}], 
           RowBox[{"Length", "/@", "reSort"}]]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"dStates", ",", 
           RowBox[{
            RowBox[{"reSort", "\[Transpose]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{
           StyleBox["powerDependences",
            FontWeight->"Bold"], ",", 
           RowBox[{
            RowBox[{"reSort", "\[Transpose]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"d\[Rho]", "[", 
           RowBox[{"[", 
            RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", 
          RowBox[{
           RowBox[{"reSort", "\[Transpose]"}], "[", 
           RowBox[{"[", "3", "]"}], "]"}]}]}]}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"reNormOperators", "=", 
       RowBox[{
       "ParallelTable", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"termsLcorrected", "=", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Head", "[", 
               RowBox[{
                RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", 
                  RowBox[{"(*", "operator", "*)"}], ",", "j", 
                  RowBox[{"(*", "term", "*)"}], ",", "1"}], 
                 RowBox[{"(*", "lhs", "*)"}], "]"}], "]"}], "]"}], "===", 
              "Plus"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"Total", "@", 
              RowBox[{
              "Table", "[", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"termsL", "=", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"Numerator", "@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Rationalize", "@", "graphEntries"}], 
                    "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "1", 
                    RowBox[{"(*", "lhs", "*)"}], ",", "n"}], "]"}], "]"}], 
                    ")"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "1"}], 
                    RowBox[{"(*", "lhs", "*)"}], "]"}], "]"}], "]"}]}], 
                    "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Union", "[", 
                    RowBox[{"Norm", "/@", 
                    RowBox[{"(", 
                    RowBox[{"termsL", "/.", "opRules"}], ")"}]}], "]"}], 
                    "]"}], "\[Equal]", "1"}], ",", 
                   RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "1", 
                    RowBox[{"(*", "lhs", "*)"}], ",", "m"}], "]"}], "]"}], 
                   ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Norm", "[", 
                    RowBox[{
                    RowBox[{"termsL", "[", 
                    RowBox[{"[", "m", "]"}], "]"}], "/.", "opRules"}], "]"}], 
                    "<", 
                    RowBox[{"Max", "[", 
                    RowBox[{"Norm", "/@", 
                    RowBox[{"(", 
                    RowBox[{"termsL", "/.", "opRules"}], ")"}]}], "]"}]}], 
                    ",", "1", ",", 
                    FractionBox["1", "4"]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"termsL", "[", 
                    RowBox[{"[", "m", "]"}], "]"}], "/", 
                    RowBox[{"Denominator", "[", 
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "1", 
                    RowBox[{"(*", "lhs", "*)"}], ",", "m"}], "]"}], "]"}], 
                    "]"}]}], ")"}]}]}], "]"}]}], "\[IndentingNewLine]", ",", 
                RowBox[{"{", 
                 RowBox[{"m", ",", "1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "1"}], 
                    RowBox[{"(*", "lhs", "*)"}], "]"}], "]"}], "]"}]}], 
                 "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"graphEntries", "\[Transpose]"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", 
                RowBox[{"(*", "operator", "*)"}], ",", "j", 
                RowBox[{"(*", "term", "*)"}], ",", "1"}], 
               RowBox[{"(*", "lhs", "*)"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"termsRcorrected", "=", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Head", "[", 
               RowBox[{
                RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", 
                  RowBox[{"(*", "operator", "*)"}], ",", "j", 
                  RowBox[{"(*", "term", "*)"}], ",", "2"}], 
                 RowBox[{"(*", "rhs", "*)"}], "]"}], "]"}], "]"}], "===", 
              "Plus"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"Total", "@", 
              RowBox[{"Table", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"termsR", "=", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"Numerator", "@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Rationalize", "@", "graphEntries"}], 
                    "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "2", 
                    RowBox[{"(*", "rhs", "*)"}], ",", "n"}], "]"}], "]"}], 
                    ")"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"n", ",", "1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "2"}], 
                    RowBox[{"(*", "rhs", "*)"}], "]"}], "]"}], "]"}]}], 
                    "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Union", "[", 
                    RowBox[{"Norm", "/@", 
                    RowBox[{"(", 
                    RowBox[{"termsR", "/.", "opRules"}], ")"}]}], "]"}], 
                    "]"}], "\[Equal]", "1"}], ",", 
                   RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "2", 
                    RowBox[{"(*", "rhs", "*)"}], ",", "m"}], "]"}], "]"}], 
                   ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Norm", "[", 
                    RowBox[{
                    RowBox[{"termsR", "[", 
                    RowBox[{"[", "m", "]"}], "]"}], "/.", "opRules"}], "]"}], 
                    "<", 
                    RowBox[{"Max", "[", 
                    RowBox[{"Norm", "/@", 
                    RowBox[{"(", 
                    RowBox[{"termsR", "/.", "opRules"}], ")"}]}], "]"}]}], 
                    ",", "1", ",", 
                    FractionBox["1", "4"]}], "]"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"termsR", "[", 
                    RowBox[{"[", "m", "]"}], "]"}], "/", 
                    RowBox[{"Denominator", "[", 
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "2", 
                    RowBox[{"(*", "rhs", "*)"}], ",", "m"}], "]"}], "]"}], 
                    "]"}]}], ")"}]}]}], "]"}]}], "\[IndentingNewLine]", 
                "\[IndentingNewLine]", ",", 
                RowBox[{"{", 
                 RowBox[{"m", ",", "1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "2"}], 
                    RowBox[{"(*", "rhs", "*)"}], "]"}], "]"}], "]"}]}], 
                 "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"graphEntries", "\[Transpose]"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", 
                RowBox[{"(*", "operator", "*)"}], ",", "j", 
                RowBox[{"(*", "term", "*)"}], ",", "2"}], 
               RowBox[{"(*", "rhs", "*)"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"powerCorrections", "=", "\[IndentingNewLine]", 
           RowBox[{"If", "[", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"Identify", " ", "multi"}], "-", 
              RowBox[{"operator", " ", "terms"}]}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Head", "[", 
                RowBox[{
                 RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"1", 
                   RowBox[{"(*", "operator", "*)"}], ",", "j", 
                   RowBox[{"(*", "term", "*)"}], ",", "1"}], 
                  RowBox[{"(*", "lhs", "*)"}], "]"}], "]"}], "]"}], "===", 
               "Plus"}], "\[IndentingNewLine]", "&&", 
              RowBox[{
               RowBox[{"Head", "[", 
                RowBox[{
                 RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"1", 
                   RowBox[{"(*", "operator", "*)"}], ",", "j", 
                   RowBox[{"(*", "term", "*)"}], ",", "2"}], 
                  RowBox[{"(*", "rhs", "*)"}], "]"}], "]"}], "]"}], "===", 
               "Plus"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             
             RowBox[{"(*", 
              RowBox[{
               RowBox[{"Normal", " ", "action", " ", "loop"}], ";", " ", 
               RowBox[{
               "reset", " ", "to", " ", "this", " ", "if", " ", "it", " ", 
                "crashes", " ", "and", " ", "burns"}]}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{"Union", "[", 
                   RowBox[{"Norm", "/@", 
                    RowBox[{"(", 
                    RowBox[{"termsL", "/.", "opRules"}], ")"}]}], "]"}], 
                  "]"}], "\[Equal]", "1"}], "&&", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{"Union", "[", 
                   RowBox[{"Norm", "/@", 
                    RowBox[{"(", 
                    RowBox[{"termsR", "/.", "opRules"}], ")"}]}], "]"}], 
                  "]"}], "\[Equal]", "1"}], "&&", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Norm", "[", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"termsL", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "/.", "opRules"}], ")"}], 
                  "]"}], "<", 
                 RowBox[{"Norm", "[", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"termsR", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "/.", "opRules"}], ")"}], 
                  "]"}]}]}], ",", "\[IndentingNewLine]", 
               FractionBox[
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "j"}], "]"}], "]"}], ">", "1"}], ",", 
                  "2", ",", "1"}], "]"}], "4"], ",", "1"}], "]"}], ",", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Single", " ", "operator", " ", "loop"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "[", 
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "1"}], 
                    RowBox[{"(*", "lhs", "*)"}], "]"}], "]"}], "]"}], "===", 
                   "Times"}], "\[IndentingNewLine]", "\[Or]", 
                  RowBox[{
                   RowBox[{"Head", "[", 
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "1"}], 
                    RowBox[{"(*", "lhs", "*)"}], "]"}], "]"}], "]"}], "===", 
                   "Symbol"}]}], ")"}], "\[IndentingNewLine]", "&&", 
                RowBox[{
                 RowBox[{"Head", "[", 
                  RowBox[{
                   RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "2"}], 
                    RowBox[{"(*", "rhs", "*)"}], "]"}], "]"}], "]"}], "===", 
                 "Plus"}]}], ",", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{"LHS", " ", "single"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Norm", "[", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "1"}], 
                    RowBox[{"(*", "lhs", "*)"}], "]"}], "]"}], "/.", 
                    "opRules"}], ")"}], "]"}], "<", 
                  RowBox[{"Norm", "[", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"termsR", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "/.", "opRules"}], ")"}], 
                   "]"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 FractionBox[
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "j"}], "]"}], "]"}], ">", "1"}], ",", 
                    "2", ",", "1"}], "]"}], "4"], ",", "1"}], "]"}], ",", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"If", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Head", "[", 
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "1"}], 
                    RowBox[{"(*", "lhs", "*)"}], "]"}], "]"}], "]"}], "===", 
                   "Plus"}], "\[IndentingNewLine]", "&&", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Head", "[", 
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "2"}], 
                    RowBox[{"(*", "rhs", "*)"}], "]"}], "]"}], "]"}], "===", 
                    "Times"}], "\[IndentingNewLine]", "\[Or]", 
                    RowBox[{
                    RowBox[{"Head", "[", 
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "2"}], 
                    RowBox[{"(*", "rhs", "*)"}], "]"}], "]"}], "]"}], "===", 
                    "Symbol"}]}], ")"}]}], ",", "\[IndentingNewLine]", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{"RHS", " ", "single"}], "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Norm", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"termsL", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "/.", "opRules"}], ")"}], 
                    "]"}], "<", 
                    RowBox[{"Norm", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "2"}], 
                    RowBox[{"(*", "rhs", "*)"}], "]"}], "]"}], "/.", 
                    "opRules"}], ")"}], "]"}]}], "&&", "\[IndentingNewLine]", 
                    
                    RowBox[{
                    RowBox[{"Norm", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"termsL", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "/.", "opRules"}], ")"}], 
                    "]"}], "\[NotEqual]", 
                    RowBox[{"Norm", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "2"}], 
                    RowBox[{"(*", "rhs", "*)"}], "]"}], "]"}], "/.", 
                    "opRules"}], ")"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
                   FractionBox[
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "j"}], "]"}], "]"}], ">", "1"}], ",", 
                    "2", ",", "1"}], "]"}], "4"], ",", "1"}], "]"}], ",", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{"LHS", " ", "&"}], " ", "RHS", " ", "single"}], 
                  "*)"}], "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Norm", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "1"}], 
                    RowBox[{"(*", "lhs", "*)"}], "]"}], "]"}], "/.", 
                    "opRules"}], ")"}], "]"}], "<", 
                    RowBox[{"Norm", "[", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"1", 
                    RowBox[{"(*", "operator", "*)"}], ",", "j", 
                    RowBox[{"(*", "term", "*)"}], ",", "2"}], 
                    RowBox[{"(*", "rhs", "*)"}], "]"}], "]"}], "/.", 
                    "opRules"}], ")"}], "]"}]}], ",", "\[IndentingNewLine]", 
                   "\[IndentingNewLine]", 
                   FractionBox[
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"graphEntries", "\[Transpose]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "j"}], "]"}], "]"}], ">", "1"}], ",", 
                    "2", ",", "1"}], "]"}], "4"], ",", "1"}], "]"}]}], 
                "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
              "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
            "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"termsLcorrected", "\[Rule]", "termsRcorrected"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"graphEntries", "\[Transpose]"}], "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "j"}], "]"}], "]"}], "powerCorrections"}]}], 
           "}"}]}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"j", ",", "1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{
             RowBox[{"graphEntries", "\[Transpose]"}], "[", 
             RowBox[{"[", "1", 
              RowBox[{"(*", "operator", "*)"}], "]"}], "]"}], "]"}]}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]",
       "     ", 
      RowBox[{"graphEntries", "=", 
       RowBox[{"Rationalize", "@", "reNormOperators"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "graphEntries"}]}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CloseKernels", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Quiet", "@", 
   RowBox[{"LaunchKernels", "[", "16", "]"}]}], ";"}]}], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10001.},
 InitializationCell->True,
 CellChangeTimes->{{3.7251929968840837`*^9, 3.7251931636528482`*^9}, {
   3.72519319796968*^9, 3.725193226676589*^9}, {3.725193265232747*^9, 
   3.725193269984181*^9}, {3.725193303883239*^9, 3.725193440267988*^9}, {
   3.725193480030159*^9, 3.7251935316623344`*^9}, {3.725196529699168*^9, 
   3.7251965329154606`*^9}, {3.725196594873577*^9, 3.7251966014727736`*^9}, 
   3.7251967373023396`*^9, {3.7251968308317137`*^9, 3.7251968846541033`*^9}, {
   3.725197313418698*^9, 3.72519731641212*^9}, {3.7251973604754295`*^9, 
   3.7251973622594643`*^9}, {3.725200190744049*^9, 3.7252001910871263`*^9}, {
   3.7252039341362963`*^9, 3.725203934589837*^9}, 3.7252057179975786`*^9, {
   3.725205793480785*^9, 3.7252058764652033`*^9}, {3.725206188779004*^9, 
   3.725206195905507*^9}, 3.7252070525557632`*^9, {3.7253704755243196`*^9, 
   3.725370497275486*^9}, {3.72537059413927*^9, 3.725370595280249*^9}, {
   3.7256474337547083`*^9, 3.7256474567548065`*^9}, {3.7256477552657356`*^9, 
   3.7256477699240355`*^9}, 3.725648603094802*^9, 3.725648834368967*^9, {
   3.7256503059798837`*^9, 3.7256503257562895`*^9}, 3.725650404211336*^9, {
   3.7256505878117595`*^9, 3.725650610080269*^9}, {3.725650726833579*^9, 
   3.7256507560585423`*^9}, {3.725650952479395*^9, 3.725650990260617*^9}, {
   3.7256518848123417`*^9, 3.7256519276985693`*^9}, {3.7256519657704935`*^9, 
   3.7256519982936635`*^9}, {3.7256520299245467`*^9, 3.72565215506422*^9}, {
   3.72565218853942*^9, 3.725652358297511*^9}, {3.7256527439456434`*^9, 
   3.725652753339388*^9}, {3.725652906704378*^9, 3.7256529290665736`*^9}, {
   3.725653568311653*^9, 3.7256536326695614`*^9}, {3.7256538276880302`*^9, 
   3.7256538734497375`*^9}, {3.725654737080703*^9, 3.7256547505838394`*^9}, 
   3.725655058404484*^9, {3.7258114376330957`*^9, 3.725811472438393*^9}, {
   3.7258115027412443`*^9, 3.7258115337220335`*^9}, {3.7258116194115205`*^9, 
   3.7258116196147766`*^9}, {3.7258123932056856`*^9, 3.725812393890376*^9}, {
   3.7258125878098774`*^9, 3.72581258787234*^9}, {3.725812637392883*^9, 
   3.7258126447694864`*^9}, {3.7265946772788677`*^9, 3.726594677718037*^9}, {
   3.726594752987986*^9, 3.72659480882454*^9}, {3.7265950062677994`*^9, 
   3.726595008408594*^9}, {3.7266109607901382`*^9, 3.726610994396282*^9}, {
   3.726688213239785*^9, 3.726688218882291*^9}, {3.7266882925059876`*^9, 
   3.7266883193568907`*^9}, {3.7266916013732243`*^9, 
   3.7266916215828214`*^9}, {3.726741170766099*^9, 3.726741190474638*^9}, {
   3.7267534179121833`*^9, 3.726753418224721*^9}, {3.7267534981231194`*^9, 
   3.7267535035771475`*^9}, {3.7267555528196917`*^9, 3.7267556235373554`*^9}, 
   3.726755654668933*^9, {3.7267557990266356`*^9, 3.7267558345890675`*^9}, {
   3.7267561324147177`*^9, 3.726756146058316*^9}, {3.7267562522852974`*^9, 
   3.7267562550201793`*^9}, {3.7267564769096537`*^9, 
   3.7267564879319134`*^9}, {3.726756577358172*^9, 3.726756577561454*^9}, {
   3.7267566119598923`*^9, 3.7267566157733965`*^9}, 3.726756680851573*^9, {
   3.72675697369781*^9, 3.7267570113897314`*^9}, {3.7267570823547096`*^9, 
   3.726757085542943*^9}, {3.726757207253981*^9, 3.72675725200842*^9}, {
   3.7272768966947136`*^9, 3.7272769056651506`*^9}, {3.72892926193099*^9, 
   3.7289292627549224`*^9}, {3.7289294324011526`*^9, 3.7289295309420624`*^9}, 
   3.7295848754079523`*^9, {3.729870999142256*^9, 3.7298709997516937`*^9}, {
   3.7298765677347956`*^9, 3.729876569797843*^9}, 3.7298766430805297`*^9, {
   3.7304806264741516`*^9, 3.7304806614610014`*^9}, {3.730487305246891*^9, 
   3.730487311452099*^9}, {3.730487816027953*^9, 3.7304878460199747`*^9}, {
   3.7304879116205425`*^9, 3.7304879480601625`*^9}, {3.7304879822725945`*^9, 
   3.730488017842498*^9}, {3.7304881826162825`*^9, 3.730488297929632*^9}, {
   3.7304883591203833`*^9, 3.730488421689934*^9}, {3.730488557558815*^9, 
   3.7304885668737254`*^9}, {3.730488933807534*^9, 3.7304889454038324`*^9}, {
   3.73048913340835*^9, 3.7304891871790223`*^9}, {3.73048926818808*^9, 
   3.7304893506283174`*^9}, {3.7304905532850237`*^9, 3.730490613277656*^9}, 
   3.730544559665535*^9, {3.730544789273074*^9, 3.7305447965155554`*^9}, {
   3.730544968539253*^9, 3.730544979739575*^9}, {3.7305453615746746`*^9, 
   3.7305455219501143`*^9}, {3.730545614707208*^9, 3.730545614988844*^9}, {
   3.7305459940272217`*^9, 3.7305460933061433`*^9}, {3.7307417555713234`*^9, 
   3.7307417869314365`*^9}, {3.730741885526308*^9, 3.730741928835077*^9}, {
   3.730810134424137*^9, 3.7308101355336733`*^9}, {3.7309806712362785`*^9, 
   3.730980689694396*^9}, {3.731936061759695*^9, 3.731936063072744*^9}, {
   3.732444752716302*^9, 3.732444752999547*^9}, {3.7324453937192144`*^9, 
   3.7324454108791823`*^9}, 3.7324566909522505`*^9, {3.735036381899548*^9, 
   3.7350364253358765`*^9}, {3.7350364590621557`*^9, 3.735036482801744*^9}, {
   3.735036552930643*^9, 3.7350365596859603`*^9}, {3.7350366077936993`*^9, 
   3.7350366456021004`*^9}, 3.735037384437158*^9, {3.736537495430333*^9, 
   3.7365374995713367`*^9}, {3.736540785209429*^9, 3.736540786053306*^9}, {
   3.736541152559082*^9, 3.7365411604670267`*^9}, {3.736541427285494*^9, 
   3.7365414717084255`*^9}, {3.7365851163527465`*^9, 3.736585119273511*^9}, {
   3.7365853366848574`*^9, 3.7365853796610746`*^9}, {3.7365861488320656`*^9, 
   3.7365861502290735`*^9}, {3.736586184256359*^9, 3.7365861870826206`*^9}, {
   3.7366131134642334`*^9, 3.736613159594599*^9}, {3.7366216954810166`*^9, 
   3.7366217044043756`*^9}, {3.736621737053117*^9, 3.736621759014477*^9}, {
   3.7377980764555535`*^9, 3.7377981258219748`*^9}, {3.738068574883181*^9, 
   3.738068583248062*^9}, 3.738068621494748*^9, {3.7380686659262686`*^9, 
   3.7380686924023914`*^9}, 3.7380687258423157`*^9, {3.738068775309495*^9, 
   3.7380688277298574`*^9}, {3.7380717577973137`*^9, 3.738071788414356*^9}, {
   3.738071848353157*^9, 3.7380718501348095`*^9}, {3.7380719252893543`*^9, 
   3.7380720044904737`*^9}, 3.7380721621172175`*^9, {3.738072806454687*^9, 
   3.738072807517333*^9}, {3.738405047796207*^9, 3.738405056226018*^9}, {
   3.738405113666732*^9, 3.7384051381656523`*^9}, {3.7384052135209217`*^9, 
   3.7384052144716597`*^9}, {3.7384053708854513`*^9, 3.73840545666055*^9}, {
   3.738420000021185*^9, 3.7384200471514177`*^9}, {3.7385833930375834`*^9, 
   3.738583401656381*^9}, {3.73859181068773*^9, 3.7385918110709033`*^9}, 
   3.7385918701737013`*^9, 3.738591932815918*^9, 3.738591980063772*^9, 
   3.7390172099420605`*^9, 3.7390173577761345`*^9, {3.7391890792288265`*^9, 
   3.7391891690196943`*^9}, 3.739189322403675*^9, {3.7391897193489323`*^9, 
   3.7391897760557737`*^9}, {3.7391898240169263`*^9, 
   3.7391898520172124`*^9}, {3.739189935465726*^9, 3.739189946350807*^9}, {
   3.7391900067222137`*^9, 3.7391900327310967`*^9}, {3.739190176740201*^9, 
   3.739190186611141*^9}, 3.7391903497495995`*^9, {3.739190476235037*^9, 
   3.7391904810679345`*^9}, {3.7391905228388367`*^9, 3.739190572408798*^9}, {
   3.739190658266624*^9, 3.7391907842704735`*^9}, 3.73919220740763*^9, {
   3.740140517546912*^9, 3.7401405199804354`*^9}, {3.7401447023217897`*^9, 
   3.740144703697529*^9}, {3.740212882575222*^9, 3.740212894425625*^9}, {
   3.740213119694577*^9, 3.740213171575925*^9}, {3.7402134345113754`*^9, 
   3.740213444146101*^9}, {3.740213871789151*^9, 3.7402138928809958`*^9}, {
   3.7402140890689745`*^9, 3.7402141300594816`*^9}, {3.740215040298744*^9, 
   3.7402150712245903`*^9}, {3.7402434090144253`*^9, 3.74024340977219*^9}, {
   3.7402437689784613`*^9, 3.740243863020958*^9}, {3.740300085279253*^9, 
   3.7403001060760965`*^9}, {3.7403002262914977`*^9, 
   3.7403002376314435`*^9}, {3.7403013149061623`*^9, 
   3.7403013164203267`*^9}, {3.740302874775504*^9, 3.7403029028191876`*^9}, {
   3.74030300265812*^9, 3.740303004502187*^9}, {3.740305356597946*^9, 
   3.7403053610985837`*^9}, 3.7403054482965965`*^9, {3.7403199801443243`*^9, 
   3.740319997571447*^9}, {3.740320057954769*^9, 3.7403200580328712`*^9}, {
   3.740393827061059*^9, 3.7403938534995475`*^9}, {3.740394223982289*^9, 
   3.7403942240603924`*^9}, 3.740401216291731*^9, {3.740836733636175*^9, 
   3.7408367972164087`*^9}, {3.740842159206941*^9, 3.7408422496001015`*^9}, {
   3.7408630033041115`*^9, 3.7408630085006003`*^9}, {3.7408637385068407`*^9, 
   3.7408637430514965`*^9}, {3.74086426268272*^9, 3.740864280716691*^9}, {
   3.740864532902051*^9, 3.7408645461216183`*^9}, {3.740864822283517*^9, 
   3.740864824423792*^9}, {3.740905147774215*^9, 3.740905161950801*^9}, 
   3.7409053643509164`*^9, 3.7409057883304596`*^9, 3.7409235115311804`*^9, {
   3.7409243166455584`*^9, 3.74092431757676*^9}, {3.74092520179185*^9, 
   3.7409252048015738`*^9}, {3.740926788683482*^9, 3.7409268057070236`*^9}, {
   3.7409268658632097`*^9, 3.740926867608715*^9}, {3.740926963934576*^9, 
   3.7409269711601686`*^9}, {3.740999078581963*^9, 3.740999084481016*^9}, {
   3.741002634089611*^9, 3.74100263451116*^9}, {3.741003008272811*^9, 
   3.7410030148451653`*^9}, 3.741003065873384*^9, {3.741003204851153*^9, 
   3.741003210806265*^9}, {3.74100385095332*^9, 3.741003894353866*^9}, {
   3.741003985000844*^9, 3.741003985685968*^9}, {3.741004037443651*^9, 
   3.741004038882165*^9}, {3.741004070792248*^9, 3.741004100517828*^9}, {
   3.741004875475029*^9, 3.741004879924686*^9}, {3.7412699783112864`*^9, 
   3.741269983046773*^9}, {3.741270875230288*^9, 3.741270887778961*^9}, 
   3.741270923620794*^9, {3.7413602527774973`*^9, 3.7413603016693487`*^9}, {
   3.7415334011413026`*^9, 3.7415334024385424`*^9}, {3.7415338869907103`*^9, 
   3.741533978605675*^9}, {3.741534010281242*^9, 3.7415340174696836`*^9}, {
   3.7415375282079954`*^9, 3.741537537458893*^9}, {3.7416229090243435`*^9, 
   3.7416229207843037`*^9}, {3.741639516786295*^9, 3.7416395301704006`*^9}, {
   3.741683285125616*^9, 3.741683301103513*^9}, {3.741683413999869*^9, 
   3.7416834191260033`*^9}, {3.7419548583749127`*^9, 3.741954862114157*^9}, 
   3.741956808332403*^9, {3.7419588085380287`*^9, 3.7419588312219615`*^9}, {
   3.7419590442657757`*^9, 3.7419590475475206`*^9}, {3.7419591319084625`*^9, 
   3.7419591326541023`*^9}, {3.7419591979247007`*^9, 3.741959224135935*^9}, {
   3.741959542265205*^9, 3.7419595520160685`*^9}, {3.7419636314552336`*^9, 
   3.741963641409134*^9}, {3.7419978395330305`*^9, 3.7419978435836306`*^9}, {
   3.7420315350582705`*^9, 3.7420315354331512`*^9}, {3.742038235627284*^9, 
   3.742038240251016*^9}, {3.7420386740920253`*^9, 3.74203868798452*^9}, {
   3.7420398025517545`*^9, 3.7420398179032154`*^9}, {3.742040249857929*^9, 
   3.7420402573910294`*^9}, {3.742043629509661*^9, 3.7420436551378174`*^9}, {
   3.742895860223888*^9, 3.7428959014254785`*^9}, {3.7428967952579136`*^9, 
   3.7428968403514357`*^9}, {3.7428974948634806`*^9, 3.742897539927368*^9}, {
   3.7471258916228294`*^9, 3.74712589263861*^9}, {3.7482627536386375`*^9, 
   3.748262767206539*^9}, {3.748463957459921*^9, 3.748463962035986*^9}, {
   3.748464008665965*^9, 3.7484640161755557`*^9}, {3.748464064485465*^9, 
   3.748464064745364*^9}, {3.748464108879333*^9, 3.748464164629627*^9}, 
   3.7484657191891747`*^9, {3.7484785627198973`*^9, 3.748478570123624*^9}, {
   3.7484788348006196`*^9, 3.7484788481272783`*^9}, {3.7487791410791073`*^9, 
   3.7487791461643224`*^9}, 3.7492968643292313`*^9, {3.7493000097862625`*^9, 
   3.7493000111616716`*^9}, {3.749300100484193*^9, 3.749300104898546*^9}, 
   3.749305441258535*^9, 3.749305473772891*^9, {3.7493056843566976`*^9, 
   3.7493057070150476`*^9}, {3.751040293786456*^9, 3.751040314211301*^9}, {
   3.7512811079091234`*^9, 3.751281108719555*^9}, 3.752153926058315*^9, {
   3.752840234822666*^9, 3.752840265425786*^9}, {3.753096790944102*^9, 
   3.753096795819685*^9}, {3.7531016099632063`*^9, 3.7531016150579095`*^9}, {
   3.7531081020360813`*^9, 3.7531081027557125`*^9}, {3.7531081764217796`*^9, 
   3.7531081772500877`*^9}, {3.753108438524683*^9, 3.753108463803309*^9}, {
   3.753111473715972*^9, 3.753111485047442*^9}, 3.7534365981284904`*^9, {
   3.7571972601421013`*^9, 3.7571972970915184`*^9}, {3.7575274107536297`*^9, 
   3.757527411815879*^9}, {3.757782682659882*^9, 3.7577826835419083`*^9}, {
   3.757782828895522*^9, 3.7577828355724497`*^9}, {3.757782917037478*^9, 
   3.75778291709999*^9}, {3.757783476301224*^9, 3.757783476468021*^9}, {
   3.7577835194003053`*^9, 3.757783526296962*^9}, 3.757852306560147*^9, {
   3.759597087049075*^9, 3.759597102436323*^9}, {3.7595971671426077`*^9, 
   3.759597168189286*^9}, {3.7596007072362814`*^9, 3.7596007641585417`*^9}, 
   3.759600932612877*^9, 3.7596009914091797`*^9, {3.759669587710764*^9, 
   3.75966968614598*^9}, {3.7596699293898616`*^9, 3.7596699439397373`*^9}, {
   3.759670143621887*^9, 3.7596701901167803`*^9}, 3.7596706398779926`*^9, {
   3.759670833906576*^9, 3.7596708722432575`*^9}, {3.7599256268540993`*^9, 
   3.7599256786458673`*^9}, {3.7599259692199435`*^9, 3.759926056540118*^9}, 
   3.759926184691838*^9, {3.7599306837898407`*^9, 3.759930709841261*^9}, {
   3.7600036497805867`*^9, 3.760003668315281*^9}, {3.7600958435594234`*^9, 
   3.7600958908133297`*^9}, {3.765803415741145*^9, 3.76580341638166*^9}, {
   3.766133395786786*^9, 3.76613343384698*^9}, {3.768206834026661*^9, 
   3.7682068427511845`*^9}, {3.768299124333563*^9, 3.768299214823773*^9}, {
   3.7687552838837547`*^9, 3.768755305214912*^9}, {3.7687556199674067`*^9, 
   3.768755633863964*^9}, 3.76875572754801*^9, {3.7687557853343925`*^9, 
   3.7687558052506847`*^9}, {3.7687558775202723`*^9, 
   3.7687558785984435`*^9}, {3.768755933926797*^9, 3.768755934666571*^9}, {
   3.7687559965826693`*^9, 3.7687559978966274`*^9}, {3.769094056742191*^9, 
   3.769094085843216*^9}, {3.769094138746907*^9, 3.769094149157819*^9}, {
   3.769100278455956*^9, 3.769100287398057*^9}, {3.769102132782508*^9, 
   3.7691021738885345`*^9}, {3.769104828692668*^9, 3.7691049288495736`*^9}, {
   3.769106066870948*^9, 3.769106075451707*^9}, {3.7691671111570883`*^9, 
   3.769167112016288*^9}, {3.7691675065893993`*^9, 3.7691675353458633`*^9}, {
   3.7692503983029175`*^9, 3.7692503990996113`*^9}, 3.769273059354041*^9, {
   3.769276553260995*^9, 3.7692765691634874`*^9}, {3.769524748445353*^9, 
   3.7695247510234427`*^9}, {3.7695276340964828`*^9, 3.769527813264021*^9}, 
   3.76952786154002*^9, {3.769935727235655*^9, 3.7699357422275963`*^9}, {
   3.769935906011181*^9, 3.7699359095969687`*^9}, {3.770213474959292*^9, 
   3.770213476744622*^9}, {3.770477893597903*^9, 3.7704778948244953`*^9}, {
   3.770479028096427*^9, 3.7704790808764973`*^9}, {3.770893174991284*^9, 
   3.770893175366187*^9}, 3.770972361724961*^9, {3.771006705795025*^9, 
   3.771006705920891*^9}, {3.7710072352610226`*^9, 3.771007243964942*^9}, {
   3.771153440692139*^9, 3.7711534472173505`*^9}, {3.774799224770635*^9, 
   3.7747992267045403`*^9}, {3.7753902016491404`*^9, 
   3.7753902712900405`*^9}, {3.7753909254203*^9, 3.775390937397504*^9}, {
   3.775391872983537*^9, 3.775391882166277*^9}, {3.777028740437317*^9, 
   3.7770287446030164`*^9}, {3.777633478560161*^9, 3.777633502132759*^9}, 
   3.778593968328165*^9, {3.7789299323101025`*^9, 3.7789299473631124`*^9}, 
   3.778946270957981*^9, {3.7793858128029366`*^9, 3.779385812927905*^9}, {
   3.7793859974718037`*^9, 3.7793860031580153`*^9}, {3.779386339528351*^9, 
   3.779386340621904*^9}, {3.779386371067878*^9, 3.7793865543374033`*^9}, {
   3.7793866650287094`*^9, 3.779386665997193*^9}, {3.7794452877719755`*^9, 
   3.7794453138469915`*^9}, {3.7794453455208683`*^9, 3.779445348008556*^9}, {
   3.7794453839159946`*^9, 3.779445385554408*^9}, {3.7794458503680396`*^9, 
   3.7794458712128124`*^9}, 3.779460484450044*^9, 3.7797081769442806`*^9, {
   3.7801370308361125`*^9, 3.7801370603433323`*^9}, {3.780241832169794*^9, 
   3.7802418542450953`*^9}, {3.780764398418844*^9, 3.78076439898728*^9}, {
   3.7807645458639207`*^9, 3.7807645654578943`*^9}, {3.780824541268304*^9, 
   3.7808245418717785`*^9}, {3.7813705704786634`*^9, 3.7813705810783367`*^9}, 
   3.7814341355056458`*^9, {3.781435422868518*^9, 3.781435424441582*^9}, {
   3.7814361637609215`*^9, 3.7814362355000916`*^9}, {3.781436314885541*^9, 
   3.7814363591440783`*^9}, {3.781436401505869*^9, 3.7814364069433813`*^9}, {
   3.7814364686234813`*^9, 3.781436480573145*^9}, {3.7814376274310517`*^9, 
   3.7814376539265614`*^9}, {3.781437768846432*^9, 3.7814377929035077`*^9}, {
   3.781438474037439*^9, 3.7814384758113236`*^9}, {3.7814409662176013`*^9, 
   3.781440981948797*^9}, {3.781543965837682*^9, 3.781543966580264*^9}, 
   3.7818811900935745`*^9, {3.7819690824530835`*^9, 3.781969095326629*^9}, {
   3.7819691324651585`*^9, 3.781969133549287*^9}, {3.7819836535865736`*^9, 
   3.781983653717308*^9}, 3.782036679616623*^9, {3.7821428062351217`*^9, 
   3.7821428558464594`*^9}, {3.782143013188699*^9, 3.7821430137282534`*^9}, {
   3.7821711769326353`*^9, 3.782171178820368*^9}, 3.7821750788034267`*^9, {
   3.782175456534366*^9, 3.782175662409034*^9}, {3.782211657766533*^9, 
   3.7822116615462637`*^9}, {3.782584665154586*^9, 3.7825846653755264`*^9}, {
   3.7827384065919275`*^9, 3.782738415799009*^9}, {3.782738619208006*^9, 
   3.78273863028002*^9}, {3.7828312021668544`*^9, 3.782831203027871*^9}, {
   3.782843081077284*^9, 3.7828430815082364`*^9}, {3.782843387618738*^9, 
   3.7828434075844955`*^9}, 3.7828440921971073`*^9, {3.7828452145600033`*^9, 
   3.782845214715163*^9}, {3.7833493842866325`*^9, 3.783349399565784*^9}, {
   3.7856707340753717`*^9, 3.785670734557575*^9}, 3.7881864237643385`*^9, 
   3.7899182170487585`*^9, {3.7899191007857904`*^9, 3.789919118704794*^9}, {
   3.790864438487217*^9, 3.790864442455991*^9}, {3.790955196626278*^9, 
   3.790955204156351*^9}, {3.7909552836109686`*^9, 3.7909553205691175`*^9}, {
   3.790955986957679*^9, 3.7909559946436377`*^9}, {3.7909562582144213`*^9, 
   3.7909562603219404`*^9}, {3.7909581889253483`*^9, 
   3.7909582254119062`*^9}, {3.7909591278903923`*^9, 3.79095916603976*^9}, {
   3.7909593499196754`*^9, 3.7909593815145807`*^9}, 3.7911307240008297`*^9, {
   3.7911371070037317`*^9, 3.7911371070818615`*^9}, 3.791820491144268*^9, {
   3.7934435420905466`*^9, 3.793443560716073*^9}, {3.794050719998025*^9, 
   3.794050722998107*^9}, {3.79405089523372*^9, 3.794051040918632*^9}, {
   3.7940512521620293`*^9, 3.79405125462714*^9}, {3.797456616049979*^9, 
   3.797456626194595*^9}, {3.7981468039987936`*^9, 3.7981468047208614`*^9}, 
   3.8018270764259105`*^9, {3.8061450484140635`*^9, 3.8061450502417564`*^9}, 
   3.806239118051529*^9, {3.8238987250879593`*^9, 3.8238987324289865`*^9}, {
   3.8358638702403584`*^9, 3.835863870943324*^9}, {3.86352572770564*^9, 
   3.863525728377328*^9}, {3.8635257704396152`*^9, 3.863525802690082*^9}, {
   3.863525866381836*^9, 3.8635258702246885`*^9}, {3.863526970618314*^9, 
   3.863526971243169*^9}, {3.8635283118051677`*^9, 3.8635283136328654`*^9}, {
   3.863528403317979*^9, 3.863528413987361*^9}, {3.863528501138558*^9, 
   3.8635285581878886`*^9}, {3.8635312366026955`*^9, 3.863531241023536*^9}, {
   3.8635319105320168`*^9, 3.8635319106413655`*^9}, {3.863533822164074*^9, 
   3.8635338229139*^9}, {3.8636240632073154`*^9, 3.8636240640040083`*^9}, {
   3.8636835189238014`*^9, 3.863683519595519*^9}, {3.863691014052784*^9, 
   3.8636910317076187`*^9}, {3.863691068466098*^9, 3.863691082429167*^9}, {
   3.8957473661734915`*^9, 3.895747374142106*^9}, {3.895747545073578*^9, 
   3.8957475451985874`*^9}, 3.9005087695771227`*^9, {3.9110398596612988`*^9, 
   3.911039890377739*^9}, 3.911043149838476*^9},
 TextAlignment->Left,
 TextJustification->1,
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 Background->RGBColor[0.88, 1, 0.88],
 CellLabel->
  "In[287]:=",ExpressionUUID->"e75a5971-6f92-43d8-b164-19d5b993a770"]
}, Closed]],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"{", "Null", "}"}], "}"}]], "Output",
 CellChangeTimes->{
  3.915616601674432*^9, 3.9158004951037292`*^9, 3.916238338815317*^9, 
   3.916885347624723*^9, 3.917485020976495*^9, {3.918047393696023*^9, 
   3.91804739789951*^9}, 3.91808745175347*^9, 3.918659334358617*^9, 
   3.9186752987968597`*^9, 3.920501270249761*^9, 3.921750942427984*^9, 
   3.930653935178665*^9, 3.9343714224935417`*^9, 3.938585676818857*^9, 
   3.938648656248569*^9},
 CellLabel->
  "Out[287]=",ExpressionUUID->"e11a1395-498c-42f8-9e31-f0e0e92c65e8"],

Cell[CellGroupData[{

Cell[TextData[StyleBox["Analysis Functions (written by Jake and Shannon)",
 FontSize->24]], "Chapter",
 CellGroupingRules->{"GroupTogetherGrouping", 10003.},
 CellChangeTimes->{{3.900505957185018*^9, 3.900505958128427*^9}, {
   3.90050600145219*^9, 3.90050601023938*^9}, {3.900506063993947*^9, 
   3.9005061439162292`*^9}, {3.900506338058025*^9, 3.900506361365775*^9}, {
   3.9005063940817842`*^9, 3.9005064889292297`*^9}, {3.9005065349550123`*^9, 
   3.900506535537916*^9}, {3.900506588148137*^9, 3.900506646424364*^9}, 
   3.900506925627324*^9, 3.9005072397863283`*^9, 3.900507416031232*^9, {
   3.900508690694935*^9, 3.9005087037221327`*^9}, 3.900508986655126*^9, {
   3.900518941293742*^9, 3.900518944430007*^9}},
 FontSize->24,
 FontWeight->"Regular",
 FontColor->GrayLevel[0],
 Background->RGBColor[
  0.88, 1, 0.88],ExpressionUUID->"1785cd89-c2b8-4bfd-b74a-181634f37583"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"PhasePlot", "[", 
    RowBox[{"data_", ",", "label_", ",", "range_"}], "]"}], ":=", 
   RowBox[{"ListDensityPlot", "[", 
    RowBox[{"data", ",", 
     RowBox[{"ColorFunction", "\[Rule]", "InverseTemp"}], ",", 
     RowBox[{"PlotLegends", "->", "Automatic"}], ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
     RowBox[{"FrameStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Medium", ",", "Black", ",", 
        RowBox[{"FontSize", "\[Rule]", "22"}]}], "]"}]}], ",", 
     RowBox[{"LabelStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Medium", ",", "Black", ",", 
        RowBox[{"FontSize", "\[Rule]", "22"}]}], "]"}]}], ",", 
     RowBox[{"ImageSize", "\[Rule]", "450"}], ",", 
     RowBox[{"FrameLabel", "\[Rule]", "label"}], ",", 
     RowBox[{"DataRange", "\[Rule]", "range"}], ",", 
     RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"JSTPlot", "[", 
    RowBox[{"data_", ",", "label_", ",", "range_"}], "]"}], ":=", 
   RowBox[{"ListDensityPlot", "[", 
    RowBox[{"data", ",", 
     RowBox[{"ColorFunction", "\[Rule]", "RajivTemp"}], ",", 
     RowBox[{"PlotLegends", "->", "Automatic"}], ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
     RowBox[{"FrameStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Medium", ",", "Black", ",", 
        RowBox[{"FontSize", "\[Rule]", "22"}]}], "]"}]}], ",", 
     RowBox[{"LabelStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Medium", ",", "Black", ",", 
        RowBox[{"FontSize", "\[Rule]", "22"}]}], "]"}]}], ",", 
     RowBox[{"ImageSize", "\[Rule]", "450"}], ",", 
     RowBox[{"FrameLabel", "\[Rule]", "label"}], ",", 
     RowBox[{"DataRange", "\[Rule]", "range"}], ",", 
     RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"CoolPhasePlot", "[", 
    RowBox[{"data_", ",", "label_", ",", "range_"}], "]"}], ":=", 
   RowBox[{"ListDensityPlot", "[", 
    RowBox[{"data", ",", 
     RowBox[{"ColorFunction", "\[Rule]", "CoolTemp"}], ",", 
     RowBox[{"PlotLegends", "->", "Automatic"}], ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
     RowBox[{"FrameStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Medium", ",", "Black", ",", 
        RowBox[{"FontSize", "\[Rule]", "22"}]}], "]"}]}], ",", 
     RowBox[{"LabelStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Medium", ",", "Black", ",", 
        RowBox[{"FontSize", "\[Rule]", "22"}]}], "]"}]}], ",", 
     RowBox[{"ImageSize", "\[Rule]", "450"}], ",", 
     RowBox[{"FrameLabel", "\[Rule]", "label"}], ",", 
     RowBox[{"DataRange", "\[Rule]", "range"}], ",", 
     RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TracePlot", "[", 
    RowBox[{"data_", ",", "style_", ",", "label_", ",", "range_"}], "]"}], ":=", 
   RowBox[{"ListLinePlot", "[", 
    RowBox[{"data", ",", 
     RowBox[{"PlotStyle", "\[Rule]", "style"}], ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
     RowBox[{"Frame", "\[Rule]", "True"}], ",", 
     RowBox[{"FrameStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Medium", ",", "Black", ",", 
        RowBox[{"FontSize", "\[Rule]", "22"}]}], "]"}]}], ",", 
     RowBox[{"ImageSize", "\[Rule]", "450"}], ",", 
     RowBox[{"FrameLabel", "\[Rule]", "label"}], ",", 
     RowBox[{"InterpolationOrder", "\[Rule]", "1"}], ",", 
     RowBox[{"DataRange", "\[Rule]", "range"}], ",", 
     RowBox[{"AxesStyle", "\[Rule]", "Black"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TracePlotS", "[", 
    RowBox[{"data_", ",", "style_"}], "]"}], ":=", 
   RowBox[{"TracePlot", "[", 
    RowBox[{"data", ",", "style", ",", 
     RowBox[{"{", 
      RowBox[{
      "\"\<\!\(\*SubscriptBox[\(\[Tau]\), \(p\)]\) (ms)\>\"", ",", 
       "\"\<Polarization \>\""}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "150"}], "}"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PointPlot", "[", 
    RowBox[{"data_", ",", "style_", ",", "label_", ",", "range_"}], "]"}], ":=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{"data", ",", 
     RowBox[{"PlotStyle", "\[Rule]", "style"}], ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
     RowBox[{"Frame", "\[Rule]", "True"}], ",", 
     RowBox[{"FrameStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Medium", ",", "Black", ",", 
        RowBox[{"FontSize", "\[Rule]", "22"}]}], "]"}]}], ",", 
     RowBox[{"ImageSize", "\[Rule]", "450"}], ",", 
     RowBox[{"FrameLabel", "\[Rule]", "label"}], ",", 
     RowBox[{"DataRange", "\[Rule]", "range"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{GridBox[{
    {
     RowBox[{
      RowBox[{"PointPlotLog", "[", 
       RowBox[{"data_", ",", "style_", ",", "label_", ",", "range_"}], "]"}], 
      ":=", 
      RowBox[{"ListPlot", "[", 
       RowBox[{"data", ",", 
        RowBox[{"PlotStyle", "\[Rule]", "style"}], ",", 
        RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
        RowBox[{"Frame", "\[Rule]", "True"}], ",", 
        RowBox[{"FrameStyle", "\[Rule]", 
         RowBox[{"Directive", "[", 
          RowBox[{"Medium", ",", "Black", ",", 
           RowBox[{"FontSize", "\[Rule]", "22"}]}], "]"}]}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "450"}], ",", 
        RowBox[{"FrameLabel", "\[Rule]", "label"}], ",", 
        RowBox[{"DataRange", "\[Rule]", "range"}], ",", 
        RowBox[{"ScalingFunctions", "\[Rule]", "\"\<Log\>\""}]}], "]"}]}]}
   },
   DefaultBaseStyle->"Column",
   GridBoxAlignment->{"Columns" -> {{Left}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SpectrumPlot", "[", "data_", "]"}], ":=", 
   RowBox[{"ListLinePlot", "[", 
    RowBox[{"data", ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
     RowBox[{"Axes", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"True", ",", "False"}], "}"}]}], ",", 
     RowBox[{"AxesOrigin", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"-", "0.1"}]}], "}"}]}], ",", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Thickness", "[", "0.003", "]"}], ",", "Black"}], "}"}]}], 
     ",", 
     RowBox[{"FrameStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Medium", ",", "Black", ",", 
        RowBox[{"FontSize", "\[Rule]", "18"}]}], "]"}]}], ",", 
     RowBox[{"FrameLabel", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"\"\<\[CapitalDelta]\[Omega] (Hz)\>\"", ",", "None"}], "}"}]}],
      ",", 
     RowBox[{"Frame", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"False", ",", "False"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"True", ",", "False"}], "}"}]}], "}"}]}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ErrorPlot", "[", 
    RowBox[{"data_", ",", "label_", ",", "range_"}], "]"}], ":=", 
   RowBox[{"Show", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"PointPlot", "[", 
      RowBox[{"data", ",", "Black", ",", "label", ",", "range"}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"PointPlot", "[", 
      RowBox[{
       RowBox[{"Select1p", "@", "data"}], ",", 
       RowBox[{"RGBColor", "[", 
        RowBox[{"0", ",", "0.63", ",", "0.99"}], "]"}], ",", "label", ",", 
       "range"}], "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"PointPlot", "[", 
      RowBox[{
       RowBox[{"Labeled", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"data", "[", 
           RowBox[{"[", 
            RowBox[{"FindMinimumRMSD", "@", "data"}], "]"}], "]"}], "}"}], 
         ",", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"data", "[", 
             RowBox[{"[", 
              RowBox[{"FindMinimumRMSD", "@", "data"}], "]"}], "]"}], "}"}], 
           "[", 
           RowBox[{"[", "1", "]"}], "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", "Above"}], "]"}], ",", "Red", 
       ",", "label", ",", "Automatic"}], "]"}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PointPlotLog", "[", 
    RowBox[{"data_", ",", "style_", ",", "label_", ",", "range_"}], "]"}], ":=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{"data", ",", 
     RowBox[{"PlotStyle", "\[Rule]", "style"}], ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
     RowBox[{"Frame", "\[Rule]", "True"}], ",", 
     RowBox[{"FrameStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{"Medium", ",", "Black", ",", 
        RowBox[{"FontSize", "\[Rule]", "22"}]}], "]"}]}], ",", 
     RowBox[{"ImageSize", "\[Rule]", "450"}], ",", 
     RowBox[{"FrameLabel", "\[Rule]", "label"}], ",", 
     RowBox[{"DataRange", "\[Rule]", "range"}], ",", 
     RowBox[{"ScalingFunctions", "\[Rule]", "\"\<Log\>\""}]}], "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"InverseTemp", "=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Blend", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Cyan", ",", 
         RowBox[{"Darker", "@", "Blue"}], ",", "Black", ",", "Red", ",", 
         "Yellow"}], "}"}], ",", "#1"}], "]"}], "&"}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RInverseTemp", "=", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Blend", "[", 
      RowBox[{
       RowBox[{"Reverse", "@", 
        RowBox[{"{", 
         RowBox[{"Cyan", ",", 
          RowBox[{"Darker", "@", "Blue"}], ",", "Black", ",", "Red", ",", 
          "Yellow"}], "}"}]}], ",", "#1"}], "]"}], "&"}], ")"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RajivTemp", " ", "=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Blend", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Black", ",", "Black", ",", 
         RowBox[{"Darker", "@", "Blue"}], ",", "Cyan"}], "}"}], ",", "#1"}], 
      "]"}], "&"}], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CoolTemp", " ", "=", " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"Blend", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"Black", ",", 
         RowBox[{"Darker", "@", "Blue"}], ",", "Blue", ",", "Cyan"}], "}"}], 
       ",", "#1"}], "]"}], "&"}], ")"}]}], ";"}]}], "Input",
 CellGroupingRules->{"GroupTogetherGrouping", 10003.},
 InitializationCell->True,
 CellChangeTimes->{{3.736608879570895*^9, 3.7366090418730073`*^9}, {
   3.7366091926766033`*^9, 3.736609262988282*^9}, {3.736609317591874*^9, 
   3.7366095146664286`*^9}, 3.73660962302859*^9, {3.7366096914619102`*^9, 
   3.736609711477086*^9}, {3.7366097780181327`*^9, 3.7366100772789974`*^9}, {
   3.736610169187051*^9, 3.7366103454533615`*^9}, {3.736610528741932*^9, 
   3.7366105986630917`*^9}, {3.7366108081799583`*^9, 
   3.7366108108211775`*^9}, {3.736610867464162*^9, 3.7366109395678864`*^9}, {
   3.7366114557128325`*^9, 3.7366114798911004`*^9}, {3.7366128789130783`*^9, 
   3.7366128791004887`*^9}, {3.7367538564395304`*^9, 3.736753902527609*^9}, {
   3.7367539730339217`*^9, 3.7367539833967443`*^9}, {3.736754025097294*^9, 
   3.7367540352089367`*^9}, {3.7367542052482967`*^9, 3.736754207826903*^9}, {
   3.736759758650467*^9, 3.7367598665413437`*^9}, {3.736759910854789*^9, 
   3.736759957104456*^9}, {3.73676001431604*^9, 3.736760016253742*^9}, {
   3.7367600955532985`*^9, 3.736760100320365*^9}, {3.7367601669966345`*^9, 
   3.7367601764248457`*^9}, {3.736760217497057*^9, 3.736760271412591*^9}, {
   3.736760444962228*^9, 3.736760470362537*^9}, {3.7368057874436774`*^9, 
   3.7368058047429285`*^9}, {3.737195097684106*^9, 3.737195188327313*^9}, {
   3.73719856610166*^9, 3.7371986451088753`*^9}, {3.7385746371788416`*^9, 
   3.738574657018391*^9}, {3.7385846597317386`*^9, 3.738584662710041*^9}, {
   3.738587014585556*^9, 3.7385870164013777`*^9}, {3.7385953034086123`*^9, 
   3.738595303605077*^9}, {3.7386752354842606`*^9, 3.7386752400400305`*^9}, {
   3.7389265715797205`*^9, 3.7389265748757496`*^9}, {3.7397902438362913`*^9, 
   3.73979024430942*^9}, {3.7401422273202133`*^9, 3.7401422317514544`*^9}, {
   3.740142552951745*^9, 3.740142559186805*^9}, {3.7401432877906017`*^9, 
   3.7401433326839476`*^9}, {3.7404152789653597`*^9, 
   3.7404152810278425`*^9}, {3.740415520082746*^9, 3.740415534514215*^9}, {
   3.741084399137154*^9, 3.7410844171472063`*^9}, {3.741101165271413*^9, 
   3.7411012227191677`*^9}, {3.7412716807441635`*^9, 
   3.7412717119422655`*^9}, {3.742981172684987*^9, 3.7429811741849127`*^9}, 
   3.743092310073307*^9, {3.745584750817892*^9, 3.745584778628845*^9}, {
   3.745597462291259*^9, 3.745597479115197*^9}, {3.745853782770392*^9, 
   3.745853783176575*^9}, {3.7462724080280204`*^9, 3.7462724317580576`*^9}, {
   3.7462948924981766`*^9, 3.746294936311205*^9}, 3.7462951424031105`*^9, {
   3.746295237114333*^9, 3.7462952374637585`*^9}, {3.751111762961176*^9, 
   3.751111763251865*^9}, {3.7531237402740793`*^9, 3.75312377850633*^9}, {
   3.760113988330496*^9, 3.7601140396869287`*^9}, {3.768755845608762*^9, 
   3.768755847280674*^9}, {3.7710076741448884`*^9, 3.7710076742733903`*^9}, {
   3.7760761805647554`*^9, 3.77607618061961*^9}, {3.780158004909073*^9, 
   3.780158005224269*^9}, 3.7815266416833878`*^9, 3.7815441689915543`*^9, {
   3.7900747127177863`*^9, 3.790074712965103*^9}, 3.796990792898414*^9, {
   3.797094017438097*^9, 3.7970940281454897`*^9}, {3.7981956440214777`*^9, 
   3.798195653609828*^9}, {3.8130616615873947`*^9, 3.8130616618412457`*^9}, 
   3.8636204904611254`*^9, 3.8636207516184645`*^9, {3.863690996849002*^9, 
   3.863691002178586*^9}, 3.9005089866554203`*^9, {3.908281413041727*^9, 
   3.9082814504655046`*^9}, {3.908457345718512*^9, 3.9084574254037733`*^9}, {
   3.908457609505259*^9, 3.908457609930525*^9}, {3.908458953222602*^9, 
   3.9084589553807*^9}},
 TextAlignment->Left,
 TextJustification->1,
 FontFamily->"Source Sans Pro",
 FontSize->16,
 FontWeight->"Regular",
 Background->RGBColor[0.88, 1, 0.88],
 CellLabel->
  "In[364]:=",ExpressionUUID->"4a56f409-53df-44b8-b858-76e2570b0c5f"]
}, Closed]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1256, 911},
WindowMargins->{{Automatic, 158}, {Automatic, 0}},
TaggingRules->Association["TryRealOnly" -> False],
SpellingDictionaries->{"CorrectWords"->{
 "Raman", "Rajiv", "Lindale", "metabonomics", "heteronuclei", "Brinnae", 
  "hyperpolarize"}},
FrontEndVersion->"12.3 for Mac OS X x86 (64-bit) (July 9, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"95d5bbc4-c176-424f-a7a0-5d9f4285510d"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 266, 4, 98, "Title",ExpressionUUID->"304f5765-109a-4cbf-953b-37d160345bfa"],
Cell[849, 28, 439, 10, 149, "Subtitle",ExpressionUUID->"a887d431-9759-47e8-ad93-93d4401927b1"],
Cell[CellGroupData[{
Cell[1313, 42, 202, 4, 69, "Chapter",ExpressionUUID->"a5c3189b-d446-48d5-ae53-e35d28b53d90"],
Cell[1518, 48, 2745, 43, 587, "Text",ExpressionUUID->"47c06549-c1fc-457a-8b9c-813a7ee2d643"]
}, Closed]],
Cell[CellGroupData[{
Cell[4300, 96, 160, 3, 58, "Chapter",ExpressionUUID->"178b57ac-9fcf-4af4-87c5-bc695b7132ca"],
Cell[CellGroupData[{
Cell[4485, 103, 756, 17, 85, "Subsection",ExpressionUUID->"d11f4a5f-e484-4594-8fc5-aaffe3dc5dac"],
Cell[5244, 122, 14278, 287, 956, "Input",ExpressionUUID->"cf03b436-3128-443e-a34f-9fc2138cb00f"],
Cell[19525, 411, 6765, 128, 332, "Input",ExpressionUUID->"b5af20c1-bd13-4328-a710-51160cd95b10"],
Cell[26293, 541, 1395, 31, 97, "Input",ExpressionUUID->"e7fd64f1-3173-4c30-9ca5-22512210a1e6"],
Cell[27691, 574, 5799, 113, 404, "Input",ExpressionUUID->"6678d03c-60b1-4ba7-85c2-ecff1d0f0632"],
Cell[33493, 689, 6864, 125, 308, "Input",ExpressionUUID->"e0d34ab5-8960-4a3b-968f-09f085a76ce0"],
Cell[40360, 816, 3918, 76, 212, "Input",ExpressionUUID->"a3c1030e-364a-4bc2-83e2-7edb261f0c13",
 CellGroupingRules->{"GroupTogetherGrouping", 10005.}],
Cell[44281, 894, 9766, 194, 913, "Input",ExpressionUUID->"396cd895-3518-4daf-9dd2-d7b795632577"],
Cell[54050, 1090, 6257, 138, 407, "Input",ExpressionUUID->"64a24b2b-daa5-46b6-9699-41916b3f8a3d"],
Cell[60310, 1230, 7481, 149, 498, "Input",ExpressionUUID->"15023cc4-d951-481c-ab39-d0958e758908"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[67840, 1385, 158, 3, 69, "Chapter",ExpressionUUID->"574db862-bd9c-4e54-bea9-5a6f4a9aa45a"],
Cell[CellGroupData[{
Cell[68023, 1392, 264, 5, 30, "Input",ExpressionUUID->"72c4e47d-408c-4ac0-835e-e693d26f458d"],
Cell[68290, 1399, 423, 7, 34, "Output",ExpressionUUID->"6afe363f-413e-4ea9-b049-00416ecc7401"]
}, Open  ]],
Cell[68728, 1409, 3119, 72, 221, "Input",ExpressionUUID->"943d7a27-eecd-44c1-8ec8-e59156ff679c"],
Cell[CellGroupData[{
Cell[71872, 1485, 241, 5, 30, "Input",ExpressionUUID->"c98b50b9-bd05-4791-8e6a-136dfbdddc86"],
Cell[72116, 1492, 213, 4, 34, "Output",ExpressionUUID->"b39f5124-07e9-4332-ae01-836921ad9f89"]
}, Open  ]],
Cell[72344, 1499, 869, 24, 30, "Input",ExpressionUUID->"633f1931-bb4c-4a3c-b563-935de7b5e240"],
Cell[CellGroupData[{
Cell[73238, 1527, 787, 16, 30, "Input",ExpressionUUID->"4d8ed523-101e-4f6d-84f4-ecde39c08ec4"],
Cell[74028, 1545, 3014, 71, 319, "Output",ExpressionUUID->"830763f8-9f83-4d5e-9635-03e2f1fb8fcb"]
}, Open  ]],
Cell[CellGroupData[{
Cell[77079, 1621, 1353, 24, 30, "Input",ExpressionUUID->"ac5b875d-79f2-473c-b0f0-4b7373855d37"],
Cell[78435, 1647, 214, 4, 34, "Output",ExpressionUUID->"9a1320ef-bc2b-4d5c-8c01-06a7af5e02ff"]
}, Open  ]],
Cell[CellGroupData[{
Cell[78686, 1656, 568, 12, 30, "Input",ExpressionUUID->"c11108fe-c03f-48ed-bcc1-d441a9854055"],
Cell[79257, 1670, 498, 8, 34, "Output",ExpressionUUID->"9bb6275b-0e7c-4db6-8f65-fa05f6d69288"]
}, Open  ]],
Cell[79770, 1681, 3888, 89, 298, "Input",ExpressionUUID->"473a157c-f14f-4e72-8ac8-9e7cb6a9c612"],
Cell[83661, 1772, 294, 7, 30, "Input",ExpressionUUID->"02912ffa-4d70-4fdb-9b96-324a11929df1"],
Cell[CellGroupData[{
Cell[83980, 1783, 318, 8, 30, "Input",ExpressionUUID->"ba3f16eb-55c0-408c-9b4e-f43ac1d2cee3"],
Cell[84301, 1793, 205, 3, 34, "Output",ExpressionUUID->"00e808ef-756c-42e8-af86-fa8810f17996"]
}, Open  ]],
Cell[84521, 1799, 3896, 88, 287, "Input",ExpressionUUID->"f6923071-d557-459c-ac38-58b7bbd26071"],
Cell[88420, 1889, 352, 8, 30, "Input",ExpressionUUID->"beb6a614-2b73-4541-8d8b-962364884953"],
Cell[88775, 1899, 717, 20, 30, "Input",ExpressionUUID->"e3c9b428-a191-41d2-808c-70f07d3a0c8a"],
Cell[89495, 1921, 1247, 34, 30, "Input",ExpressionUUID->"9fdfdc91-40f1-4c62-a751-712348c54ef5"],
Cell[CellGroupData[{
Cell[90767, 1959, 425, 10, 30, "Input",ExpressionUUID->"d4d89c69-80cb-401d-ada2-4ed5fa5c2a58"],
Cell[91195, 1971, 181, 3, 34, "Output",ExpressionUUID->"51a880ab-eb40-460c-b9a5-848dc6bae96c"]
}, Open  ]],
Cell[91391, 1977, 4092, 88, 299, "Input",ExpressionUUID->"33e2f13f-b16c-4121-89da-a8953482032e"],
Cell[95486, 2067, 347, 8, 30, "Input",ExpressionUUID->"49ab5e2f-e5da-4084-a23f-87bf2e92cf51"],
Cell[CellGroupData[{
Cell[95858, 2079, 318, 8, 30, "Input",ExpressionUUID->"e2b70bf9-ea53-4644-a3fb-ac1ba286a793"],
Cell[96179, 2089, 183, 3, 34, "Output",ExpressionUUID->"4121a072-bff2-491a-8b55-268415e25889"]
}, Open  ]],
Cell[96377, 2095, 4246, 93, 278, "Input",ExpressionUUID->"f42b1c03-eb11-4614-825b-1254704f0895"],
Cell[100626, 2190, 420, 9, 30, "Input",ExpressionUUID->"bbdea9a3-6d65-42d6-a14b-33cef58f2c98"],
Cell[CellGroupData[{
Cell[101071, 2203, 369, 9, 30, "Input",ExpressionUUID->"2634b05e-16fa-4e9f-9ea3-b756e3b367ce"],
Cell[101443, 2214, 181, 3, 34, "Output",ExpressionUUID->"219bc614-1673-49c4-94d4-fe5559b426a0"]
}, Open  ]],
Cell[101639, 2220, 3724, 88, 278, "Input",ExpressionUUID->"80a7b658-119c-4620-8c89-b580f4cd9360"],
Cell[105366, 2310, 471, 10, 30, "Input",ExpressionUUID->"cb2a4ac1-51f8-4edb-8389-2b5bbef38d2f"],
Cell[CellGroupData[{
Cell[105862, 2324, 418, 10, 30, "Input",ExpressionUUID->"994db34f-6a07-477e-be99-e303be88ed5a"],
Cell[106283, 2336, 181, 3, 57, "Output",ExpressionUUID->"2a11690d-4d35-4105-8caa-c62fcfca4c96"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[106513, 2345, 739, 14, 87, "Chapter",ExpressionUUID->"13c91605-e72d-407d-b93b-a55b405c9d93"],
Cell[107255, 2361, 1089, 18, 76, "Text",ExpressionUUID->"0b278a87-8e8d-4958-857a-b6202b445119",
 CellGroupingRules->{"GroupTogetherGrouping", 10000.}],
Cell[CellGroupData[{
Cell[108369, 2383, 638, 12, 72, "Chapter",ExpressionUUID->"80b55f5f-f82d-4c01-abcb-d55ba7826525",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[109010, 2397, 809, 20, 34, "Input",ExpressionUUID->"9044995d-6b21-4e14-b27e-385a1c2ea5e0",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[109822, 2419, 654, 11, 36, "Text",ExpressionUUID->"8170ed69-07ec-447e-b2af-0fd5f7a84a81",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[110479, 2432, 1299, 31, 34, "Input",ExpressionUUID->"6d59fa3a-469c-4ffb-afaa-08ff90ca4e42",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[111781, 2465, 1341, 36, 38, "Text",ExpressionUUID->"f34f0080-33da-407d-99f6-bc2954b9bfe1",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[113125, 2503, 5425, 110, 340, "Input",ExpressionUUID->"6262355d-7a7e-4b85-82b9-0a7577d355c1",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[118553, 2615, 1329, 37, 64, "Text",ExpressionUUID->"de74281e-7d22-467d-ba72-04158d639b1e",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[119885, 2654, 23843, 497, 1047, "Input",ExpressionUUID->"2692444d-2ae6-4503-8f41-cbd91505ab7e",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[143731, 3153, 667, 11, 36, "Text",ExpressionUUID->"07a3bbc4-6e52-4339-8e19-21050495c3c1",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[144401, 3166, 4069, 97, 392, "Input",ExpressionUUID->"23e4b4bf-70e7-41be-8fcd-469a7a6473af",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[148473, 3265, 4031, 96, 328, "Input",ExpressionUUID->"7360b8e0-7e36-43f7-9159-62b4432ad909",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[152507, 3363, 614, 11, 36, "Text",ExpressionUUID->"53b9e7d7-3d02-47b9-8e7c-3df5c5fc797e",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[153124, 3376, 22751, 502, 1021, "Input",ExpressionUUID->"4ad30a52-c327-4903-b4d5-d5232ba99f44",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[175878, 3880, 719, 17, 34, "Input",ExpressionUUID->"363accc3-8a15-4c94-9f1b-ebb25e577b48",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[176600, 3899, 828, 19, 34, "Input",ExpressionUUID->"d0533bd4-5e09-480b-a6b6-7df65d111d27",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[177431, 3920, 909, 20, 34, "Input",ExpressionUUID->"f318d244-ace9-4494-a167-a26d71344396",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[178343, 3942, 1221, 29, 34, "Input",ExpressionUUID->"89d6cb66-a359-4caf-8a91-4e118bd7c81d",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[179567, 3973, 2267, 47, 34, "Input",ExpressionUUID->"43fb2404-e221-4015-b474-e18fd1fae7ee",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[181837, 4022, 1393, 33, 34, "Input",ExpressionUUID->"76783028-d8bd-4f60-b6c9-a3b12f63d44c",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[183233, 4057, 1528, 34, 34, "Input",ExpressionUUID->"ffdeae15-a439-4197-bb83-9df20bd62ee2",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[184764, 4093, 770, 17, 34, "Input",ExpressionUUID->"08f6e6ab-b033-4dd8-9edc-a3dae8ef378c",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[185537, 4112, 1697, 43, 120, "Input",ExpressionUUID->"ab84127b-e226-4a08-9f63-9cf14d63c8fb",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[187237, 4157, 3871, 84, 165, "Input",ExpressionUUID->"889ef677-d88d-49bc-a983-572a38944da1",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[191111, 4243, 1824, 47, 139, "Input",ExpressionUUID->"33e7099c-e9f5-4c6d-86fe-e41cbd76e3c5",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[192938, 4292, 1422, 33, 57, "Input",ExpressionUUID->"92d32430-5627-4c27-a225-e93623f7510e",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[194363, 4327, 1240, 29, 34, "Input",ExpressionUUID->"34344d3b-b2d9-42f7-8082-48a046623c23",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[195606, 4358, 3138, 78, 89, "Input",ExpressionUUID->"ebae434a-887b-49fc-9c47-86907735db4a",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[198747, 4438, 2896, 72, 269, "Input",ExpressionUUID->"499d0dc8-0b1f-495c-ab66-286b8bac8e02",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[201646, 4512, 2446, 59, 331, "Input",ExpressionUUID->"86dd1f48-96ec-4b9c-962e-99af82577aab",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[204095, 4573, 2609, 55, 217, "Input",ExpressionUUID->"6cff9846-1c24-4894-b208-b1f4d58471dd",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[206707, 4630, 2598, 56, 217, "Input",ExpressionUUID->"83fcca06-6e13-4a9d-a480-8d945be2ded7",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[209308, 4688, 13812, 306, 555, "Input",ExpressionUUID->"83a7f6e5-02ea-44cb-bee3-f20f28ed3df7",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[223123, 4996, 5429, 122, 572, "Input",ExpressionUUID->"2b4fd6c0-d4f6-424a-b845-91b0e5a48cb5",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[228555, 5120, 4025, 87, 217, "Input",ExpressionUUID->"4c7baac0-2b7c-416a-b6b4-0b7f8152f12d",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[232583, 5209, 13323, 330, 1061, "Input",ExpressionUUID->"160e7eea-cd8d-419e-8a7e-3af47c9225d6",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[245909, 5541, 851, 20, 54, "Input",ExpressionUUID->"ee3d7721-cd28-4748-a60a-ad85b1a31aa2",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[246763, 5563, 610, 16, 49, "Input",ExpressionUUID->"d55bedb8-8592-4830-bdf9-efd3319a67ab",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[247376, 5581, 9188, 223, 722, "Input",ExpressionUUID->"27a9a475-a59a-46fd-8c65-54ec4d01e7ba",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[256567, 5806, 9358, 237, 702, "Input",ExpressionUUID->"ed2cf405-dc0f-41c2-b22b-2bf97822e167",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[265928, 6045, 9227, 236, 702, "Input",ExpressionUUID->"b668ca8d-e1dc-4be5-88ba-34dd8a59fa2c",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[275158, 6283, 9094, 222, 697, "Input",ExpressionUUID->"f7073153-7689-4998-9ea5-d69415b78e1f",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[284255, 6507, 20117, 463, 2019, "Input",ExpressionUUID->"57b3e728-2728-4025-ad12-ff204ec0c834",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[304375, 6972, 1251, 31, 34, "Input",ExpressionUUID->"2168007a-bba5-49f4-b98e-f00f4938b368",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[305629, 7005, 1020, 27, 52, "Input",ExpressionUUID->"5fd5d118-3a93-4cdb-b85f-c1801c41b5cf",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[306652, 7034, 1311, 32, 34, "Input",ExpressionUUID->"cb2f0189-dbf8-45a3-92c3-33633d912f7c",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[307966, 7068, 1123, 27, 36, "Input",ExpressionUUID->"5a009af1-c158-4dd4-98a0-dbf5181638f5",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[309092, 7097, 2280, 47, 113, "Input",ExpressionUUID->"bbe6f365-18c5-4165-95cb-8bcbee3692c6",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[311375, 7146, 2069, 48, 87, "Input",ExpressionUUID->"c9c7aee0-6501-4a4b-b3b4-d3dacdf186fa",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[313447, 7196, 2296, 55, 87, "Input",ExpressionUUID->"92e9d14d-8b4a-41c5-a4a4-c314736154e5",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[315746, 7253, 729, 18, 34, "Input",ExpressionUUID->"55b0a844-6e2a-451f-9b0b-3d28ee1fbc86",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[316478, 7273, 2520, 64, 347, "Input",ExpressionUUID->"eddc831d-9390-4ee9-80db-02e3671aa45a",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[319001, 7339, 6664, 157, 683, "Input",ExpressionUUID->"4679aaf0-a8a4-4404-aff3-0a979de4f459",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[325668, 7498, 17306, 424, 1668, "Input",ExpressionUUID->"c5b2fdf2-5b86-48c0-b1ac-aad404f29253",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[342977, 7924, 8220, 208, 634, "Input",ExpressionUUID->"e14ad085-8a96-413d-852b-fa01d9853b78",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[351200, 8134, 2661, 57, 120, "Input",ExpressionUUID->"9591084c-447e-4dc9-9333-424042a546d2",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[353864, 8193, 2571, 65, 152, "Input",ExpressionUUID->"e97f879f-d841-42aa-9078-5c9b69cdb3e0",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[356438, 8260, 17665, 431, 1706, "Input",ExpressionUUID->"89e34077-c5d1-4899-8b3c-f3172084fa68",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[374106, 8693, 20607, 444, 1504, "Input",ExpressionUUID->"dad7735e-3e03-410d-973f-36f8024eb4eb",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[394716, 9139, 2281, 56, 131, "Input",ExpressionUUID->"c0efde7f-3ec9-43be-bea2-3afe56c10da8",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[397000, 9197, 25199, 581, 1946, "Input",ExpressionUUID->"97bd99b7-7f34-4813-9bd1-7c3a841d649c",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[422202, 9780, 21589, 471, 1388, "Input",ExpressionUUID->"6234e170-3c6f-4c7b-a151-a420ce28efc6",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[443794, 10253, 21532, 471, 1388, "Input",ExpressionUUID->"d4947b96-9f24-4bc8-b1be-409a44320aa0",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[465329, 10726, 21838, 474, 1388, "Input",ExpressionUUID->"f5b41ece-2430-40ba-94c3-b294f9563d83",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[487170, 11202, 24426, 529, 1929, "Input",ExpressionUUID->"8eb53fe3-94bd-4a74-acb9-adf23c5f4ecb",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[511599, 11733, 17205, 360, 1127, "Input",ExpressionUUID->"f809d2f8-8c20-4057-92df-d6d3bab65e81",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[528807, 12095, 22338, 486, 1481, "Input",ExpressionUUID->"913ff889-5d49-4088-8b4d-4121b206d6a7",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[551148, 12583, 22285, 486, 1481, "Input",ExpressionUUID->"e7f25c41-4e30-44b1-aae8-25b73de75ae2",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[573436, 13071, 25769, 555, 2059, "Input",ExpressionUUID->"30eb5cae-c786-45a5-adad-c7ba046306ec",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[599208, 13628, 42770, 945, 3402, "Input",ExpressionUUID->"1991b57c-edfb-45a8-8cfa-bec71af81f26",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}],
Cell[641981, 14575, 1321, 32, 178, "Input",ExpressionUUID->"3c98e503-a649-4457-a026-ff42e8e458e1",
 CellGroupingRules->{"GroupTogetherGrouping", 10002.}]
}, Closed]],
Cell[CellGroupData[{
Cell[643339, 14612, 871, 15, 61, "Chapter",ExpressionUUID->"62c3735b-9c17-4e25-839a-e3bf29ee491d",
 CellGroupingRules->{"GroupTogetherGrouping", 10001.}],
Cell[644213, 14629, 244117, 5862, 22641, "Input",ExpressionUUID->"e75a5971-6f92-43d8-b164-19d5b993a770",
 CellGroupingRules->{"GroupTogetherGrouping", 10001.},
 InitializationCell->True]
}, Closed]],
Cell[888345, 20494, 560, 11, 33, "Output",ExpressionUUID->"e11a1395-498c-42f8-9e31-f0e0e92c65e8"],
Cell[CellGroupData[{
Cell[888930, 20509, 878, 15, 72, "Chapter",ExpressionUUID->"1785cd89-c2b8-4bfd-b74a-181634f37583",
 CellGroupingRules->{"GroupTogetherGrouping", 10003.}],
Cell[889811, 20526, 14489, 326, 943, "Input",ExpressionUUID->"4a56f409-53df-44b8-b858-76e2570b0c5f",
 CellGroupingRules->{"GroupTogetherGrouping", 10003.},
 InitializationCell->True]
}, Closed]]
}, Open  ]]
}, Open  ]]
}
]
*)

